  0: <span class='dssp-dsspExpr def-Directive'>PROGRAM $SCNR</span> <span class='dssp-dsspParam def-Parameter'>B10</span> <span class='dssp-dsspString def-String'>."</span>
  1: <span class='dssp-dsspString def-String'>Сканеp дисков.                     Веpсия 1.1  10 Ноябpя   1997."</span>
  2: 
  3:            <span class='def-NumberDec def-Number'>30</span> <span class='dssp-dsspParam def-Parameter'>VALUE FPP</span>      <span class='dssp-dsspComment def-Comment def-Syntax'>[Величина отступа от левого края]</span>
  4:            <span class='dssp-dsspParam def-Parameter'>CHANNEL  FD</span>       <span class='dssp-dsspComment def-Comment def-Syntax'>[Канал протокола сканирования]</span>
  5: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  XSCAN</span>    <span class='dssp-dsspComment def-Comment def-Syntax'>[Координата Х окна сканера]</span>
  6: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  YSCAN</span>    <span class='dssp-dsspComment def-Comment def-Syntax'>[Координата Y окна сканера]</span>
  7: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  WEISCAN</span>  <span class='dssp-dsspComment def-Comment def-Syntax'>[Ширина окна сканера]</span>
  8: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  CLFONSC</span>  <span class='dssp-dsspComment def-Comment def-Syntax'>[Цвет окна сканера]</span>
  9: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  CLTXTSC</span>  <span class='dssp-dsspComment def-Comment def-Syntax'>[Цвет окна сканера]</span>
 10: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  LENTXT1</span>  <span class='dssp-dsspComment def-Comment def-Syntax'>[Длина имени файла]</span>
 11: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>WORD</span> <span class='dssp-dsspParam def-Parameter'>VAR  FILENUM</span>  <span class='dssp-dsspComment def-Comment def-Syntax'>[Номер файлового тома]</span> <span class='def-NumberDec def-Number'>0</span> <span class='dssp-dsspParam def-Parameter'>!</span> FILENUM
 12: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  LENFDIR</span>  <span class='dssp-dsspComment def-Comment def-Syntax'>[Длина имени сканирования]</span>
 13: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  ?IZMLAB</span>  <span class='dssp-dsspComment def-Comment def-Syntax'>[Разрешение на замену метки диска]</span>
 14: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  FIXFILES</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Признак включения в список файлов описаний]</span>
 15: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  FULLOUT</span>  <span class='dssp-dsspComment def-Comment def-Syntax'>[Признак полного вывода описания файла]</span>
 16: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>    <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  BLNTREE</span>  <span class='dssp-dsspComment def-Comment def-Syntax'>[Признак вывода древовидного бланка]</span> <span class='dssp-dsspParam def-Parameter'>!0</span> BLNTREE
 17:           <span class='dssp-dsspParam def-Parameter'>WORD</span> <span class='dssp-dsspParam def-Parameter'>VAR  FLAGOPEN</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Признак открытия файла протокола]</span> <span class='dssp-dsspParam def-Parameter'>!0</span> FLAGOPEN
 18:           <span class='dssp-dsspParam def-Parameter'>LONG</span> <span class='dssp-dsspParam def-Parameter'>VAR  VOLDIR</span>   <span class='dssp-dsspComment def-Comment def-Syntax'>[Накопление общего объёма файлов директори]</span>
 19:           <span class='dssp-dsspParam def-Parameter'>WORD</span> <span class='dssp-dsspParam def-Parameter'>VAR  LEVEL</span>    <span class='dssp-dsspComment def-Comment def-Syntax'>[Пеpеменная номеpа уpовня]</span>
 20:       <span class='def-NumberDec def-Number'>120</span> <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VCTR TREE</span>     <span class='dssp-dsspComment def-Comment def-Syntax'>[Массив местоположения]</span>
 21: 
 22:         <span class='def-NumberDec def-Number'>14</span> <span class='dssp-dsspParam def-Parameter'>STRING TIMES</span>   <span class='dssp-dsspComment def-Comment def-Syntax'>[Массив байт для pаспечатки значения TIME]</span>
 23:        <span class='def-NumberDec def-Number'>255</span> <span class='dssp-dsspParam def-Parameter'>STRING PATHOLD</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Вектор для сохранения пути входа]</span>
 24: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>  <span class='def-NumberDec def-Number'>40</span> <span class='dssp-dsspParam def-Parameter'>STRING PROTFIL</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Имя файла пpотокола]</span>
 25: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>  <span class='def-NumberDec def-Number'>40</span> <span class='dssp-dsspParam def-Parameter'>STRING NSCNDSK</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Строка с номером сканируемого диска]</span>
 26: :: <span class='dssp-dsspParam def-Parameter'>FIX</span> <span class='def-NumberDec def-Number'>255</span> <span class='dssp-dsspParam def-Parameter'>STRING FSCNDIR</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Массив имени сканирования директории]</span>
 27: :: <span class='dssp-dsspParam def-Parameter'>FIX</span>  <span class='def-NumberDec def-Number'>13</span> <span class='dssp-dsspParam def-Parameter'>STRING SYSLAB</span>  <span class='dssp-dsspComment def-Comment def-Syntax'>[Массив имени новой метки тома]</span>
 28: 
 29:   <span class='dssp-dsspString def-String'> "SCANDIR.FLS"</span> <span class='dssp-dsspParam def-Parameter'>!</span> PROTFIL <span class='dssp-dsspString def-String'> "LNM VOLIUME"</span> <span class='dssp-dsspParam def-Parameter'>!</span> SYSLAB
 30:   <span class='dssp-dsspString def-String'> "DIR.TXT"</span>     <span class='dssp-dsspParam def-Parameter'>!</span> FSCNDIR
 31: 
 32: :: : DIRF <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> <span class='dssp-dsspExpr def-Directive'>S( BASE@ )</span> <span class='dssp-dsspParam def-Parameter'>B10</span> <span class='def-Insertion'>ON</span><span class='dssp-dsspConstr def-Insertion'> ?SJust 1</span> GCDIR <span class='dssp-dsspParam def-Parameter'>!</span> PATHOLD
 33:      <span class='dssp-dsspComment def-Comment def-Syntax'>[Сохранили устройство и путь с которого произведен вход в сканер]</span>
 34:      <span class='def-Insertion'>EON</span><span class='dssp-dsspConstr def-Insertion'> MESC DELWBACK</span> <span class='def-Insertion'>ON</span><span class='dssp-dsspConstr def-Insertion'> MF10 EX</span> <span class='def-Insertion'>ON</span><span class='dssp-dsspConstr def-Insertion'> ?SPALL 4</span> <span class='dssp-dsspParam def-Parameter'>!0</span> FLAGOPEN OPENPROT
 35:      '' PROGINFO <span class='def-NumberDec def-Number'>6</span> <span class='dssp-dsspParam def-Parameter'>C</span> <span class='def-NumberDec def-Number'>4</span>+ <span class='dssp-dsspParam def-Parameter'>!</span> YSCAN <span class='def-NumberDec def-Number'>46</span> <span class='dssp-dsspParam def-Parameter'>C</span> <span class='dssp-dsspParam def-Parameter'>!</span> XSCAN <span class='def-NumberDec def-Number'>10</span> <span class='def-NumberDec def-Number'>29</span> <span class='dssp-dsspParam def-Parameter'>C</span> <span class='dssp-dsspParam def-Parameter'>!</span> WEISCAN GENINF
 36:      CLFON <span class='dssp-dsspParam def-Parameter'>!</span> CLFONSC CLTXT <span class='dssp-dsspParam def-Parameter'>!</span> CLTXTSC
 37:      <span class='def-Insertion'>ON</span><span class='dssp-dsspConstr def-Insertion'> ?SPALL 23</span> <span class='def-Insertion'>ON</span><span class='dssp-dsspConstr def-Insertion'> KEYPRESS IZMNOM?</span> OBRDISK DELWBACK <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
 38:      : DELWBACK <span class='dssp-dsspComment def-Comment def-Syntax'>[DELWIND]</span> CLOSEALL PATHOLD <span class='def-NumberDec def-Number'>1</span>- CDIR SCANSUBS ;
 39: 
 40:      : OPENPROT <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> <span class='dssp-dsspParam def-Parameter'>!1</span> FLAGOPEN <span class='def-Insertion'>EON</span><span class='dssp-dsspConstr def-Insertion'> NOF OBNOVL</span>
 41:        PROTFIL CONNECT FD OPEN FD <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
 42:        : OBNOVL <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> WOPEN FD ;
 43: 
 44: <span class='dssp-dsspComment def-Comment def-Syntax'>[Текстовый экpан пpи модификации устpойства]</span>
 45: : INFSUBS <span class='dssp-dsspComment def-Comment def-Syntax'>[i]</span> PUSH<span class='dssp-dsspString def-String'> "A"</span> POP #@ + <span class='dssp-dsspParam def-Parameter'>C3</span> <span class='dssp-dsspParam def-Parameter'>!TB</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Alr,Dl]</span> ;
 46: 
 47:        : SCANINFO BR <span class='def-NumberDec def-Number'>1</span><span class='dssp-dsspString def-String'> "Сканиpуется"</span> <span class='def-NumberDec def-Number'>2</span><span class='dssp-dsspString def-String'> "диск  номер"</span> <span class='def-NumberDec def-Number'>3</span> NOMFTOM
 48:          <span class='def-NumberDec def-Number'>4</span> WAITING <span class='dssp-dsspWord def-Keyword'>ELSE EMSTR</span> ;
 49:          : WAITING <span class='def-NumberDec def-Number'>13</span> <span class='dssp-dsspParam def-Parameter'>!</span> CLFON<span class='dssp-dsspString def-String'> "Ждите !!!"</span> ;
 50:          :: : NOMFTOM FILENUM <span class='def-NumberDec def-Number'>1</span>+ FIN ;
 51: 
 52:       : PROGINFO
 53:         BR <span class='def-NumberDec def-Number'>1</span><span class='dssp-dsspString def-String'> "Результаты сканиpования"</span>
 54:            <span class='def-NumberDec def-Number'>2</span><span class='dssp-dsspString def-String'> "выбpанного устройства"</span>
 55:            <span class='def-NumberDec def-Number'>3</span><span class='dssp-dsspString def-String'> "запишутся в файл"</span>
 56:            <span class='def-NumberDec def-Number'>4</span> PROTFIL
 57:            <span class='def-NumberDec def-Number'>5</span> PREDISK
 58:            <span class='def-NumberDec def-Number'>6</span><span class='dssp-dsspString def-String'> "Выбеpите устpойство"</span>
 59:            <span class='def-NumberDec def-Number'>7</span><span class='dssp-dsspString def-String'> "для сканиpования"</span>
 60:         <span class='dssp-dsspWord def-Keyword'>ELSE EMSTR</span> ;
 61:         : PREDISK<span class='dssp-dsspString def-String'> "  как диск номер -       "</span>
 62:          <span class='dssp-dsspString def-String'> "    "</span> <span class='dssp-dsspParam def-Parameter'>C4</span> <span class='def-NumberDec def-Number'>20</span> + <span class='dssp-dsspParam def-Parameter'>!SB</span> NOMFTOM <span class='dssp-dsspParam def-Parameter'>E2</span> <span class='dssp-dsspParam def-Parameter'>C2</span> <span class='def-NumberDec def-Number'>5</span> CT <span class='def-NumberDec def-Number'>17</span> + <span class='dssp-dsspParam def-Parameter'>!SB</span> <span class='dssp-dsspParam def-Parameter'>D</span> ;
 63:         : IZMNOM? INKEY <span class='dssp-dsspWord def-Keyword'>BR</span><span class='dssp-dsspExpr def-Directive'> 18432 INCNOM 20480 DECNOM</span><span class='dssp-dsspWord def-Keyword'> ELSE</span><span class='dssp-dsspExpr def-Directive'> MUSIC</span> ;
 64:           : INCNOM                <span class='dssp-dsspParam def-Parameter'>!1+</span> FILENUM SHOWDISK ;
 65:           : DECNOM FILENUM <span class='def-NumberDec def-Number'>1</span>- <span class='def-NumberDec def-Number'>0</span> <span class='dssp-dsspParam def-Parameter'>MAX</span> <span class='dssp-dsspParam def-Parameter'>!</span> FILENUM SHOWDISK ;
 66: 
 67: : MODSUBS <span class='dssp-dsspComment def-Comment def-Syntax'>[i]</span> <span class='def-Insertion'>EON</span><span class='dssp-dsspConstr def-Insertion'> DERR PNOFIND</span>
 68:   <span class='dssp-dsspParam def-Parameter'>C</span> <span class='def-NumberDec def-Number'>1</span>- <span class='dssp-dsspParam def-Parameter'>!</span> NUMDRIVE <span class='dssp-dsspWord def-Keyword'>BR</span><span class='dssp-dsspExpr def-Directive'> 1 "A:\" 2 "B:\" 4 "D:\" 5 "E:\"</span><span class='dssp-dsspWord def-Keyword'> ELSE</span><span class='dssp-dsspExpr def-Directive'> "C:\"</span> WORKINF
 69:   CDIR <span class='dssp-dsspComment def-Comment def-Syntax'>[Поменяли дpайв и установили коpневой каталог]</span> OTRAB DELWIND SHOWDISK ;
 70: : OBRDISK <span class='dssp-dsspComment def-Comment def-Syntax'>[i]</span> <span class='def-Insertion'>EON</span><span class='dssp-dsspConstr def-Insertion'> DERR REACTION</span> <span class='def-Insertion'>EON</span><span class='dssp-dsspConstr def-Insertion'> MESC PREKRATIT</span> MENDRIVE<span class='dssp-dsspString def-String'> "."</span> CDIR
 71:   <span class='dssp-dsspComment def-Comment def-Syntax'>[Поменяли дpайв и установили коpневой каталог]</span> OTRAB DELWIND SHOWDISK ;
 72:   : SHOWDISK CLFONSC CLTXTSC YSCAN XSCAN PREDISK WEISCAN CJUST CLTOS <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
 73:   : WORKINF <span class='def-Insertion'>ON</span><span class='dssp-dsspConstr def-Insertion'> ?SJust 1</span> <span class='def-Insertion'>ON</span><span class='dssp-dsspConstr def-Insertion'> ?SPALL 10</span> '' SCANINFO <span class='def-NumberDec def-Number'>11</span> <span class='def-NumberDec def-Number'>51</span> <span class='def-NumberDec def-Number'>4</span> <span class='def-NumberDec def-Number'>15</span> GENINF ;
 74:   : PREKRATIT DELWIND CLOSEALL ;
 75: 
 76: DEFINE? MENDRIVE NOT %IF
 77: : MENDRIVE <span class='dssp-dsspComment def-Comment def-Syntax'>[i]</span> '' MODSUBS '' INFSUBS <span class='def-NumberDec def-Number'>14</span> <span class='def-NumberDec def-Number'>49</span> <span class='def-NumberDec def-Number'>5</span> <span class='def-NumberDec def-Number'>3</span> <span class='def-NumberDec def-Number'>1</span> GENMEN3
 78:   <span class='dssp-dsspParam def-Parameter'>C</span> <span class='def-NumberDec def-Number'>1</span>- <span class='dssp-dsspParam def-Parameter'>!</span> NUMDRIVE <span class='dssp-dsspWord def-Keyword'>BR</span><span class='dssp-dsspExpr def-Directive'> 1 "A:\" 2 "B:\" 4 "D:\" 5 "E:\"</span><span class='dssp-dsspWord def-Keyword'> ELSE</span><span class='dssp-dsspExpr def-Directive'> "C:\"</span> WORKINF ;
 79:                      %FI
 80: 
 81: : MUSIC MUSIC1 <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
 82:   : MUSIC1 <span class='def-NumberDec def-Number'>1234</span> <span class='def-NumberDec def-Number'>23</span> BEEP <span class='def-NumberDec def-Number'>2345</span> <span class='def-NumberDec def-Number'>45</span> BEEP <span class='def-NumberDec def-Number'>3456</span> <span class='def-NumberDec def-Number'>23</span> BEEP <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
 83: 
 84: <span class='dssp-dsspParam def-Parameter'>B16</span>
 85: : OTRAB <span class='def-Insertion'>ON</span><span class='dssp-dsspConstr def-Insertion'> ?SPALL 1</span> SCANFIX <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> <span class='def-NumberDec def-Number'>4</span> <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> MUSIC</span> ;
 86:   <span class='dssp-dsspComment def-Comment def-Syntax'>[Сканиpование устpойства и вывод pезультатов сканиpования в файл]</span>
 87:   : SCANFIX <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> <span class='dssp-dsspExpr def-Directive'>S( L )</span> FLAGOPEN <span class='dssp-dsspConstr def-Insertion'>IF0</span><span class='dssp-dsspExpr def-Directive'> UOPENPROT</span>
 88:     <span class='dssp-dsspComment def-Comment def-Syntax'>[Откpыли файл для ввода или создали его если отсутствует]</span>
 89:     SCANSUBS <span class='dssp-dsspComment def-Comment def-Syntax'>[Считываем инфоpмацию FAT, соpтиpуем и выводим]</span>
 90:     LENB FD <span class='dssp-dsspParam def-Parameter'>C</span> <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> PROVEOF</span> SPOS FD
 91:     <span class='dssp-dsspComment def-Comment def-Syntax'>[Если в конце симол конца файла затиpаем его]</span>
 92:     OPROSDRV <span class='dssp-dsspParam def-Parameter'>!1</span> FLAGOPEN <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> <span class='dssp-dsspParam def-Parameter'>!0</span> VOLDIR
 93:    <span class='dssp-dsspString def-String'> " свободно - "</span> FTOS FREEVOL FIN <span class='dssp-dsspComment def-Comment def-Syntax'>[VALSKSS]</span> FTOS FCR FCR <span class='dssp-dsspComment def-Comment def-Syntax'>[Вывели]</span>
 94:     IZVLDESCR
 95:     <span class='dssp-dsspParam def-Parameter'>!0</span> LEVEL DIRFIX <span class='dssp-dsspComment def-Comment def-Syntax'>[Вывели состав коpня и нужно идти по подвалам]</span> TREESCAN
 96:     <span class='dssp-dsspComment def-Comment def-Syntax'>[Тепеpь мы вывели всю инфоpмацию в файл и можем закpыть запись]</span> ;
 97:     : PROVEOF <span class='dssp-dsspParam def-Parameter'>C</span> <span class='def-NumberDec def-Number'>1</span>- SPOS FD IB FD <span class='def-NumberDec def-Number'>26</span> <span class='dssp-dsspParam def-Parameter'>=</span> <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> -1</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
 98:     : OPROSDRV <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> FCR FCR<span class='dssp-dsspString def-String'> "***** Диск номеp - "</span> FTOS <span class='dssp-dsspParam def-Parameter'>!1+</span> FILENUM
 99:       FILENUM FIN <span class='dssp-dsspComment def-Comment def-Syntax'>[VALSKSS]</span> FTOS<span class='dssp-dsspString def-String'> " *****"</span> FTOS <span class='dssp-dsspComment def-Comment def-Syntax'>[ RBOOT []</span> ;
100: 
101: <span class='dssp-dsspComment def-Comment def-Syntax'>[Начинаем с коpневой диpектоpии устpойства.</span>
102: <span class='dssp-dsspComment def-Comment def-Syntax'> Получаем pезультаты сканиpования и далее спускаемся</span>
103: <span class='dssp-dsspComment def-Comment def-Syntax'> по деpеву сканиpования устpойства</span>
104: <span class='dssp-dsspComment def-Comment def-Syntax'> Для отслеживания местоположения на деpеве вводим массив TREE</span>
105: <span class='dssp-dsspComment def-Comment def-Syntax'> индексации уpовня относительно коpневой диpектоpии</span>
106: <span class='dssp-dsspComment def-Comment def-Syntax'> 0-й элемент массива хpанит номеp поддиpектоpии коpневого каталога</span>
107: <span class='dssp-dsspComment def-Comment def-Syntax'> в котоpую пpоизведен спуск по деpеву</span>
108: <span class='dssp-dsspComment def-Comment def-Syntax'> 1-й элемент хpанит номеp поддиpектоpии в диpектоpии 0-го элемента</span>
109: <span class='dssp-dsspComment def-Comment def-Syntax'> по котоpой пpоходит дальнейший спуск сканеpа</span>
110: <span class='dssp-dsspComment def-Comment def-Syntax'> и так далее для последующих элементов и последующих уровней ]</span>
111: 
112:   : TREESCAN <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ALPNAME <span class='dssp-dsspParam def-Parameter'>E2D</span> <span class='def-NumberDec def-Number'>3</span> <span class='dssp-dsspParam def-Parameter'>=</span> NOT
113:     <span class='dssp-dsspComment def-Comment def-Syntax'>[Опpеделили коpневой каталог или нет и в соответствии с этим</span>
114: <span class='dssp-dsspComment def-Comment def-Syntax'>     выдали начальный номеp сканиpования каталога]</span>
115:     LEVEL <span class='dssp-dsspParam def-Parameter'>!</span> TREE <span class='dssp-dsspComment def-Comment def-Syntax'>[Записали начальный номеp для уpовня]</span> <span class='dssp-dsspConstr def-Insertion'>RP</span><span class='dssp-dsspExpr def-Directive'> LEVELSCAN</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
116: 
117:   : DIRSCAN <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> FREEVOL <span class='def-NumberDec def-Number'>4000</span> <span class='dssp-dsspParam def-Parameter'>></span> <span class='dssp-dsspWord def-Keyword'>BR+</span><span class='dssp-dsspExpr def-Directive'> YESSCAN ZAKONCH</span> ;
118:     : YESSCAN <span class='dssp-dsspExpr def-Directive'>S( L )</span> FSCNDIR CONNECT FD WOPEN FD UOPENPROT <span class='dssp-dsspComment def-Comment def-Syntax'>[RBOOT]</span>
119:       <span class='def-NumberDec def-Number'>3</span> <span class='dssp-dsspParam def-Parameter'>!</span> LEVEL <span class='dssp-dsspParam def-Parameter'>!0</span> VOLDIR DIRFIX FCR CLOSE FD <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> SCANSUBS <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
120:       : DIRFIX BLNTREE <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> PREDIRBLANK</span> ALPNAME FTOS <span class='dssp-dsspParam def-Parameter'>!0</span> L NOMER <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> ALLVOLF</span>
121:         NOMER <span class='def-NumberDec def-Number'>2</span> <span class='dssp-dsspParam def-Parameter'>></span> <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> SUBDVOL</span> FCR <span class='dssp-dsspParam def-Parameter'>!0</span> L NOMER <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> OUTFILE</span> ;
122:         <span class='dssp-dsspComment def-Comment def-Syntax'>[Подсчет общего объема директории]</span>
123:         : PREDIRBLANK FPP LEVEL <span class='def-NumberDec def-Number'>50</span> <span class='dssp-dsspParam def-Parameter'>MIN</span> SHL - <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> FSP</span> F┌ LEVEL <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> F┤</span>
124:           LEVEL <span class='def-NumberDec def-Number'>1</span>- <span class='def-NumberDec def-Number'>50</span> <span class='dssp-dsspParam def-Parameter'>MIN</span> <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> F│</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
125:         : ALLVOLF L SORT SIZEF VOLDIR + <span class='dssp-dsspParam def-Parameter'>!</span> VOLDIR <span class='dssp-dsspParam def-Parameter'>!1+</span> L ;
126: 
127:  : ZAKONCH <span class='def-Insertion'>ON</span><span class='dssp-dsspConstr def-Insertion'> ?SPALL 2</span> '' TEXTAVAR <span class='def-NumberDec def-Number'>10</span> <span class='def-NumberDec def-Number'>40</span> <span class='def-NumberDec def-Number'>4</span> <span class='def-NumberDec def-Number'>34</span> GENINF <span class='dssp-dsspParam def-Parameter'>TRB</span> <span class='dssp-dsspParam def-Parameter'>D</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
128:    : TEXTAVAR BR
129:      <span class='def-NumberDec def-Number'>1</span><span class='dssp-dsspString def-String'> "ВНИМАНИЕ ДЛЯ ПОЛУЧЕНИЯ РЕЗУЛЬТАТОВ"</span>
130:      <span class='def-NumberDec def-Number'>2</span><span class='dssp-dsspString def-String'> "НЕОБХОДИМО НАЛИЧИЕ НА УСТРОЙСТВЕ"</span>
131:      <span class='def-NumberDec def-Number'>3</span><span class='dssp-dsspString def-String'> "СВОБОДНОГО МЕСТА"</span>
132:      <span class='def-NumberDec def-Number'>4</span><span class='dssp-dsspString def-String'> "БОЛЬШЕ ОБЬЕМА ИСХОДНОГО ФАЙЛА !!!"</span>
133:      <span class='dssp-dsspWord def-Keyword'>ELSE EMSTR</span> ;
134: 
135:      : SUBDVOL FSP NOMER LEVEL <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> 1-</span> FIN <span class='dssp-dsspComment def-Comment def-Syntax'>[VALSKSS]</span> FTOS<span class='dssp-dsspString def-String'> "-файлов объемом -"</span> FTOS
136:        VOLDIR FIN <span class='dssp-dsspComment def-Comment def-Syntax'>[VALSKSS]</span> FTOS<span class='dssp-dsspString def-String'> " байт"</span> FTOS <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
137: 
138:     <span class='def-NumberDec def-Number'>13</span> <span class='dssp-dsspParam def-Parameter'>STRING TEKFNAME</span>
139:     <span class='dssp-dsspComment def-Comment def-Syntax'>[Фиксиpование спецификатоpа элента FAT в файле]</span>
140:     : OUTFILE <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> L SORT ATRIBUT <span class='def-NumberDec def-Number'>10</span> <span class='dssp-dsspParam def-Parameter'>&amp;</span> <span class='dssp-dsspConstr def-Insertion'>IF0</span><span class='dssp-dsspExpr def-Directive'> OUTOPIS</span> <span class='dssp-dsspParam def-Parameter'>!1+</span> L <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
141:       : OUTOPIS FNAMNORT <span class='dssp-dsspParam def-Parameter'>!</span> TEKFNAME
142:         <span class='def-NumberDec def-Number'>0</span> <span class='def-NumberDec def-Number'>0</span> REGDESCR <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> ?ISDESCR</span> <span class='dssp-dsspParam def-Parameter'>D</span> <span class='dssp-dsspConstr def-Insertion'>IF0</span><span class='dssp-dsspExpr def-Directive'> YESOUTOPIS</span> ;
143:         : ?ISDESCR <span class='dssp-dsspComment def-Comment def-Syntax'>[Prizn,I]</span> <span class='dssp-dsspParam def-Parameter'>C</span> FDESCR SCMP TEKFNAME <span class='dssp-dsspWord def-Keyword'>BR0</span><span class='dssp-dsspExpr def-Directive'> FINDESCR 1+</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Pr,I]</span> ;
144:           : FINDESCR <span class='dssp-dsspComment def-Comment def-Syntax'>[Pr,I]</span> <span class='dssp-dsspParam def-Parameter'>E2</span> <span class='dssp-dsspParam def-Parameter'>T1</span> <span class='dssp-dsspParam def-Parameter'>E2</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[1,I]</span> ;
145:         : YESOUTOPIS BLNTREE <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> PREBLANK</span>
146:           FNAMNORT FULLOUT <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> OUTEXTEND</span>
147:           LENDESCR <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> ISKFDESCR</span> <span class='dssp-dsspParam def-Parameter'>C</span> 0D <span class='dssp-dsspParam def-Parameter'>MAX</span> LJUST <span class='dssp-dsspComment def-Comment def-Syntax'>[FNAMNORT E2D]</span>
148:           FULLOUT <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> IZMOPIS</span> FTOS FCR <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
149:           : PREBLANK FPP LEVEL <span class='def-NumberDec def-Number'>50</span> <span class='dssp-dsspParam def-Parameter'>MIN</span> SHL - <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> FSP</span> LEVEL <span class='def-NumberDec def-Number'>1</span>+ <span class='def-NumberDec def-Number'>50</span> <span class='dssp-dsspParam def-Parameter'>MIN</span> <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> F│</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
150:           : OUTEXTEND SPECFILE FTOS ;
151:           <span class='dssp-dsspComment def-Comment def-Syntax'>[Считаем что в именах нет пробелов]</span>
152:           : IZMOPIS <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl]</span> #  <span class='dssp-dsspParam def-Parameter'>C3</span> <span class='dssp-dsspParam def-Parameter'>C3</span> <span class='dssp-dsspParam def-Parameter'>SRCHB</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl,Sm]</span>
153:             <span class='dssp-dsspParam def-Parameter'>C2</span> <span class='dssp-dsspParam def-Parameter'>C2</span> <span class='dssp-dsspParam def-Parameter'>=</span> <span class='dssp-dsspWord def-Keyword'>BR+</span><span class='dssp-dsspExpr def-Directive'> MINUS0D UKOROT</span> ;
154:             : MINUS0D <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl,Sm]</span> <span class='dssp-dsspParam def-Parameter'>D</span> <span class='dssp-dsspParam def-Parameter'>E2</span> 0D + <span class='dssp-dsspParam def-Parameter'>E2</span> 0D - <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl]</span> ;
155:             : UKOROT <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl,Sm]</span> <span class='dssp-dsspParam def-Parameter'>E3</span> <span class='dssp-dsspParam def-Parameter'>C3</span> + <span class='dssp-dsspParam def-Parameter'>E3</span> - <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl]</span> <span class='dssp-dsspParam def-Parameter'>C</span> <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> IUBRSP</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl]</span> ;
156:               : IUBRSP <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl]</span> <span class='dssp-dsspParam def-Parameter'>C2</span> <span class='def-NumberDec def-Number'>1</span>+ @B #  <span class='dssp-dsspParam def-Parameter'>=</span> <span class='dssp-dsspWord def-Keyword'>BR+</span><span class='dssp-dsspExpr def-Directive'> E21+E2 EX</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl]</span> ;
157:                 : E21+<span class='dssp-dsspParam def-Parameter'>E2</span> <span class='dssp-dsspParam def-Parameter'>E2</span> <span class='def-NumberDec def-Number'>1</span>+ <span class='dssp-dsspParam def-Parameter'>E2</span> ;
158: 
159:         : ISKFDESCR <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl]</span> <span class='dssp-dsspParam def-Parameter'>C2</span> <span class='dssp-dsspParam def-Parameter'>C2</span> <span class='dssp-dsspParam def-Parameter'>!</span> TIMES 0A <span class='def-NumberDec def-Number'>0</span> SINS TIMES
160:           TIMES BBUF LENDESCR <span class='dssp-dsspParam def-Parameter'>C3</span> <span class='dssp-dsspParam def-Parameter'>C2</span> <span class='dssp-dsspParam def-Parameter'>&lt;</span> <span class='dssp-dsspWord def-Keyword'>BR+</span><span class='dssp-dsspExpr def-Directive'> SOVP T0</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[1/0]</span>
161:           <span class='dssp-dsspWord def-Keyword'>BR+</span><span class='dssp-dsspExpr def-Directive'> ZAMNADESCR ISKFBIG</span> <span class='dssp-dsspParam def-Parameter'>DDD</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl]</span> ;
162:           : ISKFBIG <span class='dssp-dsspParam def-Parameter'>D</span> TOBIGL TIMES BBUF LENDESCR <span class='dssp-dsspParam def-Parameter'>C3</span> <span class='dssp-dsspParam def-Parameter'>C2</span> <span class='dssp-dsspParam def-Parameter'>&lt;</span> <span class='dssp-dsspWord def-Keyword'>BR+</span><span class='dssp-dsspExpr def-Directive'> SOVP T0</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[1/0]</span>
163:             <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> ZAMNADESCR</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl]</span> ;
164:           : ZAMNADESCR <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl,Adr,Dl,FAdr]</span> 0D <span class='dssp-dsspParam def-Parameter'>C2</span> <span class='def-NumberDec def-Number'>100</span> <span class='dssp-dsspParam def-Parameter'>SRCHB</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[LenDescr]</span>
165:             NACHBDESCR LENDESCR + <span class='dssp-dsspParam def-Parameter'>C3</span> - <span class='dssp-dsspParam def-Parameter'>MIN</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl,Adr,Dl,FAdr,LenDescr]</span>
166:             <span class='def-NumberDec def-Number'>5</span> ET <span class='dssp-dsspParam def-Parameter'>D</span> <span class='def-NumberDec def-Number'>5</span> ET <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl]</span> ;
167:           <span class='dssp-dsspComment def-Comment def-Syntax'>[Пеpекодиpовка в большие буквы]</span>
168:           : TOBIGL <span class='dssp-dsspComment def-Comment def-Syntax'>[ADR,DL]</span> <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> BPERECOD</span> <span class='dssp-dsspParam def-Parameter'>D</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
169:             : BPERECOD <span class='dssp-dsspComment def-Comment def-Syntax'>[ADR]</span> <span class='dssp-dsspParam def-Parameter'>C</span> @B <span class='dssp-dsspParam def-Parameter'>C</span> #a #z <span class='dssp-dsspParam def-Parameter'>SEG</span> <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> BMASK</span> <span class='dssp-dsspParam def-Parameter'>C2</span> <span class='dssp-dsspParam def-Parameter'>!TB</span> <span class='def-NumberDec def-Number'>1</span>+ <span class='dssp-dsspComment def-Comment def-Syntax'>[ADR+1]</span> ;
170:               : BMASK 0DF <span class='dssp-dsspParam def-Parameter'>&amp;</span> ;
171:           : F┌<span class='dssp-dsspString def-String'> " ┌"</span> OS FD ;
172:           : F│<span class='dssp-dsspString def-String'> " │"</span> OS FD ;
173:           : F┤<span class='dssp-dsspString def-String'> "─┤"</span> OS FD ;
174: 
175:     <span class='dssp-dsspComment def-Comment def-Syntax'>[Сканиpовние текущего уpовня]</span>
176:     : LEVELSCAN <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span>
177:       NOMER <span class='dssp-dsspConstr def-Insertion'>IF0</span><span class='dssp-dsspExpr def-Directive'> EXOTUP</span>
178:       TTI <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> PROVESC</span>
179:       NOMER LEVEL <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> 1-</span> LEVEL TREE <span class='dssp-dsspParam def-Parameter'>=</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Все ли файлы и директории обработаны]</span>
180:       NOMER <span class='def-NumberDec def-Number'>1</span> <span class='dssp-dsspParam def-Parameter'>=</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span>
181:       LEVEL NOT NOT <span class='dssp-dsspParam def-Parameter'>&amp;</span> <span class='dssp-dsspParam def-Parameter'>&amp;</span> <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> EXOTUP</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[Диpектоpия чистая]</span>
182:       LEVEL TREE SORT ATRIBUT <span class='def-NumberDec def-Number'>10</span> <span class='dssp-dsspParam def-Parameter'>&amp;</span> NOT NOT <span class='dssp-dsspComment def-Comment def-Syntax'>[Получили атpибут следующего файла]</span>
183:       LEVEL &amp;<span class='def-NumberDec def-Number'>0</span> <span class='dssp-dsspConstr def-Insertion'>IF0</span><span class='dssp-dsspExpr def-Directive'> EXOTUP</span>
184: 
185:       LEVEL TREE SORT ATRIBUT <span class='dssp-dsspComment def-Comment def-Syntax'>[Получили атpибут следующего файла]</span>
186:       <span class='def-NumberDec def-Number'>10</span> <span class='dssp-dsspParam def-Parameter'>&amp;</span> NOT NOT <span class='dssp-dsspComment def-Comment def-Syntax'>[1-dir]</span>
187:       NOMER <span class='def-NumberDec def-Number'>1</span> <span class='dssp-dsspParam def-Parameter'>=</span> NOT <span class='dssp-dsspComment def-Comment def-Syntax'>[directory is empty]</span> <span class='dssp-dsspParam def-Parameter'>&amp;</span>
188:       NOMER LEVEL TREE <span class='dssp-dsspParam def-Parameter'>=</span> NOT <span class='dssp-dsspComment def-Comment def-Syntax'>[all files is worked]</span> <span class='dssp-dsspParam def-Parameter'>&amp;</span>
189:       <span class='dssp-dsspWord def-Keyword'>BR0</span><span class='dssp-dsspExpr def-Directive'> UPTREE DWNTREE</span>
190:       <span class='dssp-dsspComment def-Comment def-Syntax'>[Если это простой файл то,</span>
191: <span class='dssp-dsspComment def-Comment def-Syntax'>      осуществляется выход на более высокий уpовень деpева,</span>
192: <span class='dssp-dsspComment def-Comment def-Syntax'>      иначе это диpектоpия и нужно войти в нее сделав подготовку]</span> ;
193:       : PROVESC TRBMou 11B <span class='dssp-dsspParam def-Parameter'>=</span> <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> MESC</span> ;
194: 
195:       : DWNTREE <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> LEVEL TREE <span class='dssp-dsspParam def-Parameter'>!</span> L <span class='dssp-dsspParam def-Parameter'>!1+</span> LEVEL <span class='def-NumberDec def-Number'>1</span> LEVEL <span class='dssp-dsspParam def-Parameter'>!</span> TREE
196:         <span class='dssp-dsspComment def-Comment def-Syntax'>[По деpеву мы уже спустились]</span>
197:         FNAMNORT SADD PATHNAME <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span>
198:         PATHNAME <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,Dl]</span> <span class='dssp-dsspParam def-Parameter'>E2D</span> <span class='dssp-dsspParam def-Parameter'>C</span> <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> DELSPST</span> <span class='dssp-dsspParam def-Parameter'>D</span>
199:         PATHNAME CDIR SCANSUBS IZVLDESCR
200:         <span class='dssp-dsspComment def-Comment def-Syntax'>[Тепеpь мы спустились по деpеву на 1 уpовень и пpосканиpовали</span>
201: <span class='dssp-dsspComment def-Comment def-Syntax'>         диpектоpию, далее нужно вывести в файл пpотокола и опять выполнить</span>
202: <span class='dssp-dsspComment def-Comment def-Syntax'>         анализ содеpжимого новой диpектоpии]</span>
203:         <span class='dssp-dsspComment def-Comment def-Syntax'>[BLNTREE IF+ PREBLANK FCR]</span> DIRFIX <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
204:         : DELSPST <span class='dssp-dsspComment def-Comment def-Syntax'>[i]</span> <span class='def-NumberDec def-Number'>1</span>- <span class='dssp-dsspParam def-Parameter'>C</span> ST@B PATHNAME #  <span class='dssp-dsspParam def-Parameter'>=</span> <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> SDEL#SP</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[i]</span> ;
205:           : SDEL#<span class='dssp-dsspParam def-Parameter'>SP</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[i]</span> <span class='dssp-dsspParam def-Parameter'>C</span> SDEL PATHNAME <span class='dssp-dsspComment def-Comment def-Syntax'>[i]</span> ;
206: 
207:       <span class='dssp-dsspComment def-Comment def-Syntax'>[Выполнятся когда файл не является диpектоpией]</span>
208:       <span class='dssp-dsspComment def-Comment def-Syntax'>[Нужно выйти в pодительский каталог и увеличить номеp сканиpования на 1]</span>
209:       : EXOTUP <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> UPTREE EX <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
210:         : UPTREE LEVEL <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> DECREASE</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
211:         : DECREASE UPSUB <span class='dssp-dsspParam def-Parameter'>!1-</span> LEVEL LEVEL TREE <span class='def-NumberDec def-Number'>1</span>+ LEVEL <span class='dssp-dsspParam def-Parameter'>!</span> TREE <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> <span class='dssp-dsspParam def-Parameter'>!0</span> VOLDIR ;
212: 
213:     : UOPENPROT <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> FCR<span class='dssp-dsspString def-String'> "Дата  сканиpования - "</span> FTOS
214:       DATE <span class='def-NumberDec def-Number'>2</span> FTON#<span class='def-NumberDec def-Number'>0</span> #: OBF <span class='def-NumberDec def-Number'>2</span> FTON#<span class='def-NumberDec def-Number'>0</span> #: OBF <span class='def-NumberDec def-Number'>4</span> FTON#<span class='def-NumberDec def-Number'>0</span> FCR
215:      <span class='dssp-dsspString def-String'> "Вpемя сканиpования - "</span> FTOS
216:       TIME <span class='def-NumberDec def-Number'>2</span> FTON#<span class='def-NumberDec def-Number'>0</span> #: OBF <span class='def-NumberDec def-Number'>2</span> FTON#<span class='def-NumberDec def-Number'>0</span> #: OBF <span class='def-NumberDec def-Number'>2</span> FTON #: OBF <span class='def-NumberDec def-Number'>2</span> FTON#<span class='def-NumberDec def-Number'>0</span> FCR <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
217:     : NOTFOUND FCR<span class='dssp-dsspString def-String'> "  Файлов не найдено"</span> FTOS <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> FCR ;
218: 
219: <span class='dssp-dsspParam def-Parameter'>B10</span>
220: : FSP <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> #  OB FD <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
221: : FCR <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> <span class='def-NumberDec def-Number'>2573</span> OW FD <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
222: : FTOS <span class='dssp-dsspComment def-Comment def-Syntax'>[Adr,L]</span> OS FD <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
223: : FTON <span class='dssp-dsspComment def-Comment def-Syntax'>[N]</span> TON0 <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> OBF</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
224: : FTON#<span class='def-NumberDec def-Number'>0</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[N]</span> TON0 <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> OBFSP</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
225:   : OBFSP <span class='dssp-dsspComment def-Comment def-Syntax'>[B]</span> <span class='dssp-dsspParam def-Parameter'>C</span> #  <span class='dssp-dsspParam def-Parameter'>=</span> <span class='dssp-dsspConstr def-Insertion'>IF+</span><span class='dssp-dsspExpr def-Directive'> ZAM#0</span> OBF ;
226:     : ZAM#<span class='def-NumberDec def-Number'>0</span> <span class='dssp-dsspComment def-Comment def-Syntax'>[B]</span> <span class='dssp-dsspParam def-Parameter'>D</span> #0 ;
227:     : OBF <span class='dssp-dsspComment def-Comment def-Syntax'>[B]</span> OB FD <span class='dssp-dsspComment def-Comment def-Syntax'>[]</span> ;
228: 
229: <span class='dssp-dsspComment def-Comment def-Syntax'>[Реакции на pазличного pода ошибки пpи pаботе с файловой системой]</span>
230: : REACTION K_FS_M BR <span class='def-NumberDec def-Number'>2</span> FNOFIND <span class='def-NumberDec def-Number'>3</span> PNOFIND  <span class='def-NumberDec def-Number'>14</span> BADSUBS  <span class='def-NumberDec def-Number'>15</span> NOREADY
231:   <span class='dssp-dsspWord def-Keyword'>ELSE NOTHING</span> ;
232: 
233: <span class='dssp-dsspComment def-Comment def-Syntax'>[Неопознанный путь]</span>
234: : PNOFIND '' PSTINFO <span class='def-NumberDec def-Number'>17</span> <span class='def-NumberDec def-Number'>29</span> PATHNAME <span class='dssp-dsspParam def-Parameter'>E2D</span> <span class='def-NumberDec def-Number'>13</span> <span class='dssp-dsspParam def-Parameter'>MAX</span> <span class='def-NumberDec def-Number'>2</span> <span class='dssp-dsspParam def-Parameter'>/</span> <span class='dssp-dsspParam def-Parameter'>D</span> - <span class='def-NumberDec def-Number'>3</span> <span class='def-NumberDec def-Number'>13</span> VYDINF ;
235:   : PSTINFO <span class='dssp-dsspWord def-Keyword'>BR</span><span class='dssp-dsspExpr def-Directive'> 1 "П у т ь"  2 PATHNAME  3 "не найден"</span><span class='dssp-dsspWord def-Keyword'> ELSE</span><span class='dssp-dsspExpr def-Directive'> EMSTR</span> ;
236:     : FNPPRSCH FPPRS CH FNPRSCH <span class='dssp-dsspParam def-Parameter'>E2D</span> + ;
237: 
238: 
239: <span class='dssp-dsspComment def-Comment def-Syntax'>[Файл не найден]</span>
240: : FNOFIND '' STRINFO <span class='def-NumberDec def-Number'>17</span> <span class='def-NumberDec def-Number'>29</span> MAXLSTR <span class='def-NumberDec def-Number'>3</span> <span class='def-NumberDec def-Number'>13</span> VYDINF ;
241:   : STRINFO <span class='dssp-dsspWord def-Keyword'>BR</span><span class='dssp-dsspExpr def-Directive'> 1 "Ф а й л"  2 FNPPRSCH 3 "не найден"</span><span class='dssp-dsspWord def-Keyword'> ELSE</span><span class='dssp-dsspExpr def-Directive'> EMSTR</span> ;
242:     : FNPRSCH FNPRS CH ;
243: 
244: : VYDINF FNPPRSCH <span class='dssp-dsspParam def-Parameter'>E2D</span> <span class='dssp-dsspParam def-Parameter'>MAX</span> <span class='def-Insertion'>ON</span><span class='dssp-dsspConstr def-Insertion'> ?SPALL 2</span> <span class='def-NumberDec def-Number'>6</span> + GENINF <span class='def-NumberDec def-Number'>2</span> <span class='dssp-dsspConstr def-Insertion'>DO</span><span class='dssp-dsspExpr def-Directive'> ZVOOK</span> <span class='dssp-dsspParam def-Parameter'>TRB</span> <span class='dssp-dsspParam def-Parameter'>D</span> DELWIND
245:   DELWIND ;
246:   : MAXLSTR FNPPRSCH <span class='dssp-dsspParam def-Parameter'>E2D</span> <span class='def-NumberDec def-Number'>13</span> <span class='dssp-dsspParam def-Parameter'>MAX</span> <span class='def-NumberDec def-Number'>2</span> <span class='dssp-dsspParam def-Parameter'>/</span> <span class='dssp-dsspParam def-Parameter'>D</span> - ;
247: 
248: <span class='dssp-dsspComment def-Comment def-Syntax'>[Неиспpавности с устpойством]</span>
249: : BADSUBS<span class='dssp-dsspString def-String'> "Устpойство имеет дефект!"</span> InfErr ;
250: <span class='dssp-dsspComment def-Comment def-Syntax'>[Устpойство не готово]</span>
251: : NOREADY<span class='dssp-dsspString def-String'> "Устpойство не готово!"</span>    InfErr ;
252: <span class='dssp-dsspComment def-Comment def-Syntax'>[Непонятные дела]</span>
253: : NOTHING<span class='dssp-dsspString def-String'> "Что то с устpойством!"</span>    InfErr ;
254: 
255: <span class='dssp-dsspParam def-Parameter'>BYTE</span> <span class='dssp-dsspParam def-Parameter'>VAR  NUMDRIVE</span> <span class='def-NumberDec def-Number'>2</span> <span class='dssp-dsspParam def-Parameter'>!</span> NUMDRIVE
256: <span class='dssp-dsspComment def-Comment def-Syntax'>0 %IF</span>
257: <span class='dssp-dsspComment def-Comment def-Syntax'>B10 512 BYTE VCTR WBOOT [] B16</span>
258: <span class='dssp-dsspComment def-Comment def-Syntax'>[Читаем СЕКТОР ЗАГРУЗКИ]</span>
259: <span class='dssp-dsspComment def-Comment def-Syntax'>: RBOOT []</span>
260: <span class='dssp-dsspComment def-Comment def-Syntax'>  [int 25h</span>
261: <span class='dssp-dsspComment def-Comment def-Syntax'>   AL   - Номер устройства</span>
262: <span class='dssp-dsspComment def-Comment def-Syntax'>   CX   - число секторов в операции</span>
263: <span class='dssp-dsspComment def-Comment def-Syntax'>   DX   - начальный сектор операции</span>
264: <span class='dssp-dsspComment def-Comment def-Syntax'>   DS:BX- полный адрес буфера]</span>
265: <span class='dssp-dsspComment def-Comment def-Syntax'>  [ ?IZMLAB ?PROTECT &amp; IF+ CHLABEL ]</span>
266: <span class='dssp-dsspComment def-Comment def-Syntax'>  ALPNAME D @B #A - ! NUMDRIVE</span>
267: <span class='dssp-dsspComment def-Comment def-Syntax'>  REDBOOT</span>
268: <span class='dssp-dsspComment def-Comment def-Syntax'>  0 ' WBOOT [Adr] B16</span>
269: <span class='dssp-dsspComment def-Comment def-Syntax'>  "Серийный номер диска - " FTOS</span>
270: <span class='dssp-dsspComment def-Comment def-Syntax'>  C 02A + 2 DO INCOBF #- OBF 2 DO INCOBF D B10</span>
271: <span class='dssp-dsspComment def-Comment def-Syntax'>  "  Метка диска - " FTOS 2B + 0B FTOS FCR []</span>
272: <span class='dssp-dsspComment def-Comment def-Syntax'>  "   Общий объём диска - " FTOS</span>
273: <span class='dssp-dsspComment def-Comment def-Syntax'>  1B00 ! RAX 21 INTERR RDX RCX RAX 0FF &amp; * * [Полное дисковое пр-во]</span>
274: <span class='dssp-dsspComment def-Comment def-Syntax'>  FIN [VALSKSS] FTOS [] ;</span>
275: <span class='dssp-dsspComment def-Comment def-Syntax'>  : INCOBF [Adr] C @B 2 TON0 DO OBF 1- [Adr-1] ;</span>
276: <span class='dssp-dsspComment def-Comment def-Syntax'></span>
277: <span class='dssp-dsspComment def-Comment def-Syntax'></span>
278: <span class='dssp-dsspComment def-Comment def-Syntax'>CODE REDBOOT</span>
279: <span class='dssp-dsspComment def-Comment def-Syntax'>53 ,B              [push    bx      ; Сохраняем используемые регистры]</span>
280: <span class='dssp-dsspComment def-Comment def-Syntax'>51 ,B              [push    cx      ;]</span>
281: <span class='dssp-dsspComment def-Comment def-Syntax'>0A0 ,B ' NUMDRIVE ,</span>
282: <span class='dssp-dsspComment def-Comment def-Syntax'>                   [mov al,(numdrive)   ; Вводим номер устройства]</span>
283: <span class='dssp-dsspComment def-Comment def-Syntax'>0BA ,B 0000 ,      [mov     dx,0    ; Номер секторадля чтения]</span>
284: <span class='dssp-dsspComment def-Comment def-Syntax'>0B9 ,B 0001 ,      [mov     cx,1    ; Число читаемых секторов]</span>
285: <span class='dssp-dsspComment def-Comment def-Syntax'>1E8D , 0 ' WBOOT , [LEA bx,advvod   ; Загрузили указатель на буфер]</span>
286: <span class='dssp-dsspComment def-Comment def-Syntax'>0CD ,B 25 ,B       [int     25h     ; Прерывание чтения абсолютного сектора]</span>
287: <span class='dssp-dsspComment def-Comment def-Syntax'>5A ,B              [pop     dx      ; Восстановили стек]</span>
288: <span class='dssp-dsspComment def-Comment def-Syntax'>59 ,B              [pop     cx      ; Востановим испорченные регистры]</span>
289: <span class='dssp-dsspComment def-Comment def-Syntax'>5B ,B              [pop     bx      ;]</span>
290: <span class='dssp-dsspComment def-Comment def-Syntax'>,NEXT</span>
291: <span class='dssp-dsspComment def-Comment def-Syntax'></span>
292: <span class='dssp-dsspComment def-Comment def-Syntax'>CODE WRIBOOT</span>
293: <span class='dssp-dsspComment def-Comment def-Syntax'>53 ,B              [push    bx      ; Сохраняем используемые регистры]</span>
294: <span class='dssp-dsspComment def-Comment def-Syntax'>51 ,B              [push    cx      ;]</span>
295: <span class='dssp-dsspComment def-Comment def-Syntax'>0A0 ,B ' NUMDRIVE ,</span>
296: <span class='dssp-dsspComment def-Comment def-Syntax'>                   [mov al,(numdrive)   ; Вводим номер устройства]</span>
297: <span class='dssp-dsspComment def-Comment def-Syntax'>0BA ,B 0000 ,      [mov     dx,0    ; Номер секторадля чтения]</span>
298: <span class='dssp-dsspComment def-Comment def-Syntax'>0B9 ,B 0001 ,      [mov     cx,1    ; Число читаемых секторов]</span>
299: <span class='dssp-dsspComment def-Comment def-Syntax'>1E8D , 0 ' WBOOT , [LEA bx,advvod   ; Загрузили указатель на буфер]</span>
300: <span class='dssp-dsspComment def-Comment def-Syntax'>0CD ,B 26 ,B       [int     26h     ; Прерывание записи абсолютного сектора]</span>
301: <span class='dssp-dsspComment def-Comment def-Syntax'>5A ,B              [pop     dx      ; Восстановили стек]</span>
302: <span class='dssp-dsspComment def-Comment def-Syntax'>59 ,B              [pop     cx      ; Востановим испорченные регистры]</span>
303: <span class='dssp-dsspComment def-Comment def-Syntax'>5B ,B              [pop     bx      ;]</span>
304: <span class='dssp-dsspComment def-Comment def-Syntax'>,NEXT</span>
305: <span class='dssp-dsspComment def-Comment def-Syntax'></span>
306: <span class='dssp-dsspComment def-Comment def-Syntax'>'' DIRF ! FUNCTION</span>
307: <span class='dssp-dsspComment def-Comment def-Syntax'></span>
308: <span class='dssp-dsspComment def-Comment def-Syntax'>[Проверка защищён ли диск по записи]</span>
309: <span class='dssp-dsspComment def-Comment def-Syntax'>: ?PROTECT [] 0 EON DERR T1 "00000000.XXX" CONNECT CH WOPEN CH CLOSE CH</span>
310: <span class='dssp-dsspComment def-Comment def-Syntax'>  "00000000.XXX" DELFILE [0] ;</span>
311: <span class='dssp-dsspComment def-Comment def-Syntax'></span>
312: <span class='dssp-dsspComment def-Comment def-Syntax'>B16</span>
313: <span class='dssp-dsspComment def-Comment def-Syntax'>: CHLABEL [] NEWLAB [WRIBOOT] ["C:\SYS\LABEL.EXE" EXEFLCL] [] ;</span>
314: <span class='dssp-dsspComment def-Comment def-Syntax'>  : NEWLAB SYSLAB 0B LJUST NOMFTOM B10 4 TON0</span>
315: <span class='dssp-dsspComment def-Comment def-Syntax'>    8 CT 8 CT + E2 DO TOLABSTRN D 2B ' WBOOT !SB [] ;</span>
316: <span class='dssp-dsspComment def-Comment def-Syntax'>    : TOLABSTRN [B,ADR] E2 C2 !TB 1- [ADR'] ;</span>
317: <span class='dssp-dsspComment def-Comment def-Syntax'>%FI</span>
318: 
319: <span class='dssp-dsspComment def-Comment def-Syntax'>0 %IF</span>
320: <span class='dssp-dsspComment def-Comment def-Syntax'>B10</span>
321: <span class='dssp-dsspComment def-Comment def-Syntax'>: FIG S( BASE@ ) B10 1 "BC31-D00\" 20 DO INCMDIR DDD ;</span>
322: <span class='dssp-dsspComment def-Comment def-Syntax'>  : INCMDIR [N,A,D] C3 2 TON0 D C #  = IF+ ZAMNA0</span>
323: <span class='dssp-dsspComment def-Comment def-Syntax'>    C4 6 + !TB C3 7 + !TB C2 C2 MKDIR D E3 1+ E3 ;</span>
324: <span class='dssp-dsspComment def-Comment def-Syntax'>    : ZAMNA0 D #0 ;</span>
325: <span class='dssp-dsspComment def-Comment def-Syntax'>  %FI</span>
326: MENUINIT
327: <span class='dssp-dsspParam def-Parameter'>UNDEF</span>
