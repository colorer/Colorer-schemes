  0: <span class='modula2-Comment def-Comment def-Syntax'>(* Copyright (C) 1987 Jensen &amp; Partners International *)</span>
  1: 
  2: <span class='modula2-Comment def-Comment def-Syntax'>(*$S-,R-,I-*)</span>
  3: <span class='modula2-Keyword def-Keyword'>IMPLEMENTATION</span> <span class='modula2-Keyword def-Keyword'>MODULE</span> FIO<span class='modula2-Symbol def-Symbol'>;</span>
  4: 
  5: <span class='modula2-Keyword def-Keyword'>FROM</span> Str    <span class='modula2-Keyword def-Keyword'>IMPORT</span> CHARSET<span class='modula2-Symbol def-Symbol'>,</span>Length<span class='modula2-Symbol def-Symbol'>,</span>Compare<span class='modula2-Symbol def-Symbol'>,</span>IntToStr<span class='modula2-Symbol def-Symbol'>,</span>CardToStr<span class='modula2-Symbol def-Symbol'>,</span>RealToStr<span class='modula2-Symbol def-Symbol'>,</span>
  6:                    StrToInt<span class='modula2-Symbol def-Symbol'>,</span>StrToCard<span class='modula2-Symbol def-Symbol'>,</span>StrToReal<span class='modula2-Symbol def-Symbol'>,</span>Copy<span class='modula2-Symbol def-Symbol'>;</span>
  7: <span class='modula2-Keyword def-Keyword'>FROM</span> <span class='def-InterfaceKeyword def-Keyword'>SYSTEM</span> <span class='modula2-Keyword def-Keyword'>IMPORT</span> Seg<span class='modula2-Symbol def-Symbol'>,</span>Ofs<span class='modula2-Symbol def-Symbol'>,</span>Registers<span class='modula2-Symbol def-Symbol'>,</span>CarryFlag<span class='modula2-Symbol def-Symbol'>;</span>
  8: 
  9: <span class='modula2-Keyword def-Keyword'>IMPORT</span> AsmLib<span class='modula2-Symbol def-Symbol'>;</span>
 10: 
 11: 
 12: <span class='modula2-Keyword def-Keyword'>CONST</span>
 13:   TrueStr   <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-String def-String'>'TRUE'</span><span class='modula2-Symbol def-Symbol'>;</span>
 14:   MaxHandle <span class='modula2-Symbol def-Symbol'>=</span> MaxOpenFiles<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>3</span><span class='modula2-Symbol def-Symbol'>;</span>
 15: 
 16: <span class='modula2-Comment def-Comment def-Syntax'>(*$V-*)</span>
 17: 
 18: <span class='modula2-Keyword def-Keyword'>TYPE</span>
 19:   FileInf   <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Keyword def-Keyword'>POINTER</span> <span class='modula2-Keyword def-Keyword'>TO</span> BufRec<span class='modula2-Symbol def-Symbol'>;</span>
 20: <span class='modula2-Keyword def-Keyword'>VAR</span>
 21:   IOR    <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* MSDOS result value *)</span>
 22: 
 23:   BufInf <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..</span>MaxHandle<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> FileInf<span class='modula2-Symbol def-Symbol'>;</span>
 24: 
 25: 
 26: <span class='modula2-Keyword def-Keyword'>CONST</span>
 27:   ErrMsg2  <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-String def-String'>'file not found'</span><span class='modula2-Symbol def-Symbol'>;</span>
 28:   ErrMsg3  <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-String def-String'>'path not found'</span><span class='modula2-Symbol def-Symbol'>;</span>
 29:   ErrMsg4  <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-String def-String'>'too many open files'</span><span class='modula2-Symbol def-Symbol'>;</span>
 30:   ErrMsg5  <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-String def-String'>'access denied'</span><span class='modula2-Symbol def-Symbol'>;</span>
 31:   ErrMsg6  <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-String def-String'>'invalid handle'</span><span class='modula2-Symbol def-Symbol'>;</span>
 32:   ErrMsg15 <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-String def-String'>'invalid drive'</span><span class='modula2-Symbol def-Symbol'>;</span>
 33:   ErrMsg16 <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-String def-String'>'current directory'</span><span class='modula2-Symbol def-Symbol'>;</span>
 34:   ErrMsg17 <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-String def-String'>'different device'</span><span class='modula2-Symbol def-Symbol'>;</span>
 35:   ErrMsgDiskFull <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-String def-String'>'disk full'</span><span class='modula2-Symbol def-Symbol'>;</span>
 36: 
 37: 
 38: 
 39: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> ErrorCheckNamed <span class='modula2-Symbol def-Symbol'>(</span> <span class='modula2-Keyword def-Keyword'>VAR</span> r <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
 40:                             str   <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
 41:                             name  <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 42: <span class='modula2-Keyword def-Keyword'>VAR</span>
 43:   s  <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..100</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
 44:   ns <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..3</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
 45:   sp <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>POINTER</span> <span class='modula2-Keyword def-Keyword'>TO</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..79</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
 46: 
 47:   <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> AddErr<span class='modula2-Symbol def-Symbol'>(</span>es<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 48:   <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 49:     Str<span class='modula2-Number def-Number'>.</span>Append<span class='modula2-Symbol def-Symbol'>(</span>s<span class='modula2-Symbol def-Symbol'>,</span>es<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 50:   <span class='modula2-Symbol def-Symbol'>END</span> AddErr<span class='modula2-Symbol def-Symbol'>;</span>
 51: 
 52: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 53:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
 54:      <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span>CarryFlag<span class='modula2-Symbol def-Symbol'>}</span> <span class='modula2-Symbol def-Symbol'>*</span> Flags<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>#</span> <span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span><span class='modula2-Symbol def-Symbol'>}</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
 55:        IOR <span class='modula2-Symbol def-Symbol'>:=</span> AX<span class='modula2-Symbol def-Symbol'>;</span>
 56:        <span class='modula2-Symbol def-Symbol'>IF</span> IOcheck <span class='modula2-Keyword def-Keyword'>THEN</span>
 57:          s <span class='modula2-Symbol def-Symbol'>:=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 58:          Copy<span class='modula2-Symbol def-Symbol'>(</span>s<span class='modula2-Symbol def-Symbol'>,</span>str<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 59:          AddErr<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-String def-String'>' : '</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 60:          <span class='modula2-Symbol def-Symbol'>CASE</span> IOR <span class='modula2-Keyword def-Keyword'>OF</span>
 61:          <span class='modula2-Number def-Number'>2</span> <span class='modula2-Symbol def-Symbol'>:</span>   sp <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>ErrMsg2<span class='modula2-Symbol def-Symbol'>)</span>            <span class='modula2-Symbol def-Symbol'>|</span>
 62:          <span class='modula2-Number def-Number'>3</span> <span class='modula2-Symbol def-Symbol'>:</span>   sp <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>ErrMsg3<span class='modula2-Symbol def-Symbol'>)</span>            <span class='modula2-Symbol def-Symbol'>|</span>
 63:          <span class='modula2-Number def-Number'>4</span> <span class='modula2-Symbol def-Symbol'>:</span>   sp <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>ErrMsg4<span class='modula2-Symbol def-Symbol'>)</span>            <span class='modula2-Symbol def-Symbol'>|</span>
 64:          <span class='modula2-Number def-Number'>5</span> <span class='modula2-Symbol def-Symbol'>:</span>   sp <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>ErrMsg5<span class='modula2-Symbol def-Symbol'>)</span>            <span class='modula2-Symbol def-Symbol'>|</span>
 65:          <span class='modula2-Number def-Number'>6</span> <span class='modula2-Symbol def-Symbol'>:</span>   sp <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>ErrMsg6<span class='modula2-Symbol def-Symbol'>)</span>            <span class='modula2-Symbol def-Symbol'>|</span>
 66:          <span class='modula2-Number def-Number'>15</span><span class='modula2-Symbol def-Symbol'>:</span>   sp <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>ErrMsg15<span class='modula2-Symbol def-Symbol'>)</span>           <span class='modula2-Symbol def-Symbol'>|</span>
 67:          <span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>:</span>   sp <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>ErrMsg16<span class='modula2-Symbol def-Symbol'>)</span>           <span class='modula2-Symbol def-Symbol'>|</span>
 68:          <span class='modula2-Number def-Number'>17</span><span class='modula2-Symbol def-Symbol'>:</span>   sp <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>ErrMsg17<span class='modula2-Symbol def-Symbol'>)</span>           <span class='modula2-Symbol def-Symbol'>|</span>
 69:          DiskFull<span class='modula2-Symbol def-Symbol'>:</span> sp <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>ErrMsgDiskFull<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>|</span>
 70:          <span class='modula2-Keyword def-Keyword'>ELSE</span>  AddErr<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-String def-String'>'MSDOS error # '</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>;</span>
 71:                ns<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span>IOR <span class='modula2-Keyword def-Keyword'>DIV</span> <span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>48</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 72:                ns<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span>IOR <span class='modula2-Keyword def-Keyword'>MOD</span> <span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>48</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 73:                ns<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 74:                sp <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>ns<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 75:          <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 76:          AddErr<span class='modula2-Symbol def-Symbol'>(</span>sp<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 77:          <span class='modula2-Symbol def-Symbol'>IF</span> name<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>#</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
 78:            AddErr<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-String def-String'>' ('</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 79:            AddErr<span class='modula2-Symbol def-Symbol'>(</span>name<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 80:            AddErr<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-String def-String'>')'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 81:          <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 82:          Lib<span class='modula2-Number def-Number'>.</span>FatalError<span class='modula2-Symbol def-Symbol'>(</span>s<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 83:        <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 84:      <span class='modula2-Keyword def-Keyword'>ELSE</span>
 85:        IOR <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
 86:      <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 87:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 88: <span class='modula2-Symbol def-Symbol'>END</span> ErrorCheckNamed<span class='modula2-Symbol def-Symbol'>;</span>
 89: 
 90: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Keyword def-Keyword'>VAR</span> r<span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span> str<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 91: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 92:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span>CarryFlag<span class='modula2-Symbol def-Symbol'>}</span> <span class='modula2-Symbol def-Symbol'>*</span> r<span class='modula2-Number def-Number'>.</span>Flags<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>#</span> <span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span><span class='modula2-Symbol def-Symbol'>}</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
 93:     ErrorCheckNamed<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span>str<span class='modula2-Symbol def-Symbol'>,</span>CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 94:   <span class='modula2-Keyword def-Keyword'>ELSE</span>
 95:     IOR <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
 96:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 97: <span class='modula2-Symbol def-Symbol'>END</span> ErrorCheck<span class='modula2-Symbol def-Symbol'>;</span>
 98: 
 99: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> IOresult <span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
100: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
101:   <span class='modula2-Keyword def-Keyword'>RETURN</span> IOR<span class='modula2-Symbol def-Symbol'>;</span>
102: <span class='modula2-Symbol def-Symbol'>END</span> IOresult<span class='modula2-Symbol def-Symbol'>;</span>
103: 
104: 
105: 
106: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Write<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> Buf<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>BYTE</span><span class='modula2-Symbol def-Symbol'>;</span> Count<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
107: <span class='modula2-Keyword def-Keyword'>VAR</span> r <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
108: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
109:   <span class='modula2-Symbol def-Symbol'>IF</span> Count <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
110:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
111:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>Buf<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
112:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>Buf<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
113:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>40H</span><span class='modula2-Symbol def-Symbol'>;</span>  <span class='modula2-Comment def-Comment def-Syntax'>(* file write *)</span>
114:     BX <span class='modula2-Symbol def-Symbol'>:=</span> F<span class='modula2-Symbol def-Symbol'>;</span>
115:     CX <span class='modula2-Symbol def-Symbol'>:=</span> Count<span class='modula2-Symbol def-Symbol'>;</span>
116:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
117:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>AX <span class='modula2-Symbol def-Symbol'>#</span> CX<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span>CarryFlag<span class='modula2-Symbol def-Symbol'>}</span> <span class='modula2-Symbol def-Symbol'>*</span> Flags<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>=</span> <span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span><span class='modula2-Symbol def-Symbol'>}</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
118:       AX <span class='modula2-Symbol def-Symbol'>:=</span> DiskFull<span class='modula2-Symbol def-Symbol'>;</span>
119:       Flags <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span>CarryFlag<span class='modula2-Symbol def-Symbol'>}</span><span class='modula2-Symbol def-Symbol'>;</span>
120:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
121:     ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Write'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
122:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
123: <span class='modula2-Symbol def-Symbol'>END</span> Write<span class='modula2-Symbol def-Symbol'>;</span>
124: 
125: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Flush<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
126: <span class='modula2-Keyword def-Keyword'>VAR</span> x <span class='modula2-Symbol def-Symbol'>:</span> FileInf<span class='modula2-Symbol def-Symbol'>;</span>
127:   r <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
128:   conv <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Symbol def-Symbol'>RECORD</span>
129:            <span class='modula2-Symbol def-Symbol'>CASE</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span> <span class='modula2-Keyword def-Keyword'>OF</span>
130:             <span class='modula2-Symbol def-Symbol'>|</span> <span class='def-Constant def-Keyword'>TRUE</span>  <span class='modula2-Symbol def-Symbol'>:</span> lo<span class='modula2-Symbol def-Symbol'>,</span>hi<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
131:             <span class='modula2-Symbol def-Symbol'>|</span> <span class='def-Constant def-Keyword'>FALSE</span> <span class='modula2-Symbol def-Symbol'>:</span> long <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>LONGINT</span><span class='modula2-Symbol def-Symbol'>;</span>
132:            <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
133:          <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
134: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
135:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>F <span class='modula2-Symbol def-Symbol'>&lt;=</span> MaxHandle<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
136:     x <span class='modula2-Symbol def-Symbol'>:=</span> BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>;</span>
137:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>x <span class='modula2-Symbol def-Symbol'>#</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
138:       <span class='modula2-Symbol def-Symbol'>WITH</span> x<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
139:         <span class='modula2-Symbol def-Symbol'>IF</span> RWPos <span class='modula2-Symbol def-Symbol'>></span> EOB <span class='modula2-Keyword def-Keyword'>THEN</span>
140:           Write<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>Buffer<span class='modula2-Symbol def-Symbol'>,</span>RWPos <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
141:         <span class='modula2-Keyword def-Keyword'>ELSIF</span> RWPos <span class='modula2-Symbol def-Symbol'>&lt;</span> EOB <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Comment def-Comment def-Syntax'>(* last was read, move DOS pointer back *)</span>
142:           conv<span class='modula2-Number def-Number'>.</span>long <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-TypeKeyword def-Keyword'>LONGINT</span><span class='modula2-Symbol def-Symbol'>(</span>RWPos<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>-</span> <span class='def-TypeKeyword def-Keyword'>LONGINT</span><span class='modula2-Symbol def-Symbol'>(</span>EOB<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
143:           <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
144:             CX <span class='modula2-Symbol def-Symbol'>:=</span> conv<span class='modula2-Number def-Number'>.</span>hi<span class='modula2-Symbol def-Symbol'>;</span>
145:             DX <span class='modula2-Symbol def-Symbol'>:=</span> conv<span class='modula2-Number def-Number'>.</span>lo<span class='modula2-Symbol def-Symbol'>;</span>
146:             AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>4201H</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* seek relative *)</span>
147:             BX <span class='modula2-Symbol def-Symbol'>:=</span> F<span class='modula2-Symbol def-Symbol'>;</span>
148:             Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
149:             ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Flush'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
150:           <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
151:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
152:         RWPos <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
153:         EOB   <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
154:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
155:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
156:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
157: <span class='modula2-Symbol def-Symbol'>END</span> Flush<span class='modula2-Symbol def-Symbol'>;</span>
158: 
159: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Truncate<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
160: <span class='modula2-Keyword def-Keyword'>VAR</span> r <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
161: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
162:   Flush<span class='modula2-Symbol def-Symbol'>(</span> F <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
163:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
164:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>40H</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* file write *)</span>
165:     BX <span class='modula2-Symbol def-Symbol'>:=</span> F<span class='modula2-Symbol def-Symbol'>;</span>
166:     CX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
167:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
168:     ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Truncate'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
169:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
170: <span class='modula2-Symbol def-Symbol'>END</span> Truncate<span class='modula2-Symbol def-Symbol'>;</span>
171: 
172: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Read<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>VAR</span> Buf<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>BYTE</span><span class='modula2-Symbol def-Symbol'>;</span> Count<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
173: <span class='modula2-Keyword def-Keyword'>VAR</span> r <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
174: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
175:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
176:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>Buf<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
177:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>Buf<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
178:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>3FH</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* file read *)</span>
179:     BX <span class='modula2-Symbol def-Symbol'>:=</span> F<span class='modula2-Symbol def-Symbol'>;</span>
180:     CX <span class='modula2-Symbol def-Symbol'>:=</span> Count<span class='modula2-Symbol def-Symbol'>;</span>
181:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
182:     ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Read'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
183:     <span class='modula2-Symbol def-Symbol'>IF</span> IOR <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
184:       <span class='modula2-Keyword def-Keyword'>RETURN</span> AX<span class='modula2-Symbol def-Symbol'>;</span>
185:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
186:       <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
187:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
188:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
189: <span class='modula2-Symbol def-Symbol'>END</span> Read<span class='modula2-Symbol def-Symbol'>;</span>
190: 
191: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrStr<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> Buf<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
192: <span class='modula2-Keyword def-Keyword'>VAR</span> Count <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
193: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
194:   OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
195:   Count <span class='modula2-Symbol def-Symbol'>:=</span> Str<span class='modula2-Number def-Number'>.</span>Length<span class='modula2-Symbol def-Symbol'>(</span> Buf <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
196:   WrBin<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>Buf<span class='modula2-Symbol def-Symbol'>,</span>Count <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
197: <span class='modula2-Symbol def-Symbol'>END</span> WrStr<span class='modula2-Symbol def-Symbol'>;</span>
198: 
199: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrLn<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
200: <span class='modula2-Keyword def-Keyword'>TYPE</span> a <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Symbol def-Symbol'>[</span> <span class='modula2-Number def-Number'>0..1</span> <span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
201: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
202:   WrStr<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span> a<span class='modula2-Symbol def-Symbol'>(</span> CHR<span class='modula2-Symbol def-Symbol'>(</span> <span class='modula2-Number def-Number'>13</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>CHR<span class='modula2-Symbol def-Symbol'>(</span> <span class='modula2-Number def-Number'>10</span> <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
203: <span class='modula2-Symbol def-Symbol'>END</span> WrLn<span class='modula2-Symbol def-Symbol'>;</span>
204: 
205: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdChar<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
206: <span class='modula2-Keyword def-Keyword'>VAR</span> c <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
207: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
208:   OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
209:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>F <span class='modula2-Symbol def-Symbol'>&lt;=</span> MaxHandle<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>#</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
210:     <span class='modula2-Symbol def-Symbol'>WITH</span> BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
211:       <span class='modula2-Symbol def-Symbol'>IF</span> RWPos <span class='modula2-Symbol def-Symbol'>&lt;</span> EOB <span class='modula2-Keyword def-Keyword'>THEN</span>
212:         c <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>[</span> RWPos <span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
213:         INC<span class='modula2-Symbol def-Symbol'>(</span>RWPos<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
214:         EOF <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Symbol def-Symbol'>(</span>c <span class='modula2-Symbol def-Symbol'>=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>26</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
215:         <span class='modula2-Keyword def-Keyword'>RETURN</span> c<span class='modula2-Symbol def-Symbol'>;</span>
216:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
217:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
218:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
219:   <span class='modula2-Symbol def-Symbol'>IF</span> RdBin<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>c<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
220:     OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
221:     c  <span class='modula2-Symbol def-Symbol'>:=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>26</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
222:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
223:   EOF <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Symbol def-Symbol'>(</span>c <span class='modula2-Symbol def-Symbol'>=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>26</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
224:   <span class='modula2-Keyword def-Keyword'>RETURN</span> c<span class='modula2-Symbol def-Symbol'>;</span>
225: <span class='modula2-Symbol def-Symbol'>END</span> RdChar<span class='modula2-Symbol def-Symbol'>;</span>
226: 
227: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdStr<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>VAR</span> Buf<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
228: <span class='modula2-Keyword def-Keyword'>VAR</span>
229:   i<span class='modula2-Symbol def-Symbol'>,</span>h <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
230:   c   <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
231: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
232:   i  <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
233:   h  <span class='modula2-Symbol def-Symbol'>:=</span> HIGH<span class='modula2-Symbol def-Symbol'>(</span> Buf <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
234:   OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
235:   <span class='modula2-Symbol def-Symbol'>LOOP</span>
236:      <span class='modula2-Symbol def-Symbol'>IF</span> i <span class='modula2-Symbol def-Symbol'>></span> h <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
237:      c <span class='modula2-Symbol def-Symbol'>:=</span> RdChar<span class='modula2-Symbol def-Symbol'>(</span> F <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
238:      <span class='modula2-Symbol def-Symbol'>IF</span> c <span class='modula2-Symbol def-Symbol'>=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span> <span class='modula2-Number def-Number'>26</span> <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
239:        Buf<span class='modula2-Symbol def-Symbol'>[</span> i <span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
240:        EOF <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Symbol def-Symbol'>(</span>i <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
241:        <span class='modula2-Keyword def-Keyword'>RETURN</span><span class='modula2-Symbol def-Symbol'>;</span>
242:      <span class='modula2-Keyword def-Keyword'>ELSIF</span> c <span class='modula2-Symbol def-Symbol'>=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span> <span class='modula2-Number def-Number'>13</span> <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
243:        Buf<span class='modula2-Symbol def-Symbol'>[</span> i <span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
244:        <span class='modula2-Keyword def-Keyword'>RETURN</span><span class='modula2-Symbol def-Symbol'>;</span>
245:      <span class='modula2-Keyword def-Keyword'>ELSIF</span> c <span class='modula2-Symbol def-Symbol'>#</span> CHR<span class='modula2-Symbol def-Symbol'>(</span> <span class='modula2-Number def-Number'>10</span> <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
246:        Buf<span class='modula2-Symbol def-Symbol'>[</span> i <span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> c<span class='modula2-Symbol def-Symbol'>;</span>
247:        INC<span class='modula2-Symbol def-Symbol'>(</span> i <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
248:      <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
249:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
250: <span class='modula2-Symbol def-Symbol'>END</span> RdStr<span class='modula2-Symbol def-Symbol'>;</span>
251: 
252: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdItem<span class='modula2-Symbol def-Symbol'>(</span> F <span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
253: <span class='modula2-Keyword def-Keyword'>VAR</span> c <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span> i<span class='modula2-Symbol def-Symbol'>,</span>L <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
254: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
255:   i <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
256:   <span class='modula2-Symbol def-Symbol'>LOOP</span>
257:     c <span class='modula2-Symbol def-Symbol'>:=</span> RdChar<span class='modula2-Symbol def-Symbol'>(</span> F <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
258:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Keyword def-Keyword'>NOT</span> OK <span class='modula2-Keyword def-Keyword'>OR</span> <span class='modula2-Keyword def-Keyword'>NOT</span> <span class='modula2-Symbol def-Symbol'>(</span>c <span class='modula2-Keyword def-Keyword'>IN</span> Separators<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>EXIT</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
259:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
260:   L <span class='modula2-Symbol def-Symbol'>:=</span> HIGH<span class='modula2-Symbol def-Symbol'>(</span> S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
261:   <span class='modula2-Symbol def-Symbol'>LOOP</span>
262:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Keyword def-Keyword'>NOT</span> OK <span class='modula2-Keyword def-Keyword'>OR</span> <span class='modula2-Symbol def-Symbol'>(</span> c <span class='modula2-Keyword def-Keyword'>IN</span> Separators <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>EXIT</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
263:     S<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> c<span class='modula2-Symbol def-Symbol'>;</span>
264:     INC<span class='modula2-Symbol def-Symbol'>(</span> i <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
265:     <span class='modula2-Symbol def-Symbol'>IF</span> i <span class='modula2-Symbol def-Symbol'>></span> L <span class='modula2-Keyword def-Keyword'>THEN</span>
266:       <span class='modula2-Keyword def-Keyword'>EXIT</span><span class='modula2-Symbol def-Symbol'>;</span>
267:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
268:       c <span class='modula2-Symbol def-Symbol'>:=</span> RdChar<span class='modula2-Symbol def-Symbol'>(</span> F <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
269:       <span class='modula2-Symbol def-Symbol'>IF</span> c <span class='modula2-Symbol def-Symbol'>=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>26</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>EXIT</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
270:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
271:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
272:   <span class='modula2-Symbol def-Symbol'>IF</span> i <span class='modula2-Symbol def-Symbol'>&lt;=</span> L <span class='modula2-Keyword def-Keyword'>THEN</span> S<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> 0C<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
273: <span class='modula2-Symbol def-Symbol'>END</span> RdItem<span class='modula2-Symbol def-Symbol'>;</span>
274: 
275: 
276: <span class='modula2-Comment def-Comment def-Syntax'>(*$V+*)</span>
277: 
278: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> S<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
279: <span class='modula2-Keyword def-Keyword'>VAR</span>
280:   L <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
281:   a <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>;</span>
282: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
283:   OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
284:   L  <span class='modula2-Symbol def-Symbol'>:=</span> Str<span class='modula2-Number def-Number'>.</span>Length<span class='modula2-Symbol def-Symbol'>(</span> S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
285:   a  <span class='modula2-Symbol def-Symbol'>:=</span> ABS<span class='modula2-Symbol def-Symbol'>(</span> Length <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>-</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>(</span> L <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
286:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>a <span class='modula2-Symbol def-Symbol'>&lt;</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> ChopOff <span class='modula2-Keyword def-Keyword'>THEN</span>
287:     L <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>(</span>ABS<span class='modula2-Symbol def-Symbol'>(</span>Length<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
288:     <span class='modula2-Symbol def-Symbol'>IF</span> L<span class='modula2-Symbol def-Symbol'>></span>HIGH<span class='modula2-Symbol def-Symbol'>(</span>S<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
289:       L <span class='modula2-Symbol def-Symbol'>:=</span> HIGH<span class='modula2-Symbol def-Symbol'>(</span>S<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
290:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
291:       S<span class='modula2-Symbol def-Symbol'>[</span>L<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
292:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
293:     <span class='modula2-Symbol def-Symbol'>WHILE</span> <span class='modula2-Symbol def-Symbol'>(</span>L<span class='modula2-Symbol def-Symbol'>></span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>DO</span> DEC<span class='modula2-Symbol def-Symbol'>(</span>L<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>;</span> S<span class='modula2-Symbol def-Symbol'>[</span>L<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-String def-String'>'?'</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
294:     OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
295:     a  <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
296:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
297:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>Length <span class='modula2-Symbol def-Symbol'>></span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>a <span class='modula2-Symbol def-Symbol'>></span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> WrCharRep<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>' '</span><span class='modula2-Symbol def-Symbol'>,</span>a <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
298:   WrStr<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
299:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>Length <span class='modula2-Symbol def-Symbol'>&lt;</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>a <span class='modula2-Symbol def-Symbol'>></span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> WrCharRep<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>' '</span><span class='modula2-Symbol def-Symbol'>,</span>a <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
300: <span class='modula2-Symbol def-Symbol'>END</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>;</span>
301: 
302: <span class='modula2-Comment def-Comment def-Syntax'>(*$V-*)</span>
303: 
304: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrChar<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
305: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
306:   OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
307:   WrBin<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>V<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
308: <span class='modula2-Symbol def-Symbol'>END</span> WrChar<span class='modula2-Symbol def-Symbol'>;</span>
309: 
310: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrCharRep<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span> <span class='modula2-Symbol def-Symbol'>;</span> Count<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
311: <span class='modula2-Keyword def-Keyword'>VAR</span>
312:   S   <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
313:   i<span class='modula2-Symbol def-Symbol'>,</span>j <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
314: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
315:   <span class='modula2-Symbol def-Symbol'>WHILE</span> Count<span class='modula2-Symbol def-Symbol'>></span><span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>DO</span>
316:     i <span class='modula2-Symbol def-Symbol'>:=</span> SIZE<span class='modula2-Symbol def-Symbol'>(</span>S<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>;</span>
317:     <span class='modula2-Symbol def-Symbol'>IF</span> i <span class='modula2-Symbol def-Symbol'>></span> Count <span class='modula2-Keyword def-Keyword'>THEN</span> i <span class='modula2-Symbol def-Symbol'>:=</span> Count <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
318:     DEC<span class='modula2-Symbol def-Symbol'>(</span>Count<span class='modula2-Symbol def-Symbol'>,</span>i<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
319:     j <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
320:     <span class='modula2-Symbol def-Symbol'>WHILE</span> <span class='modula2-Symbol def-Symbol'>(</span>j <span class='modula2-Symbol def-Symbol'>&lt;</span> i<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>DO</span> S<span class='modula2-Symbol def-Symbol'>[</span>j<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> V<span class='modula2-Symbol def-Symbol'>;</span> INC<span class='modula2-Symbol def-Symbol'>(</span>j<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
321:     OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
322:     WrBin<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>j <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
323:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Keyword def-Keyword'>NOT</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
324:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
325: <span class='modula2-Symbol def-Symbol'>END</span> WrCharRep<span class='modula2-Symbol def-Symbol'>;</span>
326: 
327: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrBool<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span><span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
328: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
329:   <span class='modula2-Symbol def-Symbol'>IF</span> V <span class='modula2-Keyword def-Keyword'>THEN</span>
330:     WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>TrueStr<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
331:   <span class='modula2-Keyword def-Keyword'>ELSE</span>
332:     WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'FALSE'</span><span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
333:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
334: <span class='modula2-Symbol def-Symbol'>END</span> WrBool<span class='modula2-Symbol def-Symbol'>;</span>
335: 
336: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrShtInt<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>SHORTINT</span><span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
337: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
338: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
339:   IntToStr<span class='modula2-Symbol def-Symbol'>(</span> VAL<span class='modula2-Symbol def-Symbol'>(</span> <span class='def-TypeKeyword def-Keyword'>LONGINT</span><span class='modula2-Symbol def-Symbol'>,</span>V <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
340:   <span class='modula2-Symbol def-Symbol'>IF</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
341: <span class='modula2-Symbol def-Symbol'>END</span> WrShtInt<span class='modula2-Symbol def-Symbol'>;</span>
342: 
343: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrInt<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
344: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
345: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
346:   IntToStr<span class='modula2-Symbol def-Symbol'>(</span> VAL<span class='modula2-Symbol def-Symbol'>(</span> <span class='def-TypeKeyword def-Keyword'>LONGINT</span><span class='modula2-Symbol def-Symbol'>,</span>V <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
347:   <span class='modula2-Symbol def-Symbol'>IF</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
348: <span class='modula2-Symbol def-Symbol'>END</span> WrInt<span class='modula2-Symbol def-Symbol'>;</span>
349: 
350: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrLngInt<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>LONGINT</span><span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
351: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
352: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
353:   IntToStr<span class='modula2-Symbol def-Symbol'>(</span> V<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
354:   <span class='modula2-Symbol def-Symbol'>IF</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
355: <span class='modula2-Symbol def-Symbol'>END</span> WrLngInt<span class='modula2-Symbol def-Symbol'>;</span>
356: 
357: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrShtCard<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> SHORTCARD<span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
358: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
359: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
360:   CardToStr<span class='modula2-Symbol def-Symbol'>(</span> VAL<span class='modula2-Symbol def-Symbol'>(</span> LONGCARD<span class='modula2-Symbol def-Symbol'>,</span>V <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
361:   <span class='modula2-Symbol def-Symbol'>IF</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
362: <span class='modula2-Symbol def-Symbol'>END</span> WrShtCard<span class='modula2-Symbol def-Symbol'>;</span>
363: 
364: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrCard<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
365: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
366: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
367:   CardToStr<span class='modula2-Symbol def-Symbol'>(</span> VAL<span class='modula2-Symbol def-Symbol'>(</span> LONGCARD<span class='modula2-Symbol def-Symbol'>,</span>V <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
368:   <span class='modula2-Symbol def-Symbol'>IF</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
369: <span class='modula2-Symbol def-Symbol'>END</span> WrCard<span class='modula2-Symbol def-Symbol'>;</span>
370: 
371: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrLngCard<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
372: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
373: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
374:   CardToStr<span class='modula2-Symbol def-Symbol'>(</span> V<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
375:   <span class='modula2-Symbol def-Symbol'>IF</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
376: <span class='modula2-Symbol def-Symbol'>END</span> WrLngCard<span class='modula2-Symbol def-Symbol'>;</span>
377: 
378: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrShtHex<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> SHORTCARD<span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
379: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
380: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
381:   CardToStr<span class='modula2-Symbol def-Symbol'>(</span> VAL<span class='modula2-Symbol def-Symbol'>(</span> LONGCARD<span class='modula2-Symbol def-Symbol'>,</span>V <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
382:   <span class='modula2-Symbol def-Symbol'>IF</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
383: <span class='modula2-Symbol def-Symbol'>END</span> WrShtHex<span class='modula2-Symbol def-Symbol'>;</span>
384: 
385: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrHex<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
386: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
387: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
388:   CardToStr<span class='modula2-Symbol def-Symbol'>(</span> VAL<span class='modula2-Symbol def-Symbol'>(</span> LONGCARD<span class='modula2-Symbol def-Symbol'>,</span>V <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
389:   <span class='modula2-Symbol def-Symbol'>IF</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
390: <span class='modula2-Symbol def-Symbol'>END</span> WrHex<span class='modula2-Symbol def-Symbol'>;</span>
391: 
392: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrLngHex<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
393: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
394: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
395:   CardToStr<span class='modula2-Symbol def-Symbol'>(</span> V<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
396:   <span class='modula2-Symbol def-Symbol'>IF</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
397: <span class='modula2-Symbol def-Symbol'>END</span> WrLngHex<span class='modula2-Symbol def-Symbol'>;</span>
398: 
399: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrReal<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>REAL</span><span class='modula2-Symbol def-Symbol'>;</span> Precision<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
400: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
401: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
402:   RealToStr<span class='modula2-Symbol def-Symbol'>(</span> VAL<span class='modula2-Symbol def-Symbol'>(</span> <span class='def-TypeKeyword def-Keyword'>LONGREAL</span><span class='modula2-Symbol def-Symbol'>,</span>V <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>Precision<span class='modula2-Symbol def-Symbol'>,</span>Eng<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
403:   <span class='modula2-Symbol def-Symbol'>IF</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
404: <span class='modula2-Symbol def-Symbol'>END</span> WrReal<span class='modula2-Symbol def-Symbol'>;</span>
405: 
406: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrLngReal<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> V<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>LONGREAL</span><span class='modula2-Symbol def-Symbol'>;</span> Precision<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span> Length<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
407: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
408: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
409:   RealToStr<span class='modula2-Symbol def-Symbol'>(</span> V<span class='modula2-Symbol def-Symbol'>,</span>Precision<span class='modula2-Symbol def-Symbol'>,</span>Eng<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
410:   <span class='modula2-Symbol def-Symbol'>IF</span> OK <span class='modula2-Keyword def-Keyword'>THEN</span> WrStrAdj<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>,</span>Length <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
411: <span class='modula2-Symbol def-Symbol'>END</span> WrLngReal<span class='modula2-Symbol def-Symbol'>;</span>
412: 
413: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdBool<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span><span class='modula2-Symbol def-Symbol'>;</span>
414: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
415: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
416:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
417:   <span class='modula2-Keyword def-Keyword'>RETURN</span> Compare<span class='modula2-Symbol def-Symbol'>(</span>S<span class='modula2-Symbol def-Symbol'>,</span>TrueStr<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
418: <span class='modula2-Symbol def-Symbol'>END</span> RdBool<span class='modula2-Symbol def-Symbol'>;</span>
419: 
420: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdShtInt<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>SHORTINT</span><span class='modula2-Symbol def-Symbol'>;</span>
421: <span class='modula2-Keyword def-Keyword'>VAR</span>
422:   S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
423:   i <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>LONGINT</span><span class='modula2-Symbol def-Symbol'>;</span>
424: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
425:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
426:   i  <span class='modula2-Symbol def-Symbol'>:=</span> StrToInt<span class='modula2-Symbol def-Symbol'>(</span> S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
427:   OK <span class='modula2-Symbol def-Symbol'>:=</span> OK <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>i <span class='modula2-Symbol def-Symbol'>>=</span> <span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>80H</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>i <span class='modula2-Symbol def-Symbol'>&lt;=</span> <span class='modula2-Number def-Number'>7FH</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
428:   <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-TypeKeyword def-Keyword'>SHORTINT</span><span class='modula2-Symbol def-Symbol'>(</span> i <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
429: <span class='modula2-Symbol def-Symbol'>END</span> RdShtInt<span class='modula2-Symbol def-Symbol'>;</span>
430: 
431: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdInt<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>;</span>
432: <span class='modula2-Keyword def-Keyword'>VAR</span>
433:   S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
434:   i <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>LONGINT</span><span class='modula2-Symbol def-Symbol'>;</span>
435: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
436:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
437:   i  <span class='modula2-Symbol def-Symbol'>:=</span> StrToInt<span class='modula2-Symbol def-Symbol'>(</span> S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
438:   OK <span class='modula2-Symbol def-Symbol'>:=</span> OK <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>i <span class='modula2-Symbol def-Symbol'>>=</span> <span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>8000H</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>i <span class='modula2-Symbol def-Symbol'>&lt;=</span> <span class='modula2-Number def-Number'>7FFFH</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
439:   <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>(</span>i<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
440: <span class='modula2-Symbol def-Symbol'>END</span> RdInt<span class='modula2-Symbol def-Symbol'>;</span>
441: 
442: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdLngInt<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>LONGINT</span><span class='modula2-Symbol def-Symbol'>;</span>
443: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
444: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
445:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
446:   <span class='modula2-Keyword def-Keyword'>RETURN</span> StrToInt<span class='modula2-Symbol def-Symbol'>(</span> S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
447: <span class='modula2-Symbol def-Symbol'>END</span> RdLngInt<span class='modula2-Symbol def-Symbol'>;</span>
448: 
449: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdShtCard<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> SHORTCARD<span class='modula2-Symbol def-Symbol'>;</span>
450: <span class='modula2-Keyword def-Keyword'>VAR</span>
451:   S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
452:   i <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
453: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
454:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
455:   i  <span class='modula2-Symbol def-Symbol'>:=</span> StrToCard<span class='modula2-Symbol def-Symbol'>(</span> S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
456:   OK <span class='modula2-Symbol def-Symbol'>:=</span> OK <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>i <span class='modula2-Symbol def-Symbol'>&lt;</span> <span class='modula2-Number def-Number'>0FFH</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
457:   <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-TypeKeyword def-Keyword'>SHORTINT</span><span class='modula2-Symbol def-Symbol'>(</span> i <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
458: <span class='modula2-Symbol def-Symbol'>END</span> RdShtCard<span class='modula2-Symbol def-Symbol'>;</span>
459: 
460: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdCard<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
461: <span class='modula2-Keyword def-Keyword'>VAR</span>
462:   S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
463:   i <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
464: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
465:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
466:   i  <span class='modula2-Symbol def-Symbol'>:=</span> StrToCard<span class='modula2-Symbol def-Symbol'>(</span> S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
467:   OK <span class='modula2-Symbol def-Symbol'>:=</span> OK <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>i <span class='modula2-Symbol def-Symbol'>&lt;</span> <span class='modula2-Number def-Number'>10000H</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
468:   <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>(</span> i <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
469: <span class='modula2-Symbol def-Symbol'>END</span> RdCard<span class='modula2-Symbol def-Symbol'>;</span>
470: 
471: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdLngCard<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
472: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
473: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
474:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
475:   <span class='modula2-Keyword def-Keyword'>RETURN</span> StrToCard<span class='modula2-Symbol def-Symbol'>(</span> S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
476: <span class='modula2-Symbol def-Symbol'>END</span> RdLngCard<span class='modula2-Symbol def-Symbol'>;</span>
477: 
478: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdShtHex<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> SHORTCARD<span class='modula2-Symbol def-Symbol'>;</span>
479: <span class='modula2-Keyword def-Keyword'>VAR</span>
480:   S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
481:   i <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
482: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
483:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
484:   i  <span class='modula2-Symbol def-Symbol'>:=</span> StrToCard<span class='modula2-Symbol def-Symbol'>(</span> S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
485:   OK <span class='modula2-Symbol def-Symbol'>:=</span> OK <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>i <span class='modula2-Symbol def-Symbol'>&lt;</span> <span class='modula2-Number def-Number'>0FFH</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
486:   <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-TypeKeyword def-Keyword'>SHORTINT</span><span class='modula2-Symbol def-Symbol'>(</span> i <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
487: <span class='modula2-Symbol def-Symbol'>END</span> RdShtHex<span class='modula2-Symbol def-Symbol'>;</span>
488: 
489: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdHex<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
490: <span class='modula2-Keyword def-Keyword'>VAR</span>
491:   S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
492:   i <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
493: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
494:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
495:   i  <span class='modula2-Symbol def-Symbol'>:=</span> StrToCard<span class='modula2-Symbol def-Symbol'>(</span> S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
496:   OK <span class='modula2-Symbol def-Symbol'>:=</span> OK <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>i <span class='modula2-Symbol def-Symbol'>&lt;</span> <span class='modula2-Number def-Number'>10000H</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
497:   <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-TypeKeyword def-Keyword'>INTEGER</span><span class='modula2-Symbol def-Symbol'>(</span> i <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
498: <span class='modula2-Symbol def-Symbol'>END</span> RdHex<span class='modula2-Symbol def-Symbol'>;</span>
499: 
500: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdLngHex<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
501: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
502: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
503:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
504:   <span class='modula2-Keyword def-Keyword'>RETURN</span> StrToCard<span class='modula2-Symbol def-Symbol'>(</span> S<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
505: <span class='modula2-Symbol def-Symbol'>END</span> RdLngHex <span class='modula2-Symbol def-Symbol'>;</span>
506: 
507: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdReal<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>REAL</span><span class='modula2-Symbol def-Symbol'>;</span>
508: <span class='modula2-Keyword def-Keyword'>VAR</span>
509:   S   <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
510:   r<span class='modula2-Symbol def-Symbol'>,</span>a <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>LONGREAL</span><span class='modula2-Symbol def-Symbol'>;</span>
511: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
512:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
513:   r  <span class='modula2-Symbol def-Symbol'>:=</span> StrToReal<span class='modula2-Symbol def-Symbol'>(</span> S<span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
514:   a  <span class='modula2-Symbol def-Symbol'>:=</span> ABS<span class='modula2-Symbol def-Symbol'>(</span> r <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
515:   OK <span class='modula2-Symbol def-Symbol'>:=</span> OK <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>a <span class='modula2-Symbol def-Symbol'>>=</span> <span class='modula2-Number def-Number'>1.2E-38</span> <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>a <span class='modula2-Symbol def-Symbol'>&lt;=</span> <span class='modula2-Number def-Number'>3.4E38</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
516:   <span class='modula2-Keyword def-Keyword'>RETURN</span> VAL<span class='modula2-Symbol def-Symbol'>(</span> <span class='def-TypeKeyword def-Keyword'>REAL</span><span class='modula2-Symbol def-Symbol'>,</span>r <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
517: <span class='modula2-Symbol def-Symbol'>END</span> RdReal<span class='modula2-Symbol def-Symbol'>;</span>
518: 
519: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdLngReal<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>LONGREAL</span><span class='modula2-Symbol def-Symbol'>;</span>
520: <span class='modula2-Keyword def-Keyword'>VAR</span> S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..80</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
521: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
522:   RdItem<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>S <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
523:   <span class='modula2-Keyword def-Keyword'>RETURN</span> StrToReal<span class='modula2-Symbol def-Symbol'>(</span> S<span class='modula2-Symbol def-Symbol'>,</span>OK <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
524: <span class='modula2-Symbol def-Symbol'>END</span> RdLngReal<span class='modula2-Symbol def-Symbol'>;</span>
525: 
526: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> WrBin<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> Buf<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>BYTE</span><span class='modula2-Symbol def-Symbol'>;</span> Count<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
527: <span class='modula2-Keyword def-Keyword'>VAR</span> i <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
528: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
529:   OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
530:   i  <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
531:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>F <span class='modula2-Symbol def-Symbol'>></span> MaxHandle<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>OR</span> <span class='modula2-Symbol def-Symbol'>(</span>BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
532:     Write<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>Buf<span class='modula2-Symbol def-Symbol'>,</span>Count <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
533:     OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Symbol def-Symbol'>(</span>IOR <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
534:   <span class='modula2-Keyword def-Keyword'>ELSE</span>
535:     <span class='modula2-Symbol def-Symbol'>WITH</span> BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
536:       <span class='modula2-Symbol def-Symbol'>IF</span> RWPos <span class='modula2-Symbol def-Symbol'>&lt;=</span> EOB <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Comment def-Comment def-Syntax'>(* last was read *)</span>
537:         Flush<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
538:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
539:       i <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
540:       <span class='modula2-Symbol def-Symbol'>WHILE</span> Count <span class='modula2-Symbol def-Symbol'>></span> i <span class='modula2-Keyword def-Keyword'>DO</span>
541:         <span class='modula2-Symbol def-Symbol'>WHILE</span> <span class='modula2-Symbol def-Symbol'>(</span>RWPos <span class='modula2-Symbol def-Symbol'>&lt;</span> BufSize<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span> Count <span class='modula2-Symbol def-Symbol'>></span> i <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>DO</span>
542:           Buffer<span class='modula2-Symbol def-Symbol'>[</span> RWPos <span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> SHORTCARD<span class='modula2-Symbol def-Symbol'>(</span>Buf<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
543:           INC<span class='modula2-Symbol def-Symbol'>(</span> i <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
544:           INC<span class='modula2-Symbol def-Symbol'>(</span> RWPos <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
545:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
546:         <span class='modula2-Symbol def-Symbol'>IF</span> RWPos <span class='modula2-Symbol def-Symbol'>=</span> BufSize <span class='modula2-Keyword def-Keyword'>THEN</span>
547:           Write<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>Buffer<span class='modula2-Symbol def-Symbol'>,</span>BufSize <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
548:           RWPos <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
549:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
550:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
551:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
552:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
553: <span class='modula2-Symbol def-Symbol'>END</span> WrBin<span class='modula2-Symbol def-Symbol'>;</span>
554: 
555: 
556: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RdBin<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>VAR</span> Buf<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>BYTE</span><span class='modula2-Symbol def-Symbol'>;</span> Count<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
557: <span class='modula2-Keyword def-Keyword'>VAR</span> i<span class='modula2-Symbol def-Symbol'>,</span>h<span class='modula2-Symbol def-Symbol'>,</span>j <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
558: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
559:   i   <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
560:   OK  <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
561:   EOF <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
562:   <span class='modula2-Symbol def-Symbol'>IF</span> Count <span class='modula2-Symbol def-Symbol'>></span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
563:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>F <span class='modula2-Symbol def-Symbol'>></span> MaxHandle<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>OR</span> <span class='modula2-Symbol def-Symbol'>(</span>BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
564:       i  <span class='modula2-Symbol def-Symbol'>:=</span> Read<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>Buf<span class='modula2-Symbol def-Symbol'>,</span>Count <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
565:       OK <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Symbol def-Symbol'>(</span>IOR<span class='modula2-Symbol def-Symbol'>=</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
566:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
567:       <span class='modula2-Symbol def-Symbol'>WITH</span> BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
568:         <span class='modula2-Symbol def-Symbol'>IF</span> RWPos <span class='modula2-Symbol def-Symbol'>></span> EOB <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Comment def-Comment def-Syntax'>(* Last was write *)</span> Flush<span class='modula2-Symbol def-Symbol'>(</span> F <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
569:         i <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
570:         <span class='modula2-Symbol def-Symbol'>LOOP</span>
571:           <span class='modula2-Symbol def-Symbol'>IF</span> Count <span class='modula2-Symbol def-Symbol'>=</span> i <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>EXIT</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
572:           <span class='modula2-Symbol def-Symbol'>IF</span> RWPos <span class='modula2-Symbol def-Symbol'>>=</span> EOB <span class='modula2-Keyword def-Keyword'>THEN</span>
573:             EOB   <span class='modula2-Symbol def-Symbol'>:=</span> Read<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>Buffer<span class='modula2-Symbol def-Symbol'>,</span>BufSize <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
574:             OK    <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Symbol def-Symbol'>(</span>IOR<span class='modula2-Symbol def-Symbol'>=</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
575:             RWPos <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
576:             <span class='modula2-Symbol def-Symbol'>IF</span> EOB<span class='modula2-Symbol def-Symbol'>=</span><span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>EXIT</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
577:           <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
578:           <span class='modula2-Symbol def-Symbol'>WHILE</span> <span class='modula2-Symbol def-Symbol'>(</span>RWPos <span class='modula2-Symbol def-Symbol'>&lt;</span> EOB<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>Count <span class='modula2-Symbol def-Symbol'>></span> i<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>DO</span>
579:             Buf<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-TypeKeyword def-Keyword'>BYTE</span><span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>[</span> RWPos <span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
580:             INC<span class='modula2-Symbol def-Symbol'>(</span> i <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
581:             INC<span class='modula2-Symbol def-Symbol'>(</span> RWPos <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
582:           <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
583:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
584:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
585:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
586:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>i <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> EOF <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
587:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
588:   <span class='modula2-Keyword def-Keyword'>RETURN</span> i<span class='modula2-Symbol def-Symbol'>;</span>
589: <span class='modula2-Symbol def-Symbol'>END</span> RdBin<span class='modula2-Symbol def-Symbol'>;</span>
590: 
591: 
592: 
593: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> GetName<span class='modula2-Symbol def-Symbol'>(</span>name<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>VAR</span> fn<span class='modula2-Symbol def-Symbol'>:</span> PathStr<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
594: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
595:   Copy<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>,</span>name<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
596:   fn<span class='modula2-Symbol def-Symbol'>[</span>SIZE<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
597: <span class='modula2-Symbol def-Symbol'>END</span> GetName<span class='modula2-Symbol def-Symbol'>;</span>
598: 
599: 
600: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Open<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span>
601: <span class='modula2-Keyword def-Keyword'>VAR</span>
602:   r <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
603:   fn<span class='modula2-Symbol def-Symbol'>:</span> PathStr<span class='modula2-Symbol def-Symbol'>;</span>
604: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
605:   GetName<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
606:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
607:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
608:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
609:     CX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
610:     AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>3D02H</span><span class='modula2-Symbol def-Symbol'>;</span>   <span class='modula2-Comment def-Comment def-Syntax'>(* open for read and write *)</span>
611:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
612:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span>CarryFlag<span class='modula2-Symbol def-Symbol'>}</span> <span class='modula2-Symbol def-Symbol'>*</span> Flags<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>#</span> <span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span><span class='modula2-Symbol def-Symbol'>}</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>AX <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>5</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
613:       <span class='modula2-Comment def-Comment def-Syntax'>(* access denied *)</span>
614:       AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>3D00H</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* open for read *)</span>
615:       Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
616:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
617:     ErrorCheckNamed<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Open'</span><span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
618:     <span class='modula2-Symbol def-Symbol'>IF</span> IOR <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
619:       <span class='modula2-Symbol def-Symbol'>IF</span> AX <span class='modula2-Symbol def-Symbol'>&lt;=</span> MaxHandle <span class='modula2-Keyword def-Keyword'>THEN</span> BufInf<span class='modula2-Symbol def-Symbol'>[</span>AX<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
620:       <span class='modula2-Keyword def-Keyword'>RETURN</span> AX<span class='modula2-Symbol def-Symbol'>;</span>
621:     <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
622:     <span class='modula2-Keyword def-Keyword'>RETURN</span> MAX<span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
623:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
624: <span class='modula2-Symbol def-Symbol'>END</span> Open<span class='modula2-Symbol def-Symbol'>;</span>
625: 
626: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Exists<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span><span class='modula2-Symbol def-Symbol'>;</span>
627: <span class='modula2-Keyword def-Keyword'>VAR</span> d <span class='modula2-Symbol def-Symbol'>:</span> DirEntry<span class='modula2-Symbol def-Symbol'>;</span>
628:     r <span class='modula2-Symbol def-Symbol'>:</span> Registers <span class='modula2-Symbol def-Symbol'>;</span>
629:     b <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span> <span class='modula2-Symbol def-Symbol'>;</span>
630: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
631:   r<span class='modula2-Number def-Number'>.</span>AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>2F00H</span> <span class='modula2-Symbol def-Symbol'>;</span>      <span class='modula2-Comment def-Comment def-Syntax'>(* save DTA *)</span>
632:   Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
633:   b <span class='modula2-Symbol def-Symbol'>:=</span> ReadFirstEntry<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>,</span>FileAttr<span class='modula2-Symbol def-Symbol'>{</span><span class='modula2-Symbol def-Symbol'>}</span><span class='modula2-Symbol def-Symbol'>,</span>d<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
634:   r<span class='modula2-Number def-Number'>.</span>AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1A00H</span> <span class='modula2-Symbol def-Symbol'>;</span>
635:   r<span class='modula2-Number def-Number'>.</span>DS <span class='modula2-Symbol def-Symbol'>:=</span> r<span class='modula2-Number def-Number'>.</span>ES <span class='modula2-Symbol def-Symbol'>;</span>
636:   r<span class='modula2-Number def-Number'>.</span>DX <span class='modula2-Symbol def-Symbol'>:=</span> r<span class='modula2-Number def-Number'>.</span>BX <span class='modula2-Symbol def-Symbol'>;</span>
637:   Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>          <span class='modula2-Comment def-Comment def-Syntax'>(* restore DTA *)</span>
638:   <span class='modula2-Keyword def-Keyword'>RETURN</span> b<span class='modula2-Symbol def-Symbol'>;</span>
639: <span class='modula2-Symbol def-Symbol'>END</span> Exists<span class='modula2-Symbol def-Symbol'>;</span>
640: 
641: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Append<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span>
642: <span class='modula2-Keyword def-Keyword'>VAR</span> F <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
643: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
644:   F <span class='modula2-Symbol def-Symbol'>:=</span> Open<span class='modula2-Symbol def-Symbol'>(</span> Name <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
645:   Seek<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>Size<span class='modula2-Symbol def-Symbol'>(</span> F <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
646:   <span class='modula2-Keyword def-Keyword'>RETURN</span> F<span class='modula2-Symbol def-Symbol'>;</span>
647: <span class='modula2-Symbol def-Symbol'>END</span> Append<span class='modula2-Symbol def-Symbol'>;</span>
648: 
649: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Create<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span>
650: <span class='modula2-Keyword def-Keyword'>VAR</span>
651:   r <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
652:   fn<span class='modula2-Symbol def-Symbol'>:</span> PathStr<span class='modula2-Symbol def-Symbol'>;</span>
653: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
654:   GetName<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
655:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
656:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
657:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
658:     CX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
659:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>3CH</span><span class='modula2-Symbol def-Symbol'>;</span>
660:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* Create, open for read and write *)</span>
661:     ErrorCheckNamed<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Create'</span><span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
662:     <span class='modula2-Symbol def-Symbol'>IF</span> IOR <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
663:       <span class='modula2-Symbol def-Symbol'>IF</span> AX <span class='modula2-Symbol def-Symbol'>&lt;=</span> MaxHandle <span class='modula2-Keyword def-Keyword'>THEN</span> BufInf<span class='modula2-Symbol def-Symbol'>[</span>AX<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
664:       <span class='modula2-Keyword def-Keyword'>RETURN</span> AX<span class='modula2-Symbol def-Symbol'>;</span>
665:     <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
666:     <span class='modula2-Keyword def-Keyword'>RETURN</span> MAX<span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
667:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
668: <span class='modula2-Symbol def-Symbol'>END</span> Create<span class='modula2-Symbol def-Symbol'>;</span>
669: 
670: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Close<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
671: <span class='modula2-Keyword def-Keyword'>VAR</span>
672:   r <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
673:   x <span class='modula2-Symbol def-Symbol'>:</span> FileInf<span class='modula2-Symbol def-Symbol'>;</span>
674: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
675:   Flush<span class='modula2-Symbol def-Symbol'>(</span> F <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
676:   <span class='modula2-Symbol def-Symbol'>IF</span> F <span class='modula2-Symbol def-Symbol'>&lt;=</span> MaxHandle <span class='modula2-Keyword def-Keyword'>THEN</span>
677:     BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span>
678:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
679:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
680:     BX <span class='modula2-Symbol def-Symbol'>:=</span> F<span class='modula2-Symbol def-Symbol'>;</span>
681:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>3EH</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* close file *)</span>
682:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
683:     ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Close'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
684:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
685: <span class='modula2-Symbol def-Symbol'>END</span> Close<span class='modula2-Symbol def-Symbol'>;</span>
686: 
687: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> GetPos<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
688: <span class='modula2-Keyword def-Keyword'>VAR</span>
689:   r    <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
690:   x    <span class='modula2-Symbol def-Symbol'>:</span> FileInf<span class='modula2-Symbol def-Symbol'>;</span>
691:   conv <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Symbol def-Symbol'>RECORD</span>
692:            <span class='modula2-Symbol def-Symbol'>CASE</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span> <span class='modula2-Keyword def-Keyword'>OF</span>
693:             <span class='modula2-Symbol def-Symbol'>|</span> <span class='def-Constant def-Keyword'>TRUE</span>  <span class='modula2-Symbol def-Symbol'>:</span> lo<span class='modula2-Symbol def-Symbol'>,</span>hi<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
694:             <span class='modula2-Symbol def-Symbol'>|</span> <span class='def-Constant def-Keyword'>FALSE</span> <span class='modula2-Symbol def-Symbol'>:</span> long <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
695:            <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
696:          <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
697: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
698:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
699:     CX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
700:     DX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
701:     AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>4201H</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* seek relative *)</span>
702:     BX <span class='modula2-Symbol def-Symbol'>:=</span> F<span class='modula2-Symbol def-Symbol'>;</span>
703:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
704:     ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'GetPos'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
705:     conv<span class='modula2-Number def-Number'>.</span>lo <span class='modula2-Symbol def-Symbol'>:=</span> AX<span class='modula2-Symbol def-Symbol'>;</span>
706:     conv<span class='modula2-Number def-Number'>.</span>hi <span class='modula2-Symbol def-Symbol'>:=</span> DX<span class='modula2-Symbol def-Symbol'>;</span>
707:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>F <span class='modula2-Symbol def-Symbol'>&lt;=</span> MaxHandle<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
708:       x <span class='modula2-Symbol def-Symbol'>:=</span> BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>;</span>
709:       <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>x <span class='modula2-Symbol def-Symbol'>#</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
710:         <span class='modula2-Symbol def-Symbol'>WITH</span> x<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
711:           <span class='modula2-Symbol def-Symbol'>IF</span> RWPos <span class='modula2-Symbol def-Symbol'>></span> EOB <span class='modula2-Keyword def-Keyword'>THEN</span>
712:             INC<span class='modula2-Symbol def-Symbol'>(</span>conv<span class='modula2-Number def-Number'>.</span>long<span class='modula2-Symbol def-Symbol'>,</span>VAL<span class='modula2-Symbol def-Symbol'>(</span>LONGCARD<span class='modula2-Symbol def-Symbol'>,</span>RWPos<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
713:           <span class='modula2-Keyword def-Keyword'>ELSIF</span> RWPos <span class='modula2-Symbol def-Symbol'>&lt;</span> EOB <span class='modula2-Keyword def-Keyword'>THEN</span>
714:             DEC<span class='modula2-Symbol def-Symbol'>(</span>conv<span class='modula2-Number def-Number'>.</span>long<span class='modula2-Symbol def-Symbol'>,</span>VAL<span class='modula2-Symbol def-Symbol'>(</span>LONGCARD<span class='modula2-Symbol def-Symbol'>,</span>EOB<span class='modula2-Symbol def-Symbol'>-</span>RWPos<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
715:           <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
716:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
717:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
718:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
719:     <span class='modula2-Keyword def-Keyword'>RETURN</span> conv<span class='modula2-Number def-Number'>.</span>long<span class='modula2-Symbol def-Symbol'>;</span>
720:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
721: <span class='modula2-Symbol def-Symbol'>END</span> GetPos<span class='modula2-Symbol def-Symbol'>;</span>
722: 
723: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Seek<span class='modula2-Symbol def-Symbol'>(</span> F <span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> pos<span class='modula2-Symbol def-Symbol'>:</span>LONGCARD <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
724: <span class='modula2-Keyword def-Keyword'>VAR</span>
725:   EOBpos <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
726:   r    <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
727:   conv <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Symbol def-Symbol'>RECORD</span>
728:            <span class='modula2-Symbol def-Symbol'>CASE</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span> <span class='modula2-Keyword def-Keyword'>OF</span>
729:             <span class='modula2-Symbol def-Symbol'>|</span> <span class='def-Constant def-Keyword'>TRUE</span>  <span class='modula2-Symbol def-Symbol'>:</span> lo<span class='modula2-Symbol def-Symbol'>,</span>hi<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
730:             <span class='modula2-Symbol def-Symbol'>|</span> <span class='def-Constant def-Keyword'>FALSE</span> <span class='modula2-Symbol def-Symbol'>:</span> long <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
731:            <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
732:          <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
733: 
734: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
735:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>&lt;=</span>MaxHandle<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span><span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
736:     <span class='modula2-Symbol def-Symbol'>WITH</span> BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
737:       <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>EOB<span class='modula2-Symbol def-Symbol'>></span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>RWPos<span class='modula2-Symbol def-Symbol'>&lt;=</span>EOB<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
738:         <span class='modula2-Comment def-Comment def-Syntax'>(* there are read bytes in the buffer *)</span>
739:         <span class='modula2-Comment def-Comment def-Syntax'>(* find out where we are in the file *)</span>
740:         <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
741:           CX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span> DX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
742:           AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>4201H</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* seek relative *)</span>
743:           BX <span class='modula2-Symbol def-Symbol'>:=</span> F<span class='modula2-Symbol def-Symbol'>;</span>
744:           Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Seek'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
745:           conv<span class='modula2-Number def-Number'>.</span>lo <span class='modula2-Symbol def-Symbol'>:=</span> AX<span class='modula2-Symbol def-Symbol'>;</span> conv<span class='modula2-Number def-Number'>.</span>hi <span class='modula2-Symbol def-Symbol'>:=</span> DX<span class='modula2-Symbol def-Symbol'>;</span> EOBpos <span class='modula2-Symbol def-Symbol'>:=</span> conv<span class='modula2-Number def-Number'>.</span>long<span class='modula2-Symbol def-Symbol'>;</span>
746:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
747:         <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>pos<span class='modula2-Symbol def-Symbol'>>=</span>EOBpos<span class='modula2-Symbol def-Symbol'>-</span>LONGCARD<span class='modula2-Symbol def-Symbol'>(</span>EOB<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>pos<span class='modula2-Symbol def-Symbol'>&lt;</span>EOBpos<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
748:           <span class='modula2-Comment def-Comment def-Syntax'>(* we can seek within the buffer *)</span>
749:           RWPos <span class='modula2-Symbol def-Symbol'>:=</span> EOB <span class='modula2-Symbol def-Symbol'>-</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>(</span>EOBpos<span class='modula2-Symbol def-Symbol'>-</span>pos<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
750:           <span class='modula2-Keyword def-Keyword'>RETURN</span><span class='modula2-Symbol def-Symbol'>;</span>
751:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
752:       <span class='modula2-Keyword def-Keyword'>ELSE</span>
753:         <span class='modula2-Symbol def-Symbol'>IF</span> RWPos <span class='modula2-Symbol def-Symbol'>></span> EOB <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Comment def-Comment def-Syntax'>(* last was write, bring DOS up to date *)</span>
754:           Write<span class='modula2-Symbol def-Symbol'>(</span> F<span class='modula2-Symbol def-Symbol'>,</span>Buffer<span class='modula2-Symbol def-Symbol'>,</span>RWPos <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
755:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
756:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
757:       <span class='modula2-Comment def-Comment def-Syntax'>(* the buffer contents are finished with now *)</span>
758:       RWPos <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
759:       EOB <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
760:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
761:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
762:   <span class='modula2-Comment def-Comment def-Syntax'>(* we haven't done an in-buffer seek - so get DOS to do it for us *)</span>
763:   conv<span class='modula2-Number def-Number'>.</span>long <span class='modula2-Symbol def-Symbol'>:=</span> pos<span class='modula2-Symbol def-Symbol'>;</span>
764:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
765:     CX <span class='modula2-Symbol def-Symbol'>:=</span> conv<span class='modula2-Number def-Number'>.</span>hi<span class='modula2-Symbol def-Symbol'>;</span>
766:     DX <span class='modula2-Symbol def-Symbol'>:=</span> conv<span class='modula2-Number def-Number'>.</span>lo<span class='modula2-Symbol def-Symbol'>;</span>
767:     AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>4200H</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* seek absolute *)</span>
768:     BX <span class='modula2-Symbol def-Symbol'>:=</span> F<span class='modula2-Symbol def-Symbol'>;</span>
769:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
770:     ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Seek'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
771:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
772: <span class='modula2-Symbol def-Symbol'>END</span> Seek<span class='modula2-Symbol def-Symbol'>;</span>
773: 
774: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Size<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
775: <span class='modula2-Keyword def-Keyword'>VAR</span>
776:   r     <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
777:   conv1<span class='modula2-Symbol def-Symbol'>,</span>
778:   conv2 <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Symbol def-Symbol'>RECORD</span>
779:             <span class='modula2-Symbol def-Symbol'>CASE</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span> <span class='modula2-Keyword def-Keyword'>OF</span>
780:              <span class='modula2-Symbol def-Symbol'>|</span> <span class='def-Constant def-Keyword'>TRUE</span>  <span class='modula2-Symbol def-Symbol'>:</span> lo<span class='modula2-Symbol def-Symbol'>,</span>hi<span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
781:              <span class='modula2-Symbol def-Symbol'>|</span> <span class='def-Constant def-Keyword'>FALSE</span> <span class='modula2-Symbol def-Symbol'>:</span> long <span class='modula2-Symbol def-Symbol'>:</span> LONGCARD<span class='modula2-Symbol def-Symbol'>;</span>
782:             <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
783:           <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
784: 
785: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
786:   Flush<span class='modula2-Symbol def-Symbol'>(</span> F <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
787:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
788:     CX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
789:     DX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
790:     AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>4201H</span><span class='modula2-Symbol def-Symbol'>;</span>   <span class='modula2-Comment def-Comment def-Syntax'>(* seek relative *)</span>
791:     BX <span class='modula2-Symbol def-Symbol'>:=</span> F<span class='modula2-Symbol def-Symbol'>;</span>
792:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
793:     conv1<span class='modula2-Number def-Number'>.</span>hi <span class='modula2-Symbol def-Symbol'>:=</span> DX<span class='modula2-Symbol def-Symbol'>;</span>
794:     conv1<span class='modula2-Number def-Number'>.</span>lo <span class='modula2-Symbol def-Symbol'>:=</span> AX<span class='modula2-Symbol def-Symbol'>;</span>
795:     CX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
796:     DX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
797:     AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>4202H</span><span class='modula2-Symbol def-Symbol'>;</span>   <span class='modula2-Comment def-Comment def-Syntax'>(* seek relative to end *)</span>
798:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
799:     conv2<span class='modula2-Number def-Number'>.</span>hi <span class='modula2-Symbol def-Symbol'>:=</span> DX<span class='modula2-Symbol def-Symbol'>;</span>
800:     conv2<span class='modula2-Number def-Number'>.</span>lo <span class='modula2-Symbol def-Symbol'>:=</span> AX<span class='modula2-Symbol def-Symbol'>;</span>
801:     CX <span class='modula2-Symbol def-Symbol'>:=</span> conv1<span class='modula2-Number def-Number'>.</span>hi<span class='modula2-Symbol def-Symbol'>;</span>
802:     DX <span class='modula2-Symbol def-Symbol'>:=</span> conv1<span class='modula2-Number def-Number'>.</span>lo<span class='modula2-Symbol def-Symbol'>;</span>
803:     AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>4200H</span><span class='modula2-Symbol def-Symbol'>;</span>   <span class='modula2-Comment def-Comment def-Syntax'>(* seek absolute *)</span>
804:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
805:     ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Size'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
806:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
807:   <span class='modula2-Keyword def-Keyword'>RETURN</span> conv2<span class='modula2-Number def-Number'>.</span>long<span class='modula2-Symbol def-Symbol'>;</span>
808: <span class='modula2-Symbol def-Symbol'>END</span> Size<span class='modula2-Symbol def-Symbol'>;</span>
809: 
810: 
811: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Erase<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>:</span><span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
812: <span class='modula2-Keyword def-Keyword'>VAR</span>
813:   r  <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
814:   fn <span class='modula2-Symbol def-Symbol'>:</span> PathStr<span class='modula2-Symbol def-Symbol'>;</span>
815: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
816:   GetName<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
817:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
818:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
819:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
820:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>41H</span><span class='modula2-Symbol def-Symbol'>;</span>
821:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
822:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span>CarryFlag<span class='modula2-Symbol def-Symbol'>}</span> <span class='modula2-Symbol def-Symbol'>*</span> Flags<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>#</span> <span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span><span class='modula2-Symbol def-Symbol'>}</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>AX <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
823:       Flags <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span><span class='modula2-Symbol def-Symbol'>}</span><span class='modula2-Symbol def-Symbol'>;</span>
824:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
825:     ErrorCheckNamed<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Erase'</span><span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
826:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
827: <span class='modula2-Symbol def-Symbol'>END</span> Erase<span class='modula2-Symbol def-Symbol'>;</span>
828: 
829: 
830: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Rename<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>,</span>newname<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
831: <span class='modula2-Keyword def-Keyword'>VAR</span>
832:   r <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
833:   fn<span class='modula2-Symbol def-Symbol'>,</span>fn2<span class='modula2-Symbol def-Symbol'>:</span> PathStr<span class='modula2-Symbol def-Symbol'>;</span>
834: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
835:   GetName<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
836:   GetName<span class='modula2-Symbol def-Symbol'>(</span>newname<span class='modula2-Symbol def-Symbol'>,</span>fn2<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
837:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
838:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
839:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
840:     ES <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>fn2<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
841:     DI <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>fn2<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
842:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>56H</span><span class='modula2-Symbol def-Symbol'>;</span>
843:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
844:     ErrorCheckNamed<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'Rename'</span><span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
845:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
846: <span class='modula2-Symbol def-Symbol'>END</span> Rename<span class='modula2-Symbol def-Symbol'>;</span>
847: 
848: 
849: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> ReadFirstEntry <span class='modula2-Symbol def-Symbol'>(</span> DirName <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
850:                            Attr    <span class='modula2-Symbol def-Symbol'>:</span> FileAttr<span class='modula2-Symbol def-Symbol'>;</span>
851:                            <span class='modula2-Keyword def-Keyword'>VAR</span> D   <span class='modula2-Symbol def-Symbol'>:</span> DirEntry<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span><span class='modula2-Symbol def-Symbol'>;</span>
852: <span class='modula2-Keyword def-Keyword'>VAR</span>
853:   r  <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
854:   fn <span class='modula2-Symbol def-Symbol'>:</span> PathStr<span class='modula2-Symbol def-Symbol'>;</span>
855: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
856:   GetName<span class='modula2-Symbol def-Symbol'>(</span>DirName<span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
857:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
858:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1AH</span><span class='modula2-Symbol def-Symbol'>;</span>
859:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>D<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
860:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>D<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
861:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>    <span class='modula2-Comment def-Comment def-Syntax'>(* set DTA *)</span>
862:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>4EH</span><span class='modula2-Symbol def-Symbol'>;</span>
863:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
864:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
865:     CL <span class='modula2-Symbol def-Symbol'>:=</span> SHORTCARD<span class='modula2-Symbol def-Symbol'>(</span>Attr<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
866:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
867:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span>CarryFlag<span class='modula2-Symbol def-Symbol'>}</span> <span class='modula2-Symbol def-Symbol'>*</span> Flags<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>#</span> <span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span><span class='modula2-Symbol def-Symbol'>}</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>AX <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>18</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
868:       IOR <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
869:       <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
870:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
871:     ErrorCheckNamed<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'ReadFirstEntry'</span><span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
872:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
873:   <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
874: <span class='modula2-Symbol def-Symbol'>END</span> ReadFirstEntry<span class='modula2-Symbol def-Symbol'>;</span>
875: 
876: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> ReadNextEntry<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Keyword def-Keyword'>VAR</span> D<span class='modula2-Symbol def-Symbol'>:</span> DirEntry<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span><span class='modula2-Symbol def-Symbol'>;</span>
877: <span class='modula2-Keyword def-Keyword'>VAR</span>
878:   r <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
879: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
880:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
881:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1AH</span><span class='modula2-Symbol def-Symbol'>;</span>
882:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>D<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
883:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>D<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
884:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>    <span class='modula2-Comment def-Comment def-Syntax'>(* set DTA *)</span>
885:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>4FH</span><span class='modula2-Symbol def-Symbol'>;</span>
886:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
887:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span>CarryFlag<span class='modula2-Symbol def-Symbol'>}</span> <span class='modula2-Symbol def-Symbol'>*</span> Flags<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>#</span> <span class='def-TypeKeyword def-Keyword'>BITSET</span><span class='modula2-Symbol def-Symbol'>{</span><span class='modula2-Symbol def-Symbol'>}</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>AX <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>18</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
888:       IOR <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
889:       <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
890:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
891:     ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'ReadNextEntry'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
892:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
893:   <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
894: <span class='modula2-Symbol def-Symbol'>END</span> ReadNextEntry<span class='modula2-Symbol def-Symbol'>;</span>
895: 
896: 
897: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> ChDir<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
898: <span class='modula2-Keyword def-Keyword'>VAR</span>
899:   r  <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
900:   fn <span class='modula2-Symbol def-Symbol'>:</span> PathStr<span class='modula2-Symbol def-Symbol'>;</span>
901: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
902:   GetName<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
903:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
904:     <span class='modula2-Symbol def-Symbol'>IF</span> fn<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-String def-String'>':'</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
905:       AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0EH</span><span class='modula2-Symbol def-Symbol'>;</span>
906:       DL <span class='modula2-Symbol def-Symbol'>:=</span> SHORTCARD<span class='modula2-Symbol def-Symbol'>(</span>CAP<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>-</span>SHORTCARD<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-String def-String'>'A'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
907:       Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
908:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
909:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
910:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
911:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>3BH</span><span class='modula2-Symbol def-Symbol'>;</span>
912:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
913:     ErrorCheckNamed<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'ChDir'</span><span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
914:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
915: <span class='modula2-Symbol def-Symbol'>END</span> ChDir<span class='modula2-Symbol def-Symbol'>;</span>
916: 
917: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> MkDir<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
918: <span class='modula2-Keyword def-Keyword'>VAR</span>
919:   r  <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
920:   fn <span class='modula2-Symbol def-Symbol'>:</span> PathStr<span class='modula2-Symbol def-Symbol'>;</span>
921: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
922:   GetName<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
923:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
924:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
925:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
926:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>39H</span><span class='modula2-Symbol def-Symbol'>;</span>
927:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
928:     ErrorCheckNamed<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'MkDir'</span><span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
929:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
930: <span class='modula2-Symbol def-Symbol'>END</span> MkDir<span class='modula2-Symbol def-Symbol'>;</span>
931: 
932: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> RmDir<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
933: <span class='modula2-Keyword def-Keyword'>VAR</span>
934:   r  <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
935:   fn <span class='modula2-Symbol def-Symbol'>:</span> PathStr<span class='modula2-Symbol def-Symbol'>;</span>
936: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
937:   GetName<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
938:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
939:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
940:     DX <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
941:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>3AH</span><span class='modula2-Symbol def-Symbol'>;</span>
942:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
943:     ErrorCheckNamed<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'RmDir'</span><span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
944:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
945: <span class='modula2-Symbol def-Symbol'>END</span> RmDir<span class='modula2-Symbol def-Symbol'>;</span>
946: 
947: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> GetDir<span class='modula2-Symbol def-Symbol'>(</span>drive<span class='modula2-Symbol def-Symbol'>:</span> SHORTCARD<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>VAR</span> Name<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
948: <span class='modula2-Keyword def-Keyword'>VAR</span>
949:   r  <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
950:   fn <span class='modula2-Symbol def-Symbol'>:</span> PathStr<span class='modula2-Symbol def-Symbol'>;</span>
951: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
952:   <span class='modula2-Symbol def-Symbol'>WITH</span> r <span class='modula2-Keyword def-Keyword'>DO</span>
953:     DS <span class='modula2-Symbol def-Symbol'>:=</span> Seg<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
954:     SI <span class='modula2-Symbol def-Symbol'>:=</span> Ofs<span class='modula2-Symbol def-Symbol'>(</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
955:     DL <span class='modula2-Symbol def-Symbol'>:=</span> drive<span class='modula2-Symbol def-Symbol'>;</span>
956:     AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>47H</span><span class='modula2-Symbol def-Symbol'>;</span>
957:     Lib<span class='modula2-Number def-Number'>.</span>Dos<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
958:     ErrorCheck<span class='modula2-Symbol def-Symbol'>(</span>r<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>'GetDir'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
959:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
960:   Copy<span class='modula2-Symbol def-Symbol'>(</span>Name<span class='modula2-Symbol def-Symbol'>,</span>fn<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
961: <span class='modula2-Symbol def-Symbol'>END</span> GetDir<span class='modula2-Symbol def-Symbol'>;</span>
962: 
963: 
964: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> InitBufInf<span class='modula2-Symbol def-Symbol'>;</span>
965: <span class='modula2-Keyword def-Keyword'>VAR</span> i <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
966: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
967:   <span class='modula2-Symbol def-Symbol'>FOR</span> i <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>TO</span> MaxHandle <span class='modula2-Keyword def-Keyword'>DO</span> BufInf<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
968: <span class='modula2-Symbol def-Symbol'>END</span> InitBufInf<span class='modula2-Symbol def-Symbol'>;</span>
969: 
970: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> AssignBuffer<span class='modula2-Symbol def-Symbol'>(</span>F<span class='modula2-Symbol def-Symbol'>:</span> File<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>VAR</span> Buf<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>BYTE</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
971: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
972:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>F <span class='modula2-Symbol def-Symbol'>&lt;=</span> MaxHandle<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span> HIGH<span class='modula2-Symbol def-Symbol'>(</span>Buf<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>></span> SIZE<span class='modula2-Symbol def-Symbol'>(</span>BufRec<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
973:     BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>Buf<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
974:     <span class='modula2-Symbol def-Symbol'>WITH</span> BufInf<span class='modula2-Symbol def-Symbol'>[</span>F<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
975:       RWPos   <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
976:       EOB     <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
977:       BufSize <span class='modula2-Symbol def-Symbol'>:=</span> HIGH<span class='modula2-Symbol def-Symbol'>(</span>Buf<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>-</span>SIZE<span class='modula2-Symbol def-Symbol'>(</span>BufRec<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>;</span>
978:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
979:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
980: <span class='modula2-Symbol def-Symbol'>END</span> AssignBuffer<span class='modula2-Symbol def-Symbol'>;</span>
981: 
982: 
983: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
984:   Eng     <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
985:   IOcheck <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
986:   OK      <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
987:   ChopOff <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
988:   Separators <span class='modula2-Symbol def-Symbol'>:=</span> CHARSET<span class='modula2-Symbol def-Symbol'>{</span>CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>9</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>13</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>26</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>' '</span><span class='modula2-Symbol def-Symbol'>}</span><span class='modula2-Symbol def-Symbol'>;</span>
989:   InitBufInf<span class='modula2-Symbol def-Symbol'>;</span>
990: <span class='modula2-Symbol def-Symbol'>END</span> FIO<span class='modula2-Symbol def-Symbol'>.</span>
991: 
992: 
