   0: <span class='modula2-Comment def-Comment def-Syntax'>(* Copyright (C) 1987 Jensen &amp; Partners International *)</span>
   1: <span class='modula2-Comment def-Comment def-Syntax'>(*$V-,R-,S-,I-,A-,O-*)</span>
   2: <span class='modula2-Keyword def-Keyword'>IMPLEMENTATION</span> <span class='modula2-Keyword def-Keyword'>MODULE</span> Window<span class='modula2-Symbol def-Symbol'>;</span>
   3: 
   4: <span class='modula2-Keyword def-Keyword'>FROM</span> <span class='def-InterfaceKeyword def-Keyword'>SYSTEM</span>  <span class='modula2-Keyword def-Keyword'>IMPORT</span> Registers<span class='modula2-Symbol def-Symbol'>,</span>CurrentProcess<span class='modula2-Symbol def-Symbol'>,</span>Seg<span class='modula2-Symbol def-Symbol'>,</span>Ofs<span class='modula2-Symbol def-Symbol'>;</span>
   5: <span class='modula2-Keyword def-Keyword'>FROM</span> Storage <span class='modula2-Keyword def-Keyword'>IMPORT</span> ALLOCATE<span class='modula2-Symbol def-Symbol'>,</span>DEALLOCATE<span class='modula2-Symbol def-Symbol'>;</span>
   6: <span class='modula2-Keyword def-Keyword'>FROM</span> Str     <span class='modula2-Keyword def-Keyword'>IMPORT</span> Length<span class='modula2-Symbol def-Symbol'>,</span>CHARSET<span class='modula2-Symbol def-Symbol'>,</span>Copy<span class='modula2-Symbol def-Symbol'>;</span>
   7: <span class='modula2-Keyword def-Keyword'>FROM</span> Lib     <span class='modula2-Keyword def-Keyword'>IMPORT</span> Move<span class='modula2-Symbol def-Symbol'>,</span>WordMove<span class='modula2-Symbol def-Symbol'>,</span>Fill<span class='modula2-Symbol def-Symbol'>,</span>WordFill<span class='modula2-Symbol def-Symbol'>,</span>ScanR<span class='modula2-Symbol def-Symbol'>,</span>FatalError<span class='modula2-Symbol def-Symbol'>;</span>
   8: <span class='modula2-Keyword def-Keyword'>FROM</span> AsmLib  <span class='modula2-Keyword def-Keyword'>IMPORT</span> BufferToScreen<span class='modula2-Symbol def-Symbol'>,</span>BufferWrite<span class='modula2-Symbol def-Symbol'>,</span>ActivePage<span class='modula2-Symbol def-Symbol'>,</span>PalXlat<span class='modula2-Symbol def-Symbol'>,</span>
   9:                     ScreenToBuffer<span class='modula2-Symbol def-Symbol'>,</span>InitScreenType<span class='modula2-Symbol def-Symbol'>;</span>
  10: 
  11: <span class='modula2-Keyword def-Keyword'>IMPORT</span> Lib<span class='modula2-Symbol def-Symbol'>,</span>IO<span class='modula2-Symbol def-Symbol'>;</span>
  12: 
  13: <span class='modula2-Keyword def-Keyword'>TYPE</span>
  14:   UseListPtr  <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Keyword def-Keyword'>POINTER</span> <span class='modula2-Keyword def-Keyword'>TO</span> UseListLink<span class='modula2-Symbol def-Symbol'>;</span>
  15:   UseListLink <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Symbol def-Symbol'>RECORD</span>
  16:                   Next <span class='modula2-Symbol def-Symbol'>:</span> UseListPtr<span class='modula2-Symbol def-Symbol'>;</span>
  17:                   Proc <span class='modula2-Symbol def-Symbol'>:</span> ADDRESS<span class='modula2-Symbol def-Symbol'>;</span>
  18:                   Wind <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
  19:                 <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  20: <span class='modula2-Keyword def-Keyword'>VAR</span>
  21:   UseList      <span class='modula2-Symbol def-Symbol'>:</span> UseListPtr<span class='modula2-Symbol def-Symbol'>;</span>
  22:   WindowStack  <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
  23:   CursorStack  <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
  24:   MultiP       <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span><span class='modula2-Symbol def-Symbol'>;</span>
  25:   Lock<span class='modula2-Symbol def-Symbol'>,</span>Unlock  <span class='modula2-Symbol def-Symbol'>:</span> PROC<span class='modula2-Symbol def-Symbol'>;</span>
  26:   CursorLines  <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span> <span class='modula2-Symbol def-Symbol'>;</span>
  27: 
  28: 
  29: <span class='modula2-Keyword def-Keyword'>CONST</span>
  30:   GuardConst <span class='modula2-Symbol def-Symbol'>=</span> <span class='modula2-Number def-Number'>4A4EH</span><span class='modula2-Symbol def-Symbol'>;</span>
  31: 
  32: 
  33: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> CheckWindow <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
  34: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
  35:   <span class='modula2-Symbol def-Symbol'>IF</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Guard<span class='modula2-Symbol def-Symbol'>-</span>Seg<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span> GuardConst <span class='modula2-Keyword def-Keyword'>THEN</span>
  36:     FatalError<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-String def-String'>'Window, Fatal error : Invalid window'</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
  37:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  38: <span class='modula2-Symbol def-Symbol'>END</span> CheckWindow<span class='modula2-Symbol def-Symbol'>;</span>
  39: 
  40: 
  41: 
  42: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> ClipFrame <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
  43: <span class='modula2-Keyword def-Keyword'>VAR</span>
  44:   i <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
  45: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
  46:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
  47:     <span class='modula2-Symbol def-Symbol'>IF</span> WDef<span class='modula2-Number def-Number'>.</span>FrameOn <span class='modula2-Keyword def-Keyword'>THEN</span> i <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1</span> <span class='modula2-Keyword def-Keyword'>ELSE</span> i <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  48:     <span class='modula2-Symbol def-Symbol'>IF</span> XA <span class='modula2-Symbol def-Symbol'>&lt;</span> WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>+</span>i <span class='modula2-Keyword def-Keyword'>THEN</span>
  49:       XA <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>+</span>i
  50:     <span class='modula2-Keyword def-Keyword'>ELSIF</span> XA <span class='modula2-Symbol def-Symbol'>></span> WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>-</span>i <span class='modula2-Keyword def-Keyword'>THEN</span>
  51:       XA <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>-</span>i
  52:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  53:     <span class='modula2-Symbol def-Symbol'>IF</span> XB <span class='modula2-Symbol def-Symbol'>></span> WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>-</span>i <span class='modula2-Keyword def-Keyword'>THEN</span>
  54:       XB <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>-</span>i
  55:     <span class='modula2-Keyword def-Keyword'>ELSIF</span> XB <span class='modula2-Symbol def-Symbol'>&lt;</span> WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>+</span>i <span class='modula2-Keyword def-Keyword'>THEN</span>
  56:       XB <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>+</span>i
  57:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  58:     <span class='modula2-Symbol def-Symbol'>IF</span> YA <span class='modula2-Symbol def-Symbol'>&lt;</span> WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>+</span>i <span class='modula2-Keyword def-Keyword'>THEN</span>
  59:       YA <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>+</span>i
  60:     <span class='modula2-Keyword def-Keyword'>ELSIF</span> YA <span class='modula2-Symbol def-Symbol'>></span> WDef<span class='modula2-Number def-Number'>.</span>Y2<span class='modula2-Symbol def-Symbol'>-</span>i <span class='modula2-Keyword def-Keyword'>THEN</span>
  61:       YA <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>Y2<span class='modula2-Symbol def-Symbol'>-</span>i
  62:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  63:     <span class='modula2-Symbol def-Symbol'>IF</span> YB <span class='modula2-Symbol def-Symbol'>></span> WDef<span class='modula2-Number def-Number'>.</span>Y2<span class='modula2-Symbol def-Symbol'>-</span>i <span class='modula2-Keyword def-Keyword'>THEN</span>
  64:       YB <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>Y2<span class='modula2-Symbol def-Symbol'>-</span>i
  65:     <span class='modula2-Keyword def-Keyword'>ELSIF</span> YB <span class='modula2-Symbol def-Symbol'>&lt;</span> WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>+</span>i <span class='modula2-Keyword def-Keyword'>THEN</span>
  66:       YB <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>+</span>i
  67:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  68:     Width <span class='modula2-Symbol def-Symbol'>:=</span> XB<span class='modula2-Symbol def-Symbol'>-</span>XA<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span> Depth <span class='modula2-Symbol def-Symbol'>:=</span> YB<span class='modula2-Symbol def-Symbol'>-</span>YA<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
  69:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  70: <span class='modula2-Symbol def-Symbol'>END</span> ClipFrame<span class='modula2-Symbol def-Symbol'>;</span>
  71: 
  72: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> ClipXY <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>VAR</span> X<span class='modula2-Symbol def-Symbol'>,</span>Y <span class='modula2-Symbol def-Symbol'>:</span> RelCoord <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
  73: <span class='modula2-Keyword def-Keyword'>VAR</span>
  74:   mw<span class='modula2-Symbol def-Symbol'>,</span>md <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
  75: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
  76:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
  77:     mw <span class='modula2-Symbol def-Symbol'>:=</span> Width<span class='modula2-Symbol def-Symbol'>;</span> md <span class='modula2-Symbol def-Symbol'>:=</span> Depth<span class='modula2-Symbol def-Symbol'>;</span>
  78:     <span class='modula2-Symbol def-Symbol'>IF</span> WDef<span class='modula2-Number def-Number'>.</span>FrameOn <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Keyword def-Keyword'>NOT</span> WDef<span class='modula2-Number def-Number'>.</span>WrapOn <span class='modula2-Keyword def-Keyword'>THEN</span>
  79:       INC<span class='modula2-Symbol def-Symbol'>(</span>md<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> INC<span class='modula2-Symbol def-Symbol'>(</span>mw<span class='modula2-Symbol def-Symbol'>)</span>
  80:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
  81:       <span class='modula2-Symbol def-Symbol'>IF</span> X<span class='modula2-Symbol def-Symbol'>=</span><span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span> X <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  82:       <span class='modula2-Symbol def-Symbol'>IF</span> Y<span class='modula2-Symbol def-Symbol'>=</span><span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span> Y <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  83:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  84:     <span class='modula2-Symbol def-Symbol'>IF</span> X<span class='modula2-Symbol def-Symbol'>></span>mw <span class='modula2-Keyword def-Keyword'>THEN</span> X <span class='modula2-Symbol def-Symbol'>:=</span> mw <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  85:     <span class='modula2-Symbol def-Symbol'>IF</span> Y<span class='modula2-Symbol def-Symbol'>></span>md <span class='modula2-Keyword def-Keyword'>THEN</span> Y <span class='modula2-Symbol def-Symbol'>:=</span> md <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  86:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
  87: <span class='modula2-Symbol def-Symbol'>END</span> ClipXY<span class='modula2-Symbol def-Symbol'>;</span>
  88: 
  89: 
  90: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> BufferSpaceFill <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> pos <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span> len <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
  91: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
  92:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
  93:     <span class='modula2-Symbol def-Symbol'>IF</span> IsPalette <span class='modula2-Keyword def-Keyword'>THEN</span>
  94:       WordFill<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>pos<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>len<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>32</span>
  95:                <span class='modula2-Symbol def-Symbol'>+</span>VAL<span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>,</span>CurPalColor<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span><span class='modula2-Number def-Number'>256</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
  96:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
  97:       WordFill<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>pos<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>len<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>32</span><span class='modula2-Symbol def-Symbol'>+</span>
  98:                ORD<span class='modula2-Symbol def-Symbol'>(</span>WDef<span class='modula2-Number def-Number'>.</span>Foreground<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span><span class='modula2-Number def-Number'>256</span><span class='modula2-Symbol def-Symbol'>+</span>ORD<span class='modula2-Symbol def-Symbol'>(</span>WDef<span class='modula2-Number def-Number'>.</span>Background<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span><span class='modula2-Number def-Number'>4096</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
  99:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 100:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 101: <span class='modula2-Symbol def-Symbol'>END</span> BufferSpaceFill<span class='modula2-Symbol def-Symbol'>;</span>
 102: 
 103: 
 104: 
 105: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> CurWin <span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 106: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 107: <span class='modula2-Comment def-Comment def-Syntax'>    Returns The current window being used for output for this process</span>
 108: <span class='modula2-Comment def-Comment def-Syntax'>    If no window assigned by Use then returns Top</span>
 109: <span class='modula2-Comment def-Comment def-Syntax'>    NB Locks window system and leaves locked if MultiP set</span>
 110: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 111: <span class='modula2-Keyword def-Keyword'>VAR</span>
 112:   u <span class='modula2-Symbol def-Symbol'>:</span> UseListPtr<span class='modula2-Symbol def-Symbol'>;</span>
 113:   p <span class='modula2-Symbol def-Symbol'>:</span> ADDRESS<span class='modula2-Symbol def-Symbol'>;</span>
 114: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 115:   <span class='modula2-Symbol def-Symbol'>IF</span> MultiP <span class='modula2-Keyword def-Keyword'>THEN</span>
 116:     Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 117:     p <span class='modula2-Symbol def-Symbol'>:=</span> CurrentProcess<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 118:     u <span class='modula2-Symbol def-Symbol'>:=</span> UseList<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 119:     <span class='modula2-Symbol def-Symbol'>LOOP</span>
 120:       <span class='modula2-Symbol def-Symbol'>IF</span> u<span class='modula2-Symbol def-Symbol'>=</span><span class='def-Constant def-Keyword'>NIL</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
 121:         <span class='modula2-Keyword def-Keyword'>RETURN</span> WindowStack <span class='modula2-Comment def-Comment def-Syntax'>(* Top() *)</span>
 122:       <span class='modula2-Keyword def-Keyword'>ELSIF</span> p<span class='modula2-Symbol def-Symbol'>=</span>u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Proc <span class='modula2-Keyword def-Keyword'>THEN</span>
 123:         <span class='modula2-Keyword def-Keyword'>RETURN</span> u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Wind<span class='modula2-Symbol def-Symbol'>;</span>
 124:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 125:       u <span class='modula2-Symbol def-Symbol'>:=</span> u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 126:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 127:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 128:   u <span class='modula2-Symbol def-Symbol'>:=</span> UseList<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 129:   <span class='modula2-Symbol def-Symbol'>IF</span> u <span class='modula2-Symbol def-Symbol'>=</span> <span class='def-Constant def-Keyword'>NIL</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>RETURN</span> WindowStack <span class='modula2-Comment def-Comment def-Syntax'>(* Top() *)</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 130:   <span class='modula2-Keyword def-Keyword'>RETURN</span> u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Wind<span class='modula2-Symbol def-Symbol'>;</span>
 131: <span class='modula2-Symbol def-Symbol'>END</span> CurWin<span class='modula2-Symbol def-Symbol'>;</span>
 132: 
 133: 
 134: 
 135: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> ResetCursor<span class='modula2-Symbol def-Symbol'>;</span>
 136: <span class='modula2-Keyword def-Keyword'>VAR</span>
 137:   R    <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
 138:   mode <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 139: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 140:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>CursorStack <span class='modula2-Symbol def-Symbol'>=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>OR</span>
 141:      ObscuredAt<span class='modula2-Symbol def-Symbol'>(</span>CursorStack<span class='modula2-Symbol def-Symbol'>,</span>CursorStack<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurrentX<span class='modula2-Symbol def-Symbol'>,</span>CursorStack<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurrentY<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
 142:     mode <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>2000H</span><span class='modula2-Symbol def-Symbol'>;</span>
 143:   <span class='modula2-Keyword def-Keyword'>ELSE</span>
 144:     <span class='modula2-Symbol def-Symbol'>WITH</span> CursorStack<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 145:       <span class='modula2-Symbol def-Symbol'>WITH</span> R <span class='modula2-Keyword def-Keyword'>DO</span>
 146:         AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>;</span>
 147:         BH <span class='modula2-Symbol def-Symbol'>:=</span> ActivePage<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 148:         DL <span class='modula2-Symbol def-Symbol'>:=</span> SHORTCARD<span class='modula2-Symbol def-Symbol'>(</span>XA<span class='modula2-Symbol def-Symbol'>+</span>CurrentX<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 149:         DH <span class='modula2-Symbol def-Symbol'>:=</span> SHORTCARD<span class='modula2-Symbol def-Symbol'>(</span>YA<span class='modula2-Symbol def-Symbol'>+</span>CurrentY<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 150:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 151:       Lib<span class='modula2-Number def-Number'>.</span>Intr<span class='modula2-Symbol def-Symbol'>(</span>R<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10H</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 152:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 153:     mode <span class='modula2-Symbol def-Symbol'>:=</span> CursorLines<span class='modula2-Symbol def-Symbol'>;</span>
 154:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 155:   R<span class='modula2-Number def-Number'>.</span>AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 156:   R<span class='modula2-Number def-Number'>.</span>CX <span class='modula2-Symbol def-Symbol'>:=</span> mode<span class='modula2-Symbol def-Symbol'>;</span>
 157:   Lib<span class='modula2-Number def-Number'>.</span>Intr<span class='modula2-Symbol def-Symbol'>(</span>R<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10H</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 158: <span class='modula2-Symbol def-Symbol'>END</span> ResetCursor<span class='modula2-Symbol def-Symbol'>;</span>
 159: 
 160: 
 161: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> UnlinkCursor <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 162: <span class='modula2-Keyword def-Keyword'>VAR</span>
 163:   w <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 164: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 165:   w <span class='modula2-Symbol def-Symbol'>:=</span> CursorStack<span class='modula2-Symbol def-Symbol'>;</span>
 166:   <span class='modula2-Symbol def-Symbol'>IF</span> w <span class='modula2-Symbol def-Symbol'>=</span> W <span class='modula2-Keyword def-Keyword'>THEN</span> CursorStack <span class='modula2-Symbol def-Symbol'>:=</span> w<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CursorChain <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 167:   <span class='modula2-Symbol def-Symbol'>LOOP</span>
 168:     <span class='modula2-Symbol def-Symbol'>IF</span> w <span class='modula2-Symbol def-Symbol'>=</span> <span class='def-Constant def-Keyword'>NIL</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 169:     <span class='modula2-Symbol def-Symbol'>IF</span> w<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CursorChain <span class='modula2-Symbol def-Symbol'>=</span> W <span class='modula2-Keyword def-Keyword'>THEN</span>
 170:       w<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CursorChain <span class='modula2-Symbol def-Symbol'>:=</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CursorChain<span class='modula2-Symbol def-Symbol'>;</span>
 171:       <span class='modula2-Keyword def-Keyword'>RETURN</span><span class='modula2-Symbol def-Symbol'>;</span>
 172:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 173:     w <span class='modula2-Symbol def-Symbol'>:=</span> w<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CursorChain<span class='modula2-Symbol def-Symbol'>;</span>
 174:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 175: <span class='modula2-Symbol def-Symbol'>END</span> UnlinkCursor<span class='modula2-Symbol def-Symbol'>;</span>
 176: 
 177: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
 178: <span class='modula2-Comment def-Comment def-Syntax'>(* Cursor Control            *)</span>
 179: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
 180: 
 181: 
 182: 
 183: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> CursorOn<span class='modula2-Symbol def-Symbol'>;</span>
 184: <span class='modula2-Keyword def-Keyword'>VAR</span>
 185:   w<span class='modula2-Symbol def-Symbol'>,</span>cw <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 186: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 187:   cw <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 188:   UnlinkCursor<span class='modula2-Symbol def-Symbol'>(</span>cw<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 189:   cw<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>CursorOn <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
 190:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Keyword def-Keyword'>NOT</span> cw<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Keyword def-Keyword'>THEN</span>
 191:     cw<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CursorChain <span class='modula2-Symbol def-Symbol'>:=</span> CursorStack<span class='modula2-Symbol def-Symbol'>;</span>
 192:     CursorStack <span class='modula2-Symbol def-Symbol'>:=</span> cw<span class='modula2-Symbol def-Symbol'>;</span>
 193:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 194:   ResetCursor<span class='modula2-Symbol def-Symbol'>;</span>
 195:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 196: <span class='modula2-Symbol def-Symbol'>END</span> CursorOn<span class='modula2-Symbol def-Symbol'>;</span>
 197: 
 198: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> CursorOff<span class='modula2-Symbol def-Symbol'>;</span>
 199: <span class='modula2-Keyword def-Keyword'>VAR</span>
 200:   w<span class='modula2-Symbol def-Symbol'>,</span>cw <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 201: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 202:   cw <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 203:   UnlinkCursor<span class='modula2-Symbol def-Symbol'>(</span>cw<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 204:   cw<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>CursorOn <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
 205:   ResetCursor<span class='modula2-Symbol def-Symbol'>;</span>
 206:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 207: <span class='modula2-Symbol def-Symbol'>END</span> CursorOff<span class='modula2-Symbol def-Symbol'>;</span>
 208: 
 209: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
 210: <span class='modula2-Comment def-Comment def-Syntax'>(* Window creation           *)</span>
 211: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
 212: 
 213: 
 214: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> MakeWindow <span class='modula2-Symbol def-Symbol'>(</span> <span class='modula2-Keyword def-Keyword'>VAR</span> WD <span class='modula2-Symbol def-Symbol'>:</span> WinDef <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 215: 
 216: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 217: <span class='modula2-Comment def-Comment def-Syntax'>  Creates a new Window descriptor</span>
 218: <span class='modula2-Comment def-Comment def-Syntax'>  The size is Inclusive of frame if needed</span>
 219: <span class='modula2-Comment def-Comment def-Syntax'>  does not allocate buffer</span>
 220: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 221: <span class='modula2-Keyword def-Keyword'>VAR</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> min <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span> <span class='modula2-Symbol def-Symbol'>;</span>
 222: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 223:   NEW<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 224:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 225:     <span class='modula2-Symbol def-Symbol'>WITH</span> WD <span class='modula2-Keyword def-Keyword'>DO</span>
 226:       <span class='modula2-Symbol def-Symbol'>IF</span> X2 <span class='modula2-Symbol def-Symbol'>>=</span> ScreenWidth <span class='modula2-Keyword def-Keyword'>THEN</span> X2<span class='modula2-Symbol def-Symbol'>:=</span>ScreenWidth<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 227:       <span class='modula2-Symbol def-Symbol'>IF</span> Y2 <span class='modula2-Symbol def-Symbol'>>=</span> ScreenDepth <span class='modula2-Keyword def-Keyword'>THEN</span> Y2<span class='modula2-Symbol def-Symbol'>:=</span>ScreenDepth<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 228:       <span class='modula2-Symbol def-Symbol'>IF</span> WD<span class='modula2-Number def-Number'>.</span>FrameOn <span class='modula2-Keyword def-Keyword'>THEN</span> min <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>2</span> <span class='modula2-Keyword def-Keyword'>ELSE</span> min <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
 229:       <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>X1<span class='modula2-Symbol def-Symbol'>+</span>min<span class='modula2-Symbol def-Symbol'>></span>X2<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> X2 <span class='modula2-Symbol def-Symbol'>:=</span> X1<span class='modula2-Symbol def-Symbol'>+</span>min <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
 230:       <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>Y1<span class='modula2-Symbol def-Symbol'>+</span>min<span class='modula2-Symbol def-Symbol'>></span>Y2<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> Y2 <span class='modula2-Symbol def-Symbol'>:=</span> Y1<span class='modula2-Symbol def-Symbol'>+</span>min <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
 231:       XA  <span class='modula2-Symbol def-Symbol'>:=</span> X1<span class='modula2-Symbol def-Symbol'>;</span> YA  <span class='modula2-Symbol def-Symbol'>:=</span> Y1<span class='modula2-Symbol def-Symbol'>;</span> XB <span class='modula2-Symbol def-Symbol'>:=</span> X2<span class='modula2-Symbol def-Symbol'>;</span> YB <span class='modula2-Symbol def-Symbol'>:=</span> Y2<span class='modula2-Symbol def-Symbol'>;</span>
 232:       Width <span class='modula2-Symbol def-Symbol'>:=</span> X2<span class='modula2-Symbol def-Symbol'>-</span>X1<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span>    <span class='modula2-Symbol def-Symbol'>;</span> Depth <span class='modula2-Symbol def-Symbol'>:=</span> Y2<span class='modula2-Symbol def-Symbol'>-</span>Y1<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 233:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 234:     WDef <span class='modula2-Symbol def-Symbol'>:=</span> WD<span class='modula2-Symbol def-Symbol'>;</span>
 235:     OWidth <span class='modula2-Symbol def-Symbol'>:=</span> Width     <span class='modula2-Symbol def-Symbol'>;</span> ODepth <span class='modula2-Symbol def-Symbol'>:=</span> Depth<span class='modula2-Symbol def-Symbol'>;</span>
 236:     CurrentX   <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 237:     CurrentY   <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 238:     Next       <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span>
 239:     Buffer     <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span>
 240:     UserRecord <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span>
 241:     IsPalette  <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
 242:     CurPalColor<span class='modula2-Symbol def-Symbol'>:=</span> NormalPaletteColor<span class='modula2-Symbol def-Symbol'>;</span>
 243:     TMode      <span class='modula2-Symbol def-Symbol'>:=</span> NoTitle<span class='modula2-Symbol def-Symbol'>;</span>
 244:     Guard      <span class='modula2-Symbol def-Symbol'>:=</span> GuardConst<span class='modula2-Symbol def-Symbol'>+</span>Seg<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 245:     Title      <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span>
 246:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 247:   ClipFrame<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 248:   <span class='modula2-Keyword def-Keyword'>RETURN</span> W<span class='modula2-Symbol def-Symbol'>;</span>
 249: <span class='modula2-Symbol def-Symbol'>END</span> MakeWindow<span class='modula2-Symbol def-Symbol'>;</span>
 250: 
 251: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> Open <span class='modula2-Symbol def-Symbol'>(</span> WD <span class='modula2-Symbol def-Symbol'>:</span> WinDef <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 252: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 253: <span class='modula2-Comment def-Comment def-Syntax'>  Opens a window on the screen ready for use</span>
 254: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 255: <span class='modula2-Keyword def-Keyword'>VAR</span>
 256:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 257: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 258:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 259:   W <span class='modula2-Symbol def-Symbol'>:=</span> MakeWindow <span class='modula2-Symbol def-Symbol'>(</span>WD<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 260:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 261:     ALLOCATE <span class='modula2-Symbol def-Symbol'>(</span> Buffer<span class='modula2-Symbol def-Symbol'>,</span>OWidth<span class='modula2-Symbol def-Symbol'>*</span>ODepth<span class='modula2-Symbol def-Symbol'>*</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 262:     BufferSpaceFill<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>,</span>OWidth<span class='modula2-Symbol def-Symbol'>*</span>ODepth<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 263:     <span class='modula2-Symbol def-Symbol'>IF</span> WD<span class='modula2-Number def-Number'>.</span>FrameOn <span class='modula2-Keyword def-Keyword'>THEN</span>
 264:       SetFrame<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>FrameDef<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>FrameFore<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>FrameBack<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 265:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 266:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 267:   <span class='modula2-Symbol def-Symbol'>IF</span> WD<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Keyword def-Keyword'>THEN</span>
 268:     Use <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>)</span>
 269:   <span class='modula2-Keyword def-Keyword'>ELSE</span>
 270:     PutOnTop <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>)</span>
 271:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 272:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 273:   <span class='modula2-Keyword def-Keyword'>RETURN</span> W<span class='modula2-Symbol def-Symbol'>;</span>
 274: <span class='modula2-Symbol def-Symbol'>END</span> Open<span class='modula2-Symbol def-Symbol'>;</span>
 275: 
 276: 
 277: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
 278: <span class='modula2-Comment def-Comment def-Syntax'>(* Window stack manipulation *)</span>
 279: <span class='modula2-Comment def-Comment def-Syntax'>(* and screen redraw         *)</span>
 280: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
 281: 
 282: 
 283: 
 284: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> Use <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 285: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 286: <span class='modula2-Comment def-Comment def-Syntax'>   Causes all subsequent output (by the current process)</span>
 287: <span class='modula2-Comment def-Comment def-Syntax'>   to appear in the specified Window</span>
 288: <span class='modula2-Comment def-Comment def-Syntax'>   NB does not have to be Top Window (or in fact on the screen at all)</span>
 289: <span class='modula2-Comment def-Comment def-Syntax'>   UseList is the MRU window</span>
 290: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 291: <span class='modula2-Keyword def-Keyword'>VAR</span>
 292:   p  <span class='modula2-Symbol def-Symbol'>:</span> ADDRESS<span class='modula2-Symbol def-Symbol'>;</span>
 293:   u  <span class='modula2-Symbol def-Symbol'>:</span> UseListPtr<span class='modula2-Symbol def-Symbol'>;</span>
 294:   up <span class='modula2-Symbol def-Symbol'>:</span> UseListPtr<span class='modula2-Symbol def-Symbol'>;</span>
 295: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 296:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 297:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 298:   p  <span class='modula2-Symbol def-Symbol'>:=</span> CurrentProcess<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 299:   up <span class='modula2-Symbol def-Symbol'>:=</span> UseList<span class='modula2-Symbol def-Symbol'>;</span>
 300:   u  <span class='modula2-Symbol def-Symbol'>:=</span> up<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 301:   <span class='modula2-Symbol def-Symbol'>LOOP</span>
 302:     <span class='modula2-Symbol def-Symbol'>IF</span> u <span class='modula2-Symbol def-Symbol'>=</span> <span class='def-Constant def-Keyword'>NIL</span> <span class='modula2-Keyword def-Keyword'>THEN</span> NEW<span class='modula2-Symbol def-Symbol'>(</span>u<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Proc <span class='modula2-Symbol def-Symbol'>:=</span> p<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>EXIT</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 303:     <span class='modula2-Symbol def-Symbol'>IF</span> p <span class='modula2-Symbol def-Symbol'>=</span> u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Proc <span class='modula2-Keyword def-Keyword'>THEN</span> up<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next <span class='modula2-Symbol def-Symbol'>:=</span> u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>EXIT</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 304:     up <span class='modula2-Symbol def-Symbol'>:=</span> u<span class='modula2-Symbol def-Symbol'>;</span> u <span class='modula2-Symbol def-Symbol'>:=</span> u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 305:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 306:   u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next <span class='modula2-Symbol def-Symbol'>:=</span> UseList<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 307:   UseList<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next <span class='modula2-Symbol def-Symbol'>:=</span> u<span class='modula2-Symbol def-Symbol'>;</span>
 308:   u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Wind <span class='modula2-Symbol def-Symbol'>:=</span> W<span class='modula2-Symbol def-Symbol'>;</span>
 309:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 310: <span class='modula2-Symbol def-Symbol'>END</span> Use<span class='modula2-Symbol def-Symbol'>;</span>
 311: 
 312: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> TakeOffStack <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* Private *)</span>
 313: <span class='modula2-Keyword def-Keyword'>VAR</span> pw <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 314: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 315:   <span class='modula2-Symbol def-Symbol'>IF</span> W <span class='modula2-Symbol def-Symbol'>=</span> WindowStack <span class='modula2-Keyword def-Keyword'>THEN</span>
 316:     WindowStack <span class='modula2-Symbol def-Symbol'>:=</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 317:   <span class='modula2-Keyword def-Keyword'>ELSE</span>
 318:     pw <span class='modula2-Symbol def-Symbol'>:=</span> WindowStack<span class='modula2-Symbol def-Symbol'>;</span>
 319:     <span class='modula2-Symbol def-Symbol'>IF</span> W <span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span> pw <span class='modula2-Keyword def-Keyword'>THEN</span>
 320:       <span class='modula2-Symbol def-Symbol'>LOOP</span>
 321:         <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>pw <span class='modula2-Symbol def-Symbol'>=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>EXIT</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 322:         <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>pw<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next <span class='modula2-Symbol def-Symbol'>=</span> W<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> pw<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next <span class='modula2-Symbol def-Symbol'>:=</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>EXIT</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 323:         pw <span class='modula2-Symbol def-Symbol'>:=</span> pw<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 324:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 325:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 326:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 327:   W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span>
 328: <span class='modula2-Symbol def-Symbol'>END</span> TakeOffStack<span class='modula2-Symbol def-Symbol'>;</span>
 329: 
 330: 
 331: 
 332: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> UpdateScreen <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> X<span class='modula2-Symbol def-Symbol'>,</span>Y <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord<span class='modula2-Symbol def-Symbol'>;</span> Len <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 333: <span class='modula2-Comment def-Comment def-Syntax'>(* Updates the screen from the window buffer *)</span>
 334: <span class='modula2-Keyword def-Keyword'>VAR</span>
 335:   NextLen<span class='modula2-Symbol def-Symbol'>,</span>
 336:   NextX <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord<span class='modula2-Symbol def-Symbol'>;</span>
 337:   w     <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 338:   oxa<span class='modula2-Symbol def-Symbol'>,</span>oxb<span class='modula2-Symbol def-Symbol'>,</span>ax<span class='modula2-Symbol def-Symbol'>,</span>bx <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord<span class='modula2-Symbol def-Symbol'>;</span>
 339:   buff  <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..</span>ScreenWidth<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 340:   a     <span class='modula2-Symbol def-Symbol'>:</span> ADDRESS<span class='modula2-Symbol def-Symbol'>;</span>
 341: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 342:   <span class='modula2-Symbol def-Symbol'>IF</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 343:   <span class='modula2-Symbol def-Symbol'>WHILE</span> Len<span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span><span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 344:     <span class='modula2-Comment def-Comment def-Syntax'>(* adjust co ordinates for crossing windows *)</span>
 345:     NextLen <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
 346:     w <span class='modula2-Symbol def-Symbol'>:=</span> WindowStack<span class='modula2-Symbol def-Symbol'>;</span>
 347:     ax <span class='modula2-Symbol def-Symbol'>:=</span> X<span class='modula2-Symbol def-Symbol'>;</span> bx <span class='modula2-Symbol def-Symbol'>:=</span> X<span class='modula2-Symbol def-Symbol'>+</span>Len<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 348:     <span class='modula2-Symbol def-Symbol'>LOOP</span>
 349:       <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>w <span class='modula2-Symbol def-Symbol'>=</span> W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Keyword def-Keyword'>OR</span><span class='modula2-Symbol def-Symbol'>(</span>w<span class='modula2-Symbol def-Symbol'>=</span><span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>EXIT</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 350:       <span class='modula2-Symbol def-Symbol'>WITH</span> w<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 351:         <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>Y<span class='modula2-Symbol def-Symbol'>>=</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>Y<span class='modula2-Symbol def-Symbol'>&lt;=</span>WDef<span class='modula2-Number def-Number'>.</span>Y2<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
 352:           oxa <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>;</span> oxb <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>;</span>
 353:           <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>ax<span class='modula2-Symbol def-Symbol'>>=</span>oxa<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>bx<span class='modula2-Symbol def-Symbol'>&lt;=</span>oxb<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>    <span class='modula2-Comment def-Comment def-Syntax'>(* wiped out *)</span>
 354:             ax <span class='modula2-Symbol def-Symbol'>:=</span> bx<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>EXIT</span><span class='modula2-Symbol def-Symbol'>;</span>
 355:           <span class='modula2-Keyword def-Keyword'>ELSIF</span> <span class='modula2-Symbol def-Symbol'>(</span>ax<span class='modula2-Symbol def-Symbol'>&lt;=</span>oxb<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>bx<span class='modula2-Symbol def-Symbol'>>=</span>oxa<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Comment def-Comment def-Syntax'>(* some interaction *)</span>
 356:             <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>ax<span class='modula2-Symbol def-Symbol'>&lt;</span>oxa<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>bx<span class='modula2-Symbol def-Symbol'>></span>oxb<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>    <span class='modula2-Comment def-Comment def-Syntax'>(* cut into two *)</span>
 357:               bx <span class='modula2-Symbol def-Symbol'>:=</span> oxa<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 358:               NextX <span class='modula2-Symbol def-Symbol'>:=</span> oxb<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 359:               NextLen <span class='modula2-Symbol def-Symbol'>:=</span> X<span class='modula2-Symbol def-Symbol'>+</span>Len<span class='modula2-Symbol def-Symbol'>-</span>NextX<span class='modula2-Symbol def-Symbol'>;</span>
 360:             <span class='modula2-Keyword def-Keyword'>ELSIF</span> <span class='modula2-Symbol def-Symbol'>(</span>bx<span class='modula2-Symbol def-Symbol'>></span>oxb<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Comment def-Comment def-Syntax'>(* left edge cut off *)</span>
 361:               ax <span class='modula2-Symbol def-Symbol'>:=</span> oxb<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 362:             <span class='modula2-Keyword def-Keyword'>ELSIF</span> <span class='modula2-Symbol def-Symbol'>(</span>ax<span class='modula2-Symbol def-Symbol'>&lt;</span>oxa<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Comment def-Comment def-Syntax'>(* right edge cut off *)</span>
 363:               bx <span class='modula2-Symbol def-Symbol'>:=</span> oxa<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 364:             <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 365:           <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 366:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 367:         w <span class='modula2-Symbol def-Symbol'>:=</span> Next<span class='modula2-Symbol def-Symbol'>;</span>
 368:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 369:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 370:     Len <span class='modula2-Symbol def-Symbol'>:=</span> bx<span class='modula2-Symbol def-Symbol'>-</span>ax<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 371:     <span class='modula2-Symbol def-Symbol'>IF</span> Len <span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
 372:       <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 373:         a <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Symbol def-Symbol'>(</span>ax<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Symbol def-Symbol'>(</span>Y<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span>OWidth<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 374:         <span class='modula2-Symbol def-Symbol'>IF</span> IsPalette <span class='modula2-Keyword def-Keyword'>THEN</span>
 375:           PalXlat<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>buff<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>a<span class='modula2-Symbol def-Symbol'>,</span>Len<span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>PalAttr<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 376:           a <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>buff<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 377:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 378:         BufferToScreen <span class='modula2-Symbol def-Symbol'>(</span> ax<span class='modula2-Symbol def-Symbol'>,</span>Y<span class='modula2-Symbol def-Symbol'>,</span>a<span class='modula2-Symbol def-Symbol'>,</span>Len<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 379:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 380:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 381:     X   <span class='modula2-Symbol def-Symbol'>:=</span> NextX<span class='modula2-Symbol def-Symbol'>;</span>
 382:     Len <span class='modula2-Symbol def-Symbol'>:=</span> NextLen<span class='modula2-Symbol def-Symbol'>;</span>
 383:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 384: <span class='modula2-Symbol def-Symbol'>END</span> UpdateScreen<span class='modula2-Symbol def-Symbol'>;</span>
 385: 
 386: 
 387: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> RedrawSection <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 388:                                  X1<span class='modula2-Symbol def-Symbol'>,</span>Y1<span class='modula2-Symbol def-Symbol'>,</span>X2<span class='modula2-Symbol def-Symbol'>,</span>Y2 <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* Private *)</span>
 389: <span class='modula2-Comment def-Comment def-Syntax'>(* redraws rectangular portion of the window from the buffer *)</span>
 390: <span class='modula2-Keyword def-Keyword'>VAR</span>
 391:   Y <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord<span class='modula2-Symbol def-Symbol'>;</span>
 392: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 393:   <span class='modula2-Symbol def-Symbol'>FOR</span> Y <span class='modula2-Symbol def-Symbol'>:=</span> Y1 <span class='modula2-Keyword def-Keyword'>TO</span> Y2 <span class='modula2-Keyword def-Keyword'>DO</span>
 394:     UpdateScreen<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>X1<span class='modula2-Symbol def-Symbol'>,</span>Y<span class='modula2-Symbol def-Symbol'>,</span>X2<span class='modula2-Symbol def-Symbol'>-</span>X1<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 395:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 396: <span class='modula2-Symbol def-Symbol'>END</span> RedrawSection<span class='modula2-Symbol def-Symbol'>;</span>
 397: 
 398: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> RedrawWindow <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* Private *)</span>
 399: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 400:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 401:     RedrawSection <span class='modula2-Symbol def-Symbol'>(</span> W<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>Y2 <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 402:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 403: <span class='modula2-Symbol def-Symbol'>END</span> RedrawWindow<span class='modula2-Symbol def-Symbol'>;</span>
 404: 
 405: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> RedrawWindowPane <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* Private *)</span>
 406: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 407:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 408:     RedrawSection <span class='modula2-Symbol def-Symbol'>(</span> W<span class='modula2-Symbol def-Symbol'>,</span>XA<span class='modula2-Symbol def-Symbol'>,</span>YA<span class='modula2-Symbol def-Symbol'>,</span>XB<span class='modula2-Symbol def-Symbol'>,</span>YB <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 409:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 410: <span class='modula2-Symbol def-Symbol'>END</span> RedrawWindowPane<span class='modula2-Symbol def-Symbol'>;</span>
 411: 
 412: 
 413: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> DisplayBeneath <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> NW <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* Private *)</span>
 414: <span class='modula2-Comment def-Comment def-Syntax'>(* Re-displays windows Obscured by W from NW *)</span>
 415: <span class='modula2-Keyword def-Keyword'>VAR</span>
 416:   x1<span class='modula2-Symbol def-Symbol'>,</span>x2<span class='modula2-Symbol def-Symbol'>,</span>y1<span class='modula2-Symbol def-Symbol'>,</span>y2 <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord<span class='modula2-Symbol def-Symbol'>;</span>
 417: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 418:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 419:     <span class='modula2-Symbol def-Symbol'>WHILE</span> NW<span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span><span class='def-Constant def-Keyword'>NIL</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 420:       <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>(</span>WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>>=</span>NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Keyword def-Keyword'>AND</span><span class='modula2-Symbol def-Symbol'>(</span>NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>>=</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span>
 421:           <span class='modula2-Symbol def-Symbol'>(</span>WDef<span class='modula2-Number def-Number'>.</span>Y2<span class='modula2-Symbol def-Symbol'>>=</span>NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Keyword def-Keyword'>AND</span><span class='modula2-Symbol def-Symbol'>(</span>NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Y2<span class='modula2-Symbol def-Symbol'>>=</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Comment def-Comment def-Syntax'>(* windows cross *)</span>
 422:          <span class='modula2-Comment def-Comment def-Syntax'>(* calculate Intersection *)</span>
 423:          <span class='modula2-Symbol def-Symbol'>IF</span> WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>></span>NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>X1 <span class='modula2-Keyword def-Keyword'>THEN</span>
 424:            x1 <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>X1
 425:          <span class='modula2-Keyword def-Keyword'>ELSE</span>
 426:            x1 <span class='modula2-Symbol def-Symbol'>:=</span> NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>X1
 427:          <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 428:          <span class='modula2-Symbol def-Symbol'>IF</span> WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>&lt;</span>NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>X2 <span class='modula2-Keyword def-Keyword'>THEN</span>
 429:            x2 <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>X2
 430:          <span class='modula2-Keyword def-Keyword'>ELSE</span>
 431:            x2 <span class='modula2-Symbol def-Symbol'>:=</span> NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>X2
 432:          <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 433:          <span class='modula2-Symbol def-Symbol'>IF</span> WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>></span>NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Y1 <span class='modula2-Keyword def-Keyword'>THEN</span>
 434:            y1 <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>Y1
 435:          <span class='modula2-Keyword def-Keyword'>ELSE</span>
 436:            y1 <span class='modula2-Symbol def-Symbol'>:=</span> NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Y1
 437:          <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 438:          <span class='modula2-Symbol def-Symbol'>IF</span> WDef<span class='modula2-Number def-Number'>.</span>Y2<span class='modula2-Symbol def-Symbol'>&lt;</span>NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Y2 <span class='modula2-Keyword def-Keyword'>THEN</span>
 439:            y2 <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>Y2
 440:          <span class='modula2-Keyword def-Keyword'>ELSE</span>
 441:            y2 <span class='modula2-Symbol def-Symbol'>:=</span> NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Y2
 442:          <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 443:          RedrawSection <span class='modula2-Symbol def-Symbol'>(</span>NW<span class='modula2-Symbol def-Symbol'>,</span> x1<span class='modula2-Symbol def-Symbol'>,</span>y1<span class='modula2-Symbol def-Symbol'>,</span>x2<span class='modula2-Symbol def-Symbol'>,</span>y2 <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 444:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 445:       NW <span class='modula2-Symbol def-Symbol'>:=</span> NW<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 446:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 447:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 448: <span class='modula2-Symbol def-Symbol'>END</span> DisplayBeneath<span class='modula2-Symbol def-Symbol'>;</span>
 449: 
 450: 
 451: 
 452: 
 453: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> PutOnTop <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 454: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 455: <span class='modula2-Comment def-Comment def-Syntax'>   Puts the specified window on the top of the window stack</span>
 456: <span class='modula2-Comment def-Comment def-Syntax'>   Ensuring that it is fully visible.</span>
 457: <span class='modula2-Comment def-Comment def-Syntax'>   If this results in other windows becoming obscured then a buffer</span>
 458: <span class='modula2-Comment def-Comment def-Syntax'>   is allocated for each of these windows.</span>
 459: <span class='modula2-Comment def-Comment def-Syntax'>   All otherwise undirected output (ie with no Use) will appear</span>
 460: <span class='modula2-Comment def-Comment def-Syntax'>   within this window.</span>
 461: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 462: 
 463: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 464:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 465:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 466:   <span class='modula2-Symbol def-Symbol'>IF</span> W <span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span> WindowStack <span class='modula2-Keyword def-Keyword'>THEN</span>
 467:     TakeOffStack<span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 468:     W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next     <span class='modula2-Symbol def-Symbol'>:=</span> WindowStack<span class='modula2-Symbol def-Symbol'>;</span>
 469:     WindowStack <span class='modula2-Symbol def-Symbol'>:=</span> W<span class='modula2-Symbol def-Symbol'>;</span>
 470:     <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 471:       WDef<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
 472:       RedrawWindow <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 473:       <span class='modula2-Symbol def-Symbol'>IF</span> WDef<span class='modula2-Number def-Number'>.</span>CursorOn <span class='modula2-Keyword def-Keyword'>THEN</span>
 474:         Use <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 475:         CursorOn<span class='modula2-Symbol def-Symbol'>;</span>
 476:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 477:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 478:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 479:   Use <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 480:   ResetCursor<span class='modula2-Symbol def-Symbol'>;</span>
 481:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 482: <span class='modula2-Symbol def-Symbol'>END</span> PutOnTop<span class='modula2-Symbol def-Symbol'>;</span>
 483: 
 484: 
 485: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> Hide <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 486: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 487: <span class='modula2-Comment def-Comment def-Syntax'>    Removes window from the Window stack and also the screen</span>
 488: <span class='modula2-Comment def-Comment def-Syntax'>    Placing the windows contents in a buffer for possible re-display later</span>
 489: <span class='modula2-Comment def-Comment def-Syntax'>    Uncovers obscured windows</span>
 490: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 491: <span class='modula2-Keyword def-Keyword'>VAR</span>
 492:   p <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 493:   w <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 494: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 495:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 496:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 497:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 498:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Keyword def-Keyword'>NOT</span> WDef<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Keyword def-Keyword'>THEN</span>
 499:       w <span class='modula2-Symbol def-Symbol'>:=</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 500:       TakeOffStack <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 501:       DisplayBeneath <span class='modula2-Symbol def-Symbol'>(</span> W<span class='modula2-Symbol def-Symbol'>,</span> w <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 502:       <span class='modula2-Symbol def-Symbol'>IF</span> WDef<span class='modula2-Number def-Number'>.</span>CursorOn <span class='modula2-Keyword def-Keyword'>THEN</span> CursorOff<span class='modula2-Symbol def-Symbol'>;</span> WDef<span class='modula2-Number def-Number'>.</span>CursorOn <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 503:       WDef<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
 504:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 505:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 506:   ResetCursor<span class='modula2-Symbol def-Symbol'>;</span>
 507:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 508: <span class='modula2-Symbol def-Symbol'>END</span> Hide<span class='modula2-Symbol def-Symbol'>;</span>
 509: 
 510: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> PutBeneath <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> WA <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 511: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 512: <span class='modula2-Comment def-Comment def-Syntax'>    Puts window W beneath window WA</span>
 513: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 514: <span class='modula2-Keyword def-Keyword'>VAR</span>
 515:   p <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 516:   w <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 517: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 518:   Hide<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 519:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 520:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>WA<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 521:   <span class='modula2-Symbol def-Symbol'>WITH</span> WA<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 522:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Keyword def-Keyword'>NOT</span> WDef<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Keyword def-Keyword'>THEN</span>
 523:       w <span class='modula2-Symbol def-Symbol'>:=</span> Next<span class='modula2-Symbol def-Symbol'>;</span>
 524:       Next <span class='modula2-Symbol def-Symbol'>:=</span> W<span class='modula2-Symbol def-Symbol'>;</span>
 525:       W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next <span class='modula2-Symbol def-Symbol'>:=</span> w<span class='modula2-Symbol def-Symbol'>;</span>
 526:       W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
 527:       RedrawWindow <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 528:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 529:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 530:   ResetCursor<span class='modula2-Symbol def-Symbol'>;</span>
 531:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 532: <span class='modula2-Symbol def-Symbol'>END</span> PutBeneath<span class='modula2-Symbol def-Symbol'>;</span>
 533: 
 534: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> SnapShot<span class='modula2-Symbol def-Symbol'>;</span>
 535: <span class='modula2-Comment def-Comment def-Syntax'>(* Updates the Window buffer from the screen *)</span>
 536: <span class='modula2-Comment def-Comment def-Syntax'>(* only works with non palette windows       *)</span>
 537: <span class='modula2-Keyword def-Keyword'>VAR</span>
 538:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 539:   y <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 540:   p <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 541: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 542:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 543:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 544:     <span class='modula2-Symbol def-Symbol'>WITH</span> WDef <span class='modula2-Keyword def-Keyword'>DO</span>
 545:       <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Keyword def-Keyword'>NOT</span> IsPalette <span class='modula2-Keyword def-Keyword'>THEN</span>
 546:         p <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
 547:         <span class='modula2-Symbol def-Symbol'>FOR</span> y <span class='modula2-Symbol def-Symbol'>:=</span> Y1 <span class='modula2-Keyword def-Keyword'>TO</span> Y2 <span class='modula2-Keyword def-Keyword'>DO</span>
 548:           ScreenToBuffer<span class='modula2-Symbol def-Symbol'>(</span>X1<span class='modula2-Symbol def-Symbol'>,</span>y<span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>p<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>OWidth<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 549:           INC<span class='modula2-Symbol def-Symbol'>(</span>p<span class='modula2-Symbol def-Symbol'>,</span>OWidth<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 550:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 551:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 552:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 553:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 554:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 555: <span class='modula2-Symbol def-Symbol'>END</span> SnapShot<span class='modula2-Symbol def-Symbol'>;</span>
 556: 
 557: 
 558: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
 559: <span class='modula2-Comment def-Comment def-Syntax'>(* Window disposal           *)</span>
 560: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
 561: 
 562: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> DisposeTitle <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 563: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 564:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 565:     <span class='modula2-Symbol def-Symbol'>IF</span> TMode <span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span> NoTitle <span class='modula2-Keyword def-Keyword'>THEN</span>
 566:       DEALLOCATE<span class='modula2-Symbol def-Symbol'>(</span>Title<span class='modula2-Symbol def-Symbol'>,</span>Length<span class='modula2-Symbol def-Symbol'>(</span>Title<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 567:       TMode <span class='modula2-Symbol def-Symbol'>:=</span> NoTitle<span class='modula2-Symbol def-Symbol'>;</span>
 568:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 569:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 570: <span class='modula2-Symbol def-Symbol'>END</span> DisposeTitle<span class='modula2-Symbol def-Symbol'>;</span>
 571: 
 572: 
 573: 
 574: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> Close <span class='modula2-Symbol def-Symbol'>(</span> <span class='modula2-Keyword def-Keyword'>VAR</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 575: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 576: <span class='modula2-Comment def-Comment def-Syntax'>     removes the specified window from the screen</span>
 577: <span class='modula2-Comment def-Comment def-Syntax'>     deletes window descriptor and</span>
 578: <span class='modula2-Comment def-Comment def-Syntax'>     de-allocates any buffers previously allocated.</span>
 579: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 580: <span class='modula2-Keyword def-Keyword'>VAR</span>
 581:   w       <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 582:   u<span class='modula2-Symbol def-Symbol'>,</span>up<span class='modula2-Symbol def-Symbol'>,</span>un <span class='modula2-Symbol def-Symbol'>:</span> UseListPtr<span class='modula2-Symbol def-Symbol'>;</span>
 583: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 584:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 585:   Hide <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 586:   TakeOffStack <span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 587:   UnlinkCursor<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 588:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 589:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>Buffer <span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> DEALLOCATE<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>,</span>OWidth <span class='modula2-Symbol def-Symbol'>*</span> ODepth <span class='modula2-Symbol def-Symbol'>*</span> <span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 590:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 591:   up <span class='modula2-Symbol def-Symbol'>:=</span> UseList<span class='modula2-Symbol def-Symbol'>;</span>
 592:   u <span class='modula2-Symbol def-Symbol'>:=</span> up<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 593:   <span class='modula2-Symbol def-Symbol'>WHILE</span> <span class='modula2-Symbol def-Symbol'>(</span>u<span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span><span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 594:     un <span class='modula2-Symbol def-Symbol'>:=</span> u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next<span class='modula2-Symbol def-Symbol'>;</span>
 595:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>u<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Wind <span class='modula2-Symbol def-Symbol'>=</span> W<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
 596:       up<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next <span class='modula2-Symbol def-Symbol'>:=</span> un<span class='modula2-Symbol def-Symbol'>;</span>
 597:       DISPOSE<span class='modula2-Symbol def-Symbol'>(</span>u<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 598:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
 599:       up <span class='modula2-Symbol def-Symbol'>:=</span> u<span class='modula2-Symbol def-Symbol'>;</span>
 600:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 601:     u <span class='modula2-Symbol def-Symbol'>:=</span> un<span class='modula2-Symbol def-Symbol'>;</span>
 602:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 603:   DisposeTitle<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 604:   W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Guard <span class='modula2-Symbol def-Symbol'>:=</span> GuardConst<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* Invalidate guard *)</span>
 605:   DISPOSE<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 606:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 607: <span class='modula2-Symbol def-Symbol'>END</span> Close<span class='modula2-Symbol def-Symbol'>;</span>
 608: 
 609: 
 610: 
 611: 
 612: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> Used <span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 613: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 614: <span class='modula2-Comment def-Comment def-Syntax'>    Returns The current window being used for output for this process</span>
 615: <span class='modula2-Comment def-Comment def-Syntax'>    If no window assigned by Use then returns Top</span>
 616: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 617: <span class='modula2-Keyword def-Keyword'>VAR</span>
 618:   w <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 619: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 620:   w <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 621:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 622:   <span class='modula2-Keyword def-Keyword'>RETURN</span> w<span class='modula2-Symbol def-Symbol'>;</span>
 623: <span class='modula2-Symbol def-Symbol'>END</span> Used<span class='modula2-Symbol def-Symbol'>;</span>
 624: 
 625: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> Top <span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 626: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 627: <span class='modula2-Comment def-Comment def-Syntax'>    Returns The current top Window</span>
 628: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 629: <span class='modula2-Keyword def-Keyword'>VAR</span> w <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 630: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 631:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 632:   w <span class='modula2-Symbol def-Symbol'>:=</span> WindowStack<span class='modula2-Symbol def-Symbol'>;</span>
 633:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 634:   <span class='modula2-Keyword def-Keyword'>RETURN</span> w<span class='modula2-Symbol def-Symbol'>;</span>
 635: <span class='modula2-Symbol def-Symbol'>END</span> Top<span class='modula2-Symbol def-Symbol'>;</span>
 636: 
 637: 
 638: 
 639: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> At <span class='modula2-Symbol def-Symbol'>(</span>X<span class='modula2-Symbol def-Symbol'>,</span>Y <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 640: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 641: <span class='modula2-Comment def-Comment def-Syntax'>    Returns the window displayed at the absolute position X,Y</span>
 642: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 643: <span class='modula2-Keyword def-Keyword'>VAR</span>
 644:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 645: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 646:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 647:   W <span class='modula2-Symbol def-Symbol'>:=</span> WindowStack<span class='modula2-Symbol def-Symbol'>;</span>
 648:   <span class='modula2-Symbol def-Symbol'>LOOP</span>
 649:     <span class='modula2-Symbol def-Symbol'>IF</span> W <span class='modula2-Symbol def-Symbol'>=</span> <span class='def-Constant def-Keyword'>NIL</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>EXIT</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 650:     <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 651:       <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>Y <span class='modula2-Symbol def-Symbol'>>=</span> WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>Y <span class='modula2-Symbol def-Symbol'>&lt;=</span> WDef<span class='modula2-Number def-Number'>.</span>Y2<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span>
 652:          <span class='modula2-Symbol def-Symbol'>(</span>X <span class='modula2-Symbol def-Symbol'>>=</span> WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>X <span class='modula2-Symbol def-Symbol'>&lt;=</span> WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
 653:         <span class='modula2-Keyword def-Keyword'>EXIT</span>
 654:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 655:       W <span class='modula2-Symbol def-Symbol'>:=</span> Next<span class='modula2-Symbol def-Symbol'>;</span>
 656:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 657:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 658:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 659:   <span class='modula2-Keyword def-Keyword'>RETURN</span> W<span class='modula2-Symbol def-Symbol'>;</span>
 660: <span class='modula2-Symbol def-Symbol'>END</span> At<span class='modula2-Symbol def-Symbol'>;</span>
 661: 
 662: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> ObscuredAt <span class='modula2-Symbol def-Symbol'>(</span>W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> X<span class='modula2-Symbol def-Symbol'>,</span>Y <span class='modula2-Symbol def-Symbol'>:</span> RelCoord <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span><span class='modula2-Symbol def-Symbol'>;</span>
 663: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 664: <span class='modula2-Comment def-Comment def-Syntax'>    Returns if the specified window is obscured at the specified position</span>
 665: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 666: <span class='modula2-Keyword def-Keyword'>VAR</span>
 667:   b <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span><span class='modula2-Symbol def-Symbol'>;</span>
 668:   w <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 669: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 670:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 671:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 672:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 673:     <span class='modula2-Symbol def-Symbol'>IF</span> WDef<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Keyword def-Keyword'>THEN</span>
 674:       b<span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
 675:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
 676:       INC<span class='modula2-Symbol def-Symbol'>(</span>X<span class='modula2-Symbol def-Symbol'>,</span>XA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> INC<span class='modula2-Symbol def-Symbol'>(</span>Y<span class='modula2-Symbol def-Symbol'>,</span>YA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 677:       w <span class='modula2-Symbol def-Symbol'>:=</span> WindowStack<span class='modula2-Symbol def-Symbol'>;</span>
 678:       <span class='modula2-Symbol def-Symbol'>LOOP</span>
 679:         <span class='modula2-Symbol def-Symbol'>IF</span> w <span class='modula2-Symbol def-Symbol'>=</span> W <span class='modula2-Keyword def-Keyword'>THEN</span> b <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>EXIT</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 680:         <span class='modula2-Symbol def-Symbol'>WITH</span> w<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 681:           <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>Y<span class='modula2-Symbol def-Symbol'>>=</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>Y<span class='modula2-Symbol def-Symbol'>&lt;=</span>WDef<span class='modula2-Number def-Number'>.</span>Y2<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span>
 682:              <span class='modula2-Symbol def-Symbol'>(</span>X<span class='modula2-Symbol def-Symbol'>>=</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>AND</span> <span class='modula2-Symbol def-Symbol'>(</span>X<span class='modula2-Symbol def-Symbol'>&lt;=</span>WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
 683:             b <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
 684:             <span class='modula2-Keyword def-Keyword'>EXIT</span>
 685:           <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 686:           w <span class='modula2-Symbol def-Symbol'>:=</span> Next<span class='modula2-Symbol def-Symbol'>;</span>
 687:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 688:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 689:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 690:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 691:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 692:   <span class='modula2-Keyword def-Keyword'>RETURN</span> b<span class='modula2-Symbol def-Symbol'>;</span>
 693: <span class='modula2-Symbol def-Symbol'>END</span> ObscuredAt<span class='modula2-Symbol def-Symbol'>;</span>
 694: 
 695: 
 696: 
 697: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> WindowWrite <span class='modula2-Symbol def-Symbol'>(</span> W     <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 698:                                x<span class='modula2-Symbol def-Symbol'>,</span>y   <span class='modula2-Symbol def-Symbol'>:</span> RelCoord<span class='modula2-Symbol def-Symbol'>;</span>
 699:                                Len   <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 700:                                str   <span class='modula2-Symbol def-Symbol'>:</span> ADDRESS<span class='modula2-Symbol def-Symbol'>;</span>
 701:                                frame <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* Private *)</span>
 702: <span class='modula2-Keyword def-Keyword'>VAR</span>
 703:   Attr <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 704:   X<span class='modula2-Symbol def-Symbol'>,</span>Y  <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord<span class='modula2-Symbol def-Symbol'>;</span>
 705: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 706:   <span class='modula2-Symbol def-Symbol'>IF</span> Len<span class='modula2-Symbol def-Symbol'>></span><span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
 707:     <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 708:       <span class='modula2-Symbol def-Symbol'>IF</span> IsPalette <span class='modula2-Keyword def-Keyword'>THEN</span>
 709:         <span class='modula2-Symbol def-Symbol'>IF</span> frame <span class='modula2-Keyword def-Keyword'>THEN</span>
 710:           Attr <span class='modula2-Symbol def-Symbol'>:=</span> VAL<span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>,</span>FramePaletteColor<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 711:         <span class='modula2-Keyword def-Keyword'>ELSE</span>
 712:           Attr <span class='modula2-Symbol def-Symbol'>:=</span> VAL<span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>,</span>CurPalColor<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 713:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 714:       <span class='modula2-Keyword def-Keyword'>ELSIF</span> frame <span class='modula2-Keyword def-Keyword'>THEN</span>
 715:         Attr <span class='modula2-Symbol def-Symbol'>:=</span> ORD<span class='modula2-Symbol def-Symbol'>(</span>WDef<span class='modula2-Number def-Number'>.</span>FrameFore<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>+</span>ORD<span class='modula2-Symbol def-Symbol'>(</span>WDef<span class='modula2-Number def-Number'>.</span>FrameBack<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span><span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>;</span>
 716:       <span class='modula2-Keyword def-Keyword'>ELSE</span>
 717:         Attr <span class='modula2-Symbol def-Symbol'>:=</span> ORD<span class='modula2-Symbol def-Symbol'>(</span>WDef<span class='modula2-Number def-Number'>.</span>Foreground<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>+</span>ORD<span class='modula2-Symbol def-Symbol'>(</span>WDef<span class='modula2-Number def-Number'>.</span>Background<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span><span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>;</span>
 718:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 719:       X <span class='modula2-Symbol def-Symbol'>:=</span> x<span class='modula2-Symbol def-Symbol'>+</span>XA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span> Y <span class='modula2-Symbol def-Symbol'>:=</span> y<span class='modula2-Symbol def-Symbol'>+</span>YA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 720:       <span class='modula2-Symbol def-Symbol'>IF</span> Len<span class='modula2-Symbol def-Symbol'>+</span>X<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>></span> WDef<span class='modula2-Number def-Number'>.</span>X2 <span class='modula2-Keyword def-Keyword'>THEN</span> Len <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>X2<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>-</span>X <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 721:       BufferWrite <span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>X<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Symbol def-Symbol'>(</span>Y<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span>OWidth<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>str<span class='modula2-Symbol def-Symbol'>,</span>Len<span class='modula2-Symbol def-Symbol'>,</span>Attr<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 722:       UpdateScreen<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>X<span class='modula2-Symbol def-Symbol'>,</span>Y<span class='modula2-Symbol def-Symbol'>,</span>Len<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 723:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 724:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 725: <span class='modula2-Symbol def-Symbol'>END</span> WindowWrite<span class='modula2-Symbol def-Symbol'>;</span>
 726: 
 727: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> DrawFrame <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 728: <span class='modula2-Keyword def-Keyword'>VAR</span>
 729:   s      <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..81</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
 730:   w<span class='modula2-Symbol def-Symbol'>,</span>l<span class='modula2-Symbol def-Symbol'>,</span>tl <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 731:   i      <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 732: 
 733:   <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> PutTitle <span class='modula2-Symbol def-Symbol'>(</span> mode <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span> row <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 734:   <span class='modula2-Keyword def-Keyword'>VAR</span>
 735:     i<span class='modula2-Symbol def-Symbol'>,</span>j <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 736:   <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 737:     <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 738:       <span class='modula2-Symbol def-Symbol'>CASE</span> mode <span class='modula2-Keyword def-Keyword'>OF</span>
 739:         <span class='modula2-Number def-Number'>0</span> <span class='modula2-Symbol def-Symbol'>:</span> i <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1</span>                     <span class='modula2-Symbol def-Symbol'>|</span>
 740:         <span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>:</span> i <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Symbol def-Symbol'>(</span>Width<span class='modula2-Symbol def-Symbol'>-</span>tl<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>DIV</span> <span class='modula2-Number def-Number'>2</span> <span class='modula2-Symbol def-Symbol'>+</span> <span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Symbol def-Symbol'>|</span>
 741:         <span class='modula2-Number def-Number'>2</span> <span class='modula2-Symbol def-Symbol'>:</span> i <span class='modula2-Symbol def-Symbol'>:=</span> Width<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>-</span>tl            <span class='modula2-Symbol def-Symbol'>|</span>
 742:       <span class='modula2-Keyword def-Keyword'>ELSE</span>
 743:         i <span class='modula2-Symbol def-Symbol'>:=</span> MAX<span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 744:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 745:       j <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
 746:       <span class='modula2-Symbol def-Symbol'>WHILE</span> <span class='modula2-Symbol def-Symbol'>(</span>i<span class='modula2-Symbol def-Symbol'>&lt;=</span>Width<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Keyword def-Keyword'>AND</span><span class='modula2-Symbol def-Symbol'>(</span>j<span class='modula2-Symbol def-Symbol'>&lt;</span>tl<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 747:         s<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> Title<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>j<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>;</span> INC<span class='modula2-Symbol def-Symbol'>(</span>i<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> INC<span class='modula2-Symbol def-Symbol'>(</span>j<span class='modula2-Symbol def-Symbol'>)</span>
 748:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 749:       WindowWrite <span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>,</span>row<span class='modula2-Symbol def-Symbol'>,</span>OWidth<span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>s<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span><span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 750:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 751:   <span class='modula2-Symbol def-Symbol'>END</span> PutTitle<span class='modula2-Symbol def-Symbol'>;</span>
 752: 
 753: 
 754: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 755:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 756:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Keyword def-Keyword'>NOT</span> WDef<span class='modula2-Number def-Number'>.</span>FrameOn <span class='modula2-Keyword def-Keyword'>THEN</span>
 757:       <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>OWidth<span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Number def-Number'>3</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Keyword def-Keyword'>OR</span><span class='modula2-Symbol def-Symbol'>(</span>ODepth<span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Number def-Number'>3</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* No Room *)</span>
 758:       WDef<span class='modula2-Number def-Number'>.</span>FrameOn <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
 759:       ClipFrame<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 760:       ResetCursor<span class='modula2-Symbol def-Symbol'>;</span>
 761:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 762:     s<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>FrameDef<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>;</span>
 763:     Fill<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>s<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>Width<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>FrameDef<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 764:     s<span class='modula2-Symbol def-Symbol'>[</span>Width<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>FrameDef<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>;</span>
 765:     <span class='modula2-Symbol def-Symbol'>IF</span> TMode <span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span> NoTitle <span class='modula2-Keyword def-Keyword'>THEN</span>
 766:       tl <span class='modula2-Symbol def-Symbol'>:=</span> Length<span class='modula2-Symbol def-Symbol'>(</span>Title<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 767:       <span class='modula2-Symbol def-Symbol'>IF</span> tl<span class='modula2-Symbol def-Symbol'>></span>Width <span class='modula2-Keyword def-Keyword'>THEN</span> tl <span class='modula2-Symbol def-Symbol'>:=</span> Width <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 768:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 769:     PutTitle<span class='modula2-Symbol def-Symbol'>(</span>ORD<span class='modula2-Symbol def-Symbol'>(</span>TMode<span class='modula2-Symbol def-Symbol'>-</span>LeftUpperTitle<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 770:     <span class='modula2-Comment def-Comment def-Syntax'>(* Sides *)</span>
 771:     <span class='modula2-Symbol def-Symbol'>FOR</span> i <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1</span> <span class='modula2-Keyword def-Keyword'>TO</span> Depth <span class='modula2-Keyword def-Keyword'>DO</span>
 772:       WindowWrite<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>,</span>i<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>WDef<span class='modula2-Number def-Number'>.</span>FrameDef<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>3</span><span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span><span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 773:       WindowWrite<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>Width<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>i<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>WDef<span class='modula2-Number def-Number'>.</span>FrameDef<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>4</span><span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span><span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 774:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 775:     s<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>FrameDef<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>5</span><span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>;</span>
 776:     Fill<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>s<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>Width<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>FrameDef<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>6</span><span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 777:     s<span class='modula2-Symbol def-Symbol'>[</span>Width<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Number def-Number'>.</span>FrameDef<span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>7</span><span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>;</span>
 778:     PutTitle<span class='modula2-Symbol def-Symbol'>(</span>ORD<span class='modula2-Symbol def-Symbol'>(</span>TMode<span class='modula2-Symbol def-Symbol'>-</span>LeftLowerTitle<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>Depth<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 779:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 780: <span class='modula2-Symbol def-Symbol'>END</span> DrawFrame<span class='modula2-Symbol def-Symbol'>;</span>
 781: 
 782: 
 783: 
 784: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span>  <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> SetFrame <span class='modula2-Symbol def-Symbol'>(</span> W     <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 785:                              Frame <span class='modula2-Symbol def-Symbol'>:</span> FrameStr<span class='modula2-Symbol def-Symbol'>;</span>
 786:                              Fore<span class='modula2-Symbol def-Symbol'>,</span> Back  <span class='modula2-Symbol def-Symbol'>:</span> Color <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 787: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 788: <span class='modula2-Comment def-Comment def-Syntax'>   Put a frame around the specified window</span>
 789: <span class='modula2-Comment def-Comment def-Syntax'>   With Title String and border definition (see above)</span>
 790: <span class='modula2-Comment def-Comment def-Syntax'>   having specified fore/background colours for the border</span>
 791: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 792: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 793:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 794:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 795:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 796:     WDef<span class='modula2-Number def-Number'>.</span>FrameDef <span class='modula2-Symbol def-Symbol'>:=</span> Frame<span class='modula2-Symbol def-Symbol'>;</span>
 797:     WDef<span class='modula2-Number def-Number'>.</span>FrameFore <span class='modula2-Symbol def-Symbol'>:=</span> Fore<span class='modula2-Symbol def-Symbol'>;</span>
 798:     WDef<span class='modula2-Number def-Number'>.</span>FrameBack <span class='modula2-Symbol def-Symbol'>:=</span> Back<span class='modula2-Symbol def-Symbol'>;</span>
 799:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 800:   DrawFrame<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 801:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 802: <span class='modula2-Symbol def-Symbol'>END</span> SetFrame<span class='modula2-Symbol def-Symbol'>;</span>
 803: 
 804: 
 805: 
 806: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> MergeWindows <span class='modula2-Symbol def-Symbol'>(</span> s<span class='modula2-Symbol def-Symbol'>,</span>d <span class='modula2-Symbol def-Symbol'>:</span> WinType <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 807: <span class='modula2-Comment def-Comment def-Syntax'>(* slightly complicated procedure to merge two windows</span>
 808: <span class='modula2-Comment def-Comment def-Syntax'>   s is new (hidden) window</span>
 809: <span class='modula2-Comment def-Comment def-Syntax'>   d is old window to be merged into</span>
 810: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 811: <span class='modula2-Keyword def-Keyword'>VAR</span>
 812:   w <span class='modula2-Symbol def-Symbol'>:</span> WinDescriptor<span class='modula2-Symbol def-Symbol'>;</span>
 813:   r<span class='modula2-Symbol def-Symbol'>,</span>wd        <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 814:   sw<span class='modula2-Symbol def-Symbol'>,</span>sd<span class='modula2-Symbol def-Symbol'>,</span>so<span class='modula2-Symbol def-Symbol'>,</span>sp <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 815:   dw<span class='modula2-Symbol def-Symbol'>,</span>dd<span class='modula2-Symbol def-Symbol'>,</span>do<span class='modula2-Symbol def-Symbol'>,</span>dp <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 816: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 817:   s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurrentX    <span class='modula2-Symbol def-Symbol'>:=</span> d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurrentX<span class='modula2-Symbol def-Symbol'>;</span>
 818:   s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurrentY    <span class='modula2-Symbol def-Symbol'>:=</span> d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurrentY<span class='modula2-Symbol def-Symbol'>;</span>
 819:   s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CursorChain <span class='modula2-Symbol def-Symbol'>:=</span> d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CursorChain<span class='modula2-Symbol def-Symbol'>;</span>
 820:   s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>UserRecord  <span class='modula2-Symbol def-Symbol'>:=</span> d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>UserRecord<span class='modula2-Symbol def-Symbol'>;</span>
 821:   s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurPalColor <span class='modula2-Symbol def-Symbol'>:=</span> d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurPalColor<span class='modula2-Symbol def-Symbol'>;</span>
 822:   s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Title       <span class='modula2-Symbol def-Symbol'>:=</span> d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Title<span class='modula2-Symbol def-Symbol'>;</span>
 823:   s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>TMode       <span class='modula2-Symbol def-Symbol'>:=</span> d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>TMode<span class='modula2-Symbol def-Symbol'>;</span>
 824:   d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>TMode       <span class='modula2-Symbol def-Symbol'>:=</span> NoTitle<span class='modula2-Symbol def-Symbol'>;</span>
 825:   d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>CursorOn  <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
 826:   w <span class='modula2-Symbol def-Symbol'>:=</span> d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>;</span> d<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Symbol def-Symbol'>:=</span> s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>;</span> s<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Symbol def-Symbol'>:=</span> w<span class='modula2-Symbol def-Symbol'>;</span>
 827:   <span class='modula2-Symbol def-Symbol'>WITH</span> s<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 828:     sw <span class='modula2-Symbol def-Symbol'>:=</span> OWidth<span class='modula2-Symbol def-Symbol'>;</span> sd <span class='modula2-Symbol def-Symbol'>:=</span> ODepth<span class='modula2-Symbol def-Symbol'>;</span>
 829:     <span class='modula2-Symbol def-Symbol'>IF</span> WDef<span class='modula2-Number def-Number'>.</span>FrameOn <span class='modula2-Keyword def-Keyword'>THEN</span>
 830:       DEC<span class='modula2-Symbol def-Symbol'>(</span>sw<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> DEC<span class='modula2-Symbol def-Symbol'>(</span>sd<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 831:       sp <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Symbol def-Symbol'>(</span>OWidth<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 832:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
 833:       sp <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
 834:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 835:     Guard <span class='modula2-Symbol def-Symbol'>:=</span> GuardConst<span class='modula2-Symbol def-Symbol'>+</span>Seg<span class='modula2-Symbol def-Symbol'>(</span>s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 836:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 837:   <span class='modula2-Symbol def-Symbol'>WITH</span> d<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 838:     dw <span class='modula2-Symbol def-Symbol'>:=</span> OWidth<span class='modula2-Symbol def-Symbol'>;</span> dd <span class='modula2-Symbol def-Symbol'>:=</span> ODepth<span class='modula2-Symbol def-Symbol'>;</span>
 839:     <span class='modula2-Symbol def-Symbol'>IF</span> WDef<span class='modula2-Number def-Number'>.</span>FrameOn <span class='modula2-Keyword def-Keyword'>THEN</span>
 840:       DEC<span class='modula2-Symbol def-Symbol'>(</span>dw<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> DEC<span class='modula2-Symbol def-Symbol'>(</span>dd<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 841:       dp <span class='modula2-Symbol def-Symbol'>:=</span> OWidth<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
 842:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
 843:       dp <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
 844:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 845:     Guard <span class='modula2-Symbol def-Symbol'>:=</span> GuardConst<span class='modula2-Symbol def-Symbol'>+</span>Seg<span class='modula2-Symbol def-Symbol'>(</span>d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 846:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 847:   <span class='modula2-Symbol def-Symbol'>IF</span> sd <span class='modula2-Symbol def-Symbol'>&lt;</span> dd <span class='modula2-Keyword def-Keyword'>THEN</span> wd <span class='modula2-Symbol def-Symbol'>:=</span> sd <span class='modula2-Keyword def-Keyword'>ELSE</span> wd <span class='modula2-Symbol def-Symbol'>:=</span> dd <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 848:   <span class='modula2-Symbol def-Symbol'>FOR</span> r <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>TO</span> wd<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 849:     <span class='modula2-Symbol def-Symbol'>IF</span> sw<span class='modula2-Symbol def-Symbol'>>=</span>dw <span class='modula2-Keyword def-Keyword'>THEN</span>
 850:       WordMove<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>sp<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>dp<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>dw<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 851:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
 852:       WordMove<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>sp<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>dp<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>sw<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 853:       BufferSpaceFill<span class='modula2-Symbol def-Symbol'>(</span>d<span class='modula2-Symbol def-Symbol'>,</span>dp<span class='modula2-Symbol def-Symbol'>+</span>sw<span class='modula2-Symbol def-Symbol'>,</span>dw<span class='modula2-Symbol def-Symbol'>-</span>sw<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 854:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 855:     INC<span class='modula2-Symbol def-Symbol'>(</span>sp<span class='modula2-Symbol def-Symbol'>,</span>s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>OWidth<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> INC<span class='modula2-Symbol def-Symbol'>(</span>dp<span class='modula2-Symbol def-Symbol'>,</span>d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>OWidth<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 856:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 857:   <span class='modula2-Comment def-Comment def-Syntax'>(* now fill rest *)</span>
 858:   <span class='modula2-Symbol def-Symbol'>IF</span> wd<span class='modula2-Symbol def-Symbol'>&lt;</span>dd <span class='modula2-Keyword def-Keyword'>THEN</span>
 859:     <span class='modula2-Symbol def-Symbol'>FOR</span> r <span class='modula2-Symbol def-Symbol'>:=</span> wd <span class='modula2-Keyword def-Keyword'>TO</span> dd<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 860:       BufferSpaceFill<span class='modula2-Symbol def-Symbol'>(</span>d<span class='modula2-Symbol def-Symbol'>,</span>dp<span class='modula2-Symbol def-Symbol'>,</span>dw<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 861:       INC<span class='modula2-Symbol def-Symbol'>(</span>dp<span class='modula2-Symbol def-Symbol'>,</span>d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>OWidth<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 862:     <span class='modula2-Symbol def-Symbol'>END</span>
 863:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 864:   <span class='modula2-Symbol def-Symbol'>IF</span> d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>FrameOn <span class='modula2-Keyword def-Keyword'>THEN</span> DrawFrame<span class='modula2-Symbol def-Symbol'>(</span>d<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 865:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Keyword def-Keyword'>NOT</span> s<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Keyword def-Keyword'>THEN</span>
 866:     d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next <span class='modula2-Symbol def-Symbol'>:=</span> s<span class='modula2-Symbol def-Symbol'>;</span>
 867:     d<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
 868:     RedrawWindow<span class='modula2-Symbol def-Symbol'>(</span>d<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 869:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 870:   Close<span class='modula2-Symbol def-Symbol'>(</span>s<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 871: <span class='modula2-Symbol def-Symbol'>END</span> MergeWindows<span class='modula2-Symbol def-Symbol'>;</span>
 872: 
 873: 
 874: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> IGotoXY <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> X<span class='modula2-Symbol def-Symbol'>,</span>Y <span class='modula2-Symbol def-Symbol'>:</span> RelCoord <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 875: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 876: <span class='modula2-Comment def-Comment def-Syntax'>    Sets the current X Y position of the pane currently being used</span>
 877: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 878: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 879:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span> CurrentX <span class='modula2-Symbol def-Symbol'>:=</span> X<span class='modula2-Symbol def-Symbol'>;</span> CurrentY <span class='modula2-Symbol def-Symbol'>:=</span> Y <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 880:   <span class='modula2-Symbol def-Symbol'>IF</span> CursorStack <span class='modula2-Symbol def-Symbol'>=</span> W <span class='modula2-Keyword def-Keyword'>THEN</span> ResetCursor <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 881: <span class='modula2-Symbol def-Symbol'>END</span> IGotoXY<span class='modula2-Symbol def-Symbol'>;</span>
 882: 
 883: 
 884: 
 885: 
 886: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
 887: <span class='modula2-Comment def-Comment def-Syntax'>(* Palette procedures        *)</span>
 888: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
 889: 
 890: 
 891: 
 892: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> GetPal <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>VAR</span> Pal <span class='modula2-Symbol def-Symbol'>:</span> PaletteDef <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 893: <span class='modula2-Keyword def-Keyword'>VAR</span>
 894:   i <span class='modula2-Symbol def-Symbol'>:</span> PaletteRange<span class='modula2-Symbol def-Symbol'>;</span>
 895: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 896:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 897:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 898:     <span class='modula2-Symbol def-Symbol'>FOR</span> i <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>TO</span> PaletteMax <span class='modula2-Keyword def-Keyword'>DO</span>
 899:       Pal<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>.</span>Fore <span class='modula2-Symbol def-Symbol'>:=</span> Color<span class='modula2-Symbol def-Symbol'>(</span>PalAttr<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>MOD</span> <span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 900:       Pal<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>.</span>Back <span class='modula2-Symbol def-Symbol'>:=</span> Color<span class='modula2-Symbol def-Symbol'>(</span>PalAttr<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>DIV</span> <span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 901:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 902:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 903: <span class='modula2-Symbol def-Symbol'>END</span> GetPal<span class='modula2-Symbol def-Symbol'>;</span>
 904: 
 905: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> SetPal <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>VAR</span> Pal <span class='modula2-Symbol def-Symbol'>:</span> PaletteDef <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 906: <span class='modula2-Keyword def-Keyword'>VAR</span>
 907:   i <span class='modula2-Symbol def-Symbol'>:</span> PaletteRange<span class='modula2-Symbol def-Symbol'>;</span>
 908: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 909:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 910:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 911:     <span class='modula2-Symbol def-Symbol'>FOR</span> i <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>TO</span> PaletteMax <span class='modula2-Keyword def-Keyword'>DO</span>
 912:       PalAttr<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> VAL<span class='modula2-Symbol def-Symbol'>(</span>SHORTCARD<span class='modula2-Symbol def-Symbol'>,</span>ORD<span class='modula2-Symbol def-Symbol'>(</span>Pal<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>.</span>Fore<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>+</span>ORD<span class='modula2-Symbol def-Symbol'>(</span>Pal<span class='modula2-Symbol def-Symbol'>[</span>i<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>.</span>Back<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span><span class='modula2-Number def-Number'>16</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 913:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 914:     IsPalette <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
 915:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 916: <span class='modula2-Symbol def-Symbol'>END</span> SetPal<span class='modula2-Symbol def-Symbol'>;</span>
 917: 
 918: 
 919: 
 920: 
 921: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> PaletteOpen<span class='modula2-Symbol def-Symbol'>(</span>WD<span class='modula2-Symbol def-Symbol'>:</span> WinDef<span class='modula2-Symbol def-Symbol'>;</span> Pal<span class='modula2-Symbol def-Symbol'>:</span> PaletteDef<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 922: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 923: <span class='modula2-Comment def-Comment def-Syntax'>  Opens a window on the screen ready for use</span>
 924: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 925: <span class='modula2-Keyword def-Keyword'>VAR</span>
 926:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 927: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 928:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 929:   W <span class='modula2-Symbol def-Symbol'>:=</span> MakeWindow <span class='modula2-Symbol def-Symbol'>(</span>WD<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 930:   SetPal<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>Pal<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 931:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 932:     ALLOCATE <span class='modula2-Symbol def-Symbol'>(</span> Buffer<span class='modula2-Symbol def-Symbol'>,</span>OWidth<span class='modula2-Symbol def-Symbol'>*</span>ODepth<span class='modula2-Symbol def-Symbol'>*</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 933:     BufferSpaceFill<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>,</span>OWidth<span class='modula2-Symbol def-Symbol'>*</span>ODepth<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 934:     <span class='modula2-Symbol def-Symbol'>IF</span> WD<span class='modula2-Number def-Number'>.</span>FrameOn <span class='modula2-Keyword def-Keyword'>THEN</span>
 935:       SetFrame<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>FrameDef<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>FrameFore<span class='modula2-Symbol def-Symbol'>,</span>WDef<span class='modula2-Number def-Number'>.</span>FrameBack<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 936:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 937:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 938:   <span class='modula2-Symbol def-Symbol'>IF</span> WD<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Keyword def-Keyword'>THEN</span>
 939:     Use <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>)</span>
 940:   <span class='modula2-Keyword def-Keyword'>ELSE</span>
 941:     PutOnTop <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>)</span>
 942:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 943:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 944:   <span class='modula2-Keyword def-Keyword'>RETURN</span> W<span class='modula2-Symbol def-Symbol'>;</span>
 945: <span class='modula2-Symbol def-Symbol'>END</span> PaletteOpen<span class='modula2-Symbol def-Symbol'>;</span>
 946: 
 947: 
 948: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> SetPaletteColor <span class='modula2-Symbol def-Symbol'>(</span> c <span class='modula2-Symbol def-Symbol'>:</span> PaletteRange <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 949: <span class='modula2-Keyword def-Keyword'>VAR</span>
 950:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 951: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 952:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 953:   W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurPalColor <span class='modula2-Symbol def-Symbol'>:=</span> c<span class='modula2-Symbol def-Symbol'>;</span>
 954:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 955: <span class='modula2-Symbol def-Symbol'>END</span> SetPaletteColor<span class='modula2-Symbol def-Symbol'>;</span>
 956: 
 957: 
 958: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> PaletteColor<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> PaletteRange<span class='modula2-Symbol def-Symbol'>;</span>
 959: <span class='modula2-Keyword def-Keyword'>VAR</span>
 960:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
 961: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 962:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 963:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 964:   <span class='modula2-Keyword def-Keyword'>RETURN</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurPalColor<span class='modula2-Symbol def-Symbol'>;</span>
 965: <span class='modula2-Symbol def-Symbol'>END</span> PaletteColor<span class='modula2-Symbol def-Symbol'>;</span>
 966: 
 967: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> SetPalette<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> Pal<span class='modula2-Symbol def-Symbol'>:</span> PaletteDef<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 968: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 969: <span class='modula2-Comment def-Comment def-Syntax'>   Changes the Palette of the specified window,</span>
 970: <span class='modula2-Comment def-Comment def-Syntax'>   redisplaying the changed colors</span>
 971: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 972: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 973:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 974:   SetPal<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>Pal<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 975:   RedrawWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 976:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 977: <span class='modula2-Symbol def-Symbol'>END</span> SetPalette<span class='modula2-Symbol def-Symbol'>;</span>
 978: 
 979: 
 980: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> PaletteColorUsed<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> pc<span class='modula2-Symbol def-Symbol'>:</span> PaletteRange<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span><span class='modula2-Symbol def-Symbol'>;</span>
 981: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
 982: <span class='modula2-Comment def-Comment def-Syntax'>   Returns if color in use anywhere in the window</span>
 983: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
 984: <span class='modula2-Keyword def-Keyword'>VAR</span>
 985:   p  <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 986:   l  <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 987:   m  <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
 988:   ba <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>POINTER</span> <span class='modula2-Keyword def-Keyword'>TO</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..</span>MAX<span class='modula2-Symbol def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> SHORTCARD<span class='modula2-Symbol def-Symbol'>;</span>
 989: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
 990:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 991:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
 992:     ba <span class='modula2-Symbol def-Symbol'>:=</span> ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 993:     p  <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
 994:     m  <span class='modula2-Symbol def-Symbol'>:=</span> OWidth<span class='modula2-Symbol def-Symbol'>*</span>ODepth<span class='modula2-Symbol def-Symbol'>*</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>;</span>
 995:     <span class='modula2-Symbol def-Symbol'>LOOP</span>
 996:       l <span class='modula2-Symbol def-Symbol'>:=</span> m<span class='modula2-Symbol def-Symbol'>-</span>p<span class='modula2-Symbol def-Symbol'>;</span>
 997:       p <span class='modula2-Symbol def-Symbol'>:=</span> p<span class='modula2-Symbol def-Symbol'>+</span>ScanR<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>ba<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>p<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>l<span class='modula2-Symbol def-Symbol'>,</span>pc<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
 998:       <span class='modula2-Symbol def-Symbol'>IF</span> p <span class='modula2-Symbol def-Symbol'>>=</span> m <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-Constant def-Keyword'>FALSE</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
 999:       <span class='modula2-Symbol def-Symbol'>IF</span> ODD<span class='modula2-Symbol def-Symbol'>(</span>p<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='def-Constant def-Keyword'>TRUE</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1000:       INC<span class='modula2-Symbol def-Symbol'>(</span>p<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1001:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1002:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1003: <span class='modula2-Symbol def-Symbol'>END</span> PaletteColorUsed<span class='modula2-Symbol def-Symbol'>;</span>
1004: 
1005: 
1006: 
1007: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
1008: <span class='modula2-Comment def-Comment def-Syntax'>(* Move resize procedure     *)</span>
1009: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
1010: 
1011: 
1012: 
1013: 
1014: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> Change <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> X1<span class='modula2-Symbol def-Symbol'>,</span>Y1<span class='modula2-Symbol def-Symbol'>,</span>X2<span class='modula2-Symbol def-Symbol'>,</span>Y2 <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1015: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
1016: <span class='modula2-Comment def-Comment def-Syntax'>   Changes the size and/or position of the specified window</span>
1017: <span class='modula2-Comment def-Comment def-Syntax'>   The contents of the window will be moved with it</span>
1018: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
1019: <span class='modula2-Keyword def-Keyword'>VAR</span>
1020:   nw   <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1021:   wd   <span class='modula2-Symbol def-Symbol'>:</span> WinDef<span class='modula2-Symbol def-Symbol'>;</span>
1022:   pal  <span class='modula2-Symbol def-Symbol'>:</span> PaletteDef<span class='modula2-Symbol def-Symbol'>;</span>
1023:   save <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1024:   min  <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span> <span class='modula2-Symbol def-Symbol'>;</span>
1025: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1026:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1027:   save <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1028:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1029:     <span class='modula2-Symbol def-Symbol'>IF</span> X2<span class='modula2-Symbol def-Symbol'>>=</span>ScreenWidth <span class='modula2-Keyword def-Keyword'>THEN</span> X2<span class='modula2-Symbol def-Symbol'>:=</span>ScreenWidth<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1030:     <span class='modula2-Symbol def-Symbol'>IF</span> Y2<span class='modula2-Symbol def-Symbol'>>=</span>ScreenDepth <span class='modula2-Keyword def-Keyword'>THEN</span> Y2<span class='modula2-Symbol def-Symbol'>:=</span>ScreenDepth<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1031:     wd <span class='modula2-Symbol def-Symbol'>:=</span> WDef<span class='modula2-Symbol def-Symbol'>;</span>
1032:     <span class='modula2-Symbol def-Symbol'>IF</span> wd<span class='modula2-Number def-Number'>.</span>FrameOn <span class='modula2-Keyword def-Keyword'>THEN</span> min <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>2</span> <span class='modula2-Keyword def-Keyword'>ELSE</span> min <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span> <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
1033:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>X1<span class='modula2-Symbol def-Symbol'>+</span>min<span class='modula2-Symbol def-Symbol'>></span>X2<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Keyword def-Keyword'>OR</span><span class='modula2-Symbol def-Symbol'>(</span>Y1<span class='modula2-Symbol def-Symbol'>+</span>min<span class='modula2-Symbol def-Symbol'>></span>Y2<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
1034:     wd<span class='modula2-Number def-Number'>.</span>X1 <span class='modula2-Symbol def-Symbol'>:=</span> X1<span class='modula2-Symbol def-Symbol'>;</span> wd<span class='modula2-Number def-Number'>.</span>Y1 <span class='modula2-Symbol def-Symbol'>:=</span> Y1<span class='modula2-Symbol def-Symbol'>;</span>
1035:     wd<span class='modula2-Number def-Number'>.</span>X2 <span class='modula2-Symbol def-Symbol'>:=</span> X2<span class='modula2-Symbol def-Symbol'>;</span> wd<span class='modula2-Number def-Number'>.</span>Y2 <span class='modula2-Symbol def-Symbol'>:=</span> Y2<span class='modula2-Symbol def-Symbol'>;</span>
1036:     wd<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
1037:     <span class='modula2-Symbol def-Symbol'>IF</span> IsPalette <span class='modula2-Keyword def-Keyword'>THEN</span>
1038:       GetPal<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>pal<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1039:       nw <span class='modula2-Symbol def-Symbol'>:=</span> PaletteOpen<span class='modula2-Symbol def-Symbol'>(</span>wd<span class='modula2-Symbol def-Symbol'>,</span>pal<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1040:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
1041:       nw <span class='modula2-Symbol def-Symbol'>:=</span> Open<span class='modula2-Symbol def-Symbol'>(</span> wd <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1042:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1043:     MergeWindows<span class='modula2-Symbol def-Symbol'>(</span>nw<span class='modula2-Symbol def-Symbol'>,</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1044:     ClipFrame <span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1045:     <span class='modula2-Symbol def-Symbol'>IF</span> CurrentX<span class='modula2-Symbol def-Symbol'>></span>Width <span class='modula2-Keyword def-Keyword'>THEN</span> CurrentX <span class='modula2-Symbol def-Symbol'>:=</span> Width <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1046:     <span class='modula2-Symbol def-Symbol'>IF</span> CurrentY<span class='modula2-Symbol def-Symbol'>></span>Depth <span class='modula2-Keyword def-Keyword'>THEN</span> CurrentY <span class='modula2-Symbol def-Symbol'>:=</span> Depth <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1047:     ResetCursor<span class='modula2-Symbol def-Symbol'>;</span>
1048:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1049:   Use<span class='modula2-Symbol def-Symbol'>(</span>save<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* restore used window *)</span>
1050:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1051: <span class='modula2-Symbol def-Symbol'>END</span> Change<span class='modula2-Symbol def-Symbol'>;</span>
1052: 
1053: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
1054: <span class='modula2-Comment def-Comment def-Syntax'>(* Multi process support     *)</span>
1055: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
1056: 
1057: 
1058: 
1059: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> NullProc<span class='modula2-Symbol def-Symbol'>;</span>
1060: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1061: <span class='modula2-Symbol def-Symbol'>END</span> NullProc<span class='modula2-Symbol def-Symbol'>;</span>
1062: 
1063: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> SetProcessLocks <span class='modula2-Symbol def-Symbol'>(</span> LockProc<span class='modula2-Symbol def-Symbol'>,</span>UnlockProc <span class='modula2-Symbol def-Symbol'>:</span> PROC <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1064: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1065:   Lock   <span class='modula2-Symbol def-Symbol'>:=</span> LockProc<span class='modula2-Symbol def-Symbol'>;</span>
1066:   Unlock <span class='modula2-Symbol def-Symbol'>:=</span> UnlockProc<span class='modula2-Symbol def-Symbol'>;</span>
1067:   MultiP <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span><span class='modula2-Symbol def-Symbol'>;</span>
1068: <span class='modula2-Symbol def-Symbol'>END</span> SetProcessLocks<span class='modula2-Symbol def-Symbol'>;</span>
1069: 
1070: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
1071: <span class='modula2-Comment def-Comment def-Syntax'>(* Window output             *)</span>
1072: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
1073: 
1074: 
1075: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> DeleteLine <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> Y <span class='modula2-Symbol def-Symbol'>:</span> RelCoord <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1076: <span class='modula2-Keyword def-Keyword'>VAR</span>
1077:   r<span class='modula2-Symbol def-Symbol'>,</span>p <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
1078: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1079:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1080:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1081:     p <span class='modula2-Symbol def-Symbol'>:=</span> XA<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Symbol def-Symbol'>(</span>YA<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>+</span>Y<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span>OWidth<span class='modula2-Symbol def-Symbol'>;</span>
1082:     <span class='modula2-Symbol def-Symbol'>FOR</span> r <span class='modula2-Symbol def-Symbol'>:=</span> Y <span class='modula2-Keyword def-Keyword'>TO</span> Depth<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1083:       Move<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>p<span class='modula2-Symbol def-Symbol'>+</span>OWidth<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>p<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>Width<span class='modula2-Symbol def-Symbol'>*</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1084:       INC<span class='modula2-Symbol def-Symbol'>(</span>p<span class='modula2-Symbol def-Symbol'>,</span>OWidth<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1085:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1086:     BufferSpaceFill<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>p<span class='modula2-Symbol def-Symbol'>,</span>Width<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1087:     RedrawSection <span class='modula2-Symbol def-Symbol'>(</span> W<span class='modula2-Symbol def-Symbol'>,</span>XA<span class='modula2-Symbol def-Symbol'>,</span>Y<span class='modula2-Symbol def-Symbol'>+</span>YA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>XB<span class='modula2-Symbol def-Symbol'>,</span>YB <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1088:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1089: <span class='modula2-Symbol def-Symbol'>END</span> DeleteLine<span class='modula2-Symbol def-Symbol'>;</span>
1090: 
1091: 
1092: 
1093: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> Clear<span class='modula2-Symbol def-Symbol'>;</span>
1094: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
1095: <span class='modula2-Comment def-Comment def-Syntax'>  clears the current window</span>
1096: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
1097: <span class='modula2-Keyword def-Keyword'>VAR</span>
1098:   r<span class='modula2-Symbol def-Symbol'>,</span>p <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
1099:   W   <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1100: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1101:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1102:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1103:     p <span class='modula2-Symbol def-Symbol'>:=</span> XA<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Symbol def-Symbol'>(</span>YA<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span>OWidth<span class='modula2-Symbol def-Symbol'>;</span>
1104:     <span class='modula2-Symbol def-Symbol'>FOR</span> r <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>1</span> <span class='modula2-Keyword def-Keyword'>TO</span> Depth <span class='modula2-Keyword def-Keyword'>DO</span>
1105:       BufferSpaceFill<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>p<span class='modula2-Symbol def-Symbol'>,</span>Width<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1106:       INC<span class='modula2-Symbol def-Symbol'>(</span>p<span class='modula2-Symbol def-Symbol'>,</span>OWidth<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1107:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1108:     RedrawWindowPane<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1109:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1110:   IGotoXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1111:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1112: <span class='modula2-Symbol def-Symbol'>END</span> Clear<span class='modula2-Symbol def-Symbol'>;</span>
1113: 
1114: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> ClrEol<span class='modula2-Symbol def-Symbol'>;</span>
1115: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
1116: <span class='modula2-Comment def-Comment def-Syntax'>   clears from the cursor to the end of line</span>
1117: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
1118: <span class='modula2-Keyword def-Keyword'>VAR</span>
1119:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1120: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1121:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1122:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1123:     BufferSpaceFill<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>XA<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>+</span>CurrentX<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Symbol def-Symbol'>(</span>YA<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>+</span>CurrentY<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span>OWidth<span class='modula2-Symbol def-Symbol'>,</span>
1124:           Width<span class='modula2-Symbol def-Symbol'>-</span>CurrentX<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1125:     RedrawSection <span class='modula2-Symbol def-Symbol'>(</span> W<span class='modula2-Symbol def-Symbol'>,</span>XA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>+</span>CurrentX<span class='modula2-Symbol def-Symbol'>,</span>YA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>+</span>CurrentY<span class='modula2-Symbol def-Symbol'>,</span>XB<span class='modula2-Symbol def-Symbol'>,</span>YA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>+</span>CurrentY <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1126:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1127:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1128: <span class='modula2-Symbol def-Symbol'>END</span> ClrEol<span class='modula2-Symbol def-Symbol'>;</span>
1129: 
1130: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Bell<span class='modula2-Symbol def-Symbol'>;</span>
1131: <span class='modula2-Keyword def-Keyword'>VAR</span>
1132:   R <span class='modula2-Symbol def-Symbol'>:</span> Registers<span class='modula2-Symbol def-Symbol'>;</span>
1133: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1134:   <span class='modula2-Symbol def-Symbol'>WITH</span> R <span class='modula2-Keyword def-Keyword'>DO</span>
1135:     AX <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0E07H</span><span class='modula2-Symbol def-Symbol'>;</span>
1136:     BL <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
1137:     Lib<span class='modula2-Number def-Number'>.</span>Intr<span class='modula2-Symbol def-Symbol'>(</span>R<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10H</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1138:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1139: <span class='modula2-Symbol def-Symbol'>END</span> Bell<span class='modula2-Symbol def-Symbol'>;</span>
1140: 
1141: 
1142: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$N*)</span> WriteC <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> C <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1143: <span class='modula2-Keyword def-Keyword'>VAR</span>
1144:   nx <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
1145: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1146:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1147:     <span class='modula2-Symbol def-Symbol'>CASE</span> C <span class='modula2-Keyword def-Keyword'>OF</span>
1148:        CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>12</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> Clear<span class='modula2-Symbol def-Symbol'>;</span>
1149:                  IGotoXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1150:      <span class='modula2-Symbol def-Symbol'>|</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>10</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Symbol def-Symbol'>IF</span> CurrentY<span class='modula2-Symbol def-Symbol'>=</span>Depth <span class='modula2-Keyword def-Keyword'>THEN</span>
1151:                    DeleteLine <span class='modula2-Symbol def-Symbol'>(</span> W<span class='modula2-Symbol def-Symbol'>,</span> <span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1152:                  <span class='modula2-Keyword def-Keyword'>ELSE</span>
1153:                    IGotoXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>CurrentX<span class='modula2-Symbol def-Symbol'>,</span>CurrentY<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1154:                  <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1155:      <span class='modula2-Symbol def-Symbol'>|</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>13</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Comment def-Comment def-Syntax'>(*ClrEol; change 1/7/88*)</span> IGotoXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>CurrentY<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1156:      <span class='modula2-Symbol def-Symbol'>|</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>08</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Symbol def-Symbol'>IF</span> CurrentX<span class='modula2-Symbol def-Symbol'>></span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
1157:                    IGotoXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>CurrentX<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>CurrentY<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> WriteC<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-String def-String'>' '</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1158:                    IGotoXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>CurrentX<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>CurrentY<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1159:                  <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1160:      <span class='modula2-Symbol def-Symbol'>|</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>7</span><span class='modula2-Symbol def-Symbol'>)</span>  <span class='modula2-Symbol def-Symbol'>:</span> Bell<span class='modula2-Symbol def-Symbol'>;</span>
1161:     <span class='modula2-Keyword def-Keyword'>ELSE</span>
1162:         <span class='modula2-Symbol def-Symbol'>IF</span> CurrentX <span class='modula2-Symbol def-Symbol'>></span> Width <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>RETURN</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1163:         WindowWrite<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>CurrentX<span class='modula2-Symbol def-Symbol'>,</span>CurrentY<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>C<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span><span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1164:         <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>CurrentX<span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span>Width<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Keyword def-Keyword'>OR</span> <span class='modula2-Keyword def-Keyword'>NOT</span> WDef<span class='modula2-Number def-Number'>.</span>WrapOn <span class='modula2-Keyword def-Keyword'>THEN</span>
1165:           IGotoXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>CurrentX<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>CurrentY<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1166:         <span class='modula2-Keyword def-Keyword'>ELSE</span>
1167:           <span class='modula2-Symbol def-Symbol'>IF</span> CurrentY<span class='modula2-Symbol def-Symbol'>=</span>Depth <span class='modula2-Keyword def-Keyword'>THEN</span>
1168:             DeleteLine <span class='modula2-Symbol def-Symbol'>(</span> W<span class='modula2-Symbol def-Symbol'>,</span> <span class='modula2-Number def-Number'>1</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1169:             IGotoXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>CurrentY<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1170:           <span class='modula2-Keyword def-Keyword'>ELSE</span>
1171:             IGotoXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>CurrentY<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1172:           <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1173:         <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1174:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1175:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1176: <span class='modula2-Symbol def-Symbol'>END</span> WriteC<span class='modula2-Symbol def-Symbol'>;</span>
1177: 
1178: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> WriteOut <span class='modula2-Symbol def-Symbol'>(</span>S <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1179: <span class='modula2-Keyword def-Keyword'>VAR</span>
1180:   W     <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1181:   p<span class='modula2-Symbol def-Symbol'>,</span>q<span class='modula2-Symbol def-Symbol'>,</span>m <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
1182:   ss    <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
1183: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1184:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1185:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1186:     ss <span class='modula2-Symbol def-Symbol'>:=</span> HIGH<span class='modula2-Symbol def-Symbol'>(</span>S<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
1187:     p <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
1188:     q <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
1189:     <span class='modula2-Symbol def-Symbol'>LOOP</span>
1190:       <span class='modula2-Comment def-Comment def-Syntax'>(* first accumulate normal chars on same line *)</span>
1191:       m <span class='modula2-Symbol def-Symbol'>:=</span> Width<span class='modula2-Symbol def-Symbol'>+</span>p<span class='modula2-Symbol def-Symbol'>-</span>CurrentX<span class='modula2-Symbol def-Symbol'>;</span>
1192:       <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Keyword def-Keyword'>NOT</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>WrapOn <span class='modula2-Keyword def-Keyword'>THEN</span> INC<span class='modula2-Symbol def-Symbol'>(</span>m<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* can fit another char in *)</span>
1193:       <span class='modula2-Symbol def-Symbol'>IF</span> m <span class='modula2-Symbol def-Symbol'>></span> ss <span class='modula2-Keyword def-Keyword'>THEN</span> m <span class='modula2-Symbol def-Symbol'>:=</span> ss <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1194:       <span class='modula2-Symbol def-Symbol'>WHILE</span> <span class='modula2-Symbol def-Symbol'>(</span>q<span class='modula2-Symbol def-Symbol'>&lt;</span>m<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Keyword def-Keyword'>AND</span><span class='modula2-Symbol def-Symbol'>(</span>S<span class='modula2-Symbol def-Symbol'>[</span>q<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>>=</span><span class='modula2-String def-String'>' '</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>DO</span> INC<span class='modula2-Symbol def-Symbol'>(</span>q<span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1195:       <span class='modula2-Comment def-Comment def-Syntax'>(* now output the line *)</span>
1196:       <span class='modula2-Symbol def-Symbol'>IF</span> q <span class='modula2-Symbol def-Symbol'>></span> p <span class='modula2-Keyword def-Keyword'>THEN</span>
1197:         WindowWrite<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>CurrentX<span class='modula2-Symbol def-Symbol'>,</span>CurrentY<span class='modula2-Symbol def-Symbol'>,</span>q<span class='modula2-Symbol def-Symbol'>-</span>p<span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>S<span class='modula2-Symbol def-Symbol'>[</span>p<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span><span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1198:         IGotoXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>CurrentX<span class='modula2-Symbol def-Symbol'>+</span>q<span class='modula2-Symbol def-Symbol'>-</span>p<span class='modula2-Symbol def-Symbol'>,</span>CurrentY<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1199:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1200:       <span class='modula2-Comment def-Comment def-Syntax'>(* now output the special char *)</span>
1201:       <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>S<span class='modula2-Symbol def-Symbol'>[</span>q<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>OR</span> <span class='modula2-Symbol def-Symbol'>(</span>q <span class='modula2-Symbol def-Symbol'>></span> HIGH<span class='modula2-Symbol def-Symbol'>(</span>S<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span> <span class='modula2-Keyword def-Keyword'>EXIT</span> <span class='modula2-Keyword def-Keyword'>ELSE</span> WriteC<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>S<span class='modula2-Symbol def-Symbol'>[</span>q<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1202:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1203:       INC<span class='modula2-Symbol def-Symbol'>(</span>q<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1204:       p <span class='modula2-Symbol def-Symbol'>:=</span> q<span class='modula2-Symbol def-Symbol'>;</span>
1205:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1206:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1207:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1208: <span class='modula2-Symbol def-Symbol'>END</span> WriteOut<span class='modula2-Symbol def-Symbol'>;</span>
1209: 
1210: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> DirectWrite <span class='modula2-Symbol def-Symbol'>(</span> X<span class='modula2-Symbol def-Symbol'>,</span>Y <span class='modula2-Symbol def-Symbol'>:</span> RelCoord<span class='modula2-Symbol def-Symbol'>;</span>      <span class='modula2-Comment def-Comment def-Syntax'>(* start co-ords *)</span>
1211:                                A   <span class='modula2-Symbol def-Symbol'>:</span> ADDRESS<span class='modula2-Symbol def-Symbol'>;</span>       <span class='modula2-Comment def-Comment def-Syntax'>(* address of char array *)</span>
1212:                                Len <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>    <span class='modula2-Comment def-Comment def-Syntax'>(* length to be written *)</span>
1213: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
1214: <span class='modula2-Comment def-Comment def-Syntax'>   writes directly to current window at the specified X,Y coordinates</span>
1215: <span class='modula2-Comment def-Comment def-Syntax'>   with no check for special (ie control) chars or eol wrap</span>
1216: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
1217: <span class='modula2-Keyword def-Keyword'>VAR</span>
1218:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1219: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1220:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1221:   ClipXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>X<span class='modula2-Symbol def-Symbol'>,</span>Y<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1222:   WindowWrite<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>X<span class='modula2-Symbol def-Symbol'>,</span>Y<span class='modula2-Symbol def-Symbol'>,</span>Len<span class='modula2-Symbol def-Symbol'>,</span>A<span class='modula2-Symbol def-Symbol'>,</span><span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1223:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1224: <span class='modula2-Symbol def-Symbol'>END</span> DirectWrite<span class='modula2-Symbol def-Symbol'>;</span>
1225: 
1226: 
1227: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> GotoXY <span class='modula2-Symbol def-Symbol'>(</span> X<span class='modula2-Symbol def-Symbol'>,</span>Y <span class='modula2-Symbol def-Symbol'>:</span> RelCoord <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1228: <span class='modula2-Keyword def-Keyword'>VAR</span>
1229:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1230: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1231:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1232:   ClipXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>X<span class='modula2-Symbol def-Symbol'>,</span>Y<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1233:   IGotoXY<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>X<span class='modula2-Symbol def-Symbol'>,</span>Y<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1234:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1235: <span class='modula2-Symbol def-Symbol'>END</span> GotoXY<span class='modula2-Symbol def-Symbol'>;</span>
1236: 
1237: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> WhereX <span class='modula2-Symbol def-Symbol'>(</span> <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> RelCoord<span class='modula2-Symbol def-Symbol'>;</span>
1238: <span class='modula2-Keyword def-Keyword'>VAR</span>
1239:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1240: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1241:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1242:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1243:   <span class='modula2-Keyword def-Keyword'>RETURN</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurrentX<span class='modula2-Symbol def-Symbol'>;</span>
1244: <span class='modula2-Symbol def-Symbol'>END</span> WhereX<span class='modula2-Symbol def-Symbol'>;</span>
1245: 
1246: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> WhereY <span class='modula2-Symbol def-Symbol'>(</span> <span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>:</span> RelCoord<span class='modula2-Symbol def-Symbol'>;</span>
1247: <span class='modula2-Keyword def-Keyword'>VAR</span>
1248:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1249: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1250:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1251:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1252:   <span class='modula2-Keyword def-Keyword'>RETURN</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurrentY<span class='modula2-Symbol def-Symbol'>;</span>
1253: <span class='modula2-Symbol def-Symbol'>END</span> WhereY<span class='modula2-Symbol def-Symbol'>;</span>
1254: 
1255: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> ConvertCoords <span class='modula2-Symbol def-Symbol'>(</span> W         <span class='modula2-Symbol def-Symbol'>:</span> WinType  <span class='modula2-Symbol def-Symbol'>;</span>
1256:                                  X<span class='modula2-Symbol def-Symbol'>,</span>Y       <span class='modula2-Symbol def-Symbol'>:</span> RelCoord<span class='modula2-Symbol def-Symbol'>;</span>
1257:                                  <span class='modula2-Keyword def-Keyword'>VAR</span> XO<span class='modula2-Symbol def-Symbol'>,</span>YO <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1258: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1259:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1260:   XO <span class='modula2-Symbol def-Symbol'>:=</span> X<span class='modula2-Symbol def-Symbol'>+</span>W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>XA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span> YO <span class='modula2-Symbol def-Symbol'>:=</span> Y<span class='modula2-Symbol def-Symbol'>+</span>W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>YA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
1261: <span class='modula2-Symbol def-Symbol'>END</span> ConvertCoords<span class='modula2-Symbol def-Symbol'>;</span>
1262: 
1263: 
1264: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> InsLine<span class='modula2-Symbol def-Symbol'>;</span>
1265: <span class='modula2-Keyword def-Keyword'>VAR</span>
1266:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1267:   r<span class='modula2-Symbol def-Symbol'>,</span>p<span class='modula2-Symbol def-Symbol'>,</span>p1 <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
1268: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1269:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1270:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1271:     p <span class='modula2-Symbol def-Symbol'>:=</span> XA<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Symbol def-Symbol'>(</span>YA<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>+</span>Depth<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span>OWidth<span class='modula2-Symbol def-Symbol'>;</span>
1272:     <span class='modula2-Symbol def-Symbol'>FOR</span> r <span class='modula2-Symbol def-Symbol'>:=</span> CurrentY <span class='modula2-Keyword def-Keyword'>TO</span> Depth<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1273:       DEC<span class='modula2-Symbol def-Symbol'>(</span>p<span class='modula2-Symbol def-Symbol'>,</span>OWidth<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1274:       Move<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>p<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>p<span class='modula2-Symbol def-Symbol'>+</span>OWidth<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>Width<span class='modula2-Symbol def-Symbol'>*</span><span class='modula2-Number def-Number'>2</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1275:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1276:     BufferSpaceFill<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>p<span class='modula2-Symbol def-Symbol'>,</span>Width<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1277:     RedrawSection <span class='modula2-Symbol def-Symbol'>(</span> W<span class='modula2-Symbol def-Symbol'>,</span>XA<span class='modula2-Symbol def-Symbol'>,</span>CurrentY<span class='modula2-Symbol def-Symbol'>+</span>YA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>XB<span class='modula2-Symbol def-Symbol'>,</span>YB <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1278:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1279:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1280: <span class='modula2-Symbol def-Symbol'>END</span> InsLine<span class='modula2-Symbol def-Symbol'>;</span>
1281: 
1282: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> DelLine<span class='modula2-Symbol def-Symbol'>;</span>
1283: <span class='modula2-Keyword def-Keyword'>VAR</span>
1284:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1285: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1286:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1287:   DeleteLine<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>CurrentY<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1288:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1289: <span class='modula2-Symbol def-Symbol'>END</span> DelLine<span class='modula2-Symbol def-Symbol'>;</span>
1290: 
1291: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> TextColor <span class='modula2-Symbol def-Symbol'>(</span> c <span class='modula2-Symbol def-Symbol'>:</span> Color <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1292: <span class='modula2-Keyword def-Keyword'>VAR</span>
1293:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1294: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1295:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1296:   W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Foreground <span class='modula2-Symbol def-Symbol'>:=</span> c<span class='modula2-Symbol def-Symbol'>;</span>
1297:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1298: <span class='modula2-Symbol def-Symbol'>END</span> TextColor<span class='modula2-Symbol def-Symbol'>;</span>
1299: 
1300: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> TextBackground <span class='modula2-Symbol def-Symbol'>(</span> c <span class='modula2-Symbol def-Symbol'>:</span> Color <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1301: <span class='modula2-Keyword def-Keyword'>VAR</span>
1302:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1303: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1304:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1305:   W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>Background <span class='modula2-Symbol def-Symbol'>:=</span> c<span class='modula2-Symbol def-Symbol'>;</span>
1306:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1307: <span class='modula2-Symbol def-Symbol'>END</span> TextBackground<span class='modula2-Symbol def-Symbol'>;</span>
1308: 
1309: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> SetWrap <span class='modula2-Symbol def-Symbol'>(</span> on <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1310: <span class='modula2-Keyword def-Keyword'>VAR</span>
1311:   W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1312: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1313:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1314:   W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>WrapOn <span class='modula2-Symbol def-Symbol'>:=</span> on<span class='modula2-Symbol def-Symbol'>;</span>
1315:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1316: <span class='modula2-Symbol def-Symbol'>END</span> SetWrap<span class='modula2-Symbol def-Symbol'>;</span>
1317: 
1318: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Info <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> <span class='modula2-Symbol def-Symbol'>(</span> W <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Keyword def-Keyword'>VAR</span> WD <span class='modula2-Symbol def-Symbol'>:</span> WinDef <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1319: <span class='modula2-Comment def-Comment def-Syntax'>(* gets information for specified window *)</span>
1320: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1321:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1322:   WD <span class='modula2-Symbol def-Symbol'>:=</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef <span class='modula2-Symbol def-Symbol'>;</span>
1323:   Unlock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1324: <span class='modula2-Symbol def-Symbol'>END</span> Info<span class='modula2-Symbol def-Symbol'>;</span>
1325: 
1326: 
1327: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
1328: <span class='modula2-Comment def-Comment def-Syntax'>(* Title procedure           *)</span>
1329: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
1330: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> SetTitle <span class='modula2-Symbol def-Symbol'>(</span> W        <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1331:                      NewTitle <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
1332:                      Mode     <span class='modula2-Symbol def-Symbol'>:</span> TitleMode <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1333: <span class='modula2-Comment def-Comment def-Syntax'>(*</span>
1334: <span class='modula2-Comment def-Comment def-Syntax'>  updates the window title within the window frame,</span>
1335: <span class='modula2-Comment def-Comment def-Syntax'>  positioning it in the position defined by the title mode</span>
1336: <span class='modula2-Comment def-Comment def-Syntax'>*)</span>
1337: <span class='modula2-Keyword def-Keyword'>VAR</span>
1338:   l <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
1339: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1340:   CheckWindow<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1341:   Lock<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1342:   DisposeTitle<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1343:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1344:     <span class='modula2-Symbol def-Symbol'>IF</span> Mode <span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Symbol def-Symbol'>></span> NoTitle <span class='modula2-Keyword def-Keyword'>THEN</span>
1345:       l <span class='modula2-Symbol def-Symbol'>:=</span> Length<span class='modula2-Symbol def-Symbol'>(</span>NewTitle<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1346:       ALLOCATE<span class='modula2-Symbol def-Symbol'>(</span>Title<span class='modula2-Symbol def-Symbol'>,</span>l<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1347:       Move<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>NewTitle<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>Title<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>l<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1348:       Title<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>l<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1349:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1350:     TMode <span class='modula2-Symbol def-Symbol'>:=</span> Mode<span class='modula2-Symbol def-Symbol'>;</span>
1351:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1352:   DrawFrame<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1353:   Unlock<span class='modula2-Symbol def-Symbol'>;</span>
1354: <span class='modula2-Symbol def-Symbol'>END</span> SetTitle<span class='modula2-Symbol def-Symbol'>;</span>
1355: 
1356: 
1357: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> ReadString  <span class='modula2-Symbol def-Symbol'>(</span> <span class='modula2-Keyword def-Keyword'>VAR</span> string <span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1358: <span class='modula2-Keyword def-Keyword'>VAR</span>
1359:   c   <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
1360:   line<span class='modula2-Symbol def-Symbol'>:</span> <span class='modula2-Keyword def-Keyword'>ARRAY</span><span class='modula2-Symbol def-Symbol'>[</span><span class='modula2-Number def-Number'>0..82</span><span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Keyword def-Keyword'>OF</span> <span class='def-TypeKeyword def-Keyword'>CHAR</span><span class='modula2-Symbol def-Symbol'>;</span>
1361:   p<span class='modula2-Symbol def-Symbol'>,</span>H <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span><span class='modula2-Symbol def-Symbol'>;</span>
1362:   W   <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>
1363:   con <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>BOOLEAN</span><span class='modula2-Symbol def-Symbol'>;</span>
1364: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1365:   W <span class='modula2-Symbol def-Symbol'>:=</span> CurWin<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1366:   PutOnTop<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1367:   con <span class='modula2-Symbol def-Symbol'>:=</span> W<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>WDef<span class='modula2-Number def-Number'>.</span>CursorOn<span class='modula2-Symbol def-Symbol'>;</span>
1368:   CursorOn<span class='modula2-Symbol def-Symbol'>;</span>
1369:   H <span class='modula2-Symbol def-Symbol'>:=</span> HIGH<span class='modula2-Symbol def-Symbol'>(</span>string<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1370:   <span class='modula2-Symbol def-Symbol'>IF</span> H<span class='modula2-Symbol def-Symbol'>></span><span class='modula2-Number def-Number'>79</span> <span class='modula2-Keyword def-Keyword'>THEN</span> H <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>79</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1371:   p <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>;</span>
1372:   <span class='modula2-Symbol def-Symbol'>LOOP</span>
1373:     c <span class='modula2-Symbol def-Symbol'>:=</span> IO<span class='modula2-Number def-Number'>.</span>RdKey<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1374:     <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>c<span class='modula2-Symbol def-Symbol'>=</span>CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>8</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Keyword def-Keyword'>OR</span><span class='modula2-Symbol def-Symbol'>(</span>c<span class='modula2-Symbol def-Symbol'>=</span>CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>127</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
1375:       <span class='modula2-Symbol def-Symbol'>IF</span> p<span class='modula2-Symbol def-Symbol'>></span><span class='modula2-Number def-Number'>0</span> <span class='modula2-Keyword def-Keyword'>THEN</span> DEC<span class='modula2-Symbol def-Symbol'>(</span>p<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> IO<span class='modula2-Number def-Number'>.</span>WrChar<span class='modula2-Symbol def-Symbol'>(</span>CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>8</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1376:     <span class='modula2-Keyword def-Keyword'>ELSIF</span> <span class='modula2-Symbol def-Symbol'>(</span>c<span class='modula2-Symbol def-Symbol'>>=</span><span class='modula2-String def-String'>' '</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
1377:       <span class='modula2-Symbol def-Symbol'>IF</span> p<span class='modula2-Symbol def-Symbol'>&lt;=</span>H <span class='modula2-Keyword def-Keyword'>THEN</span>
1378:         IO<span class='modula2-Number def-Number'>.</span>WrChar<span class='modula2-Symbol def-Symbol'>(</span>c<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1379:         line<span class='modula2-Symbol def-Symbol'>[</span>p<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> c<span class='modula2-Symbol def-Symbol'>;</span>
1380:         INC<span class='modula2-Symbol def-Symbol'>(</span>p<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1381:       <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1382:     <span class='modula2-Keyword def-Keyword'>ELSIF</span> c<span class='modula2-Symbol def-Symbol'>=</span>CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>13</span><span class='modula2-Symbol def-Symbol'>)</span> <span class='modula2-Keyword def-Keyword'>THEN</span>
1383:       <span class='modula2-Keyword def-Keyword'>EXIT</span><span class='modula2-Symbol def-Symbol'>;</span>
1384:     <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1385:   <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1386:   line<span class='modula2-Symbol def-Symbol'>[</span>p<span class='modula2-Symbol def-Symbol'>]</span> <span class='modula2-Symbol def-Symbol'>:=</span> CHR<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1387:   Copy<span class='modula2-Symbol def-Symbol'>(</span>string<span class='modula2-Symbol def-Symbol'>,</span>line<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1388:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Keyword def-Keyword'>NOT</span> con <span class='modula2-Keyword def-Keyword'>THEN</span> CursorOff <span class='modula2-Symbol def-Symbol'>END</span><span class='modula2-Symbol def-Symbol'>;</span>
1389:   Unlock<span class='modula2-Symbol def-Symbol'>;</span>
1390:   IO<span class='modula2-Number def-Number'>.</span>WrLn<span class='modula2-Symbol def-Symbol'>;</span>
1391: <span class='modula2-Symbol def-Symbol'>END</span> ReadString<span class='modula2-Symbol def-Symbol'>;</span>
1392: 
1393: <span class='modula2-Comment def-Comment def-Syntax'>(* Low level routines to read and write to the window buffer direct *)</span>
1394: 
1395: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> RdBufferLn <span class='modula2-Symbol def-Symbol'>(</span> W    <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>        <span class='modula2-Comment def-Comment def-Syntax'>(* Source window *)</span>
1396:                               X<span class='modula2-Symbol def-Symbol'>,</span>Y  <span class='modula2-Symbol def-Symbol'>:</span> RelCoord<span class='modula2-Symbol def-Symbol'>;</span>      <span class='modula2-Comment def-Comment def-Syntax'>(* start co-ords *)</span>
1397:                               Dest <span class='modula2-Symbol def-Symbol'>:</span> ADDRESS<span class='modula2-Symbol def-Symbol'>;</span>       <span class='modula2-Comment def-Comment def-Syntax'>(* address of buffer *)</span>
1398:                               Len  <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>    <span class='modula2-Comment def-Comment def-Syntax'>(* length in WORDs *)</span>
1399: <span class='modula2-Keyword def-Keyword'>VAR</span>
1400:   AX<span class='modula2-Symbol def-Symbol'>,</span>AY  <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord<span class='modula2-Symbol def-Symbol'>;</span>
1401: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1402:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1403:       AX <span class='modula2-Symbol def-Symbol'>:=</span> X<span class='modula2-Symbol def-Symbol'>+</span>XA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span> AY <span class='modula2-Symbol def-Symbol'>:=</span> Y<span class='modula2-Symbol def-Symbol'>+</span>YA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
1404:       Lib<span class='modula2-Number def-Number'>.</span>WordMove<span class='modula2-Symbol def-Symbol'>(</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>AX<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Symbol def-Symbol'>(</span>AY<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span>OWidth<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>Dest<span class='modula2-Symbol def-Symbol'>,</span>Len<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1405:   <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
1406: <span class='modula2-Symbol def-Symbol'>END</span> RdBufferLn <span class='modula2-Symbol def-Symbol'>;</span>
1407: 
1408: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> <span class='modula2-Comment def-Comment def-Syntax'>(*$F*)</span> WrBufferLn <span class='modula2-Symbol def-Symbol'>(</span> W    <span class='modula2-Symbol def-Symbol'>:</span> WinType<span class='modula2-Symbol def-Symbol'>;</span>       <span class='modula2-Comment def-Comment def-Syntax'>(* Dest window *)</span>
1409:                               X<span class='modula2-Symbol def-Symbol'>,</span>Y  <span class='modula2-Symbol def-Symbol'>:</span> RelCoord<span class='modula2-Symbol def-Symbol'>;</span>      <span class='modula2-Comment def-Comment def-Syntax'>(* start co-ords *)</span>
1410:                               Src  <span class='modula2-Symbol def-Symbol'>:</span> ADDRESS<span class='modula2-Symbol def-Symbol'>;</span>       <span class='modula2-Comment def-Comment def-Syntax'>(* address of buffer *)</span>
1411:                               Len  <span class='modula2-Symbol def-Symbol'>:</span> <span class='def-TypeKeyword def-Keyword'>CARDINAL</span> <span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>    <span class='modula2-Comment def-Comment def-Syntax'>(* length in WORDs *)</span>
1412: <span class='modula2-Keyword def-Keyword'>VAR</span>
1413:   AX<span class='modula2-Symbol def-Symbol'>,</span>AY  <span class='modula2-Symbol def-Symbol'>:</span> AbsCoord<span class='modula2-Symbol def-Symbol'>;</span>
1414: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1415:   <span class='modula2-Symbol def-Symbol'>WITH</span> W<span class='modula2-Symbol def-Symbol'>^</span> <span class='modula2-Keyword def-Keyword'>DO</span>
1416:       AX <span class='modula2-Symbol def-Symbol'>:=</span> X<span class='modula2-Symbol def-Symbol'>+</span>XA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span> AY <span class='modula2-Symbol def-Symbol'>:=</span> Y<span class='modula2-Symbol def-Symbol'>+</span>YA<span class='modula2-Symbol def-Symbol'>-</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>;</span>
1417:       Lib<span class='modula2-Number def-Number'>.</span>WordMove<span class='modula2-Symbol def-Symbol'>(</span>Src<span class='modula2-Symbol def-Symbol'>,</span>ADR<span class='modula2-Symbol def-Symbol'>(</span>Buffer<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>[</span>AX<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>X1<span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Symbol def-Symbol'>(</span>AY<span class='modula2-Symbol def-Symbol'>-</span>WDef<span class='modula2-Number def-Number'>.</span>Y1<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>*</span>OWidth<span class='modula2-Symbol def-Symbol'>]</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>,</span>Len<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1418:       UpdateScreen<span class='modula2-Symbol def-Symbol'>(</span>W<span class='modula2-Symbol def-Symbol'>,</span>AX<span class='modula2-Symbol def-Symbol'>,</span>AY<span class='modula2-Symbol def-Symbol'>,</span>Len<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1419:   <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
1420: <span class='modula2-Symbol def-Symbol'>END</span> WrBufferLn <span class='modula2-Symbol def-Symbol'>;</span>
1421: 
1422: 
1423: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
1424: <span class='modula2-Comment def-Comment def-Syntax'>(* Main initialization       *)</span>
1425: <span class='modula2-Comment def-Comment def-Syntax'>(* ------------------------- *)</span>
1426: <span class='modula2-Keyword def-Keyword'>PROCEDURE</span> Init <span class='modula2-Symbol def-Symbol'>;</span>
1427: <span class='modula2-Keyword def-Keyword'>CONST</span>
1428:   ClearOnEntry <span class='modula2-Symbol def-Symbol'>=</span> <span class='def-Constant def-Keyword'>TRUE</span> <span class='modula2-Symbol def-Symbol'>;</span>    <span class='modula2-Comment def-Comment def-Syntax'>(* Change to FALSE if automatic clear</span>
1429: <span class='modula2-Comment def-Comment def-Syntax'>                              NOT required *)</span>
1430: <span class='modula2-Keyword def-Keyword'>VAR</span>
1431:   R <span class='modula2-Symbol def-Symbol'>:</span> Registers <span class='modula2-Symbol def-Symbol'>;</span>
1432:   WD <span class='modula2-Symbol def-Symbol'>:</span> WinDef <span class='modula2-Symbol def-Symbol'>;</span>
1433: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1434:   InitScreenType<span class='modula2-Symbol def-Symbol'>(</span><span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span> <span class='modula2-Comment def-Comment def-Syntax'>(* FALSE = no snow *)</span>
1435:   R<span class='modula2-Number def-Number'>.</span>AH <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>3</span><span class='modula2-Symbol def-Symbol'>;</span>
1436:   R<span class='modula2-Number def-Number'>.</span>BH <span class='modula2-Symbol def-Symbol'>:=</span> ActivePage<span class='modula2-Symbol def-Symbol'>(</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1437:   Lib<span class='modula2-Number def-Number'>.</span>Intr<span class='modula2-Symbol def-Symbol'>(</span>R<span class='modula2-Symbol def-Symbol'>,</span><span class='modula2-Number def-Number'>10H</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1438:   <span class='modula2-Symbol def-Symbol'>IF</span> <span class='modula2-Symbol def-Symbol'>(</span>R<span class='modula2-Number def-Number'>.</span>CH<span class='modula2-Symbol def-Symbol'>&lt;</span><span class='modula2-Number def-Number'>20H</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Keyword def-Keyword'>AND</span><span class='modula2-Symbol def-Symbol'>(</span>R<span class='modula2-Number def-Number'>.</span>CL<span class='modula2-Symbol def-Symbol'>></span><span class='modula2-Number def-Number'>0</span><span class='modula2-Symbol def-Symbol'>)</span>  <span class='modula2-Keyword def-Keyword'>THEN</span>
1439:      CursorLines <span class='modula2-Symbol def-Symbol'>:=</span> R<span class='modula2-Number def-Number'>.</span>CX <span class='modula2-Symbol def-Symbol'>;</span>
1440:   <span class='modula2-Keyword def-Keyword'>ELSE</span>
1441:      CursorLines <span class='modula2-Symbol def-Symbol'>:=</span> <span class='modula2-Number def-Number'>0607H</span> <span class='modula2-Symbol def-Symbol'>;</span>
1442:   <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
1443:   Lock <span class='modula2-Symbol def-Symbol'>:=</span> NullProc<span class='modula2-Symbol def-Symbol'>;</span>
1444:   Unlock <span class='modula2-Symbol def-Symbol'>:=</span> NullProc<span class='modula2-Symbol def-Symbol'>;</span>
1445:   MultiP <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>FALSE</span><span class='modula2-Symbol def-Symbol'>;</span>
1446:   WindowStack <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span>
1447:   NEW<span class='modula2-Symbol def-Symbol'>(</span>UseList<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1448:   UseList<span class='modula2-Symbol def-Symbol'>^</span><span class='modula2-Symbol def-Symbol'>.</span>Next <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span>        <span class='modula2-Comment def-Comment def-Syntax'>(* dummy *)</span>
1449:   CursorStack <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>NIL</span><span class='modula2-Symbol def-Symbol'>;</span>
1450:   IO<span class='modula2-Number def-Number'>.</span>WrStrRedirect <span class='modula2-Symbol def-Symbol'>:=</span> WriteOut<span class='modula2-Symbol def-Symbol'>;</span>
1451:   IO<span class='modula2-Number def-Number'>.</span>RdStrRedirect <span class='modula2-Symbol def-Symbol'>:=</span> ReadString<span class='modula2-Symbol def-Symbol'>;</span>
1452:   <span class='modula2-Symbol def-Symbol'>IF</span> ClearOnEntry <span class='modula2-Keyword def-Keyword'>THEN</span>
1453:     FullScreen       <span class='modula2-Symbol def-Symbol'>:=</span> Open<span class='modula2-Symbol def-Symbol'>(</span>FullScreenDef<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1454:   <span class='modula2-Keyword def-Keyword'>ELSE</span>
1455:     WD <span class='modula2-Symbol def-Symbol'>:=</span> FullScreenDef <span class='modula2-Symbol def-Symbol'>;</span>
1456:     WD<span class='modula2-Number def-Number'>.</span>Hidden <span class='modula2-Symbol def-Symbol'>:=</span> <span class='def-Constant def-Keyword'>TRUE</span> <span class='modula2-Symbol def-Symbol'>;</span>
1457:     FullScreen       <span class='modula2-Symbol def-Symbol'>:=</span> Open<span class='modula2-Symbol def-Symbol'>(</span>WD<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1458:     SnapShot <span class='modula2-Symbol def-Symbol'>;</span>
1459:     PutOnTop<span class='modula2-Symbol def-Symbol'>(</span>FullScreen<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1460:     GotoXY<span class='modula2-Symbol def-Symbol'>(</span>ORD<span class='modula2-Symbol def-Symbol'>(</span>R<span class='modula2-Number def-Number'>.</span>DL<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>,</span>ORD<span class='modula2-Symbol def-Symbol'>(</span>R<span class='modula2-Number def-Number'>.</span>DH<span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>+</span><span class='modula2-Number def-Number'>1</span><span class='modula2-Symbol def-Symbol'>)</span><span class='modula2-Symbol def-Symbol'>;</span>
1461:   <span class='modula2-Symbol def-Symbol'>END</span> <span class='modula2-Symbol def-Symbol'>;</span>
1462: <span class='modula2-Symbol def-Symbol'>END</span> Init <span class='modula2-Symbol def-Symbol'>;</span>
1463: 
1464: <span class='modula2-Symbol def-Symbol'>BEGIN</span>
1465:   Init <span class='modula2-Symbol def-Symbol'>;</span>
1466: <span class='modula2-Symbol def-Symbol'>END</span> Window<span class='modula2-Symbol def-Symbol'>.</span>
1467: 
