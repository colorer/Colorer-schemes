   0: <span class='Baan-baanSection def-KeywordStrong def-Keyword'>declaration</span><span class='Baan-baanSymbol def-Symbol'>:</span>    
   1:     <span class='Baan-baanDirective def-Directive'>#include</span> <span class='Baan-baanString def-String'>"itfzzzcommon"</span>
   2:     <span class='Baan-baanDirective def-Directive'>#include</span> <span class='Baan-baanString def-String'>"itfzzyerrors"</span>
   3:     <span class='Baan-baanDirective def-Directive'>#include</span> <span class='Baan-baanString def-String'>"itfzzzoasis"</span>
   4:     <span class='Baan-baanDirective def-Directive'>#include</span> <span class='Baan-baanString def-String'>"itfzzttest"</span>
   5:     <span class='Baan-baanDirective def-Directive'>#include</span> <span class='Baan-baanString def-String'>"itfzzydomains"</span>
   6: 
   7:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll000m01
   8:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll003m01
   9:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll007m00
  10:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll007m01
  11:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll009
  12:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll021m01
  13:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll021m01
  14:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll039m01
  15:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll064m01
  16:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll154
  17:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll171
  18:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdll259
  19:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdllbw
  20:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdllefiltr
  21:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdllperiod
  22:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdllprofil
  23:     <span class='Baan-baanDirective def-Directive'>#pragma</span> used dll otfzzzdlltable
  24: 
  25:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>str200 fileName
  26:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>str20 oasis<span class='Baan-baanNumber def-Number'>.</span>ver
  27:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftvs doc<span class='Baan-baanNumber def-Number'>.</span>type
  28:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf form<span class='Baan-baanNumber def-Number'>.</span>type
  29:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>id efilter<span class='Baan-baanNumber def-Number'>.</span>group
  30:     
  31:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper period
  32:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>year year
  33:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>id assur<span class='Baan-baanNumber def-Number'>.</span>part
  34:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>str200 assur<span class='Baan-baanNumber def-Number'>.</span>part<span class='Baan-baanNumber def-Number'>.</span>desc
  35:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>id cumul<span class='Baan-baanNumber def-Number'>.</span>part
  36:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>str200 cumul<span class='Baan-baanNumber def-Number'>.</span>part<span class='Baan-baanNumber def-Number'>.</span>desc
  37:     <span class='Baan-baanKeyword def-Keyword'>extern</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>str200 efilter<span class='Baan-baanNumber def-Number'>.</span>group<span class='Baan-baanNumber def-Number'>.</span>dsc
  38: 
  39:     <span class='Baan-baanKeyword def-Keyword'>table</span>    ttfzzz003    <span class='def-Comment def-Syntax'>| Работники</span>
  40:     <span class='Baan-baanKeyword def-Keyword'>table</span>    ttfzzz024    <span class='def-Comment def-Syntax'>| Условия труда</span>
  41:     <span class='Baan-baanKeyword def-Keyword'>table</span>    ttfzzz026
  42:     <span class='Baan-baanKeyword def-Keyword'>table</span>    ttfzzz040    <span class='def-Comment def-Syntax'>| Адреса работников</span>
  43:     <span class='Baan-baanKeyword def-Keyword'>table</span>    ttfzzz087    <span class='def-Comment def-Syntax'>| Инвалидность работников    </span>
  44:     <span class='Baan-baanKeyword def-Keyword'>table</span>    ttfzzz095    <span class='def-Comment def-Syntax'>| Виды стажей</span>
  45: 
  46: <span class='Baan-baanSection def-KeywordStrong def-Keyword'>before.program</span><span class='Baan-baanSymbol def-Symbol'>:</span>
  47: <span class='def-Comment def-Syntax'>|    execute(get.defaults)</span>
  48:     <span class='Baan-baanUserProcedure def-Identifier'>efilter.setDefault</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  49: <span class='Baan-baanSection def-KeywordStrong def-Keyword'>form.all</span><span class='Baan-baanSymbol def-Symbol'>:</span>
  50:     <span class='Baan-baanSection def-KeywordStrong def-Keyword'>init.form</span><span class='Baan-baanSymbol def-Symbol'>:</span>
  51:         <span class='Baan-baanProcedure def-Symbol'>get.screen.defaults</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  52: <span class='def-Comment def-Syntax'>|        execute(cont.process) | !!!!!!!</span>
  53: <span class='Baan-baanSection def-KeywordStrong def-Keyword'>field.efilter.group:</span>
  54:     <span class='Baan-baanSection def-KeywordStrong def-Keyword'>after.input</span><span class='Baan-baanSymbol def-Symbol'>:</span>
  55:         <span class='Baan-baanProcedure def-Symbol'>display</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"efilter.group.dsc"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  56: <span class='Baan-baanSection def-KeywordStrong def-Keyword'>field.efilter.group.dsc:</span>
  57:     <span class='Baan-baanSection def-KeywordStrong def-Keyword'>before.display</span><span class='Baan-baanSymbol def-Symbol'>:</span>    
  58:         efilter<span class='Baan-baanNumber def-Number'>.</span>group<span class='Baan-baanNumber def-Number'>.</span>dsc<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanUserProcedure def-Identifier'>grp.desc.byID</span><span class='Baan-baanSymbol def-Symbol'>(</span>efilter<span class='Baan-baanNumber def-Number'>.</span>group<span class='Baan-baanSymbol def-Symbol'>)</span>    
  59: <span class='Baan-baanSection def-KeywordStrong def-Keyword'>field.assur.part:</span>
  60:     <span class='Baan-baanSection def-KeywordStrong def-Keyword'>after.input</span><span class='Baan-baanSymbol def-Symbol'>:</span>
  61:         <span class='Baan-baanProcedure def-Symbol'>display</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"assur.part.desc"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  62: <span class='Baan-baanSection def-KeywordStrong def-Keyword'>field.assur.part.desc:</span>
  63:     <span class='Baan-baanSection def-KeywordStrong def-Keyword'>before.display</span><span class='Baan-baanSymbol def-Symbol'>:</span>
  64:         assur<span class='Baan-baanNumber def-Number'>.</span>part<span class='Baan-baanNumber def-Number'>.</span>desc<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanUserProcedure def-Identifier'>nalc.name</span><span class='Baan-baanSymbol def-Symbol'>(</span>assur<span class='Baan-baanNumber def-Number'>.</span>part<span class='Baan-baanSymbol def-Symbol'>)</span>
  65: 
  66: <span class='Baan-baanSection def-KeywordStrong def-Keyword'>field.cumul.part:</span>
  67:     <span class='Baan-baanSection def-KeywordStrong def-Keyword'>after.input</span><span class='Baan-baanSymbol def-Symbol'>:</span>
  68:         <span class='Baan-baanProcedure def-Symbol'>display</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"cumul.part.desc"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  69: <span class='Baan-baanSection def-KeywordStrong def-Keyword'>field.cumul.part.desc:</span>
  70:     <span class='Baan-baanSection def-KeywordStrong def-Keyword'>before.display</span><span class='Baan-baanSymbol def-Symbol'>:</span>
  71:         cumul<span class='Baan-baanNumber def-Number'>.</span>part<span class='Baan-baanNumber def-Number'>.</span>desc<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanUserProcedure def-Identifier'>nalc.name</span><span class='Baan-baanSymbol def-Symbol'>(</span>cumul<span class='Baan-baanNumber def-Number'>.</span>part<span class='Baan-baanSymbol def-Symbol'>)</span>
  72: <span class='Baan-baanSection def-KeywordStrong def-Keyword'>choice.cont.process</span><span class='Baan-baanSymbol def-Symbol'>:</span>
  73:     <span class='Baan-baanSection def-KeywordStrong def-Keyword'>on.choice</span><span class='Baan-baanSymbol def-Symbol'>:</span>
  74:         <span class='Baan-baanUserProcedure def-Identifier'>tab.setLevelParams</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>true</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>true</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>true</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  75:        <span class='Baan-baanKeyword def-Keyword'> if</span> doc<span class='Baan-baanNumber def-Number'>.</span>type<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftvs<span class='Baan-baanNumber def-Number'>.</span>inds <span class='Baan-baanKeyword def-Keyword'>then</span>
  76:             <span class='Baan-baanProcedure def-Symbol'>message</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"Поле Тип документа: для текущей версии допустимо только значение ИНДС"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  77:             <span class='Baan-baanProcedure def-Symbol'>choice.again</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  78:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
  79:        <span class='Baan-baanKeyword def-Keyword'> if</span> <span class='Baan-baanProcedure def-Symbol'>etol</span><span class='Baan-baanSymbol def-Symbol'>(</span>period<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
  80:             <span class='Baan-baanProcedure def-Symbol'>message</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"Поле Период: должно быть указано значение"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  81:             <span class='Baan-baanProcedure def-Symbol'>choice.again</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  82:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
  83:        <span class='Baan-baanKeyword def-Keyword'> if</span> <span class='Baan-baanKeyword def-Keyword'>not</span> year <span class='Baan-baanKeyword def-Keyword'>then</span>
  84:             <span class='Baan-baanProcedure def-Symbol'>message</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"Поле Год: должно быть указано значение"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  85:             <span class='Baan-baanProcedure def-Symbol'>choice.again</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  86:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
  87:         <span class='Baan-baanKeyword def-Keyword'>long</span> startTime
  88:         startTime<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanProcedure def-Symbol'>time.num</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  89:         writeOasisFile<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  90:         <span class='Baan-baanUserProcedure def-Identifier'>showCurrentError</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>
  91:         alert<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanProcedure def-Symbol'>time.num</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>-</span>startTime<span class='Baan-baanSymbol def-Symbol'>)</span>
  92:         <span class='Baan-baanKeyword def-Keyword'>stop</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span> <span class='def-Comment def-Syntax'>| !!!!!!!!!</span>
  93: <span class='Baan-baanSection def-KeywordStrong def-Keyword'>functions</span><span class='Baan-baanSymbol def-Symbol'>:</span>
  94: 
  95: 
  96: tdate     work<span class='Baan-baanNumber def-Number'>.</span>date
  97: tdate     lBdate<span class='Baan-baanSymbol def-Symbol'>,</span> lEdate
  98: <span class='Baan-baanKeyword def-Keyword'>long</span>     curr1<span class='Baan-baanSymbol def-Symbol'>,</span> curr2
  99: <span class='Baan-baanKeyword def-Keyword'>domain</span>     tfzzz<span class='Baan-baanNumber def-Number'>.</span>str15 strahnum
 100: bool     isNotOtm
 101: 
 102: 
 103: <span class='Baan-baanKeyword def-Keyword'>function</span> writeOasisFile<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 104:     <span class='Baan-baanUserProcedure def-Identifier'>prof.init</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>true</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 105:     <span class='Baan-baanKeyword def-Keyword'>long</span> all all<span class='Baan-baanSymbol def-Symbol'>=</span>grp<span class='Baan-baanNumber def-Number'>.</span>size<span class='Baan-baanNumber def-Number'>.</span>byID<span class='Baan-baanSymbol def-Symbol'>(</span>efilter<span class='Baan-baanNumber def-Number'>.</span>group<span class='Baan-baanSymbol def-Symbol'>)</span>
 106:     work<span class='Baan-baanNumber def-Number'>.</span>date <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanUserProcedure def-Identifier'>get.work.date</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 107:     get<span class='Baan-baanNumber def-Number'>.</span>zzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>dates<span class='Baan-baanSymbol def-Symbol'>(</span>year<span class='Baan-baanSymbol def-Symbol'>,</span> period<span class='Baan-baanSymbol def-Symbol'>,</span>lBdate<span class='Baan-baanSymbol def-Symbol'>,</span> lEdate<span class='Baan-baanSymbol def-Symbol'>)</span>
 108: 
 109:     OAS_FILE<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"oasis.txt"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 110:     OAS_REC<span class='Baan-baanSymbol def-Symbol'>(</span>O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"ЗГЛВ"</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"04.00"</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 111:     OAS_REC<span class='Baan-baanSymbol def-Symbol'>(</span>O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"РБТД"</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"РБТД"</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanUserProcedure def-Identifier'>get.pf.reg.num</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>14</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanUserProcedure def-Identifier'>get.comp.name</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>100</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 112:     OAS_REC<span class='Baan-baanSymbol def-Symbol'>(</span>O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"ПАЧК"</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> O<span class='Baan-baanNumber def-Number'>.</span>D<span class='Baan-baanSymbol def-Symbol'>(</span>work<span class='Baan-baanNumber def-Number'>.</span>date<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 113:     OAS_REC<span class='Baan-baanSymbol def-Symbol'>(</span>O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"ТИПД"</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanProcedure def-Symbol'>enum.descr$</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"tfzzz.pftvs"</span><span class='Baan-baanSymbol def-Symbol'>,</span>doc<span class='Baan-baanNumber def-Number'>.</span>type<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>4</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span>doc<span class='Baan-baanNumber def-Number'>.</span>count<span class='Baan-baanSymbol def-Symbol'>(</span>doc<span class='Baan-baanNumber def-Number'>.</span>type<span class='Baan-baanSymbol def-Symbol'>,</span> work<span class='Baan-baanNumber def-Number'>.</span>date<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 114:     curr1 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanNumber def-Number'>1</span>
 115:     <span class='Baan-baanKeyword def-Keyword'>long</span> count
 116:     count<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 117:     <span class='Baan-baanSQL def-Directive'>select</span> tfzzz003.<span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz011<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz003 <span class='Baan-baanSQL def-Directive'>where</span>
 118:         tfzzz011._index1<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>efilter.group</span><span class='Baan-baanSymbol def-Symbol'>}</span>    
 119:         <span class='Baan-baanSQL def-Directive'>and</span>
 120:         tfzzz003._index1<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanSymbol def-Symbol'>{</span>tfzzz011.entrempl<span class='Baan-baanSymbol def-Symbol'>}</span>
 121:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 122:        <span class='Baan-baanKeyword def-Keyword'> if</span> <span class='Baan-baanUserProcedure def-Identifier'>empl.in.group</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span> efilter<span class='Baan-baanNumber def-Number'>.</span>group<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 123:             inc<span class='Baan-baanSymbol def-Symbol'>(</span>count<span class='Baan-baanSymbol def-Symbol'>)</span> 
 124:             <span class='Baan-baanUserProcedure def-Identifier'>set.sb.msg</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanProcedure def-Symbol'>str$</span><span class='Baan-baanSymbol def-Symbol'>(</span>count<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>&amp;</span><span class='Baan-baanString def-String'>" из "</span><span class='Baan-baanSymbol def-Symbol'>&amp;</span><span class='Baan-baanProcedure def-Symbol'>str$</span><span class='Baan-baanSymbol def-Symbol'>(</span>all<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 125:             isNotOtm <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanSymbol def-Symbol'>(</span> convertTypeCorr<span class='Baan-baanSymbol def-Symbol'>(</span>form<span class='Baan-baanNumber def-Number'>.</span>type<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>otm <span class='Baan-baanSymbol def-Symbol'>)</span>
 126:             strahnum <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanUserProcedure def-Identifier'>get.empl.pfin</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>true</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 127:             strahnum<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>12</span><span class='Baan-baanSymbol def-Symbol'>;</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>" "</span>
 128:             <span class='def-Comment def-Syntax'>| огранизация перебора в функции ProcessInterval всех инвалидностей и неинвалидностей.</span>
 129:             tdate left
 130:             left  <span class='Baan-baanSymbol def-Symbol'>=</span> DR_MIN_DATE
 131: 
 132:            <span class='Baan-baanKeyword def-Keyword'> if</span> tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanNumber def-Number'>13</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 133:                 tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid <span class='Baan-baanSymbol def-Symbol'>=</span> tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid
 134:            <span class='Baan-baanKeyword def-Keyword'> endif</span>
 135: 
 136:            <span class='Baan-baanKeyword def-Keyword'> repeat</span> <span class='def-Comment def-Syntax'>| этот цикл - по комкам инвалидностей. </span>
 137:                    <span class='def-Comment def-Syntax'>| комок инвалидностей - это период времени, не содержащий неинавалидностей.</span>
 138:                 bool found
 139:                 found<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanKeyword def-Keyword'>false</span>
 140:                 <span class='Baan-baanSQL def-Directive'>select</span> <span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz087
 141:                 <span class='Baan-baanSQL def-Directive'>where</span> _index2  <span class='Baan-baanComment def-Comment def-Syntax'>| целиком правее точки left</span>
 142:                   <span class='Baan-baanSQL def-Directive'>inrange</span> <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz003.emplid</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>left</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 143:                   <span class='Baan-baanSQL def-Directive'>and</span>      <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz003.emplid</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MAX_DATE<span class='Baan-baanSymbol def-Symbol'>}</span>
 144:                   <span class='Baan-baanSQL def-Directive'>order</span> <span class='Baan-baanSQL def-Directive'>by</span> _index2
 145:                 <span class='Baan-baanSQL def-Directive'>as</span> <span class='Baan-baanSQL def-Directive'>set</span> <span class='Baan-baanSQL def-Directive'>with</span> 1 <span class='Baan-baanSQL def-Directive'>rows</span>
 146:                 <span class='Baan-baanSQL def-Directive'>selectdo</span> 
 147:                     <span class='def-Comment def-Syntax'>| нашли один некий интервал целиком справа от точки left</span>
 148:                     found<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>1</span> 
 149: 
 150:                     <span class='def-Comment def-Syntax'>| т.к изначально left=0 то леввее этого интервала точно неинавлид</span>
 151:                     <span class='def-Comment def-Syntax'>| => в диапазоне [left;    tfzzz087.invafrom] - НЕИНВАЛИД</span>
 152:                     tdate lStart 
 153:                     lStart <span class='Baan-baanSymbol def-Symbol'>=</span> tfzzz087<span class='Baan-baanNumber def-Number'>.</span>invafrom
 154:                        ProcessInterval<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span>left<span class='Baan-baanSymbol def-Symbol'>,</span>lStart<span class='Baan-baanSymbol def-Symbol'>-</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span> <span class='def-Comment def-Syntax'>| период где НЕИНВАЛИД</span>
 155: 
 156:                     <span class='def-Comment def-Syntax'>| надо найти правый край (lStop)</span>
 157:                     <span class='def-Comment def-Syntax'>| это сложнее т.к. может быть несколько индвалидностей налеплено вместе.</span>
 158:                     <span class='def-Comment def-Syntax'>| ищем правый край, отодвигая вправо переменную lStop</span>
 159:                     tdate lStop
 160:                     lStop <span class='Baan-baanSymbol def-Symbol'>=</span>  tfzzz087<span class='Baan-baanNumber def-Number'>.</span>invato
 161:                    <span class='Baan-baanKeyword def-Keyword'> repeat</span>
 162:                         <span class='Baan-baanKeyword def-Keyword'>long</span> cont
 163:                         cont <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanNumber def-Number'>0</span>    
 164:                         <span class='Baan-baanKeyword def-Keyword'>long</span> xxx
 165:                         xxx <span class='Baan-baanSymbol def-Symbol'>=</span> lStop <span class='Baan-baanSymbol def-Symbol'>+</span> <span class='Baan-baanNumber def-Number'>1</span>
 166:                         <span class='Baan-baanSQL def-Directive'>select</span> <span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz087
 167:                         <span class='Baan-baanSQL def-Directive'>where</span> _index2  <span class='Baan-baanComment def-Comment def-Syntax'>| перекрывает точку lStop</span>
 168:                           <span class='Baan-baanSQL def-Directive'>inrange</span> <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz003.emplid</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>lStart</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>xxx</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 169:                             <span class='Baan-baanSQL def-Directive'>and</span>    <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz003.emplid</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>lStop</span> <span class='Baan-baanSymbol def-Symbol'>,</span> DR_MAX_DATE<span class='Baan-baanSymbol def-Symbol'>}</span>
 170:                           <span class='Baan-baanSQL def-Directive'>order</span> <span class='Baan-baanSQL def-Directive'>by</span> _index2
 171:                         <span class='Baan-baanSQL def-Directive'>as</span> <span class='Baan-baanSQL def-Directive'>set</span> <span class='Baan-baanSQL def-Directive'>with</span> 1 <span class='Baan-baanSQL def-Directive'>rows</span>
 172:                         <span class='Baan-baanSQL def-Directive'>selectdo</span>
 173:                             lStop <span class='Baan-baanSymbol def-Symbol'>=</span> tfzzz087<span class='Baan-baanNumber def-Number'>.</span>invato
 174:                         <span class='Baan-baanSQL def-Directive'>selectempty</span>
 175:                             cont<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>1</span> <span class='def-Comment def-Syntax'>| всё, не нашли, правее двигать некуда, выходим.</span>
 176:                         <span class='Baan-baanSQL def-Directive'>endselect</span>
 177:                    <span class='Baan-baanKeyword def-Keyword'> until </span>cont<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>1</span>
 178:                 <span class='Baan-baanSQL def-Directive'>selectempty</span>
 179:                     found<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 180:                 <span class='Baan-baanSQL def-Directive'>endselect</span>
 181:                <span class='Baan-baanKeyword def-Keyword'> if</span> found <span class='Baan-baanKeyword def-Keyword'>then</span> 
 182:                        ProcessInterval<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>true</span><span class='Baan-baanSymbol def-Symbol'>,</span>lStart<span class='Baan-baanSymbol def-Symbol'>,</span>lStop<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='def-Comment def-Syntax'>| период где ИНВАЛИД</span>
 183:                        left <span class='Baan-baanSymbol def-Symbol'>=</span> lStop <span class='Baan-baanSymbol def-Symbol'>+</span> <span class='Baan-baanNumber def-Number'>1</span> <span class='def-Comment def-Syntax'>| вот так! дальше будем искать следующий комок </span>
 184:                    <span class='Baan-baanKeyword def-Keyword'>else</span>                     
 185:                     <span class='Baan-baanKeyword def-Keyword'>break</span> <span class='def-Comment def-Syntax'>| выход из repeat</span>
 186:                <span class='Baan-baanKeyword def-Keyword'> endif</span>
 187:            <span class='Baan-baanKeyword def-Keyword'> until </span>left<span class='Baan-baanSymbol def-Symbol'>></span>lEdate
 188:             <span class='def-Comment def-Syntax'>| тут надо вызвать еще раз, для остатка оси времени и типа=неинвалид</span>
 189:             ProcessInterval<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span>left<span class='Baan-baanSymbol def-Symbol'>,</span>DR_MAX_DATE<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='def-Comment def-Syntax'>| период где НЕИНВАЛИД</span>
 190: 
 191:             inc<span class='Baan-baanSymbol def-Symbol'>(</span>curr1<span class='Baan-baanSymbol def-Symbol'>)</span> 
 192: 
 193:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
 194:     <span class='Baan-baanSQL def-Directive'>endselect</span>
 195:     OAS_FILE_END
 196:     <span class='Baan-baanUserProcedure def-Identifier'>server2client</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"oasis.txt"</span><span class='Baan-baanSymbol def-Symbol'>,</span> fileName<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>true</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 197:     <span class='Baan-baanUserProcedure def-Identifier'>prof.toFile</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"oasis.profile.csv"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 198: <span class='Baan-baanSymbol def-Symbol'>}</span>
 199: 
 200: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>long</span> doc<span class='Baan-baanNumber def-Number'>.</span>count<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftvs dType<span class='Baan-baanSymbol def-Symbol'>,</span> tdate work<span class='Baan-baanNumber def-Number'>.</span>date<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 201:     <span class='Baan-baanKeyword def-Keyword'>long</span> count
 202:     count <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanNumber def-Number'>0</span>
 203:     <span class='Baan-baanSQL def-Directive'>select</span> tfzzz003.emplid 
 204:     <span class='Baan-baanSQL def-Directive'>from</span>    tfzzz003
 205:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 206:        <span class='Baan-baanKeyword def-Keyword'> if</span> <span class='Baan-baanUserProcedure def-Identifier'>efilter.matches</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span> work<span class='Baan-baanNumber def-Number'>.</span>date<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 207:             inc<span class='Baan-baanSymbol def-Symbol'>(</span>count<span class='Baan-baanSymbol def-Symbol'>)</span>
 208:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
 209:     <span class='Baan-baanSQL def-Directive'>endselect</span>
 210:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>count<span class='Baan-baanSymbol def-Symbol'>)</span>
 211: <span class='Baan-baanSymbol def-Symbol'>}</span>
 212: 
 213: <span class='def-Comment def-Syntax'>| когда оттестирую, заменю тут всё на дефайны</span>
 214: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>void</span> get<span class='Baan-baanNumber def-Number'>.</span>zzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>dates<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> yr<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper period<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>ref</span> tdate lBdate<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>ref</span> tdate lEdate<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 215:   <span class='Baan-baanKeyword def-Keyword'>on</span> <span class='Baan-baanKeyword def-Keyword'>case</span> period                                                           
 216:     <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>jnsp<span class='Baan-baanSymbol def-Symbol'>:</span> lBdate<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanProcedure def-Symbol'>date.to.num</span><span class='Baan-baanSymbol def-Symbol'>(</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>01</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>01</span><span class='Baan-baanSymbol def-Symbol'>)</span> lEdate<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanProcedure def-Symbol'>date.to.num</span><span class='Baan-baanSymbol def-Symbol'>(</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>09</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>30</span><span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>break</span> <span class='def-Comment def-Syntax'>|01.01-30.09</span>
 217:     <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>apsp<span class='Baan-baanSymbol def-Symbol'>:</span> lBdate<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanProcedure def-Symbol'>date.to.num</span><span class='Baan-baanSymbol def-Symbol'>(</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>04</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>01</span><span class='Baan-baanSymbol def-Symbol'>)</span> lEdate<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanProcedure def-Symbol'>date.to.num</span><span class='Baan-baanSymbol def-Symbol'>(</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>09</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>30</span><span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>break</span> <span class='def-Comment def-Syntax'>|01.04-30.09</span>
 218:     <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>apdc<span class='Baan-baanSymbol def-Symbol'>:</span> lBdate<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanProcedure def-Symbol'>date.to.num</span><span class='Baan-baanSymbol def-Symbol'>(</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>04</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>01</span><span class='Baan-baanSymbol def-Symbol'>)</span> lEdate<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanProcedure def-Symbol'>date.to.num</span><span class='Baan-baanSymbol def-Symbol'>(</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>12</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>31</span><span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>break</span> <span class='def-Comment def-Syntax'>|01.04-31.12</span>
 219: 
 220:     <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>jnmc<span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanUserProcedure def-Identifier'>get.period.dates</span><span class='Baan-baanSymbol def-Symbol'>(</span>getTypedPeriodId<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pert<span class='Baan-baanNumber def-Number'>.</span>quarter <span class='Baan-baanSymbol def-Symbol'>,</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span>lBdate<span class='Baan-baanSymbol def-Symbol'>,</span>lEdate<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>break</span> <span class='def-Comment def-Syntax'>|1 квартал</span>
 221:     <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>apju<span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanUserProcedure def-Identifier'>get.period.dates</span><span class='Baan-baanSymbol def-Symbol'>(</span>getTypedPeriodId<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pert<span class='Baan-baanNumber def-Number'>.</span>quarter <span class='Baan-baanSymbol def-Symbol'>,</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>2</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span>lBdate<span class='Baan-baanSymbol def-Symbol'>,</span>lEdate<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>break</span> <span class='def-Comment def-Syntax'>|2 квартал</span>
 222:     <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>jlsp<span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanUserProcedure def-Identifier'>get.period.dates</span><span class='Baan-baanSymbol def-Symbol'>(</span>getTypedPeriodId<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pert<span class='Baan-baanNumber def-Number'>.</span>quarter <span class='Baan-baanSymbol def-Symbol'>,</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>3</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span>lBdate<span class='Baan-baanSymbol def-Symbol'>,</span>lEdate<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>break</span> <span class='def-Comment def-Syntax'>|3 квартал</span>
 223:     <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>okdc<span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanUserProcedure def-Identifier'>get.period.dates</span><span class='Baan-baanSymbol def-Symbol'>(</span>getTypedPeriodId<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pert<span class='Baan-baanNumber def-Number'>.</span>quarter <span class='Baan-baanSymbol def-Symbol'>,</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>4</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span>lBdate<span class='Baan-baanSymbol def-Symbol'>,</span>lEdate<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>break</span> <span class='def-Comment def-Syntax'>|4 квартал</span>
 224: 
 225:     <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>jnju<span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanUserProcedure def-Identifier'>get.period.dates</span><span class='Baan-baanSymbol def-Symbol'>(</span>getTypedPeriodId<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pert<span class='Baan-baanNumber def-Number'>.</span>halfyear<span class='Baan-baanSymbol def-Symbol'>,</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span>lBdate<span class='Baan-baanSymbol def-Symbol'>,</span>lEdate<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>break</span> <span class='def-Comment def-Syntax'>|1 полугодие</span>
 226:     <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>jldc<span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanUserProcedure def-Identifier'>get.period.dates</span><span class='Baan-baanSymbol def-Symbol'>(</span>getTypedPeriodId<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pert<span class='Baan-baanNumber def-Number'>.</span>halfyear<span class='Baan-baanSymbol def-Symbol'>,</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>2</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span>lBdate<span class='Baan-baanSymbol def-Symbol'>,</span>lEdate<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>break</span> <span class='def-Comment def-Syntax'>|2 полугодие</span>
 227: 
 228:     <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfper<span class='Baan-baanNumber def-Number'>.</span>jndc<span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanUserProcedure def-Identifier'>get.period.dates</span><span class='Baan-baanSymbol def-Symbol'>(</span>getTypedPeriodId<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pert<span class='Baan-baanNumber def-Number'>.</span>year    <span class='Baan-baanSymbol def-Symbol'>,</span>yr<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span>lBdate<span class='Baan-baanSymbol def-Symbol'>,</span>lEdate<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>break</span> <span class='def-Comment def-Syntax'>|весь год</span>
 229:   <span class='Baan-baanKeyword def-Keyword'>endcase</span>           
 230: <span class='Baan-baanSymbol def-Symbol'>}</span>
 231: 
 232: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>long</span> getTypedPeriodId<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pert eKind<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> lYear<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> lPerNo<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 233:     <span class='Baan-baanKeyword def-Keyword'>long</span> type 
 234:     type <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanUserProcedure def-Identifier'>calc.period.type</span><span class='Baan-baanSymbol def-Symbol'>(</span>eKind<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 235:     type <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanUserProcedure def-Identifier'>calc.period.id</span><span class='Baan-baanSymbol def-Symbol'>(</span>type<span class='Baan-baanSymbol def-Symbol'>,</span>lYear<span class='Baan-baanSymbol def-Symbol'>,</span> lPerNo<span class='Baan-baanSymbol def-Symbol'>)</span>
 236:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>type<span class='Baan-baanSymbol def-Symbol'>)</span>
 237: <span class='Baan-baanSymbol def-Symbol'>}</span>
 238:                                           
 239: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>String</span> convertTypeFormStr<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf form<span class='Baan-baanNumber def-Number'>.</span>type<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 240:     <span class='Baan-baanKeyword def-Keyword'>on</span> <span class='Baan-baanKeyword def-Keyword'>case</span> form<span class='Baan-baanNumber def-Number'>.</span>type
 241:      <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>isx  <span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>convertStr<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>isx<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 242:      <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>pens <span class='Baan-baanSymbol def-Symbol'>:</span>    
 243:      <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>pkorr<span class='Baan-baanSymbol def-Symbol'>:</span>
 244:      <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>potm <span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>convertStr<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>pens<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 245:     <span class='Baan-baanKeyword def-Keyword'>endcase</span>
 246:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>convertStr<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>empty</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 247: <span class='Baan-baanSymbol def-Symbol'>}</span>
 248: 
 249: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf ConvertTypeCorr<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf form<span class='Baan-baanNumber def-Number'>.</span>type<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 250:     <span class='Baan-baanKeyword def-Keyword'>on</span> <span class='Baan-baanKeyword def-Keyword'>case</span> form<span class='Baan-baanNumber def-Number'>.</span>type
 251:      <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>korr  <span class='Baan-baanSymbol def-Symbol'>:</span>    
 252:      <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>pkorr <span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>korr<span class='Baan-baanSymbol def-Symbol'>)</span>
 253:      <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>otm   <span class='Baan-baanSymbol def-Symbol'>:</span>
 254:      <span class='Baan-baanKeyword def-Keyword'>case</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>potm  <span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf<span class='Baan-baanNumber def-Number'>.</span>otm<span class='Baan-baanSymbol def-Symbol'>)</span>
 255:     <span class='Baan-baanKeyword def-Keyword'>endcase</span>
 256:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>empty</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 257: <span class='Baan-baanSymbol def-Symbol'>}</span>
 258: 
 259: 
 260: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>String</span> convertStr<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pftf type<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 261:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanProcedure def-Symbol'>etol</span><span class='Baan-baanSymbol def-Symbol'>(</span>type<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanSymbol def-Symbol'>?</span> <span class='Baan-baanProcedure def-Symbol'>enum.descr$</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"tfzzz.pftf"</span><span class='Baan-baanSymbol def-Symbol'>,</span>type<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanString def-String'>""</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 262: <span class='Baan-baanSymbol def-Symbol'>}</span>
 263: 
 264: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>String</span> ConvertKTZL<span class='Baan-baanSymbol def-Symbol'>(</span>bool invalid<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 265:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>trim$<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplpfct<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanSymbol def-Symbol'>&amp;</span> <span class='Baan-baanSymbol def-Symbol'>(</span>invalid<span class='Baan-baanSymbol def-Symbol'>?</span> <span class='Baan-baanString def-String'>"ИВ"</span><span class='Baan-baanSymbol def-Symbol'>:</span><span class='Baan-baanString def-String'>""</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 266: <span class='Baan-baanSymbol def-Symbol'>}</span>
 267: 
 268: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>String</span> ConvertAddr<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 269:     <span class='Baan-baanSQL def-Directive'>select</span>    tfzzz040.<span class='Baan-baanSymbol def-Symbol'>*</span>
 270:     <span class='Baan-baanSQL def-Directive'>from</span>    tfzzz040
 271:     <span class='Baan-baanSQL def-Directive'>where</span>    tfzzz040._index2 <span class='Baan-baanSQL def-Directive'>inrange</span> <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz003.emplid</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MIN_LONG<span class='Baan-baanSymbol def-Symbol'>,</span> DR_MIN_DATE<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>work.date</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 272:                              <span class='Baan-baanSQL def-Directive'>and</span>     <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz003.emplid</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MAX_LONG<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>work.date</span><span class='Baan-baanSymbol def-Symbol'>,</span>  DR_MAX_DATE<span class='Baan-baanSymbol def-Symbol'>}</span>
 273:     <span class='Baan-baanSQL def-Directive'>and</span> tfzzz040.addrtype <span class='Baan-baanSQL def-Directive'>in</span> <span class='Baan-baanSymbol def-Symbol'>(</span> tfzzz.addrtype.mpr <span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz.addrtype.mprog <span class='Baan-baanSymbol def-Symbol'>)</span>
 274:     <span class='Baan-baanSQL def-Directive'>order</span> <span class='Baan-baanSQL def-Directive'>by</span> tfzzz040.addrtype <span class='Baan-baanSQL def-Directive'>desc</span>
 275:     <span class='Baan-baanSQL def-Directive'>as</span> <span class='Baan-baanSQL def-Directive'>set</span> <span class='Baan-baanSQL def-Directive'>with</span> 1 <span class='Baan-baanSQL def-Directive'>rows</span>
 276:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 277:      <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanProcedure def-Symbol'>sprintf$</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"%s,%s,%s,%s,%s,%s,%s,%s,%s,%s"</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 278:          trim$<span class='Baan-baanSymbol def-Symbol'>(</span>cvtCntry<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 279:          trim$<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrindx<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 280:          trim$<span class='Baan-baanSymbol def-Symbol'>(</span>cvtRegion<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 281:          trim$<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrrion<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 282:          trim$<span class='Baan-baanSymbol def-Symbol'>(</span>cvtCity<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 283:          trim$<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrnapu<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 284:          trim$<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrstrt<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 285:          trim$<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrhous<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 286:          trim$<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrkrps<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 287:          trim$<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrflat<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 288:     <span class='Baan-baanSQL def-Directive'>selectempty</span>
 289:            <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanProcedure def-Symbol'>sprintf$</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>",,,,,,,,,"</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 290:     <span class='Baan-baanSQL def-Directive'>endselect</span>
 291:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>""</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 292: <span class='Baan-baanSymbol def-Symbol'>}</span>
 293: 
 294: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>String</span> cvtRegion<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 295:    <span class='Baan-baanKeyword def-Keyword'> if</span> tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrregn<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"077"</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 296:         <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"МОСКВА Г"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 297:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 298:    <span class='Baan-baanKeyword def-Keyword'> if</span> tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrregn<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"078"</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 299:         <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"САНКТ-ПЕТЕРБУРГ Г"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 300:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 301:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrregn<span class='Baan-baanSymbol def-Symbol'>)</span>
 302: <span class='Baan-baanSymbol def-Symbol'>}</span>
 303: 
 304: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>String</span> cvtCity<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 305:    <span class='Baan-baanKeyword def-Keyword'> if</span> tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrregn<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"077"</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 306:         <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>""</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 307:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 308:    <span class='Baan-baanKeyword def-Keyword'> if</span> tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrregn<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"078"</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 309:         <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>""</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 310:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 311:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz040<span class='Baan-baanNumber def-Number'>.</span>addrrion<span class='Baan-baanSymbol def-Symbol'>)</span>
 312: <span class='Baan-baanSymbol def-Symbol'>}</span>
 313: 
 314: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>String</span> cvtCntry<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 315:     <span class='Baan-baanKeyword def-Keyword'>domain</span> tcccty country
 316:     country <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanUserProcedure def-Identifier'>get.empl.citizenship.country</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span> work<span class='Baan-baanNumber def-Number'>.</span>date<span class='Baan-baanSymbol def-Symbol'>)</span>
 317:     <span class='Baan-baanKeyword def-Keyword'>return</span> <span class='Baan-baanSymbol def-Symbol'>(</span> country<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"RUS"</span> <span class='Baan-baanSymbol def-Symbol'>?</span> <span class='Baan-baanString def-String'>""</span> <span class='Baan-baanSymbol def-Symbol'>:</span> country <span class='Baan-baanSymbol def-Symbol'>)</span>
 318: <span class='Baan-baanSymbol def-Symbol'>}</span>
 319: 
 320: 
 321: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>void</span> processInterval<span class='Baan-baanSymbol def-Symbol'>(</span>Bool inv<span class='Baan-baanSymbol def-Symbol'>,</span> TDate date<span class='Baan-baanNumber def-Number'>.</span>f<span class='Baan-baanSymbol def-Symbol'>,</span> TDate date<span class='Baan-baanNumber def-Number'>.</span>t<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 322:     TDate    d1<span class='Baan-baanSymbol def-Symbol'>,</span> d2
 323: 
 324:    <span class='Baan-baanKeyword def-Keyword'> if</span> date<span class='Baan-baanNumber def-Number'>.</span>f <span class='Baan-baanSymbol def-Symbol'>></span><span class='Baan-baanSymbol def-Symbol'>=</span> date<span class='Baan-baanNumber def-Number'>.</span>t <span class='Baan-baanKeyword def-Keyword'>then</span>
 325:         <span class='Baan-baanKeyword def-Keyword'>return</span> <span class='def-Comment def-Syntax'>| прочь, неправильные интервалы!</span>
 326:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 327: 
 328:     <span class='Baan-baanUserProcedure def-Identifier'>intersect.ranges</span><span class='Baan-baanSymbol def-Symbol'>(</span>date<span class='Baan-baanNumber def-Number'>.</span>f<span class='Baan-baanSymbol def-Symbol'>,</span>date<span class='Baan-baanNumber def-Number'>.</span>t<span class='Baan-baanSymbol def-Symbol'>,</span> lBdate<span class='Baan-baanSymbol def-Symbol'>,</span> lEdate<span class='Baan-baanSymbol def-Symbol'>,</span> d1<span class='Baan-baanSymbol def-Symbol'>,</span> d2<span class='Baan-baanSymbol def-Symbol'>)</span>
 329:    <span class='Baan-baanKeyword def-Keyword'> if</span> d1<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span> <span class='Baan-baanKeyword def-Keyword'>and</span> d2<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 330:         <span class='Baan-baanKeyword def-Keyword'>return</span> <span class='def-Comment def-Syntax'>| нет пересечения с отчетным периодом, прочь!</span>
 331:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 332: 
 333:     OAS_REC<span class='Baan-baanSymbol def-Symbol'>(</span>
 334:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"ИНДС"</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 1</span>
 335:       O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span>curr1<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>   <span class='def-Comment def-Syntax'>| 2</span>
 336:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span>convertTypeFormStr<span class='Baan-baanSymbol def-Symbol'>(</span>form<span class='Baan-baanNumber def-Number'>.</span>type<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>4</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 3</span>
 337:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span>convertStr<span class='Baan-baanSymbol def-Symbol'>(</span>ConvertTypeCorr<span class='Baan-baanSymbol def-Symbol'>(</span>form<span class='Baan-baanNumber def-Number'>.</span>type<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>4</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 4          </span>
 338:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span>strahnum<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>14</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 5</span>
 339:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanProcedure def-Symbol'>str$</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanUserProcedure def-Identifier'>get.table.number</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span> work<span class='Baan-baanNumber def-Number'>.</span>date<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 6</span>
 340:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanUserProcedure def-Identifier'>get.employee.fio</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanNumber def-Number'>11</span><span class='Baan-baanSymbol def-Symbol'>,</span> work<span class='Baan-baanNumber def-Number'>.</span>date<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>40</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 7</span>
 341:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanUserProcedure def-Identifier'>get.employee.fio</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanNumber def-Number'>12</span><span class='Baan-baanSymbol def-Symbol'>,</span> work<span class='Baan-baanNumber def-Number'>.</span>date<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>40</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 8</span>
 342:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanUserProcedure def-Identifier'>get.employee.fio</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanNumber def-Number'>13</span><span class='Baan-baanSymbol def-Symbol'>,</span> work<span class='Baan-baanNumber def-Number'>.</span>date<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>40</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 9</span>
 343:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span>convertGender<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 10</span>
 344:       O<span class='Baan-baanNumber def-Number'>.</span>D<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanUserProcedure def-Identifier'>get.empl.bdate</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>true</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 11</span>
 345:       O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span>year<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>                       <span class='def-Comment def-Syntax'>| 12</span>
 346:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>(</span>isNotOtm <span class='Baan-baanSymbol def-Symbol'>?</span> ConvertKTZL<span class='Baan-baanSymbol def-Symbol'>(</span>inv<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>:</span><span class='Baan-baanString def-String'>""</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>   <span class='Baan-baanNumber def-Number'>4</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='def-Comment def-Syntax'>| 13</span>
 347:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>(</span>isNotOtm <span class='Baan-baanSymbol def-Symbol'>?</span> <span class='Baan-baanString def-String'>"0"</span>             <span class='Baan-baanSymbol def-Symbol'>:</span><span class='Baan-baanString def-String'>""</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>   <span class='Baan-baanNumber def-Number'>4</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='def-Comment def-Syntax'>| 14</span>
 348:       O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>(</span>isNotOtm <span class='Baan-baanSymbol def-Symbol'>?</span> ConvertAddr<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>   <span class='Baan-baanSymbol def-Symbol'>:</span><span class='Baan-baanString def-String'>""</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanNumber def-Number'>200</span><span class='Baan-baanSymbol def-Symbol'>)</span> <span class='def-Comment def-Syntax'>| 15</span>
 349:     <span class='Baan-baanSymbol def-Symbol'>)</span>
 350: 
 351:    <span class='Baan-baanKeyword def-Keyword'> if</span> isNotOtm <span class='Baan-baanKeyword def-Keyword'>then</span> 
 352:         curr2 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanNumber def-Number'>1</span>
 353:         payings <span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span> lBDate<span class='Baan-baanSymbol def-Symbol'>,</span> lEdate<span class='Baan-baanSymbol def-Symbol'>,</span> d1<span class='Baan-baanSymbol def-Symbol'>,</span> d2<span class='Baan-baanSymbol def-Symbol'>,</span> assur<span class='Baan-baanNumber def-Number'>.</span>part<span class='Baan-baanSymbol def-Symbol'>,</span> cumul<span class='Baan-baanNumber def-Number'>.</span>part<span class='Baan-baanSymbol def-Symbol'>)</span>
 354: <span class='def-Comment def-Syntax'>|        variant1 (tfzzz003.emplid, d1, d2)</span>
 355: <span class='def-Comment def-Syntax'>|        variant23(tfzzz003.emplid, d1, d2)</span>
 356:         variantMaxa<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span> d1<span class='Baan-baanSymbol def-Symbol'>,</span> d2<span class='Baan-baanSymbol def-Symbol'>)</span>
 357:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 358: <span class='Baan-baanSymbol def-Symbol'>}</span>
 359: 
 360: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>String</span> convertGender<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 361:     <span class='Baan-baanKeyword def-Keyword'>String</span> gstr<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 362:     gstr <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanProcedure def-Symbol'>enum.descr$</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"tfzzz.gender"</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanUserProcedure def-Identifier'>get.employee.gender</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz003<span class='Baan-baanNumber def-Number'>.</span>emplid<span class='Baan-baanSymbol def-Symbol'>,</span> work<span class='Baan-baanNumber def-Number'>.</span>date<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 363:    <span class='Baan-baanKeyword def-Keyword'> if</span> gstr<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"Н"</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 364: <span class='def-Comment def-Syntax'>|        message("Сообщение: для работника с кодом "&amp;str$(tfzzz003.emplid)&amp;" нет данных о поле") !!!!!!! @@@@@@@@@@@</span>
 365:         gstr<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>" "</span>
 366:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 367:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>gstr<span class='Baan-baanSymbol def-Symbol'>)</span>
 368: <span class='Baan-baanSymbol def-Symbol'>}</span>
 369: 
 370: <span class='Baan-baanKeyword def-Keyword'>table</span> ttfzzz007
 371: <span class='Baan-baanKeyword def-Keyword'>table</span> ttfzzz006
 372: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@params</span>
 373: <span class='def-Comment def-Syntax'>|  rep.* - отчетный период</span>
 374: <span class='def-Comment def-Syntax'>|  pfis.* - период формирования индивидуальных сведений</span>
 375: <span class='def-Comment def-Syntax'>|  assurPart - страховая часть</span>
 376: <span class='def-Comment def-Syntax'>|  cumulPart - накопительная часть</span>
 377: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 378: <span class='def-Comment def-Syntax'>| by Max Belugin 10.12.2002 16:33:20</span>
 379: <span class='Baan-baanKeyword def-Keyword'>function</span> payings<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> TDate rep<span class='Baan-baanNumber def-Number'>.</span>first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate rep<span class='Baan-baanNumber def-Number'>.</span>last<span class='Baan-baanSymbol def-Symbol'>,</span> TDate pfis<span class='Baan-baanNumber def-Number'>.</span>first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate pfis<span class='Baan-baanNumber def-Number'>.</span>last<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> assurPart<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> cumulPart<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 380:     <span class='Baan-baanKeyword def-Keyword'>double</span> days 
 381:     days<span class='Baan-baanSymbol def-Symbol'>=</span>temporaryIllnessDays<span class='Baan-baanSymbol def-Symbol'>(</span>empl<span class='Baan-baanSymbol def-Symbol'>,</span> assurPart<span class='Baan-baanSymbol def-Symbol'>,</span> rep<span class='Baan-baanNumber def-Number'>.</span>first<span class='Baan-baanSymbol def-Symbol'>,</span> rep<span class='Baan-baanNumber def-Number'>.</span>last<span class='Baan-baanSymbol def-Symbol'>)</span>    
 382:     <span class='Baan-baanKeyword def-Keyword'>double</span> allLeaveDays 
 383:     allLeaveDays<span class='Baan-baanSymbol def-Symbol'>=</span>leaveDays<span class='Baan-baanSymbol def-Symbol'>(</span>empl<span class='Baan-baanSymbol def-Symbol'>,</span> rep<span class='Baan-baanNumber def-Number'>.</span>first<span class='Baan-baanSymbol def-Symbol'>,</span> rep<span class='Baan-baanNumber def-Number'>.</span>last<span class='Baan-baanSymbol def-Symbol'>)</span>
 384:     
 385:     OAS_REC<span class='Baan-baanSymbol def-Symbol'>(</span>
 386:         <span class='def-Comment def-Syntax'>|&lt;ТПЗП6>    Тип записи    Строка    4</span>
 387:         O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"НЧСЛ"</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> 
 388:         <span class='def-Comment def-Syntax'>|&lt;БНЧСЛ>    База для начислений страховых взносов    Действительное число    15.2</span>
 389:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> 
 390:         <span class='def-Comment def-Syntax'>|&lt;СЧПФ>    Сумма начисленного взноса на страховую часть пенсии    Действительное число    15.2</span>
 391:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span>ChPF<span class='Baan-baanSymbol def-Symbol'>(</span>empl<span class='Baan-baanSymbol def-Symbol'>,</span> pfis<span class='Baan-baanNumber def-Number'>.</span>first<span class='Baan-baanSymbol def-Symbol'>,</span> pfis<span class='Baan-baanNumber def-Number'>.</span>last<span class='Baan-baanSymbol def-Symbol'>,</span> assurPart<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 392:         <span class='def-Comment def-Syntax'>|&lt;НЧПФ>    Сумма начисленного взноса на накопительную часть пенсии    Действительное число    15.2</span>
 393:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span>ChPF<span class='Baan-baanSymbol def-Symbol'>(</span>empl<span class='Baan-baanSymbol def-Symbol'>,</span> pfis<span class='Baan-baanNumber def-Number'>.</span>first<span class='Baan-baanSymbol def-Symbol'>,</span> pfis<span class='Baan-baanNumber def-Number'>.</span>last<span class='Baan-baanSymbol def-Symbol'>,</span> cumulPart<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 394:         <span class='def-Comment def-Syntax'>|&lt;ДВЗПФ>    Сумма начисленного взноса по дополнительному тарифу    Действительное число    15.2</span>
 395:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 396:         <span class='def-Comment def-Syntax'>|&lt;ВНДН>    Период работы по временной нетрудоспособности - месяцев    Целое число    2</span>
 397:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanProcedure def-Symbol'>round</span><span class='Baan-baanSymbol def-Symbol'>(</span>days\<span class='Baan-baanNumber def-Number'>30</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>2</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 398:         <span class='def-Comment def-Syntax'>|&lt;ВНМСЦ>    Период работы по временной нетрудоспособности - дней    Целое число    2</span>
 399:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanProcedure def-Symbol'>round</span><span class='Baan-baanSymbol def-Symbol'>(</span>days<span class='Baan-baanSymbol def-Symbol'>/</span><span class='Baan-baanNumber def-Number'>30</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 400:         <span class='def-Comment def-Syntax'>|&lt;АОДН>    Отпуск без сохранения содержания - месяцев    Целое число    2</span>
 401:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanProcedure def-Symbol'>round</span><span class='Baan-baanSymbol def-Symbol'>(</span>allLeaveDays\<span class='Baan-baanNumber def-Number'>30</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>2</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 402:         <span class='def-Comment def-Syntax'>|&lt;АОМСЦ>    Отпуск без сохранения содержания - дней    Целое число    2    )</span>
 403:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanProcedure def-Symbol'>round</span><span class='Baan-baanSymbol def-Symbol'>(</span>allLeaveDays<span class='Baan-baanSymbol def-Symbol'>/</span><span class='Baan-baanNumber def-Number'>30</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 404:      <span class='Baan-baanSymbol def-Symbol'>)</span>
 405: <span class='Baan-baanSymbol def-Symbol'>}</span>
 406: <span class='def-Comment def-Syntax'>|&lt;СЧПФ> - сумма по полям &lt;Сумма> таблицы tfzzz022, по работнику, для </span>
 407: <span class='def-Comment def-Syntax'>|  которого формируется данная запись индивидуальных сведений, периодам </span>
 408: <span class='def-Comment def-Syntax'>|  непрерывной работы, попадающим в период формирования индивидуальных </span>
 409: <span class='def-Comment def-Syntax'>|  сведений, периодам выплат, попадающим в период формирования индивидуальных </span>
 410: <span class='def-Comment def-Syntax'>|  сведений, и коду налога, соответствующего значению параметра запроса </span>
 411: <span class='def-Comment def-Syntax'>|  &lt;Страховая часть>.</span>
 412: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 413: <span class='def-Comment def-Syntax'>| by Max Belugin 10.12.2002 16:17:58</span>
 414: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>double</span> ChPF<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> TDate first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate last<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> tax<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 415:     <span class='Baan-baanKeyword def-Keyword'>double</span> result<span class='Baan-baanSymbol def-Symbol'>,</span> cur
 416:     result<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 417:     <span class='Baan-baanKeyword def-Keyword'>table</span> ttfzzz022
 418:     <span class='Baan-baanKeyword def-Keyword'>long</span> curPeriod
 419:     <span class='Baan-baanSQL def-Directive'>select</span> tfzzz022.summ:<span class='Baan-baanSQLParam def-Identifier'>cur</span><span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz022.pern:<span class='Baan-baanSQLParam def-Identifier'>curPeriod</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz022<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz027 <span class='Baan-baanSQL def-Directive'>where</span>
 420:         <span class='Baan-baanComment def-Comment def-Syntax'>| по работнику, для которого формируется данная запись </span>
 421:         <span class='Baan-baanComment def-Comment def-Syntax'>| индивидуальных сведений,</span>
 422:         tfzzz022._index1<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz027.pwpwbdat<span class='Baan-baanSymbol def-Symbol'>}</span>
 423:         <span class='Baan-baanSQL def-Directive'>and</span>
 424:         <span class='Baan-baanComment def-Comment def-Syntax'>| периодам </span>
 425:         <span class='Baan-baanComment def-Comment def-Syntax'>|  непрерывной работы, попадающим в период формирования </span>
 426:         <span class='Baan-baanComment def-Comment def-Syntax'>| индивидуальных сведений</span>
 427:         tfzzz027._index2 <span class='Baan-baanSQL def-Directive'>inrange</span> 
 428:             <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MIN_DATE<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 429:             <span class='Baan-baanSQL def-Directive'>and</span>
 430:             <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MAX_DATE<span class='Baan-baanSymbol def-Symbol'>}</span>
 431:         <span class='Baan-baanSQL def-Directive'>and</span>
 432:         <span class='Baan-baanComment def-Comment def-Syntax'>| коду налога, соответствующего значению параметра запроса </span>
 433:         <span class='Baan-baanComment def-Comment def-Syntax'>|  &lt;Страховая часть></span>
 434:         tfzzz022.nalc<span class='Baan-baanSymbol def-Symbol'>=</span>:<span class='Baan-baanSQLParam def-Identifier'>tax</span>
 435:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 436:         <span class='def-Comment def-Syntax'>| периодам выплат, попадающим в период формирования индивидуальных </span>
 437:         <span class='def-Comment def-Syntax'>| сведений</span>
 438:         TDate curBeg<span class='Baan-baanSymbol def-Symbol'>,</span> curEnd
 439:         <span class='Baan-baanUserProcedure def-Identifier'>get.period.dates</span><span class='Baan-baanSymbol def-Symbol'>(</span>curPeriod<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span> curBeg<span class='Baan-baanSymbol def-Symbol'>,</span> curEnd<span class='Baan-baanSymbol def-Symbol'>)</span>
 440:        <span class='Baan-baanKeyword def-Keyword'> if</span> curEnd<span class='Baan-baanSymbol def-Symbol'>></span><span class='Baan-baanSymbol def-Symbol'>=</span>first <span class='Baan-baanKeyword def-Keyword'>and</span> curBeg<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>=</span>last <span class='Baan-baanKeyword def-Keyword'>then</span>
 441:             inc<span class='Baan-baanSymbol def-Symbol'>(</span>result<span class='Baan-baanSymbol def-Symbol'>,</span> cur<span class='Baan-baanSymbol def-Symbol'>)</span>
 442:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
 443:     <span class='Baan-baanSQL def-Directive'>endselect</span>
 444:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>result<span class='Baan-baanSymbol def-Symbol'>)</span>
 445: <span class='Baan-baanSymbol def-Symbol'>}</span>
 446: 
 447: <span class='def-Comment def-Syntax'>|</span>
 448: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 449: <span class='def-Comment def-Syntax'>| by Max Belugin 10.12.2002 17:05:22</span>
 450: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>long</span> illnessDays<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> period<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 451:     TDate first 
 452:     TDate last
 453:     <span class='Baan-baanUserProcedure def-Identifier'>get.period.dates</span><span class='Baan-baanSymbol def-Symbol'>(</span>period<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span> first<span class='Baan-baanSymbol def-Symbol'>,</span> last<span class='Baan-baanSymbol def-Symbol'>)</span>
 454:     <span class='Baan-baanKeyword def-Keyword'>long</span> result
 455:     result<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 456:     <span class='Baan-baanKeyword def-Keyword'>long</span> was
 457:     <span class='def-Comment def-Syntax'>|количество записей в непрерывном по датам наборе записей </span>
 458:     <span class='def-Comment def-Syntax'>|(периоде больничного) в таблице tfzzz007 по основному рабочему </span>
 459:     <span class='def-Comment def-Syntax'>|месту работника, виду времени, соответствующему значениям, </span>
 460:     <span class='def-Comment def-Syntax'>|указанным в полях &lt;Вид времени> записей таблицы tfzzz259, </span>
 461:     <span class='def-Comment def-Syntax'>|имеющих значение поля &lt;Тип отпуска> - &lt;Временная нетрудоспособность>, </span>
 462:     <span class='def-Comment def-Syntax'>|с признаком &lt;Верхний уровень> и датой, попадающей в отчетный период. </span>
 463:     <span class='def-Comment def-Syntax'>|Начало периода суммирования календарных дней определяется </span>
 464:     <span class='def-Comment def-Syntax'>|как максимальная из дат:</span>
 465:     <span class='def-Comment def-Syntax'>|        дата начала периода &lt;ПЕРИОД_ПУСТ>,</span>
 466:     <span class='def-Comment def-Syntax'>|        первая дата периода больничного;</span>
 467:     <span class='def-Comment def-Syntax'>|    Окончание периода суммирования календарных дней по одному документу определяется как минимальная из дат:</span>
 468:     <span class='def-Comment def-Syntax'>|        дата окончания периода &lt;ПЕРИОД_ПУСТ>,</span>
 469:     <span class='def-Comment def-Syntax'>|        последняя дата периода больничного.</span>
 470:     <span class='Baan-baanKeyword def-Keyword'>long</span> skipDate
 471:     skipDate<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 472:     TBool prevWasIllness
 473:     prevWasIllness<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanKeyword def-Keyword'>false</span>
 474:     <span class='Baan-baanKeyword def-Keyword'>long</span> prevDate
 475:     prevDate<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 476:     TBool hasIllness
 477:     hasIllness<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanKeyword def-Keyword'>false</span>
 478:     <span class='Baan-baanKeyword def-Keyword'>long</span> wpID<span class='Baan-baanSymbol def-Symbol'>,</span> dummy
 479:     <span class='Baan-baanSQL def-Directive'>select</span> 
 480:         tfzzz026.wp_id:<span class='Baan-baanSQLParam def-Identifier'>wpID</span><span class='Baan-baanSymbol def-Symbol'>,</span>tfzzz026.wp_vid:<span class='Baan-baanSQLParam def-Identifier'>dummy</span><span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz026.wp_crdat:<span class='Baan-baanSQLParam def-Identifier'>dummy</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 481:         tfzzz026.wp_andat:<span class='Baan-baanSQLParam def-Identifier'>dummy</span>
 482:     <span class='Baan-baanSQL def-Directive'>from</span> tfzzz026 <span class='Baan-baanSQL def-Directive'>where</span>
 483:         tfzzz026._index2<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 484:         <span class='Baan-baanSQL def-Directive'>and</span>
 485:         tfzzz026._index4 <span class='Baan-baanSQL def-Directive'>inrange</span> 
 486:             <span class='Baan-baanSymbol def-Symbol'>{</span>CB_TRUE<span class='Baan-baanSymbol def-Symbol'>,</span> DR_MIN_DATE<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 487:             <span class='Baan-baanSQL def-Directive'>and</span>
 488:             <span class='Baan-baanSymbol def-Symbol'>{</span>CB_TRUE<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MAX_DATE<span class='Baan-baanSymbol def-Symbol'>}</span>
 489:     <span class='Baan-baanSQL def-Directive'>order</span> <span class='Baan-baanSQL def-Directive'>by</span> tfzzz026._index4
 490:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 491:         <span class='Baan-baanSQL def-Directive'>select</span> tfzzz006.<span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz006 <span class='Baan-baanSQL def-Directive'>where</span>  
 492:             tfzzz006._index1<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>wpid</span><span class='Baan-baanSymbol def-Symbol'>,</span>:<span class='Baan-baanSQLParam def-Identifier'>period</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 493:         <span class='Baan-baanSQL def-Directive'>selectdo</span>
 494:             <span class='Baan-baanSQL def-Directive'>select</span> tfzzz007.<span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz007  <span class='Baan-baanSQL def-Directive'>where</span>     
 495:                 tfzzz007._index2 <span class='Baan-baanSQL def-Directive'>inrange</span> 
 496:                     <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz006.id_tab</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span><span class='Baan-baanSymbol def-Symbol'>}</span> 
 497:                     <span class='Baan-baanSQL def-Directive'>and</span>
 498:                     <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz006.id_tab</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span><span class='Baan-baanSymbol def-Symbol'>}</span> 
 499:             <span class='Baan-baanSQL def-Directive'>order</span> <span class='Baan-baanSQL def-Directive'>by</span> tfzzz007._index2
 500:             <span class='Baan-baanSQL def-Directive'>selectdo</span>
 501:                <span class='Baan-baanKeyword def-Keyword'> if</span> cb2b<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_high<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 502: 
 503:                <span class='Baan-baanKeyword def-Keyword'> if</span> prevDate<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span>tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_data <span class='Baan-baanKeyword def-Keyword'>then</span>
 504:                     prevDate<span class='Baan-baanSymbol def-Symbol'>=</span>tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_data
 505:                     prevWasIllness<span class='Baan-baanSymbol def-Symbol'>=</span>hasIllness
 506:                     hasIllness<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanKeyword def-Keyword'>false</span>
 507:                <span class='Baan-baanKeyword def-Keyword'> endif</span>
 508:                <span class='Baan-baanKeyword def-Keyword'> if</span> tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_data<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span>skipDate <span class='Baan-baanKeyword def-Keyword'>then</span>
 509:                     hasIllness<span class='Baan-baanSymbol def-Symbol'>=</span>isIllnessDay<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_v_cod<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>or</span>
 510:                         <span class='Baan-baanSymbol def-Symbol'>(</span>isVyhodnoj<span class='Baan-baanSymbol def-Symbol'>(</span>wpid<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_data<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>and</span>  prevWasIllness<span class='Baan-baanSymbol def-Symbol'>)</span>
 511:                    <span class='Baan-baanKeyword def-Keyword'> if</span> hasIllness <span class='Baan-baanKeyword def-Keyword'>then</span>
 512:                         skipDate<span class='Baan-baanSymbol def-Symbol'>=</span>tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_data
 513:                         inc<span class='Baan-baanSymbol def-Symbol'>(</span>result<span class='Baan-baanSymbol def-Symbol'>)</span>
 514:                    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 515:                <span class='Baan-baanKeyword def-Keyword'> endif</span>
 516:                 
 517:                <span class='Baan-baanKeyword def-Keyword'> endif</span>
 518:             <span class='Baan-baanSQL def-Directive'>endselect</span>    
 519:         <span class='Baan-baanSQL def-Directive'>endselect</span>
 520:     <span class='Baan-baanSQL def-Directive'>endselect</span>
 521:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>result<span class='Baan-baanSymbol def-Symbol'>)</span>    
 522: <span class='Baan-baanSymbol def-Symbol'>}</span>
 523: <span class='def-Comment def-Syntax'>|</span>
 524: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 525: <span class='def-Comment def-Syntax'>| by Max Belugin 10.12.2002 18:01:12</span>
 526: <span class='Baan-baanKeyword def-Keyword'>function</span> TBool isIllnessDay<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>str<span class='Baan-baanNumber def-Number'>.</span>id<span class='Baan-baanNumber def-Number'>.8</span> timeKind<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 527:     <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr dummy
 528:     <span class='Baan-baanSQL def-Directive'>select</span> tfzzz259.pfvidvr:<span class='Baan-baanSQLParam def-Identifier'>dummy</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz259 <span class='Baan-baanSQL def-Directive'>where</span>
 529:         tfzzz259._index1 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanSymbol def-Symbol'>{</span>tfzzz.pfvr.boln<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>timeKind</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 530:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 531:         <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>true</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 532:     <span class='Baan-baanSQL def-Directive'>endselect</span>
 533:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 534: <span class='Baan-baanSymbol def-Symbol'>}</span>
 535: <span class='def-Comment def-Syntax'>|</span>
 536: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 537: <span class='def-Comment def-Syntax'>| by Max Belugin 10.12.2002 18:10:47</span>
 538: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>long</span> temporaryIllnessDays<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> assurPart<span class='Baan-baanSymbol def-Symbol'>,</span> TDate first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate last<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 539:     <span class='Baan-baanKeyword def-Keyword'>long</span> result result<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 540:     <span class='Baan-baanUserProcedure def-Identifier'>forPeriodsBetween.begin</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanUserProcedure def-Identifier'>periodByDate</span><span class='Baan-baanSymbol def-Symbol'>(</span>first<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanUserProcedure def-Identifier'>periodByDate</span><span class='Baan-baanSymbol def-Symbol'>(</span>last<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 541:    <span class='Baan-baanKeyword def-Keyword'> while</span> <span class='Baan-baanKeyword def-Keyword'>not</span> <span class='Baan-baanUserProcedure def-Identifier'>ForPeriodsBetween.isEnd</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span> 
 542:         TDate curFirst<span class='Baan-baanSymbol def-Symbol'>,</span> curLast
 543:         <span class='Baan-baanUserProcedure def-Identifier'>get.period.dates</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanUserProcedure def-Identifier'>prd.id</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span> curFirst<span class='Baan-baanSymbol def-Symbol'>,</span> curLast<span class='Baan-baanSymbol def-Symbol'>)</span>
 544:        <span class='Baan-baanKeyword def-Keyword'> if</span> hasNoHrens<span class='Baan-baanSymbol def-Symbol'>(</span>empl<span class='Baan-baanSymbol def-Symbol'>,</span> curFirst<span class='Baan-baanSymbol def-Symbol'>,</span> curLast<span class='Baan-baanSymbol def-Symbol'>,</span> assurPart<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 545:             inc<span class='Baan-baanSymbol def-Symbol'>(</span>result<span class='Baan-baanSymbol def-Symbol'>,</span> illnessDays<span class='Baan-baanSymbol def-Symbol'>(</span>empl<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanUserProcedure def-Identifier'>prd.id</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 546:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
 547:         <span class='Baan-baanUserProcedure def-Identifier'>ForPeriodsBetween.next</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 548:    <span class='Baan-baanKeyword def-Keyword'> endwhile</span>
 549:     <span class='Baan-baanUserProcedure def-Identifier'>ForPeriodsBetween.end</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 550:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>result<span class='Baan-baanSymbol def-Symbol'>)</span>
 551: <span class='Baan-baanSymbol def-Symbol'>}</span>
 552: 
 553: <span class='def-Comment def-Syntax'>|</span>
 554: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 555: <span class='def-Comment def-Syntax'>| by Max Belugin 11.12.2002 12:34:38</span>
 556: <span class='Baan-baanKeyword def-Keyword'>function</span> TBool hasNoHrens<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> TDate first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate last<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> tax<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 557:     <span class='Baan-baanKeyword def-Keyword'>return</span> is0<span class='Baan-baanSymbol def-Symbol'>(</span>ChPF<span class='Baan-baanSymbol def-Symbol'>(</span>empl<span class='Baan-baanSymbol def-Symbol'>,</span> first<span class='Baan-baanSymbol def-Symbol'>,</span> last<span class='Baan-baanSymbol def-Symbol'>,</span> tax<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 558: <span class='Baan-baanSymbol def-Symbol'>}</span>
 559: 
 560: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>long</span> leaveDays<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> first<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> last<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 561:     <span class='Baan-baanKeyword def-Keyword'>long</span> result
 562:     result<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 563:     <span class='Baan-baanKeyword def-Keyword'>long</span> skipDate
 564:     skipDate<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 565:     <span class='Baan-baanKeyword def-Keyword'>long</span> wpID<span class='Baan-baanSymbol def-Symbol'>,</span> dummy
 566:     <span class='Baan-baanKeyword def-Keyword'>long</span> firstPeriod firstPeriod<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanUserProcedure def-Identifier'>periodByDate</span><span class='Baan-baanSymbol def-Symbol'>(</span>first<span class='Baan-baanSymbol def-Symbol'>)</span>
 567:     <span class='Baan-baanKeyword def-Keyword'>long</span> lastPeriod lastPeriod<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanUserProcedure def-Identifier'>periodByDate</span><span class='Baan-baanSymbol def-Symbol'>(</span>last<span class='Baan-baanSymbol def-Symbol'>)</span>
 568:     <span class='Baan-baanSQL def-Directive'>select</span> 
 569:         tfzzz026.wp_id:<span class='Baan-baanSQLParam def-Identifier'>wpID</span><span class='Baan-baanSymbol def-Symbol'>,</span>tfzzz026.wp_vid:<span class='Baan-baanSQLParam def-Identifier'>dummy</span><span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz026.wp_crdat:<span class='Baan-baanSQLParam def-Identifier'>dummy</span><span class='Baan-baanSymbol def-Symbol'>,</span>
 570:         tfzzz026.wp_andat:<span class='Baan-baanSQLParam def-Identifier'>dummy</span>
 571:     <span class='Baan-baanSQL def-Directive'>from</span> tfzzz026 <span class='Baan-baanSQL def-Directive'>where</span>
 572:         tfzzz026._index2<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 573:         <span class='Baan-baanSQL def-Directive'>and</span>
 574:         tfzzz026._index4 <span class='Baan-baanSQL def-Directive'>inrange</span> 
 575:             <span class='Baan-baanSymbol def-Symbol'>{</span>CB_TRUE<span class='Baan-baanSymbol def-Symbol'>,</span> DR_MIN_DATE<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 576:             <span class='Baan-baanSQL def-Directive'>and</span>
 577:             <span class='Baan-baanSymbol def-Symbol'>{</span>CB_TRUE<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MAX_DATE<span class='Baan-baanSymbol def-Symbol'>}</span>
 578:     <span class='Baan-baanSQL def-Directive'>order</span> <span class='Baan-baanSQL def-Directive'>by</span> tfzzz026._index4
 579:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 580:         <span class='Baan-baanSQL def-Directive'>select</span> tfzzz006.<span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz006 <span class='Baan-baanSQL def-Directive'>where</span>
 581:             tfzzz006._index1 <span class='Baan-baanSQL def-Directive'>inrange</span> 
 582:                 <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>wpid</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>firstPeriod</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 583:                 <span class='Baan-baanSQL def-Directive'>and</span>
 584:                 <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>wpid</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>lastPeriod</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 585:         <span class='Baan-baanSQL def-Directive'>order</span> <span class='Baan-baanSQL def-Directive'>by</span> tfzzz006._index1
 586:         <span class='Baan-baanSQL def-Directive'>selectdo</span>
 587:             <span class='Baan-baanSQL def-Directive'>select</span> tfzzz007.<span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz007  <span class='Baan-baanSQL def-Directive'>where</span>     
 588:                 tfzzz007._index2 <span class='Baan-baanSQL def-Directive'>inrange</span> 
 589:                     <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz006.id_tab</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span><span class='Baan-baanSymbol def-Symbol'>}</span> 
 590:                     <span class='Baan-baanSQL def-Directive'>and</span>
 591:                     <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz006.id_tab</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span><span class='Baan-baanSymbol def-Symbol'>}</span> 
 592:                 <span class='Baan-baanSQL def-Directive'>and</span>
 593:                 tfzzz007.tb_high<span class='Baan-baanSymbol def-Symbol'>=</span>CB_TRUE
 594:             <span class='Baan-baanSQL def-Directive'>order</span> <span class='Baan-baanSQL def-Directive'>by</span> tfzzz007._index2
 595:             <span class='Baan-baanSQL def-Directive'>selectdo</span>
 596:                 <span class='def-Comment def-Syntax'>|if cb2b(tfzzz007.tb_high) then</span>
 597:                    <span class='Baan-baanKeyword def-Keyword'> if</span> tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_data<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span>skipDate <span class='Baan-baanKeyword def-Keyword'>then</span>
 598:                        <span class='Baan-baanKeyword def-Keyword'> if</span> isLeaveDay<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_v_cod<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 599:                             skipDate<span class='Baan-baanSymbol def-Symbol'>=</span>tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_data
 600:                             inc<span class='Baan-baanSymbol def-Symbol'>(</span>result<span class='Baan-baanSymbol def-Symbol'>)</span>
 601:                        <span class='Baan-baanKeyword def-Keyword'> endif</span>
 602:                    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 603:                 <span class='def-Comment def-Syntax'>|endif</span>
 604:             <span class='Baan-baanSQL def-Directive'>endselect</span>
 605:         <span class='Baan-baanSQL def-Directive'>endselect</span>
 606:     <span class='Baan-baanSQL def-Directive'>endselect</span>
 607:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>result<span class='Baan-baanSymbol def-Symbol'>)</span>        
 608: <span class='Baan-baanSymbol def-Symbol'>}</span>
 609: <span class='Baan-baanKeyword def-Keyword'>function</span> TBool isLeaveDay<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>str<span class='Baan-baanNumber def-Number'>.</span>id<span class='Baan-baanNumber def-Number'>.8</span> timeKind<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 610:     <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr dummy
 611:     <span class='Baan-baanSQL def-Directive'>select</span> tfzzz259.pfvidvr:<span class='Baan-baanSQLParam def-Identifier'>dummy</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz259 <span class='Baan-baanSQL def-Directive'>where</span>
 612:         tfzzz259._index1 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanSymbol def-Symbol'>{</span>tfzzz.pfvr.adm<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>timeKind</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 613:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 614:         <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>true</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 615:     <span class='Baan-baanSQL def-Directive'>endselect</span>
 616:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 617: <span class='Baan-baanSymbol def-Symbol'>}</span>
 618: 
 619: <span class='def-Comment def-Syntax'>|</span>
 620: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 621: <span class='def-Comment def-Syntax'>| by Max Belugin 12.12.2002 15:34:04</span>
 622: <span class='Baan-baanKeyword def-Keyword'>function</span> TBool isVyhodnoj<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> wp<span class='Baan-baanSymbol def-Symbol'>,</span> TDate aDate<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 623:     <span class='Baan-baanUserProcedure def-Identifier'>prof.begPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"isVyhodnoj"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 624:     <span class='Baan-baanKeyword def-Keyword'>long</span> days
 625:     <span class='Baan-baanKeyword def-Keyword'>double</span> hours
 626:     ghis<span class='Baan-baanNumber def-Number'>.</span>fundForDate<span class='Baan-baanSymbol def-Symbol'>(</span>wp<span class='Baan-baanSymbol def-Symbol'>,</span> aDate<span class='Baan-baanSymbol def-Symbol'>,</span> days<span class='Baan-baanSymbol def-Symbol'>,</span> hours<span class='Baan-baanSymbol def-Symbol'>)</span>
 627:     <span class='Baan-baanUserProcedure def-Identifier'>prof.endPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"isVyhodnoj"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 628:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>days<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span> <span class='Baan-baanKeyword def-Keyword'>and</span> is0<span class='Baan-baanSymbol def-Symbol'>(</span>hours<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 629: <span class='Baan-baanSymbol def-Symbol'>}</span>
 630: 
 631: <span class='def-Comment def-Syntax'>|</span>
 632: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 633: <span class='def-Comment def-Syntax'>| by Max Belugin 12.12.2002 16:48:57</span>
 634: <span class='Baan-baanKeyword def-Keyword'>function</span> variantMaxa<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> TDate first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate last<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 635:     <span class='Baan-baanUserProcedure def-Identifier'>prof.begPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"variantMaxa"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 636:     <span class='Baan-baanSQL def-Directive'>select</span> tfzzz026.<span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz026 <span class='Baan-baanSQL def-Directive'>where</span>
 637:         tfzzz026._index2<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 638:         <span class='Baan-baanSQL def-Directive'>and</span>
 639:         tfzzz026._index4 <span class='Baan-baanSQL def-Directive'>inrange</span> 
 640:             <span class='Baan-baanSymbol def-Symbol'>{</span>CB_TRUE<span class='Baan-baanSymbol def-Symbol'>,</span> DR_MIN_DATE<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 641:             <span class='Baan-baanSQL def-Directive'>and</span>
 642:             <span class='Baan-baanSymbol def-Symbol'>{</span>CB_TRUE<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MAX_DATE<span class='Baan-baanSymbol def-Symbol'>}</span>
 643:     <span class='Baan-baanSQL def-Directive'>order</span> <span class='Baan-baanSQL def-Directive'>by</span> tfzzz026._index4
 644:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 645:         variantByWP<span class='Baan-baanSymbol def-Symbol'>(</span>empl<span class='Baan-baanSymbol def-Symbol'>,</span> _max<span class='Baan-baanSymbol def-Symbol'>(</span>first<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_crdat<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> _min<span class='Baan-baanSymbol def-Symbol'>(</span>last<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_andat<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 646:     <span class='Baan-baanSQL def-Directive'>endselect</span>    
 647:     <span class='Baan-baanUserProcedure def-Identifier'>prof.endPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"variantMaxa"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 648: <span class='Baan-baanSymbol def-Symbol'>}</span>
 649: <span class='def-Comment def-Syntax'>|</span>
 650: <span class='def-Comment def-Syntax'>| вызывает handlePeriod(wp,begDate, endDate, leaveKind, false)</span>
 651: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 652: <span class='def-Comment def-Syntax'>| by Max Belugin 12.12.2002 15:55:34</span>
 653: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>extern</span> variantByWP<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> TDate first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate last<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 654:     <span class='Baan-baanUserProcedure def-Identifier'>prof.begPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"variant4_byWP"</span><span class='Baan-baanSymbol def-Symbol'>)</span>    
 655:     <span class='Baan-baanKeyword def-Keyword'>long</span> firstPeriod firstPeriod<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanUserProcedure def-Identifier'>periodByDate</span><span class='Baan-baanSymbol def-Symbol'>(</span>first<span class='Baan-baanSymbol def-Symbol'>)</span>
 656:     <span class='Baan-baanKeyword def-Keyword'>long</span> lastPeriod lastPeriod<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanUserProcedure def-Identifier'>periodByDate</span><span class='Baan-baanSymbol def-Symbol'>(</span>last<span class='Baan-baanSymbol def-Symbol'>)</span>    
 657:     TDate currentRange<span class='Baan-baanNumber def-Number'>.</span>start
 658:     <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr currentRange<span class='Baan-baanNumber def-Number'>.</span>leaveKind
 659:     <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr currentDay<span class='Baan-baanNumber def-Number'>.</span>leaveKind
 660:     currentDay<span class='Baan-baanNumber def-Number'>.</span>leaveKind<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanKeyword def-Keyword'>empty</span>
 661:     currentRange<span class='Baan-baanNumber def-Number'>.</span>start<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 662:     TDate skipDate skipDate<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 663:     TDate prevDate prevDate<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>    
 664:     TBool prevWasLeave
 665:     prevWasLeave<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanKeyword def-Keyword'>false</span>
 666:     TBool wasLeaves
 667:     <span class='Baan-baanSQL def-Directive'>select</span> tfzzz007.<span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz026<span class='Baan-baanSymbol def-Symbol'>,</span>tfzzz006<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz007  <span class='Baan-baanSQL def-Directive'>where</span>     
 668:         tfzzz026._index2<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 669:         <span class='Baan-baanSQL def-Directive'>and</span>
 670:         tfzzz006._index1<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanSymbol def-Symbol'>{</span>tfzzz026.wp_id<span class='Baan-baanSymbol def-Symbol'>}</span>
 671: <span class='Baan-baanComment def-Comment def-Syntax'>|        and</span>
 672: <span class='Baan-baanComment def-Comment def-Syntax'>|        tfzzz006._index1 inrange</span>
 673: <span class='Baan-baanComment def-Comment def-Syntax'>|            {tfzzz026.wp_id,:firstPeriod}</span>
 674: <span class='Baan-baanComment def-Comment def-Syntax'>|            and</span>
 675: <span class='Baan-baanComment def-Comment def-Syntax'>|            {tfzzz026.wp_id,:lastPeriod}</span>
 676:         <span class='Baan-baanSQL def-Directive'>and</span>
 677:         tfzzz007._index2 <span class='Baan-baanSQL def-Directive'>inrange</span> 
 678:             <span class='Baan-baanSymbol def-Symbol'>{</span>tfzzz006.id_tab<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span><span class='Baan-baanSymbol def-Symbol'>}</span> 
 679:             <span class='Baan-baanSQL def-Directive'>and</span>
 680:             <span class='Baan-baanSymbol def-Symbol'>{</span>tfzzz006.id_tab<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span><span class='Baan-baanSymbol def-Symbol'>}</span> 
 681:         <span class='Baan-baanSQL def-Directive'>and</span>
 682:         tfzzz007.tb_high<span class='Baan-baanSymbol def-Symbol'>=</span>CB_TRUE
 683:     <span class='Baan-baanComment def-Comment def-Syntax'>|@todo:index12</span>
 684:     <span class='Baan-baanSQL def-Directive'>order</span> <span class='Baan-baanSQL def-Directive'>by</span> tfzzz007.tb_data <span class='Baan-baanComment def-Comment def-Syntax'>| tfzzz007._index12 | tfzzz007.tb_data</span>
 685:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 686:         <span class='Baan-baanUserProcedure def-Identifier'>prof.begPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"v4_body"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 687:         <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr curLeaveKind
 688:         curLeaveKind<span class='Baan-baanSymbol def-Symbol'>=</span>leaveKindByTimeKind<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_v_cod<span class='Baan-baanSymbol def-Symbol'>)</span>
 689:        <span class='Baan-baanKeyword def-Keyword'> if</span> curLeaveKind<span class='Baan-baanSymbol def-Symbol'>=</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr<span class='Baan-baanNumber def-Number'>.</span>boln <span class='Baan-baanKeyword def-Keyword'>then</span>
 690:             curLeaveKind<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanKeyword def-Keyword'>empty</span>
 691:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
 692:        <span class='Baan-baanKeyword def-Keyword'> if</span> tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_data<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span>prevDate <span class='Baan-baanKeyword def-Keyword'>then</span>
 693:             TBool isHoliday             
 694:             isHoliday<span class='Baan-baanSymbol def-Symbol'>=</span>isVyhodnoj<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_id<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_data<span class='Baan-baanSymbol def-Symbol'>)</span>
 695:            <span class='Baan-baanKeyword def-Keyword'> if</span> currentRange<span class='Baan-baanNumber def-Number'>.</span>start<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 696:                 currentRange<span class='Baan-baanNumber def-Number'>.</span>start<span class='Baan-baanSymbol def-Symbol'>=</span>tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_data
 697:             <span class='Baan-baanKeyword def-Keyword'>else</span>
 698:                <span class='Baan-baanKeyword def-Keyword'> if</span> currentDay<span class='Baan-baanNumber def-Number'>.</span>leaveKind<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span>currentRange<span class='Baan-baanNumber def-Number'>.</span>leaveKind <span class='Baan-baanKeyword def-Keyword'>then</span>
 699:                     handlePeriod<span class='Baan-baanSymbol def-Symbol'>(</span>empl<span class='Baan-baanSymbol def-Symbol'>,</span> currentRange<span class='Baan-baanNumber def-Number'>.</span>start<span class='Baan-baanSymbol def-Symbol'>,</span> prevDate<span class='Baan-baanSymbol def-Symbol'>-</span><span class='Baan-baanNumber def-Number'>1</span><span class='Baan-baanSymbol def-Symbol'>,</span> 
 700:                         currentRange<span class='Baan-baanNumber def-Number'>.</span>leaveKind<span class='Baan-baanSymbol def-Symbol'>)</span>
 701:                     currentrange<span class='Baan-baanNumber def-Number'>.</span>start<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 702:                     currentRange<span class='Baan-baanNumber def-Number'>.</span>leaveKind <span class='Baan-baanSymbol def-Symbol'>=</span> currentDay<span class='Baan-baanNumber def-Number'>.</span>leaveKind
 703:                     currentRange<span class='Baan-baanNumber def-Number'>.</span>start<span class='Baan-baanSymbol def-Symbol'>=</span>prevDate
 704:                <span class='Baan-baanKeyword def-Keyword'> endif</span>
 705:            <span class='Baan-baanKeyword def-Keyword'> endif</span>
 706:            <span class='Baan-baanKeyword def-Keyword'> if</span> <span class='Baan-baanKeyword def-Keyword'>not</span> isHoliday <span class='Baan-baanKeyword def-Keyword'>then</span>
 707:                 currentDay<span class='Baan-baanNumber def-Number'>.</span>leaveKind<span class='Baan-baanSymbol def-Symbol'>=</span>curLeaveKind
 708:            <span class='Baan-baanKeyword def-Keyword'> endif</span>
 709:         <span class='Baan-baanKeyword def-Keyword'>else</span>
 710:            <span class='Baan-baanKeyword def-Keyword'> if</span> curLeaveKind<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span>currentDay<span class='Baan-baanNumber def-Number'>.</span>leaveKind <span class='Baan-baanKeyword def-Keyword'>and</span> <span class='Baan-baanKeyword def-Keyword'>not</span> isHoliday <span class='Baan-baanKeyword def-Keyword'>then</span>
 711:                 currentDay<span class='Baan-baanNumber def-Number'>.</span>leaveKind<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanKeyword def-Keyword'>empty</span>
 712:            <span class='Baan-baanKeyword def-Keyword'> endif</span>
 713:        <span class='Baan-baanKeyword def-Keyword'> endif </span>               
 714:         <span class='Baan-baanUserProcedure def-Identifier'>prof.endPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"v4_body"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 715:         prevDate<span class='Baan-baanSymbol def-Symbol'>=</span>tfzzz007<span class='Baan-baanNumber def-Number'>.</span>tb_data
 716:         wasLeaves<span class='Baan-baanSymbol def-Symbol'>=</span>wasLeaves <span class='Baan-baanKeyword def-Keyword'>or</span> currentRange<span class='Baan-baanNumber def-Number'>.</span>leaveKind<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span><span class='Baan-baanKeyword def-Keyword'>empty</span>
 717:     <span class='Baan-baanSQL def-Directive'>endselect</span>
 718:     
 719:    <span class='Baan-baanKeyword def-Keyword'> if</span> currentRange<span class='Baan-baanNumber def-Number'>.</span>start<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span><span class='Baan-baanNumber def-Number'>0</span> <span class='Baan-baanKeyword def-Keyword'>then</span> <span class='def-Comment def-Syntax'>| if currentRange.start&lt;>0 and wasLeaves then</span>
 720:         handlePeriod<span class='Baan-baanSymbol def-Symbol'>(</span>empl<span class='Baan-baanSymbol def-Symbol'>,</span> currentRange<span class='Baan-baanNumber def-Number'>.</span>start<span class='Baan-baanSymbol def-Symbol'>,</span> prevDate<span class='Baan-baanSymbol def-Symbol'>,</span> 
 721:             currentRange<span class='Baan-baanNumber def-Number'>.</span>leaveKind<span class='Baan-baanSymbol def-Symbol'>)</span>
 722:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 723:     <span class='Baan-baanUserProcedure def-Identifier'>prof.endPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"variant4_byWP"</span><span class='Baan-baanSymbol def-Symbol'>)</span>    
 724: <span class='Baan-baanSymbol def-Symbol'>}</span>
 725: 
 726: 
 727: <span class='Baan-baanDirective def-Directive'>#define</span> FLAG1
 728: <span class='Baan-baanSymbol def-Symbol'>^</span> <span class='Baan-baanSymbol def-Symbol'>(</span>  OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"САМОЛЕТ"</span> 
 729: <span class='Baan-baanSymbol def-Symbol'>^</span> <span class='Baan-baanKeyword def-Keyword'>or</span> OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"СПЕЦАВ"</span> 
 730: <span class='Baan-baanSymbol def-Symbol'>^</span> <span class='Baan-baanKeyword def-Keyword'>or</span> OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ИТСИСП"</span> 
 731: <span class='Baan-baanSymbol def-Symbol'>^</span> <span class='Baan-baanKeyword def-Keyword'>or</span> OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ИТСМАВ"</span> 
 732: <span class='Baan-baanSymbol def-Symbol'>^</span> <span class='Baan-baanKeyword def-Keyword'>or</span> OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ИНСПЕКТ"</span> 
 733: <span class='Baan-baanSymbol def-Symbol'>^</span> <span class='Baan-baanKeyword def-Keyword'>or</span> OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ЛЕТИСП"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 734: 
 735: <span class='Baan-baanDirective def-Directive'>#define</span> FLAG2
 736: <span class='Baan-baanSymbol def-Symbol'>^</span>    OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ЗП80РК"</span>
 737: 
 738: <span class='Baan-baanDirective def-Directive'>#define</span> FLAG3
 739: <span class='Baan-baanSymbol def-Symbol'>^</span> <span class='Baan-baanSymbol def-Symbol'>(</span> OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ЗП81СМ"</span>
 740: <span class='Baan-baanSymbol def-Symbol'>^</span> <span class='Baan-baanKeyword def-Keyword'>or</span> OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ЗП81ГД"</span>
 741: <span class='Baan-baanSymbol def-Symbol'>^</span> <span class='Baan-baanKeyword def-Keyword'>or</span> OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ХИРУРГСМ"</span>
 742: <span class='Baan-baanSymbol def-Symbol'>^</span> <span class='Baan-baanKeyword def-Keyword'>or</span> OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ХИРУРГД"</span>
 743: <span class='Baan-baanSymbol def-Symbol'>^</span> <span class='Baan-baanKeyword def-Keyword'>or</span> OIVL<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ЗП80ПД"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 744: 
 745: 
 746: <span class='Baan-baanKeyword def-Keyword'>function</span> handlePeriod<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> TDate first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate last<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr leaveKind<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 747: 
 748:    <span class='Baan-baanKeyword def-Keyword'> if</span> leaveKind<span class='Baan-baanSymbol def-Symbol'>=</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr<span class='Baan-baanNumber def-Number'>.</span>adm <span class='Baan-baanKeyword def-Keyword'>then</span>
 749:         <span class='Baan-baanKeyword def-Keyword'>return</span>
 750:    <span class='Baan-baanKeyword def-Keyword'> endif </span>   
 751:     
 752:     tbool was1 
 753:     tbool was2 
 754:     tbool was3
 755: 
 756:     <span class='Baan-baanSQL def-Directive'>select</span> <span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz026 <span class='Baan-baanSQL def-Directive'>where</span>
 757:     _index6 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>}</span> 
 758:     <span class='Baan-baanSQL def-Directive'>and</span>
 759:     tfzzz026.wp_crdat <span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>=</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span>
 760:     <span class='Baan-baanSQL def-Directive'>and</span>
 761:     tfzzz026.wp_andat <span class='Baan-baanSymbol def-Symbol'>></span><span class='Baan-baanSymbol def-Symbol'>=</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span>
 762:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 763:         was1 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_vid <span class='Baan-baanSymbol def-Symbol'>=</span> CB_TRUE<span class='Baan-baanSymbol def-Symbol'>)</span>
 764:         was2 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanKeyword def-Keyword'>false</span>        
 765:         was3 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanKeyword def-Keyword'>false</span>        
 766: 
 767:         <span class='def-Comment def-Syntax'>| 2я часть недержания - 1</span>
 768:         <span class='Baan-baanSQL def-Directive'>select</span>  tfzzz024.<span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span>    tfzzz058<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz024
 769:         <span class='Baan-baanSQL def-Directive'>where</span>     tfzzz058._index1<span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_staff</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_prid1</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 770:             <span class='Baan-baanSQL def-Directive'>and</span> tfzzz058.pnplwcnd <span class='Baan-baanSQL def-Directive'>refers</span> <span class='Baan-baanSQL def-Directive'>to</span> tfzzz024 <span class='Baan-baanComment def-Comment def-Syntax'>| линк на 024</span>
 771:             <span class='Baan-baanSQL def-Directive'>and</span> tfzzz024.c_lb_pfc <span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span> ""
 772:         <span class='Baan-baanSQL def-Directive'>selectdo</span>
 773:            was2<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanKeyword def-Keyword'>true</span>    
 774:         <span class='Baan-baanSQL def-Directive'>endselect</span>
 775:     
 776:         <span class='def-Comment def-Syntax'>| 2я часть недержания - 2</span>
 777:         <span class='Baan-baanSQL def-Directive'>select</span> tfzzz095.<span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz095<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz156 <span class='Baan-baanSQL def-Directive'>where</span> 
 778:           tfzzz156._index1 <span class='Baan-baanSQL def-Directive'>inrange</span> <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_staff</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_id</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MIN_LONG<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 779:                               <span class='Baan-baanSQL def-Directive'>and</span>  <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_staff</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_id</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MAX_LONG<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 780:             <span class='Baan-baanSQL def-Directive'>and</span> tfzzz156.smagstzh <span class='Baan-baanSQL def-Directive'>refers</span> <span class='Baan-baanSQL def-Directive'>to</span> tfzzz095    <span class='Baan-baanComment def-Comment def-Syntax'>| Виды стажей</span>
 781:             <span class='Baan-baanSQL def-Directive'>and</span> tfzzz095.rctpvsbs <span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span> ""
 782:         <span class='Baan-baanSQL def-Directive'>as</span> <span class='Baan-baanSQL def-Directive'>set</span> <span class='Baan-baanSQL def-Directive'>with</span> 1 <span class='Baan-baanSQL def-Directive'>rows</span>
 783:         <span class='Baan-baanSQL def-Directive'>selectdo</span>
 784:            was3<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanKeyword def-Keyword'>true</span>
 785:         <span class='Baan-baanSQL def-Directive'>endselect</span>
 786: 
 787:        <span class='Baan-baanKeyword def-Keyword'> if</span> was1 <span class='Baan-baanKeyword def-Keyword'>or</span> was2 <span class='Baan-baanKeyword def-Keyword'>or</span> was3 <span class='Baan-baanKeyword def-Keyword'>then</span> 
 788:             handlePeriodOld<span class='Baan-baanSymbol def-Symbol'>(</span>_max<span class='Baan-baanSymbol def-Symbol'>(</span>first<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_crdat<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> _min<span class='Baan-baanSymbol def-Symbol'>(</span>last<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_andat<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> leaveKind<span class='Baan-baanSymbol def-Symbol'>,</span> was1<span class='Baan-baanSymbol def-Symbol'>,</span> was2<span class='Baan-baanSymbol def-Symbol'>,</span> was3<span class='Baan-baanSymbol def-Symbol'>)</span>
 789:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
 790: 
 791:         <span class='def-Comment def-Syntax'>| по просьбам Маш</span>
 792:        <span class='Baan-baanKeyword def-Keyword'> if</span> leaveKind<span class='Baan-baanSymbol def-Symbol'>=</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr<span class='Baan-baanNumber def-Number'>.</span>deti <span class='Baan-baanKeyword def-Keyword'>or</span> leaveKind<span class='Baan-baanSymbol def-Symbol'>=</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr<span class='Baan-baanNumber def-Number'>.</span>dekr <span class='Baan-baanKeyword def-Keyword'>then</span>
 793:             <span class='Baan-baanKeyword def-Keyword'>break</span>
 794:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
 795: 
 796:     <span class='Baan-baanSQL def-Directive'>endselect</span>
 797: 
 798: <span class='Baan-baanSymbol def-Symbol'>}</span>
 799: 
 800: <span class='def-Comment def-Syntax'>|</span>
 801: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 802: <span class='def-Comment def-Syntax'>| by Max Belugin 12.12.2002 16:52:24</span>
 803: <span class='Baan-baanKeyword def-Keyword'>function</span> handlePeriodOld<span class='Baan-baanSymbol def-Symbol'>(</span>TDate first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate last<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>domain</span> tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr leaveKind<span class='Baan-baanSymbol def-Symbol'>,</span> tbool was1<span class='Baan-baanSymbol def-Symbol'>,</span> tbool was2<span class='Baan-baanSymbol def-Symbol'>,</span> tbool was3<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 804:     <span class='Baan-baanUserProcedure def-Identifier'>prof.begPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"handlePeriod"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 805:     TDate  NCPR     
 806:     TDate  KNPR      
 807:     <span class='Baan-baanKeyword def-Keyword'>String</span> TOOS<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>40</span><span class='Baan-baanSymbol def-Symbol'>)</span>  
 808:     <span class='Baan-baanKeyword def-Keyword'>String</span> OUUS<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>40</span><span class='Baan-baanSymbol def-Symbol'>)</span>  
 809:     <span class='Baan-baanKeyword def-Keyword'>String</span> OITS<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>40</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 810:     <span class='Baan-baanKeyword def-Keyword'>long</span>   DCC1
 811:     <span class='Baan-baanKeyword def-Keyword'>long</span>   DCC2
 812:     <span class='Baan-baanKeyword def-Keyword'>String</span> DCC3<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>40</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 813:     <span class='Baan-baanKeyword def-Keyword'>String</span> OIVL<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>40</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 814:     <span class='Baan-baanKeyword def-Keyword'>long</span>   DSV1
 815:     <span class='Baan-baanKeyword def-Keyword'>long</span>   DSV2
 816:     <span class='Baan-baanKeyword def-Keyword'>double</span> DSV3
 817:     <span class='Baan-baanKeyword def-Keyword'>String</span> KPSP<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>40</span><span class='Baan-baanSymbol def-Symbol'>)</span> 
 818:     <span class='def-Comment def-Syntax'>| 3</span>
 819:     NCPR <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanProcedure def-Symbol'>max</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_crdat<span class='Baan-baanSymbol def-Symbol'>,</span> first<span class='Baan-baanSymbol def-Symbol'>)</span> 
 820:     <span class='def-Comment def-Syntax'>| 4</span>
 821:     KNPR <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanProcedure def-Symbol'>min</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_andat<span class='Baan-baanSymbol def-Symbol'>,</span> last <span class='Baan-baanSymbol def-Symbol'>)</span> 
 822:     <span class='def-Comment def-Syntax'>| 5</span>
 823:     TOOS <span class='Baan-baanSymbol def-Symbol'>=</span> was2 <span class='Baan-baanSymbol def-Symbol'>?</span> tfzzz024<span class='Baan-baanNumber def-Number'>.</span>terusl   <span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanString def-String'>""</span>
 824:     <span class='def-Comment def-Syntax'>| 6</span>
 825:     OUUS<span class='Baan-baanSymbol def-Symbol'>=</span>  was2 <span class='Baan-baanSymbol def-Symbol'>?</span> tfzzz024<span class='Baan-baanNumber def-Number'>.</span>c_lb_pfc <span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanString def-String'>""</span>
 826:     <span class='def-Comment def-Syntax'>| 7</span>
 827:     OITS<span class='Baan-baanSymbol def-Symbol'>=</span>  was3 <span class='Baan-baanSymbol def-Symbol'>?</span> tfzzz095<span class='Baan-baanNumber def-Number'>.</span>pfoist   <span class='Baan-baanSymbol def-Symbol'>:</span> <span class='Baan-baanString def-String'>""</span>
 828:     <span class='def-Comment def-Syntax'>| 8,9</span>
 829:     <span class='Baan-baanKeyword def-Keyword'>double</span> kdst<span class='Baan-baanSymbol def-Symbol'>,</span> klwc<span class='Baan-baanSymbol def-Symbol'>,</span> kdstDiv30
 830:     kdst <span class='Baan-baanSymbol def-Symbol'>=</span> getKDST<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_staff<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_id<span class='Baan-baanSymbol def-Symbol'>,</span> NCPR<span class='Baan-baanSymbol def-Symbol'>,</span> KNPR<span class='Baan-baanSymbol def-Symbol'>)</span> 
 831:     <span class='Baan-baanKeyword def-Keyword'>long</span> years <span class='Baan-baanSymbol def-Symbol'>,</span>months<span class='Baan-baanSymbol def-Symbol'>,</span> days
 832:     PFSeniority<span class='Baan-baanSymbol def-Symbol'>(</span>first<span class='Baan-baanSymbol def-Symbol'>,</span> last<span class='Baan-baanSymbol def-Symbol'>,</span> years <span class='Baan-baanSymbol def-Symbol'>,</span>months<span class='Baan-baanSymbol def-Symbol'>,</span> days<span class='Baan-baanSymbol def-Symbol'>)</span>
 833: 
 834:     klwc <span class='Baan-baanSymbol def-Symbol'>=</span> KLWCh<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_staff<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_id<span class='Baan-baanSymbol def-Symbol'>,</span>NCPR<span class='Baan-baanSymbol def-Symbol'>,</span> KNPR<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='def-Comment def-Syntax'>| можно ли тут так передавать empl и wp ?</span>
 835:     DCC1<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 836:     DCC2<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 837:     <span class='Baan-baanDirective def-Directive'>#define</span> notVodolaz  <span class='Baan-baanSymbol def-Symbol'>(</span>trim$<span class='Baan-baanSymbol def-Symbol'>(</span>OITS<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanSymbol def-Symbol'>></span><span class='Baan-baanString def-String'>"ВОДОЛАЗ"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 838:    <span class='Baan-baanKeyword def-Keyword'> if</span> <span class='Baan-baanSymbol def-Symbol'>(</span>was2 <span class='Baan-baanKeyword def-Keyword'>or</span> was3<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>and</span> <span class='Baan-baanKeyword def-Keyword'>not</span> <span class='Baan-baanProcedure def-Symbol'>isSpace</span><span class='Baan-baanSymbol def-Symbol'>(</span>OUUS<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 839:         DCC1 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanProcedure def-Symbol'>min</span><span class='Baan-baanSymbol def-Symbol'>(</span>months<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanProcedure def-Symbol'>round</span><span class='Baan-baanSymbol def-Symbol'>(</span>notVodolaz <span class='Baan-baanSymbol def-Symbol'>?</span> <span class='Baan-baanSymbol def-Symbol'>(</span>kdst<span class='Baan-baanSymbol def-Symbol'>/</span><span class='Baan-baanNumber def-Number'>30</span><span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanSymbol def-Symbol'>:</span> klwc<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 840:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 841:    <span class='Baan-baanKeyword def-Keyword'> if</span> <span class='Baan-baanSymbol def-Symbol'>(</span>was2 <span class='Baan-baanKeyword def-Keyword'>or</span> was3<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>and</span> <span class='Baan-baanKeyword def-Keyword'>not</span> <span class='Baan-baanProcedure def-Symbol'>isSpace</span><span class='Baan-baanSymbol def-Symbol'>(</span>OUUS<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 842:         DCC2 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanProcedure def-Symbol'>min</span><span class='Baan-baanSymbol def-Symbol'>(</span>days  <span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanProcedure def-Symbol'>round</span><span class='Baan-baanSymbol def-Symbol'>(</span>notVodolaz <span class='Baan-baanSymbol def-Symbol'>?</span> <span class='Baan-baanSymbol def-Symbol'>(</span>kdst\<span class='Baan-baanNumber def-Number'>30</span><span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanSymbol def-Symbol'>:</span> frac<span class='Baan-baanSymbol def-Symbol'>(</span>klwc<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>*</span><span class='Baan-baanNumber def-Number'>60.0</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanNumber def-Number'>2</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 843:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 844:     <span class='def-Comment def-Syntax'>| 10</span>
 845:     DCC3<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>""</span>
 846:    <span class='Baan-baanKeyword def-Keyword'> if</span> leaveKind<span class='Baan-baanSymbol def-Symbol'>=</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr<span class='Baan-baanNumber def-Number'>.</span>dekr <span class='Baan-baanKeyword def-Keyword'>then</span>
 847:         DCC3<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ДЕКРЕТ"</span>
 848: <span class='def-Comment def-Syntax'>|        alert(dcc3)</span>
 849:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 850:    <span class='Baan-baanKeyword def-Keyword'> if</span> leaveKind<span class='Baan-baanSymbol def-Symbol'>=</span>tfzzz<span class='Baan-baanNumber def-Number'>.</span>pfvr<span class='Baan-baanNumber def-Number'>.</span>deti <span class='Baan-baanKeyword def-Keyword'>then</span>
 851:         DCC3<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanString def-String'>"ДЕТИ"</span>
 852:     <span class='def-Comment def-Syntax'>|    alert(dcc3)</span>
 853:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 854:     <span class='def-Comment def-Syntax'>| 11</span>
 855:     OIVL <span class='Baan-baanSymbol def-Symbol'>=</span> getOIVL<span class='Baan-baanSymbol def-Symbol'>(</span>first<span class='Baan-baanSymbol def-Symbol'>,</span>last<span class='Baan-baanSymbol def-Symbol'>)</span>
 856:     <span class='def-Comment def-Syntax'>| 12,13</span>
 857:    <span class='Baan-baanKeyword def-Keyword'> if</span> FLAG1 <span class='Baan-baanKeyword def-Keyword'>or</span> FLAG2 <span class='Baan-baanKeyword def-Keyword'>then</span>
 858:         <span class='Baan-baanKeyword def-Keyword'>double</span> klwc1
 859:         klwc1 <span class='Baan-baanSymbol def-Symbol'>=</span> KLWCh1<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_staff<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_id<span class='Baan-baanSymbol def-Symbol'>,</span>NCPR<span class='Baan-baanSymbol def-Symbol'>,</span> KNPR<span class='Baan-baanSymbol def-Symbol'>)</span>
 860:        <span class='Baan-baanKeyword def-Keyword'> if</span> FLAG1 <span class='Baan-baanKeyword def-Keyword'>or</span> FLAG2 <span class='Baan-baanKeyword def-Keyword'>then</span> 
 861:             DSV1 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanProcedure def-Symbol'>round</span><span class='Baan-baanSymbol def-Symbol'>(</span>klwc1<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>)</span> 
 862:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
 863:        <span class='Baan-baanKeyword def-Keyword'> if</span> FLAG1 <span class='Baan-baanKeyword def-Keyword'>then</span> 
 864:             DSV2 <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanProcedure def-Symbol'>round</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>0.6</span><span class='Baan-baanSymbol def-Symbol'>*</span><span class='Baan-baanSymbol def-Symbol'>(</span>klwc1<span class='Baan-baanSymbol def-Symbol'>-</span><span class='Baan-baanProcedure def-Symbol'>round</span><span class='Baan-baanSymbol def-Symbol'>(</span>klwc1<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>2</span><span class='Baan-baanSymbol def-Symbol'>)</span> 
 865:        <span class='Baan-baanKeyword def-Keyword'> endif</span>
 866:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 867:     <span class='def-Comment def-Syntax'>| 14</span>
 868:     KPSP <span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanUserProcedure def-Identifier'>string.value.byID</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"tfzzz019"</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanString def-String'>"pos_kslp"</span><span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz026<span class='Baan-baanNumber def-Number'>.</span>wp_dp_ps<span class='Baan-baanSymbol def-Symbol'>)</span>
 869:     <span class='def-Comment def-Syntax'>| 15</span>
 870:     DSV3<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0.0</span>
 871:    <span class='Baan-baanKeyword def-Keyword'> if</span> FLAG3 <span class='Baan-baanKeyword def-Keyword'>then</span> 
 872:         <span class='Baan-baanSQL def-Directive'>select</span> tfzzz058.pnplstav:<span class='Baan-baanSQLParam def-Identifier'>DSV3</span> <span class='Baan-baanSQL def-Directive'>from</span>    tfzzz058
 873:         <span class='Baan-baanSQL def-Directive'>where</span>     tfzzz058._index1<span class='Baan-baanSymbol def-Symbol'>=</span> <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_staff</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_prid1</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 874:         <span class='Baan-baanSQL def-Directive'>as</span> <span class='Baan-baanSQL def-Directive'>set</span> <span class='Baan-baanSQL def-Directive'>with</span> 1 <span class='Baan-baanSQL def-Directive'>rows</span>
 875:         <span class='Baan-baanSQL def-Directive'>selectdo</span>
 876:         <span class='Baan-baanSQL def-Directive'>endselect</span>
 877:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 878: 
 879:     OAS_REC<span class='Baan-baanSymbol def-Symbol'>(</span>
 880:         O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"СТАЖ"</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 1</span>
 881:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span>curr2<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>  <span class='def-Comment def-Syntax'>| 2</span>
 882:         O<span class='Baan-baanNumber def-Number'>.</span>D<span class='Baan-baanSymbol def-Symbol'>(</span>NCPR<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>   <span class='def-Comment def-Syntax'>| 3</span>
 883:         O<span class='Baan-baanNumber def-Number'>.</span>D<span class='Baan-baanSymbol def-Symbol'>(</span>KNPR<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>   <span class='def-Comment def-Syntax'>| 4          </span>
 884:         O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span>TOOS<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>3</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 5</span>
 885:         O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span>OUUS<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>6</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 6</span>
 886:         O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span>OITS<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>7</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 7</span>
 887:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span>DCC1<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>   <span class='def-Comment def-Syntax'>| 8</span>
 888:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span>DCC2<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>   <span class='def-Comment def-Syntax'>| 9</span>
 889:         O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span>DCC3<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>9</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 10</span>
 890:         O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span>OIVL<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>8</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='def-Comment def-Syntax'>| 11</span>
 891:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span>DSV1<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>   <span class='def-Comment def-Syntax'>| 12</span>
 892:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span>DSV2<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span>   <span class='def-Comment def-Syntax'>| 13</span>
 893:         O<span class='Baan-baanNumber def-Number'>.</span>S<span class='Baan-baanSymbol def-Symbol'>(</span>KPSP<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanNumber def-Number'>20</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>,</span><span class='def-Comment def-Syntax'>| 14</span>
 894:         O<span class='Baan-baanNumber def-Number'>.</span>N<span class='Baan-baanSymbol def-Symbol'>(</span>DSV3<span class='Baan-baanSymbol def-Symbol'>)</span>    <span class='def-Comment def-Syntax'>| 15</span>
 895:     <span class='Baan-baanSymbol def-Symbol'>)</span>
 896:     inc<span class='Baan-baanSymbol def-Symbol'>(</span>curr2<span class='Baan-baanSymbol def-Symbol'>)</span>
 897:     <span class='Baan-baanUserProcedure def-Identifier'>prof.endPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"handlePeriod"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 898: <span class='Baan-baanSymbol def-Symbol'>}</span>
 899: 
 900: 
 901: <span class='def-Comment def-Syntax'>|</span>
 902: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 903: <span class='def-Comment def-Syntax'>| by Max Belugin 12.12.2002 17:38:10</span>
 904: <span class='Baan-baanKeyword def-Keyword'>function</span> PFSeniority<span class='Baan-baanSymbol def-Symbol'>(</span>TDate first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate last<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>ref</span> <span class='Baan-baanKeyword def-Keyword'>long</span> y<span class='Baan-baanSymbol def-Symbol'>,</span><span class='Baan-baanKeyword def-Keyword'>ref</span> <span class='Baan-baanKeyword def-Keyword'>long</span> m<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>ref</span> <span class='Baan-baanKeyword def-Keyword'>long</span> d<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 905:     <span class='def-Comment def-Syntax'>|?    Гн Мн Дн - дата начала периода,</span>
 906:     <span class='Baan-baanKeyword def-Keyword'>long</span> first<span class='Baan-baanNumber def-Number'>.</span>y<span class='Baan-baanSymbol def-Symbol'>,</span> first<span class='Baan-baanNumber def-Number'>.</span>m<span class='Baan-baanSymbol def-Symbol'>,</span> first<span class='Baan-baanNumber def-Number'>.</span>d
 907:     <span class='Baan-baanProcedure def-Symbol'>num.to.date</span><span class='Baan-baanSymbol def-Symbol'>(</span>first<span class='Baan-baanSymbol def-Symbol'>,</span> first<span class='Baan-baanNumber def-Number'>.</span>y<span class='Baan-baanSymbol def-Symbol'>,</span> first<span class='Baan-baanNumber def-Number'>.</span>m<span class='Baan-baanSymbol def-Symbol'>,</span> first<span class='Baan-baanNumber def-Number'>.</span>d<span class='Baan-baanSymbol def-Symbol'>)</span>
 908:     <span class='def-Comment def-Syntax'>|?    Гк Мк Дк - дата конца периода,</span>
 909:     <span class='Baan-baanKeyword def-Keyword'>long</span> last<span class='Baan-baanNumber def-Number'>.</span>y<span class='Baan-baanSymbol def-Symbol'>,</span> last<span class='Baan-baanNumber def-Number'>.</span>m<span class='Baan-baanSymbol def-Symbol'>,</span> last<span class='Baan-baanNumber def-Number'>.</span>d
 910:     <span class='Baan-baanProcedure def-Symbol'>num.to.date</span><span class='Baan-baanSymbol def-Symbol'>(</span>last<span class='Baan-baanSymbol def-Symbol'>,</span> last<span class='Baan-baanNumber def-Number'>.</span>y<span class='Baan-baanSymbol def-Symbol'>,</span> last<span class='Baan-baanNumber def-Number'>.</span>m<span class='Baan-baanSymbol def-Symbol'>,</span> last<span class='Baan-baanNumber def-Number'>.</span>d<span class='Baan-baanSymbol def-Symbol'>)</span>
 911: <span class='def-Comment def-Syntax'>|    |?    Г М Д - календарно отработанное время.</span>
 912: <span class='def-Comment def-Syntax'>|    long y, m, d</span>
 913:     <span class='def-Comment def-Syntax'>|?    Д=Дк-Дн</span>
 914:     d<span class='Baan-baanSymbol def-Symbol'>=</span>last<span class='Baan-baanNumber def-Number'>.</span>d<span class='Baan-baanSymbol def-Symbol'>-</span>first<span class='Baan-baanNumber def-Number'>.</span>d
 915:     <span class='def-Comment def-Syntax'>| если Д&lt;0 </span>
 916:    <span class='Baan-baanKeyword def-Keyword'> if</span> d<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanNumber def-Number'>0</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 917:         <span class='def-Comment def-Syntax'>| то Д=Д+30 </span>
 918:         inc<span class='Baan-baanSymbol def-Symbol'>(</span>d<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanNumber def-Number'>30</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 919:         <span class='def-Comment def-Syntax'>| Мк=Мк-1</span>
 920:         dec<span class='Baan-baanSymbol def-Symbol'>(</span>last<span class='Baan-baanNumber def-Number'>.</span>m<span class='Baan-baanSymbol def-Symbol'>)</span>
 921:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 922:     <span class='def-Comment def-Syntax'>|?    М= Мк-Мн</span>
 923:     m<span class='Baan-baanSymbol def-Symbol'>=</span>last<span class='Baan-baanNumber def-Number'>.</span>m<span class='Baan-baanSymbol def-Symbol'>-</span>first<span class='Baan-baanNumber def-Number'>.</span>m
 924:     <span class='def-Comment def-Syntax'>|если М&lt;0</span>
 925:    <span class='Baan-baanKeyword def-Keyword'> if</span> m<span class='Baan-baanSymbol def-Symbol'>&lt;</span><span class='Baan-baanNumber def-Number'>0</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 926:         <span class='def-Comment def-Syntax'>|то М=М+12</span>
 927:         inc<span class='Baan-baanSymbol def-Symbol'>(</span>m<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanNumber def-Number'>12</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 928:         <span class='def-Comment def-Syntax'>|Гк=Гк-1</span>
 929:         dec<span class='Baan-baanSymbol def-Symbol'>(</span>last<span class='Baan-baanNumber def-Number'>.</span>y<span class='Baan-baanSymbol def-Symbol'>)</span>
 930:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
 931:     <span class='def-Comment def-Syntax'>|?    Г=Гк-Гн</span>
 932:     y<span class='Baan-baanSymbol def-Symbol'>=</span>last<span class='Baan-baanNumber def-Number'>.</span>y<span class='Baan-baanSymbol def-Symbol'>-</span>first<span class='Baan-baanNumber def-Number'>.</span>y
 933:     <span class='def-Comment def-Syntax'>|?    Д=Д+1</span>
 934:     inc<span class='Baan-baanSymbol def-Symbol'>(</span>d<span class='Baan-baanSymbol def-Symbol'>)</span>
 935:     <span class='def-Comment def-Syntax'>|    если Д>=30</span>
 936:    <span class='Baan-baanKeyword def-Keyword'> if</span> d<span class='Baan-baanSymbol def-Symbol'>></span><span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>30</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
 937:         <span class='def-Comment def-Syntax'>|    то Д=0</span>
 938:         d<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 939:         <span class='def-Comment def-Syntax'>|    М=М+1</span>
 940:         inc<span class='Baan-baanSymbol def-Symbol'>(</span>m<span class='Baan-baanSymbol def-Symbol'>)</span>
 941:    <span class='Baan-baanKeyword def-Keyword'> endif </span>   
 942: <span class='Baan-baanSymbol def-Symbol'>}</span>
 943: 
 944: 
 945: <span class='def-Comment def-Syntax'>|?    &lt;КЛВЧ> - сумма по полям &lt;Время> tfzzz156, для записей по </span>
 946: <span class='def-Comment def-Syntax'>|текущему коду работника, рабочего места, виду стажа, в записи </span>
 947: <span class='def-Comment def-Syntax'>|о котором в поле tfzzz095.pfst стоит значение &lt;ДА>, и датам с </span>
 948: <span class='def-Comment def-Syntax'>|&lt;НЧПР> по &lt;КНПР>.</span>
 949: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 950: <span class='def-Comment def-Syntax'>| by Max Belugin 12.12.2002 17:57:02</span>
 951: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>double</span> KLWCh<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> wp<span class='Baan-baanSymbol def-Symbol'>,</span> TDate first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate last<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 952:     <span class='Baan-baanUserProcedure def-Identifier'>prof.begPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"KLWCh"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 953:     <span class='Baan-baanKeyword def-Keyword'>double</span> result result<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 954:     <span class='Baan-baanSQL def-Directive'>select</span> SUM<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz156.smagtime<span class='Baan-baanSymbol def-Symbol'>)</span>:<span class='Baan-baanSQLParam def-Identifier'>result</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz095<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz156 <span class='Baan-baanSQL def-Directive'>where</span>
 955:         tfzzz095.pfst<span class='Baan-baanSymbol def-Symbol'>=</span>CB_TRUE
 956:         <span class='Baan-baanSQL def-Directive'>and</span>
 957:         tfzzz156._index1 <span class='Baan-baanSQL def-Directive'>inrange</span> 
 958:             <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>wp</span><span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz095.rctpid<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 959:             <span class='Baan-baanSQL def-Directive'>and</span>
 960:             <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>wp</span><span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz095.rctpid<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 961:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 962:     <span class='Baan-baanSQL def-Directive'>endselect</span>         
 963:     <span class='Baan-baanUserProcedure def-Identifier'>prof.endPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"KLWCh"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
 964:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>result<span class='Baan-baanSymbol def-Symbol'>)</span>    
 965: <span class='Baan-baanSymbol def-Symbol'>}</span>
 966: 
 967: 
 968: 
 969: <span class='def-Comment def-Syntax'>|?    &lt;КЛВЧ1> - сумма по полям &lt;Время> tfzzz156, для записей по </span>
 970: <span class='def-Comment def-Syntax'>|текущему коду работника, рабочего места, виду стажа, в записи </span>
 971: <span class='def-Comment def-Syntax'>|о котором в поле tfzzz095.rctpinvs стоит значение &lt;ДА>, и датам с </span>
 972: <span class='def-Comment def-Syntax'>|&lt;НЧПР> по &lt;КНПР>.</span>
 973: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
 974: <span class='def-Comment def-Syntax'>| by Max Belugin 12.12.2002 17:57:02</span>
 975: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>double</span> KLWCh1<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> wp<span class='Baan-baanSymbol def-Symbol'>,</span> TDate first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate last<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 976:     <span class='Baan-baanKeyword def-Keyword'>double</span> result result<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanNumber def-Number'>0</span>
 977:     <span class='Baan-baanSQL def-Directive'>select</span> SUM<span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz156.smagtime<span class='Baan-baanSymbol def-Symbol'>)</span>:<span class='Baan-baanSQLParam def-Identifier'>result</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz095<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz156 <span class='Baan-baanSQL def-Directive'>where</span>
 978:         tfzzz095.rctpinvs<span class='Baan-baanSymbol def-Symbol'>=</span>CB_TRUE
 979:         <span class='Baan-baanSQL def-Directive'>and</span>
 980:         tfzzz156._index1 <span class='Baan-baanSQL def-Directive'>inrange</span> 
 981:             <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>wp</span><span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz095.rctpid<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 982:             <span class='Baan-baanSQL def-Directive'>and</span>
 983:             <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>empl</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>wp</span><span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz095.rctpid<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 984:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
 985:     <span class='Baan-baanSQL def-Directive'>endselect</span>         
 986:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>result<span class='Baan-baanSymbol def-Symbol'>)</span>
 987: <span class='Baan-baanSymbol def-Symbol'>}</span>
 988: 
 989: 
 990: <span class='def-Comment def-Syntax'>|?  &lt;ОИВЛ> - значение поля tfzzz095.rctpvsbs для записи о виде стажа, </span>
 991: <span class='def-Comment def-Syntax'>|по которому у работника по текущему рабочему месту существуют данные </span>
 992: <span class='def-Comment def-Syntax'>| в таблице tfzzz156 на период с &lt;НЧПР> по &lt;КНПР>, и в записи о котором </span>
 993: <span class='def-Comment def-Syntax'>| в поле "Входит в выслугу" стоит значение "ДА".</span>
 994: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>String</span> getOIVL<span class='Baan-baanSymbol def-Symbol'>(</span>tdate first<span class='Baan-baanSymbol def-Symbol'>,</span> tdate last<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
 995: 
 996:     <span class='Baan-baanSQL def-Directive'>select</span> tfzzz095.<span class='Baan-baanSymbol def-Symbol'>*</span> <span class='Baan-baanSQL def-Directive'>from</span> tfzzz095<span class='Baan-baanSymbol def-Symbol'>,</span> tfzzz156 <span class='Baan-baanSQL def-Directive'>where</span> 
 997:       tfzzz156._index1 <span class='Baan-baanSQL def-Directive'>inrange</span> <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_staff</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_id</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MIN_LONG<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>first</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 998:                           <span class='Baan-baanSQL def-Directive'>and</span>  <span class='Baan-baanSymbol def-Symbol'>{</span>:<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_staff</span><span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>tfzzz026.wp_id</span><span class='Baan-baanSymbol def-Symbol'>,</span> DR_MAX_LONG<span class='Baan-baanSymbol def-Symbol'>,</span> :<span class='Baan-baanSQLParam def-Identifier'>last</span><span class='Baan-baanSymbol def-Symbol'>}</span>
 999:         <span class='Baan-baanSQL def-Directive'>and</span> tfzzz156.smagstzh <span class='Baan-baanSQL def-Directive'>refers</span> <span class='Baan-baanSQL def-Directive'>to</span> tfzzz095    <span class='Baan-baanComment def-Comment def-Syntax'>| Виды стажей</span>
1000:         <span class='Baan-baanSQL def-Directive'>and</span> tfzzz095.rctpinvs <span class='Baan-baanSymbol def-Symbol'>=</span> CB_TRUE
1001:     <span class='Baan-baanSQL def-Directive'>as</span> <span class='Baan-baanSQL def-Directive'>set</span> <span class='Baan-baanSQL def-Directive'>with</span> 1 <span class='Baan-baanSQL def-Directive'>rows</span>
1002:     <span class='Baan-baanSQL def-Directive'>selectdo</span>
1003:         <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>tfzzz095<span class='Baan-baanNumber def-Number'>.</span>rctpvsbs<span class='Baan-baanSymbol def-Symbol'>)</span>
1004:     <span class='Baan-baanSQL def-Directive'>endselect</span>
1005:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>""</span><span class='Baan-baanSymbol def-Symbol'>)</span>
1006: <span class='Baan-baanSymbol def-Symbol'>}</span>
1007: 
1008: <span class='def-Comment def-Syntax'>|</span>
1009: <span class='def-Comment def-Syntax'>|</span><span class='def-CommentContent def-Comment def-Syntax'>@created</span><span class='def-Comment def-Syntax'> </span>
1010: <span class='def-Comment def-Syntax'>| by Max Belugin 13.12.2002 13:05:27</span>
1011: <span class='Baan-baanKeyword def-Keyword'>function</span> <span class='Baan-baanKeyword def-Keyword'>double</span> getKDST<span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanKeyword def-Keyword'>long</span> empl<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>long</span> wp<span class='Baan-baanSymbol def-Symbol'>,</span> TDate first<span class='Baan-baanSymbol def-Symbol'>,</span> TDate last<span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>{</span>
1012:     <span class='Baan-baanUserProcedure def-Identifier'>prof.begPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"getKDST"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
1013:     <span class='def-Comment def-Syntax'>|    &lt;ФРВ> - фонд рабочего времени в днях по табелю за период с </span>
1014:     <span class='def-Comment def-Syntax'>|&lt;НЧПР> по &lt;КНПР>.</span>
1015:     <span class='Baan-baanKeyword def-Keyword'>long</span> FRV 
1016:     FRV<span class='Baan-baanSymbol def-Symbol'>=</span><span class='Baan-baanUserProcedure def-Identifier'>tb.workingDaysByDates</span><span class='Baan-baanSymbol def-Symbol'>(</span>wp<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanString def-String'>""</span><span class='Baan-baanSymbol def-Symbol'>,</span> first<span class='Baan-baanSymbol def-Symbol'>,</span> last<span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>false</span><span class='Baan-baanSymbol def-Symbol'>,</span> <span class='Baan-baanKeyword def-Keyword'>true</span><span class='Baan-baanSymbol def-Symbol'>)</span>
1017:     <span class='def-Comment def-Syntax'>|    &lt;КВЧ> - сумма по полям &lt;Время> tfzzz156, для записей по текущему </span>
1018:     <span class='def-Comment def-Syntax'>|коду работника, рабочего места, виду стажа, в записи о котором в поле </span>
1019:     <span class='def-Comment def-Syntax'>|tfzzz095.pfst стоит значение &lt;ДА>, и датам с &lt;НЧПР> по &lt;КНПР>.</span>
1020:     <span class='Baan-baanKeyword def-Keyword'>double</span> KVCh 
1021:     KVCh<span class='Baan-baanSymbol def-Symbol'>=</span>KLWCh<span class='Baan-baanSymbol def-Symbol'>(</span>empl<span class='Baan-baanSymbol def-Symbol'>,</span> wp<span class='Baan-baanSymbol def-Symbol'>,</span> first<span class='Baan-baanSymbol def-Symbol'>,</span> last<span class='Baan-baanSymbol def-Symbol'>)</span>    
1022:    <span class='Baan-baanKeyword def-Keyword'> if</span> is0<span class='Baan-baanSymbol def-Symbol'>(</span>KVCh<span class='Baan-baanSymbol def-Symbol'>)</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
1023:         <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanNumber def-Number'>0</span><span class='Baan-baanSymbol def-Symbol'>)</span>
1024:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
1025:     <span class='def-Comment def-Syntax'>|    &lt;КДПР> - количество календарных дней периода с &lt;НЧПР> по &lt;КНПР>.</span>
1026:     <span class='Baan-baanKeyword def-Keyword'>long</span> KDPR    
1027:     KDPR<span class='Baan-baanSymbol def-Symbol'>=</span>last<span class='Baan-baanSymbol def-Symbol'>-</span>first<span class='Baan-baanSymbol def-Symbol'>+</span><span class='Baan-baanNumber def-Number'>1</span>
1028:     <span class='def-Comment def-Syntax'>| ?    &lt;КДСТ> - равно КДПР - (ФРВ - КВЧ/24), если (ФРВ - КВЧ/24) > 0, в </span>
1029:     <span class='def-Comment def-Syntax'>|противном случае КДСТ равно КДПР, где</span>
1030:    <span class='Baan-baanKeyword def-Keyword'> if</span> <span class='Baan-baanSymbol def-Symbol'>(</span>FRV<span class='Baan-baanSymbol def-Symbol'>-</span>KVCh<span class='Baan-baanSymbol def-Symbol'>/</span><span class='Baan-baanNumber def-Number'>24</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>></span><span class='Baan-baanNumber def-Number'>0</span> <span class='Baan-baanKeyword def-Keyword'>then</span>
1031:         <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>KDPR <span class='Baan-baanSymbol def-Symbol'>-</span> <span class='Baan-baanSymbol def-Symbol'>(</span>FRV <span class='Baan-baanSymbol def-Symbol'>-</span> KVCh<span class='Baan-baanSymbol def-Symbol'>/</span><span class='Baan-baanNumber def-Number'>24</span><span class='Baan-baanSymbol def-Symbol'>)</span><span class='Baan-baanSymbol def-Symbol'>)</span>
1032:    <span class='Baan-baanKeyword def-Keyword'> endif</span>
1033:     <span class='Baan-baanUserProcedure def-Identifier'>prof.endPiece</span><span class='Baan-baanSymbol def-Symbol'>(</span><span class='Baan-baanString def-String'>"getKDST"</span><span class='Baan-baanSymbol def-Symbol'>)</span>
1034:     <span class='Baan-baanKeyword def-Keyword'>return</span><span class='Baan-baanSymbol def-Symbol'>(</span>KDPR<span class='Baan-baanSymbol def-Symbol'>)</span>
1035: <span class='Baan-baanSymbol def-Symbol'>}</span>
1036: 
1037: 
1038: 
