  0: <span class='forth-forComment def-Comment def-Syntax'>\ Resolve path device procedure LNM 04-11-1999 based on IEEE 1275-1994</span>
  1: <span class='forth-forWord def-Keyword'>." </span><span class='forth-forString def-String'>Resolve path device procedure</span><span class='forth-forWord def-Keyword'>"</span>
  2: include? task-aw.fth        aw.fth
  3: include? task-showdevs.fth  showdevs.fth
  4: <span class='forth-forWord def-Keyword'>forth</span> <span class='forth-forWord def-Keyword'>definitions</span> anew task-rp.fth <span class='forth-forWord def-Keyword'>decimal</span>
  5: 
  6: <span class='forth-forNumb def-Number'>255</span> <span class='forth-forWord def-Keyword'>value</span> <span class='forth-forWordDefinition def-Keyword'>sizestr</span>
  7: <span class='forth-forNumb def-Number'>0</span> string emptystr   <span class='forth-forComment def-Comment def-Syntax'> \ Empty string for varios needs</span>
  8: sizestr string shead<span class='forth-forComment def-Comment def-Syntax'> \ String for head of sourse string</span>
  9: sizestr string stail<span class='forth-forComment def-Comment def-Syntax'> \ String for tail of sourse string</span>
 10: sizestr string path_name<span class='forth-forComment def-Comment def-Syntax'> \ Target full alias name</span>
 11: sizestr string arguments<span class='forth-forComment def-Comment def-Syntax'> \ Arguments string</span>
 12: <span class='forth-forNumb def-Number'>31</span>      string unit_addr
 13: <span class='forth-forNumb def-Number'>31</span>      string node_name<span class='forth-forComment def-Comment def-Syntax'> \ The current node name</span>
 14: 
 15: <span class='forth-forWord def-Keyword'>variable</span> <span class='forth-forWordDefinition def-Keyword'>targetnode</span><span class='forth-forComment def-Comment def-Syntax'> \ Pnode of finded name</span>
 16: <span class='forth-forWord def-Keyword'>variable</span> <span class='forth-forWordDefinition def-Keyword'>active-package</span>  <span class='forth-forNumb def-Number'>0</span> active-package <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ Current active package</span>
 17: <span class='forth-forWord def-Keyword'>variable</span> <span class='forth-forWordDefinition def-Keyword'>parentnode</span>
 18: 2variable ptail     <span class='forth-forComment def-Comment def-Syntax'> \ Pointer to tail string</span>
 19: 2variable phead     <span class='forth-forComment def-Comment def-Syntax'> \ Pointer to head string</span>
 20: 2variable paliasargs<span class='forth-forComment def-Comment def-Syntax'> \ Pointer to string alias arguments</span>
 21: <span class='forth-forWord def-Keyword'>variable</span> <span class='forth-forWordDefinition def-Keyword'>unit_phys</span> <span class='forth-forNumb def-Number'>0</span> unit_phys <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ Physical adress of unit</span>
 22: 
 23: <span class='forth-forComment def-Comment def-Syntax'>\ Parent</span>
 24: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>parent</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span> >code parenthandle <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> ( ParentHandle )</span><span class='forth-forWord def-Keyword'> ;</span><span class='forth-forComment def-Comment def-Syntax'> \ ++ 16-02-2000</span>
 25: <span class='forth-forComment def-Comment def-Syntax'>\ If Phandle exist in device tree return Phandle else return true</span>
 26: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>provphandle</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle -- Phandle | T )</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forNumb def-Number'>25</span> <span class='forth-forNumb def-Number'>0</span>
 27:     <span class='forth-forResWord def-Label'>do</span> <span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span>
 28:         parent <span class='forth-forWord def-Keyword'>dup</span><span class='forth-forComment def-Comment def-Syntax'> ( Parent )</span>
 29:        <span class='forth-forComment def-Comment def-Syntax'> \ not</span>
 30:         roothandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>=</span> <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>leave</span> <span class='forth-forResWord def-Label'>then</span>
 31:     <span class='forth-forResWord def-Label'>loop</span><span class='forth-forComment def-Comment def-Syntax'> ( PhandleBeg PhandleEnd )</span>
 32:     roothandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>=</span> <span class='forth-forWord def-Keyword'>not</span>
 33:     <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forWord def-Keyword'>true</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle | T )</span><span class='forth-forWord def-Keyword'> ;</span><span class='forth-forComment def-Comment def-Syntax'> \ ++ 16-05-2000</span>
 34: <span class='forth-forComment def-Comment def-Syntax'>\ Child</span>
 35: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>child</span><span class='forth-forComment def-Comment def-Syntax'> ( PhandleParent -- PhandleChild )</span> provphandle <span class='forth-forWord def-Keyword'>dup</span>
 36:     <span class='forth-forResWord def-Label'>if</span> >code childhandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( PhandleChild )</span><span class='forth-forWord def-Keyword'> ;</span>
 37: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>findalias</span><span class='forth-forComment def-Comment def-Syntax'> ( Adr Len -- AdrAlias LenAlias 0 | 1 )</span>
 38:     aliashandle <span class='forth-forWord def-Keyword'>@</span> getPhandleProperty<span class='forth-forComment def-Comment def-Syntax'> ( Adr Len 0 | 1 )</span><span class='forth-forWord def-Keyword'> ;</span>
 39: 
 40: <span class='forth-forComment def-Comment def-Syntax'>\ Concatenate 2 string and 1 symbol to shead string</span>
 41: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>conc2str&amp;symb</span><span class='forth-forComment def-Comment def-Syntax'> ( AStr1 LStr1 AStr2 LStr2 Symb -- A L )</span> <span class='forth-forWord def-Keyword'>{</span> symb <span class='forth-forWord def-Keyword'>--</span><span class='forth-forWord def-Keyword'> }</span>
 42:     <span class='forth-forWord def-Keyword'>2swap</span><span class='forth-forComment def-Comment def-Syntax'> ( AStr2 LStr2 AStr1 LStr1 )</span>
 43:     shead st!<span class='forth-forComment def-Comment def-Syntax'> \ Story count in shead</span>
 44:     shead <span class='forth-forWord def-Keyword'>2dup</span> <span class='forth-forWord def-Keyword'>+</span> symb <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>c!</span><span class='forth-forComment def-Comment def-Syntax'> ( AStr2 LStr2 Ash Lsh )</span>
 45:     <span class='forth-forNumb def-Number'>1</span> <span class='forth-forWord def-Keyword'>+</span> <span class='forth-forNumb def-Number'>2</span> <span class='forth-forWord def-Keyword'>pick</span> <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forWord def-Keyword'>+</span><span class='forth-forComment def-Comment def-Syntax'> ( AStr2 LStr2 Ash Lsh Lnew )</span>
 46:     <span class='forth-forNumb def-Number'>2</span> <span class='forth-forWord def-Keyword'>pick</span> <span class='forth-forNumb def-Number'>1</span> <span class='forth-forWord def-Keyword'>-</span> <span class='forth-forWord def-Keyword'>c!</span><span class='forth-forComment def-Comment def-Syntax'> ( AStr2 LStr2 Ash Lsh )</span><span class='forth-forComment def-Comment def-Syntax'> \ Story new len in shead</span>
 47:     <span class='forth-forWord def-Keyword'>+</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>move</span><span class='forth-forComment def-Comment def-Syntax'> ( ( Story content of alias_shead )</span> shead<span class='forth-forComment def-Comment def-Syntax'> ( A L )</span><span class='forth-forWord def-Keyword'> ;</span>
 48: 
 49: <span class='forth-forComment def-Comment def-Syntax'>\ 4.3.1.A.3 Change alias by real name</span>
 50: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>workwithalias</span><span class='forth-forComment def-Comment def-Syntax'> ( AdrAlias LenAlias )</span>
 51:     paliasargs 2@ <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span><span class='forth-forComment def-Comment def-Syntax'> \ Not empty args of alias</span>
 52:    <span class='forth-forComment def-Comment def-Syntax'> ( AdrAlias LenAlias AdrAlArg LenAlArg LenAlArg )</span>
 53:     <span class='forth-forResWord def-Label'>if</span> <span class='forth-forComment def-Comment def-Syntax'> \ 3-ii Alias args is not empty</span>
 54:        <span class='forth-forComment def-Comment def-Syntax'> \ 3-ii-a</span>
 55:         ascii / right-split<span class='forth-forComment def-Comment def-Syntax'> ( AdrAlHead LenAlhead AdrAlTail LenAltail )</span>
 56:        <span class='forth-forComment def-Comment def-Syntax'> \ 3-ii-b</span>
 57:         ascii <span class='forth-forWord def-Keyword'>:</span> right-split<span class='forth-forComment def-Comment def-Syntax'> ( AdrAlHead LenAlhead AdrAlTail LenAltail ADeadArg LDeadArg )</span>
 58:         <span class='forth-forWord def-Keyword'>2drop</span><span class='forth-forComment def-Comment def-Syntax'> ( AdrAlHead LenAlhead AdrAlTail LenAltail  )</span>
 59:         <span class='forth-forNumb def-Number'>2</span> <span class='forth-forWord def-Keyword'>pick</span><span class='forth-forComment def-Comment def-Syntax'> \ AliasHead length</span>
 60:         <span class='forth-forResWord def-Label'>if</span> <span class='forth-forComment def-Comment def-Syntax'> \ 3-ii-c concatenate (alias_head,"/",Alias_tail)</span>
 61:             ascii / conc2str&amp;symb<span class='forth-forComment def-Comment def-Syntax'> ( A L )</span>
 62:         <span class='forth-forResWord def-Label'>else</span> 
 63:             <span class='forth-forWord def-Keyword'>2swap</span> <span class='forth-forWord def-Keyword'>2drop</span><span class='forth-forComment def-Comment def-Syntax'> ( AdrAlTail LenAltail )</span>
 64:         <span class='forth-forResWord def-Label'>then</span>
 65:        <span class='forth-forComment def-Comment def-Syntax'> ( A L )</span> paliasargs 2@ ascii <span class='forth-forWord def-Keyword'>:</span> conc2str&amp;symb
 66:        <span class='forth-forComment def-Comment def-Syntax'> \ 3-ii-d concatinate aliastail : aliasargs</span>
 67:     <span class='forth-forResWord def-Label'>then</span> <span class='forth-forComment def-Comment def-Syntax'> ( AdrAlias' LenAlias' )</span><span class='forth-forWord def-Keyword'> ;</span>
 68: 
 69: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>setroot</span><span class='forth-forComment def-Comment def-Syntax'> \ cr ." I must set root active package </span><span class='def-TODO def-Error'>!!!!</span><span class='forth-forComment def-Comment def-Syntax'>"</span>
 70:     roothandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>dup</span> nodehandle <span class='forth-forWord def-Keyword'>!</span> active-package <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
 71: 
 72: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>copynode</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> nodehandle <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> creanode <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> sizenode <span class='forth-forWord def-Keyword'>move</span><span class='forth-forWord def-Keyword'> ;</span>
 73: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>copydata</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> nodehandle <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> <span class='forth-forWord def-Keyword'>dup</span> adrinstdata <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> <span class='forth-forWord def-Keyword'>swap</span> leninstdata <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> ( Adr Dl )</span>
 74:     <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>here</span> <span class='forth-forWord def-Keyword'>-rot</span> altovoc code> <span class='forth-forResWord def-Label'>else</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>false</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( adr )</span>
 75:     creanode <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> adrinstdata <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> ( ( Copy and store adrinsdata )</span><span class='forth-forWord def-Keyword'> ;</span>
 76: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>copyproperty</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
 77:     <span class='forth-forNumb def-Number'>0</span> creanode <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> prophandle <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ No property in created instance before copying's</span>
 78:     nodehandle <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span>
 79:     creanode <span class='forth-forWord def-Keyword'>@</span> nodehandle <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span>
 80:     <span class='forth-forWord def-Keyword'>dup</span> >code prophandle<span class='forth-forComment def-Comment def-Syntax'> ( Phandle AdrPtrChainProp )</span>
 81:     <span class='forth-forResWord def-Label'>begin</span>
 82:         <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> (  )</span>
 83:     <span class='forth-forResWord def-Label'>while</span>
 84:        <span class='forth-forComment def-Comment def-Syntax'> \ >code</span>
 85:         code> ptrprop>valprop<span class='forth-forComment def-Comment def-Syntax'> ( Av Lv An Ln )</span>
 86: <span class='forth-forComment def-Comment def-Syntax'>\        @nt dup cell+ dup cell+ swap @nt count rot count</span>
 87:        <span class='forth-forComment def-Comment def-Syntax'> \ cr 2dup type space 3 pick 3 pick type</span>
 88:         <span class='forth-forExtWords def-VarStrong def-Var'>property</span><span class='forth-forComment def-Comment def-Syntax'> (  .s key drop )</span>
 89:     <span class='forth-forResWord def-Label'>repeat</span> <span class='forth-forWord def-Keyword'>drop</span>
 90:    <span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span> nodehandle <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
 91: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>resolvelinks</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
 92:     nodehandle <span class='forth-forWord def-Keyword'>@</span> creanode <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ Story phandle of prototype</span>
 93:     <span class='forth-forNumb def-Number'>0</span> creanode <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> childhandle <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ No child on new created instance</span>
 94:     <span class='forth-forNumb def-Number'>0</span> creanode <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> siblinghandle <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ No sibling on new created instance</span>
 95:     <span class='forth-forNumb def-Number'>0</span> creanode <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> ihandle <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ No instance on new created instance</span>
 96:    <span class='forth-forComment def-Comment def-Syntax'> \ creanode @ dup p.node</span>
 97:    <span class='forth-forComment def-Comment def-Syntax'> ( >code @ p.node insinchainsibling (  )</span><span class='forth-forWord def-Keyword'> ;</span>
 98: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>copyfromprototype</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
 99: <span class='forth-forComment def-Comment def-Syntax'>\   ."  Go "</span>
100:     copynode
101: <span class='forth-forComment def-Comment def-Syntax'>\   ."  node "</span>
102:     copydata
103: <span class='forth-forComment def-Comment def-Syntax'>\   ."  Data "</span>
104:     copyproperty
105: <span class='forth-forComment def-Comment def-Syntax'>\   ."  Property "</span>
106:     resolvelinks
107: <span class='forth-forComment def-Comment def-Syntax'>\   ."  Links "</span>
108: <span class='forth-forComment def-Comment def-Syntax'>\    creanode @ p.node   key drop</span>
109:    <span class='forth-forComment def-Comment def-Syntax'> (   )</span><span class='forth-forWord def-Keyword'> ;</span>
110: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>first-component</span><span class='forth-forComment def-Comment def-Syntax'> ( Adr Dl )</span> <span class='forth-forNumb def-Number'>0</span> <span class='forth-forNumb def-Number'>0</span> <span class='forth-forWord def-Keyword'>2swap</span> <span class='forth-forWord def-Keyword'>>number</span> <span class='forth-forWord def-Keyword'>drop</span><span class='forth-forComment def-Comment def-Syntax'> ( N )</span><span class='forth-forWord def-Keyword'> ;</span>
111: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>setmy-unit</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
112:     unit_addr <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span><span class='forth-forComment def-Comment def-Syntax'> ( L )</span> <span class='forth-forWord def-Keyword'>0=</span>
113:     <span class='forth-forResWord def-Label'>if</span>  <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>reg</span><span class='forth-forWord def-Keyword'>"</span> get-my-property <span class='forth-forWord def-Keyword'>false</span> <span class='forth-forWord def-Keyword'>=</span>
114:         <span class='forth-forResWord def-Label'>if</span> <span class='forth-forComment def-Comment def-Syntax'> ( Adr Dl )</span>
115:             first-component my-unit <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ 4.3.2.e.1.i</span>
116:         <span class='forth-forResWord def-Label'>else</span>
117:             <span class='forth-forNumb def-Number'>0</span> my-unit <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ 4.3.2.e.1.ii</span>
118:         <span class='forth-forResWord def-Label'>then</span>
119:     <span class='forth-forResWord def-Label'>else</span>
120:         unit_phys <span class='forth-forWord def-Keyword'>@</span> my-unit <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ 4.3.2.e.2</span>
121:     <span class='forth-forResWord def-Label'>then</span><span class='forth-forWord def-Keyword'> ;</span>
122: 
123: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>crinst</span><span class='forth-forComment def-Comment def-Syntax'> \ Create new instance, add it to instance chain, and set various fields</span>
124:     makeinstnode<span class='forth-forComment def-Comment def-Syntax'> \ 4.3.2.a</span>
125: <span class='forth-forComment def-Comment def-Syntax'>\    ."  Crea "</span>
126:     copyfromprototype<span class='forth-forComment def-Comment def-Syntax'> \ cr ." Save new arguments!"</span>
127:    <span class='forth-forComment def-Comment def-Syntax'> ( ."  Inst. of " node_name type )</span> <span class='forth-forNumb def-Number'>40</span> space.to.column
128:     arguments<span class='forth-forComment def-Comment def-Syntax'> ( A L )</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>here</span> placeinvoc<span class='forth-forComment def-Comment def-Syntax'> ( Ahere )</span> code> <span class='forth-forResWord def-Label'>else</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forResWord def-Label'>then</span>
129:     creanode <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> adrarguments <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ 4.3.2.b cr ." 4.3.2.b"</span>
130:     parentnode <span class='forth-forWord def-Keyword'>@</span> creanode <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> parenthandle <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ 4.3.2.c Set my-parent field Story parent ihandle Story parent ihandle</span>
131:     creanode <span class='forth-forWord def-Keyword'>@</span> parentnode <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> childhandle <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ NEW added in BM - Store child field in parentnode</span>
132:    <span class='forth-forComment def-Comment def-Syntax'> \ cr ." 4.3.2.c Set my-parent field"</span>
133:     creanode <span class='forth-forWord def-Keyword'>@</span> parentnode <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ 4.3.2.d cr ." 4.3.2.d"</span>
134:     setmy-unit<span class='forth-forComment def-Comment def-Syntax'> ( ( 4.3.2.d )</span><span class='forth-forWord def-Keyword'> ;</span>
135: 
136: <span class='forth-forComment def-Comment def-Syntax'>\ 4.3.6. Node name match</span>
137: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>afternamecomma</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>  node_name <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>name</span><span class='forth-forWord def-Keyword'>"</span> get-my-property ascii <span class='forth-forWord def-Keyword'>,</span>
138:     left-split  <span class='forth-forWord def-Keyword'>2swap</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>compare</span> <span class='forth-forWord def-Keyword'>not</span><span class='forth-forWord def-Keyword'> ;</span>
139: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>namecompare</span><span class='forth-forComment def-Comment def-Syntax'> ( Al Ll AN LN )</span> <span class='forth-forWord def-Keyword'>compare</span> <span class='forth-forExtWords def-VarStrong def-Var'>br0</span> <span class='forth-forWord def-Keyword'>true</span> afternamecomma<span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
140: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>2dropfalse</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>false</span><span class='forth-forWord def-Keyword'> ;</span>
141: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>nocomma</span><span class='forth-forComment def-Comment def-Syntax'> ( Al Ll Ar Lr )</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>name</span><span class='forth-forWord def-Keyword'>"</span> get-my-property
142:     <span class='forth-forExtWords def-VarStrong def-Var'>br0</span> namecompare 2dropfalse<span class='forth-forWord def-Keyword'> ;</span>
143: 
144: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>iscomma</span><span class='forth-forComment def-Comment def-Syntax'> ( Al Ll Ar Lr )</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>2drop</span> node_name <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>name</span><span class='forth-forWord def-Keyword'>"</span> get-my-property <span class='forth-forWord def-Keyword'>drop</span>
145:     <span class='forth-forWord def-Keyword'>compare</span> <span class='forth-forWord def-Keyword'>not</span><span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
146: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>prov_vender</span> <span class='forth-forComment def-Comment def-Syntax'> ( -- T/F )</span>
147:     node_name<span class='forth-forComment def-Comment def-Syntax'> ( Adr Dl )</span> ascii <span class='forth-forWord def-Keyword'>,</span> left-split <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forExtWords def-VarStrong def-Var'>br0</span> nocomma iscomma<span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
148: 
149: <span class='forth-forComment def-Comment def-Syntax'>\ 4.3.5. Wildcard math</span>
150: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>contnoempty</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> node_name <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forWord def-Keyword'>0=</span> unit_addr <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forWord def-Keyword'>0=</span> <span class='forth-forWord def-Keyword'>and</span> <span class='forth-forWord def-Keyword'>not</span><span class='forth-forWord def-Keyword'> ;</span>
151: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>noempty</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>reg</span><span class='forth-forWord def-Keyword'>"</span> get-my-property <span class='forth-forExtWords def-VarStrong def-Var'>br0</span> 2dropfalse contnoempty<span class='forth-forWord def-Keyword'> ;</span>
152: 
153: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>withemptynode</span><span class='forth-forComment def-Comment def-Syntax'> ( AN LN )</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>name</span><span class='forth-forWord def-Keyword'>"</span> get-my-property <span class='forth-forWord def-Keyword'>-rot</span> <span class='forth-forWord def-Keyword'>2drop</span>
154:     <span class='forth-forExtWords def-VarStrong def-Var'>br0</span> prov_vender <span class='forth-forWord def-Keyword'>false</span><span class='forth-forWord def-Keyword'> ;</span>
155: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>wildeq?</span><span class='forth-forComment def-Comment def-Syntax'> ( -- T/F )</span> node_name <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forExtWords def-VarStrong def-Var'>br0</span> withemptynode noempty<span class='forth-forWord def-Keyword'> ;</span>
156: 
157: <span class='forth-forComment def-Comment def-Syntax'>\ 4.3.4. Exact match</span>
158: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>cmp_phys</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>reg</span><span class='forth-forWord def-Keyword'>"</span> get-my-property
159:     <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>abort" </span><span class='forth-forString def-String'>No adres defined</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forResWord def-Label'>else</span> <span class='forth-forNumb def-Number'>0</span> <span class='forth-forNumb def-Number'>0</span> <span class='forth-forWord def-Keyword'>2swap</span> <span class='forth-forWord def-Keyword'>>number</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forResWord def-Label'>then</span>
160:     unit_phys <span class='forth-forWord def-Keyword'>=</span><span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
161: 
162: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>nuempty?</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>name</span><span class='forth-forWord def-Keyword'>"</span> get-my-property
163:     <span class='forth-forExtWords def-VarStrong def-Var'>br0</span> cmp_phys <span class='forth-forWord def-Keyword'>false</span><span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
164: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>exactemptynode</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> unit_addr <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forExtWords def-VarStrong def-Var'>br0</span> nuempty? cmp_phys<span class='forth-forWord def-Keyword'> ;</span>
165: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>exactmatch</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> node_name <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forExtWords def-VarStrong def-Var'>br0</span> exactemptynode prov_vender<span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
166: 
167: <span class='forth-forComment def-Comment def-Syntax'>\ 4.3.3. Matching child node</span>
168: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>recursivefindmatch</span><span class='forth-forComment def-Comment def-Syntax'> ( False -- T/F )</span> nodehandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>swap</span> norealize
169:     <span class='forth-forWord def-Keyword'>swap</span> nodehandle <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
170: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>findwildmatch</span><span class='forth-forComment def-Comment def-Syntax'> ( False -- T/F )</span> norealize <span class='forth-forExtWords def-VarStrong def-Var'>ex</span><span class='forth-forWord def-Keyword'> ;</span>
171: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>findexactmatch</span><span class='forth-forComment def-Comment def-Syntax'> ( False -- T/F )</span> norealize <span class='forth-forExtWords def-VarStrong def-Var'>ex</span><span class='forth-forWord def-Keyword'> ;</span>
172: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>rpfindwildmatch</span> <span class='forth-forExtWords def-VarStrong def-Var'>rp</span> findwildmatch<span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
173: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>contmatchchild</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> <span class='forth-forNumb def-Number'>0</span> <span class='forth-forExtWords def-VarStrong def-Var'>rp</span> findexactmatch<span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span>
174:     <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forExtWords def-VarStrong def-Var'>if0</span> rpfindwildmatch<span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forExtWords def-VarStrong def-Var'>if0</span> recursivefindmatch<span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
175: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>exmetphys</span><span class='forth-forComment def-Comment def-Syntax'> ( Xt T )</span> <span class='forth-forWord def-Keyword'>drop</span> unit_addr <span class='forth-forWord def-Keyword'>rot</span> <span class='forth-forWord def-Keyword'>execute</span> unit_phys <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> ( Rezult )</span><span class='forth-forWord def-Keyword'> ;</span>
176: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>execdecodeunit</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>decode-unit</span><span class='forth-forWord def-Keyword'>"</span> nodehandle <span class='forth-forWord def-Keyword'>@</span> find-method
177:    <span class='forth-forComment def-Comment def-Syntax'> ( False | Xt True )</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>not</span> <span class='forth-forExtWords def-VarStrong def-Var'>if0</span> exmetphys<span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
178: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>matchchild</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> unit_addr <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span><span class='forth-forComment def-Comment def-Syntax'> ( len )</span>
179:     <span class='forth-forExtWords def-VarStrong def-Var'>br0</span> execdecodeunit contmatchchild<span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
180: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>initocrugenie</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> <span class='forth-forNumb def-Number'>0</span> parentnode <span class='forth-forWord def-Keyword'>!</span> emptystr arguments st!
181:     emptystr unit_addr st!<span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
182: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>?root</span><span class='forth-forComment def-Comment def-Syntax'> ( A L -- T | F )</span> <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forWord def-Keyword'>c@</span> ascii / <span class='forth-forWord def-Keyword'>=</span><span class='forth-forComment def-Comment def-Syntax'> ( T | F )</span><span class='forth-forWord def-Keyword'> ;</span>
183: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>exchangealiasbyvalue</span><span class='forth-forComment def-Comment def-Syntax'> ( AdrAlias LenAlias )</span>
184:     <span class='forth-forWord def-Keyword'>2swap</span> <span class='forth-forWord def-Keyword'>2drop</span> workwithalias<span class='forth-forComment def-Comment def-Syntax'> ( AValAlias LValAlias )</span>
185:     ptail 2@ ascii / <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forResWord def-Label'>if</span> conc2str&amp;symb <span class='forth-forResWord def-Label'>else</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( A' L' )</span><span class='forth-forWord def-Keyword'> ;</span>
186: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>extractalias</span><span class='forth-forComment def-Comment def-Syntax'> ( A L )</span>
187:     ascii / left-split<span class='forth-forComment def-Comment def-Syntax'> ( AdrL LenL AdrR LenR )</span> ptail 2!<span class='forth-forComment def-Comment def-Syntax'> \ 4.3.1.A.1</span>
188:     ascii <span class='forth-forWord def-Keyword'>:</span> left-split<span class='forth-forComment def-Comment def-Syntax'> ( AdrAlN LenAlN AdrAlArg LenAlArg )</span><span class='forth-forComment def-Comment def-Syntax'> \ 4.3.1.A.2</span>
189:     paliasargs 2!<span class='forth-forComment def-Comment def-Syntax'> \ Store string's arguments for alias</span>
190:     <span class='forth-forWord def-Keyword'>2dup</span> findalias<span class='forth-forComment def-Comment def-Syntax'> ( AdrAlias LenAlias 1 | 0 )</span> <span class='forth-forWord def-Keyword'>not</span>
191:     <span class='forth-forResWord def-Label'>if</span> exchangealiasbyvalue <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( A' L' )</span><span class='forth-forWord def-Keyword'> ;</span>
192: 
193: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>findchildnode</span><span class='forth-forComment def-Comment def-Syntax'> ( -- T/F )</span>
194:     nodehandle <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span> childhandle <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span>
195:     <span class='forth-forResWord def-Label'>begin</span>
196:         <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>name</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forNumb def-Number'>2</span> <span class='forth-forWord def-Keyword'>pick</span> getPhandleProperty<span class='forth-forComment def-Comment def-Syntax'> ( A L F | T )</span> <span class='forth-forWord def-Keyword'>not</span>
197:         <span class='forth-forResWord def-Label'>if</span> <span class='forth-forComment def-Comment def-Syntax'> \ cr 2dup type </span>
198:             node_name <span class='forth-forWord def-Keyword'>compare</span> 0&lt;><span class='forth-forComment def-Comment def-Syntax'> ( False if equ )</span>
199:         <span class='forth-forResWord def-Label'>else</span> <span class='forth-forWord def-Keyword'>true</span>
200:         <span class='forth-forResWord def-Label'>then</span>
201:        <span class='forth-forComment def-Comment def-Syntax'> ( Phandle Flag )</span> <span class='forth-forWord def-Keyword'>over</span> >code siblinghandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forWord def-Keyword'>and</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle Flag )</span>
202:     <span class='forth-forResWord def-Label'>while</span>
203:         <span class='forth-forWord def-Keyword'>drop</span> >code siblinghandle <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle' )</span>
204:     <span class='forth-forResWord def-Label'>repeat</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle' F/T )</span> <span class='forth-forWord def-Keyword'>not</span> <span class='forth-forWord def-Keyword'>swap</span> targetnode <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> ( T/F )</span><span class='forth-forWord def-Keyword'> ;</span>
205: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>creacall</span> creanode <span class='forth-forWord def-Keyword'>@</span> $call-method<span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
206: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>execopen</span> <span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>OPEN</span><span class='forth-forWord def-Keyword'>"</span> creacall<span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
207: 
208: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>gototargetnode</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> targetnode <span class='forth-forWord def-Keyword'>@</span> nodehandle <span class='forth-forWord def-Keyword'>!</span> crinst <span class='forth-forWord def-Keyword'>drop</span><span class='forth-forComment def-Comment def-Syntax'> \ In final node Len=0</span>
209:     <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forResWord def-Label'>if</span> execopen <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
210: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>razbornode</span><span class='forth-forComment def-Comment def-Syntax'> ( A L )</span>
211:     ascii / left-split<span class='forth-forComment def-Comment def-Syntax'> ( 2Component 2PathName )</span> <span class='forth-forWord def-Keyword'>2swap</span>
212:     ascii <span class='forth-forWord def-Keyword'>:</span> left-split<span class='forth-forComment def-Comment def-Syntax'> ( 2PathName 2NodeAdr 2Arguments )</span> <span class='forth-forWord def-Keyword'>2swap</span>
213:     ascii <span class='forth-forWord def-Keyword'>@</span> left-split<span class='forth-forComment def-Comment def-Syntax'> ( 2PathName 2Arguments 2NodeName 2Unit_Adr )</span>
214:     unit_addr st!<span class='forth-forComment def-Comment def-Syntax'> ( 2PathName 2Arguments 2NodeName )</span>
215:     node_name st!<span class='forth-forComment def-Comment def-Syntax'> ( 2PathName 2Arguments )</span>
216:     arguments st!<span class='forth-forComment def-Comment def-Syntax'> ( 2PathName )</span><span class='forth-forComment def-Comment def-Syntax'> ( Aost Lost )</span><span class='forth-forWord def-Keyword'> ;</span>
217: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>inode</span> creanode <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> ( Inode )</span><span class='forth-forComment def-Comment def-Syntax'> ( norealize )</span><span class='forth-forWord def-Keyword'> ;</span>
218: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>fullotkat</span><span class='forth-forComment def-Comment def-Syntax'> ( 2PathName )</span> inode<span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span>
219:     <span class='forth-forResWord def-Label'>begin</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span><span class='forth-forComment def-Comment def-Syntax'> \ map .s key drop</span>
220:         <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>CLOSE</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forNumb def-Number'>2</span> <span class='forth-forWord def-Keyword'>pick</span> $call-method
221:        <span class='forth-forComment def-Comment def-Syntax'> \ dup here - allot \ Release memory assigned for this node </span><span class='def-TODO def-Error'>!!!</span>
222:         parent<span class='forth-forComment def-Comment def-Syntax'> ( Parent )</span> <span class='forth-forWord def-Keyword'>dup</span> roothandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>=</span> <span class='forth-forWord def-Keyword'>not</span>
223:     <span class='forth-forResWord def-Label'>until</span><span class='forth-forComment def-Comment def-Syntax'> ( False )</span><span class='forth-forWord def-Keyword'> ;</span>
224: 
225: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>gobynodefrompath</span><span class='forth-forComment def-Comment def-Syntax'> ( A L )</span>
226:     razbornode
227:     findchildnode<span class='forth-forComment def-Comment def-Syntax'> ( 2PathName T/F )</span>
228:     <span class='forth-forResWord def-Label'>if</span>   gototargetnode <span class='forth-forWord def-Keyword'>true</span><span class='forth-forComment def-Comment def-Syntax'> \ 4.3.1.K</span>
229:     <span class='forth-forResWord def-Label'>else</span> fullotkat<span class='forth-forComment def-Comment def-Syntax'> \ 4.3.1.L</span>
230:     <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( A L )</span><span class='forth-forWord def-Keyword'> ;</span>
231: <span class='forth-forWord def-Keyword'>defer</span> execfinalnode <span class='forth-forResWord def-Label'>'</span> <span class='forth-forWord def-Keyword'>noop</span> <span class='forth-forWord def-Keyword'>is</span> execfinalnode
232: <span class='forth-forWord def-Keyword'>variable</span> <span class='forth-forWordDefinition def-Keyword'>oldnode</span><span class='forth-forComment def-Comment def-Syntax'> \ Node  before beginig procedure, for restoring in crash finding</span>
233: <span class='forth-forWord def-Keyword'>variable</span> <span class='forth-forWordDefinition def-Keyword'>oldinst</span><span class='forth-forComment def-Comment def-Syntax'> \ Inode before beginig procedure, for restoring in crash finding</span>
234: 
235: <span class='forth-forComment def-Comment def-Syntax'>\ Path resolve procedure 4.3.1 Variant 2</span>
236: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>shpath</span> <span class='forth-forWord def-Keyword'>2dup</span> path_name st! <span class='forth-forWord def-Keyword'>cr</span> <span class='forth-forWord def-Keyword'>." </span><span class='forth-forString def-String'>Full path=</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forWord def-Keyword'>2dup</span> <span class='forth-forWord def-Keyword'>type</span><span class='forth-forWord def-Keyword'> ;</span>
237: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>contgopath</span><span class='forth-forComment def-Comment def-Syntax'> ( Adr Len )</span> shpath <span class='forth-forWord def-Keyword'>true</span><span class='forth-forComment def-Comment def-Syntax'> \ Special initial flag</span>
238:     <span class='forth-forResWord def-Label'>begin</span>
239:         <span class='forth-forWord def-Keyword'>drop</span> gobynodefrompath<span class='forth-forComment def-Comment def-Syntax'> ( Adr Len T/F )</span> <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forWord def-Keyword'>not</span> <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forWord def-Keyword'>not</span> <span class='forth-forWord def-Keyword'>or</span>
240:     <span class='forth-forResWord def-Label'>until</span><span class='forth-forComment def-Comment def-Syntax'> ( Adr False )</span>
241:     <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>2drop</span> execfinalnode inode<span class='forth-forComment def-Comment def-Syntax'> ( Inode )</span> <span class='forth-forResWord def-Label'>else</span> <span class='forth-forWord def-Keyword'>2drop</span><span class='forth-forComment def-Comment def-Syntax'> (  )</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
242: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>extalias</span>
243:    <span class='forth-forComment def-Comment def-Syntax'> ( Adr Len XtFinalExec -- Inode )</span> <span class='forth-forWord def-Keyword'>is</span> execfinalnode<span class='forth-forComment def-Comment def-Syntax'> ( Adr Len )</span>
244:     nodehandle <span class='forth-forWord def-Keyword'>@</span> oldnode <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ Saving node</span>
245:     inode oldinst <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> \ Saving Inode</span>
246:     ?root <span class='forth-forResWord def-Label'>if</span> setroot <span class='forth-forResWord def-Label'>else</span> extractalias <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( Adr Len )</span>
247:     ?root <span class='forth-forResWord def-Label'>if</span> setroot <span class='forth-forWord def-Keyword'>1-</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>1+</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( Adr Len ( 4.3.1.b )</span><span class='forth-forWord def-Keyword'> ;</span>
248: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>gobypath</span><span class='forth-forComment def-Comment def-Syntax'> ( A L )</span> extalias active-package <span class='forth-forWord def-Keyword'>@</span>
249:     <span class='forth-forResWord def-Label'>if</span> contgopath<span class='forth-forComment def-Comment def-Syntax'> ( ( 4.3.1.c )</span> <span class='forth-forResWord def-Label'>else</span> 2dropfalse <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( F | Inode )</span><span class='forth-forWord def-Keyword'> ;</span>
250: 
251: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>open-dev</span><span class='forth-forComment def-Comment def-Syntax'> ( Adr Len )</span> <span class='forth-forResWord def-Label'>[']</span> <span class='forth-forWord def-Keyword'>execopen</span> gobypath<span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
252: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>find-dev</span><span class='forth-forComment def-Comment def-Syntax'> ( Adr Len )</span> <span class='forth-forResWord def-Label'>[']</span> <span class='forth-forWord def-Keyword'>noop</span>     gobypath<span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
253: 
254: <span class='forth-forNumb def-Number'>31</span> string ispmethod<span class='forth-forComment def-Comment def-Syntax'> \ Name of method that will be executed on last node</span>
255: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>execispmethod</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> ispmethod creacall<span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
256: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>execute-device-method</span><span class='forth-forComment def-Comment def-Syntax'> ( Am Lm Ap Lp )</span> <span class='forth-forWord def-Keyword'>2swap</span> ispmethod st!<span class='forth-forComment def-Comment def-Syntax'> ( Ap Lp )</span>
257:     <span class='forth-forResWord def-Label'>[']</span> <span class='forth-forWord def-Keyword'>execispmethod</span> gobypath<span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
258: 
259: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>begin-package</span><span class='forth-forComment def-Comment def-Syntax'> ( arg-str, arg-len, reg-str, reg-len, dev-str, dev-len -- )</span>
260:     open-dev   <span class='forth-forComment def-Comment def-Syntax'> ( arg-str, arg-len, reg-str, reg-len )</span>
261:     <span class='forth-forExtWords def-VarStrong def-Var'>new-device</span> <span class='forth-forComment def-Comment def-Syntax'> ( arg-str, arg-len, reg-str, reg-len )</span>
262:     set-args creanewvoc<span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
263: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>savenode</span>       norealize<span class='forth-forWord def-Keyword'> ;</span>
264: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>delnode</span>        norealize<span class='forth-forWord def-Keyword'> ;</span>
265: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>deleteinstance</span> norealize<span class='forth-forWord def-Keyword'> ;</span>
266: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>selectparent</span>  <span class='forth-forComment def-Comment def-Syntax'> ( norealize )</span>
267:                  nodehandle <span class='forth-forWord def-Keyword'>@</span> parenthandle >code <span class='forth-forWord def-Keyword'>@</span>
268:                 <span class='forth-forComment def-Comment def-Syntax'> \ cr ."  Parent =" .s</span>
269:                  <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>dup</span> nodehandle <span class='forth-forWord def-Keyword'>!</span> <span class='forth-forWord def-Keyword'>-></span> <span class='forth-forExtWords def-VarStrong def-Var'>my-self</span>
270:                  parent parentnode <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
271: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>close-dev</span>      norealize<span class='forth-forWord def-Keyword'> ;</span>
272: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>finish-device</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
273: <span class='forth-forComment def-Comment def-Syntax'>\    s" name" creanode @ getPhandleProperty ( A L F | T )</span>
274: <span class='forth-forComment def-Comment def-Syntax'>\    ."  Property taken"</span>
275: <span class='forth-forComment def-Comment def-Syntax'>\    if delnode else 2drop savenode then</span>
276: <span class='forth-forComment def-Comment def-Syntax'>\    deleteinstance</span>
277:     <span class='forth-forWord def-Keyword'>forth</span><span class='forth-forComment def-Comment def-Syntax'> ( previous )</span> <span class='forth-forWord def-Keyword'>definitions</span><span class='forth-forComment def-Comment def-Syntax'> \ set Forth as main vocabulary</span>
278: <span class='forth-forComment def-Comment def-Syntax'>\    order vocs key drop</span>
279:     selectparent<span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
280: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>end-package</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
281:     <span class='forth-forExtWords def-VarStrong def-Var'>finish-device</span>
282:     <span class='forth-forWord def-Keyword'>previous</span><span class='forth-forComment def-Comment def-Syntax'> \ set Forth as main vocabulary</span>
283:     close-dev<span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
284: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>bprp</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>bus:120,123456/espdma@f,400000</span><span class='forth-forWord def-Keyword'>"</span>
285: <span class='forth-forComment def-Comment def-Syntax'>\ /sp@f,800000</span>
286:     <span class='forth-forResWord def-Label'>[']</span> <span class='forth-forWord def-Keyword'>execopen</span> gobypath <span class='forth-forWord def-Keyword'>drop</span><span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
287: <span class='forth-forComment def-Comment def-Syntax'>\ options/openprom</span>
288: <span class='forth-forComment def-Comment def-Syntax'>\ Для пpовеpки пpавильности изменения значения свойства</span>
289: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>er</span><span class='forth-forComment def-Comment def-Syntax'> (  )</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>/espdma@f,400000/esp@f,800000</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>SDDEV</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forExtWords def-VarStrong def-Var'>property</span> <span class='forth-forWord def-Keyword'>drop</span><span class='forth-forComment def-Comment def-Syntax'> (  )</span><span class='forth-forWord def-Keyword'> ;</span>
290: 
291: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>.name</span><span class='forth-forComment def-Comment def-Syntax'> ( Pnode )</span> <span class='forth-forWord def-Keyword'>space</span> <span class='forth-forWord def-Keyword'>space</span>
292:     <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>name</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forNumb def-Number'>2</span> <span class='forth-forWord def-Keyword'>pick</span> getPhandleProperty <span class='forth-forWord def-Keyword'>not</span> <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>type</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( Pnode )</span><span class='forth-forWord def-Keyword'> ;</span>
293: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>ls</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> nodehandle <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> childhandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>dup</span>
294:     <span class='forth-forResWord def-Label'>if</span> .name<span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span>
295:         <span class='forth-forResWord def-Label'>begin</span> >code siblinghandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forResWord def-Label'>while</span> .name <span class='forth-forResWord def-Label'>repeat</span> <span class='forth-forWord def-Keyword'>drop</span><span class='forth-forComment def-Comment def-Syntax'> (  )</span>
296:     <span class='forth-forResWord def-Label'>else</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forResWord def-Label'>then</span> <span class='forth-forWord def-Keyword'>cr</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
297: 
