  0: <span class='forth-forComment def-Comment def-Syntax'>\ Client interface for BootMon. Chapter 6</span>
  1: <span class='forth-forWord def-Keyword'>." </span><span class='forth-forString def-String'>Client interface</span><span class='forth-forWord def-Keyword'>"</span>
  2: include? task-rp.fth rp.fth anew task-ClientInt.fth <span class='forth-forWord def-Keyword'>decimal</span>
  3: <span class='forth-forWord def-Keyword'>vocabulary</span> <span class='forth-forWordDefinition def-Keyword'>client</span> <span class='forth-forWord def-Keyword'>also</span> client <span class='forth-forWord def-Keyword'>definitions</span>
  4: <span class='forth-forExtWords def-VarStrong def-Var'>dictlist</span> <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>cell+</span> <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>value</span> <span class='forth-forWordDefinition def-Keyword'>clientvoc</span><span class='forth-forComment def-Comment def-Syntax'> \ Adr vocabulary of client interface</span>
  5: 
  6: <span class='forth-forComment def-Comment def-Syntax'>\ Convert zerro terminated string to S" string</span>
  7: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>z>s-string</span><span class='forth-forComment def-Comment def-Syntax'> ( Azstr -- A L )</span> <span class='forth-forWord def-Keyword'>dup</span>
  8:     <span class='forth-forNumb def-Number'>0</span> <span class='forth-forResWord def-Label'>begin</span> <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forWord def-Keyword'>c@</span> <span class='forth-forResWord def-Label'>while</span> <span class='forth-forWord def-Keyword'>1+</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>1+</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forResWord def-Label'>repeat</span><span class='forth-forComment def-Comment def-Syntax'> ( A Aend L )</span>
  9:     <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forWord def-Keyword'>1-</span><span class='forth-forComment def-Comment def-Syntax'> ( A L )</span><span class='forth-forWord def-Keyword'> ;</span>
 10: <span class='forth-forComment def-Comment def-Syntax'>\ Test of existanse target method</span>
 11: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>test</span><span class='forth-forComment def-Comment def-Syntax'> ( Azstr -- F/T )</span> z>s-string
 12:     clientvoc vfind<span class='forth-forComment def-Comment def-Syntax'> ( XtW 1 | endVoc 0 )</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forWord def-Keyword'>not</span><span class='forth-forComment def-Comment def-Syntax'> ( F/T )</span><span class='forth-forWord def-Keyword'> ;</span>
 13: <span class='forth-forComment def-Comment def-Syntax'>\ Peer</span>
 14: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>Psibl</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span> >code siblinghandle <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> ( SiblingHandle )</span><span class='forth-forWord def-Keyword'> ;</span>
 15: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>Proot</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span> <span class='forth-forWord def-Keyword'>drop</span> roothandle <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> ( SiblingHandle )</span><span class='forth-forWord def-Keyword'> ;</span>
 16: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>peer</span> <span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forExtWords def-VarStrong def-Var'>br0</span> Proot Psibl<span class='forth-forComment def-Comment def-Syntax'> ( SiblingHandle )</span><span class='forth-forWord def-Keyword'> ;</span><span class='forth-forComment def-Comment def-Syntax'> \ ++ 16-02-2000</span>
 17: <span class='forth-forComment def-Comment def-Syntax'>\ Child</span>
 18: <span class='forth-forComment def-Comment def-Syntax'>\ : child ( Phandle ) >code childhandle @ ( ChildHandle ) ;</span>
 19: <span class='forth-forComment def-Comment def-Syntax'>\ getproplen</span>
 20: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>getproplen</span><span class='forth-forComment def-Comment def-Syntax'> ( Azstr Phandle -- Len | F )</span>
 21:     <span class='forth-forWord def-Keyword'>swap</span> z>s-string <span class='forth-forWord def-Keyword'>rot</span><span class='forth-forComment def-Comment def-Syntax'> ( A L Phandle )</span> getPhandleProperty
 22:    <span class='forth-forComment def-Comment def-Syntax'> ( Adr Len False | True  )</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>not</span> <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( Lprop )</span><span class='forth-forWord def-Keyword'> ;</span><span class='forth-forComment def-Comment def-Syntax'> \ ++ 16-02-2000</span>
 23: <span class='forth-forComment def-Comment def-Syntax'>\ getprop</span>
 24: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>getprop</span><span class='forth-forComment def-Comment def-Syntax'> ( LenBuf AdrBuf Azstr Phandle -- Len | F )</span>
 25:     <span class='forth-forWord def-Keyword'>swap</span> z>s-string <span class='forth-forWord def-Keyword'>rot</span><span class='forth-forComment def-Comment def-Syntax'> ( LenBuf AdrBuf A L Phandle )</span> getPhandleProperty
 26:    <span class='forth-forComment def-Comment def-Syntax'> ( LenBuf AdrBuf Adr Len False | True )</span> <span class='forth-forWord def-Keyword'>not</span>
 27:     <span class='forth-forResWord def-Label'>if</span> <span class='forth-forComment def-Comment def-Syntax'> ( LenBuf AdrBuf Adr Len )</span>
 28:         <span class='forth-forWord def-Keyword'>2swap</span> <span class='forth-forWord def-Keyword'>rot</span><span class='forth-forComment def-Comment def-Syntax'> ( Adr AdrBuf Len LenBuf AdrBuf )</span>
 29:         <span class='forth-forWord def-Keyword'>min</span><span class='forth-forComment def-Comment def-Syntax'> ( Adr AdrBuf LenMin )</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>>r</span> <span class='forth-forWord def-Keyword'>move</span> <span class='forth-forWord def-Keyword'>r></span><span class='forth-forComment def-Comment def-Syntax'> ( Len )</span>
 30:     <span class='forth-forResWord def-Label'>else</span><span class='forth-forComment def-Comment def-Syntax'> ( AdrBuf LenBuf )</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>true</span><span class='forth-forComment def-Comment def-Syntax'> ( T )</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( Lprop )</span><span class='forth-forWord def-Keyword'> ;</span><span class='forth-forComment def-Comment def-Syntax'> \ ++ 16-02-2000</span>
 31: <span class='forth-forComment def-Comment def-Syntax'>\ nextprop</span>
 32: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>nextprop</span><span class='forth-forComment def-Comment def-Syntax'> ( AdrBuf Azstr Phandle -- T | F )</span>
 33:     <span class='forth-forWord def-Keyword'>swap</span> z>s-string <span class='forth-forWord def-Keyword'>rot</span><span class='forth-forComment def-Comment def-Syntax'> ( AdrBuf A L Phandle )</span>
 34:     next-property<span class='forth-forComment def-Comment def-Syntax'> ( AdrBuf Anp Lnp T | AdrBuf F )</span>
 35:     <span class='forth-forResWord def-Label'>if</span><span class='forth-forComment def-Comment def-Syntax'> ( AdrBuf Anp Lnp )</span>
 36:         <span class='forth-forNumb def-Number'>2</span> <span class='forth-forWord def-Keyword'>pick</span> <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forWord def-Keyword'>+</span> <span class='forth-forWord def-Keyword'>1+</span> <span class='forth-forNumb def-Number'>0</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>c!</span><span class='forth-forComment def-Comment def-Syntax'> \ Write 0 for zerro terminated string</span>
 37:         <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>>r</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>-rot</span> <span class='forth-forWord def-Keyword'>move</span> <span class='forth-forWord def-Keyword'>r></span><span class='forth-forComment def-Comment def-Syntax'> ( L )</span>
 38:     <span class='forth-forResWord def-Label'>else</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forWord def-Keyword'>false</span><span class='forth-forComment def-Comment def-Syntax'> ( F )</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( L )</span><span class='forth-forWord def-Keyword'> ;</span><span class='forth-forComment def-Comment def-Syntax'> \ ++ 16-02-2000</span>
 39: 
 40: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>setprop</span><span class='forth-forComment def-Comment def-Syntax'> ( Len Buf SnameProp Phandle -- Size )</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forNumb def-Number'>4</span> <span class='forth-forWord def-Keyword'>mod</span>
 41:     <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>true</span>
 42:     <span class='forth-forResWord def-Label'>else</span>
 43:         provphandle<span class='forth-forComment def-Comment def-Syntax'> ( ... Phandle/T )</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>true</span> <span class='forth-forWord def-Keyword'>=</span>
 44:         <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>true</span>
 45:         <span class='forth-forResWord def-Label'>else</span>
 46:             <span class='forth-forWord def-Keyword'>2swap</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>>r</span> <span class='forth-forExtWords def-VarStrong def-Var'>encode-string</span> <span class='forth-forWord def-Keyword'>2swap</span><span class='forth-forComment def-Comment def-Syntax'> ( Buf Len Sname Phandle )</span>
 47:             <span class='forth-forWord def-Keyword'>swap</span> z>s-string <span class='forth-forWord def-Keyword'>2DUP</span> <span class='forth-forWord def-Keyword'>TYPE</span> <span class='forth-forWord def-Keyword'>rot</span><span class='forth-forComment def-Comment def-Syntax'> ( Buf Len A L Phandle )</span>
 48:             nodehandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>>r</span> nodehandle <span class='forth-forWord def-Keyword'>!</span>
 49:             <span class='forth-forWord def-Keyword'>.S</span> <span class='forth-forExtWords def-VarStrong def-Var'>property</span><span class='forth-forComment def-Comment def-Syntax'> \ Change value or make new property</span>
 50:             <span class='forth-forWord def-Keyword'>r></span> nodehandle <span class='forth-forWord def-Keyword'>!</span> <span class='forth-forWord def-Keyword'>r></span><span class='forth-forComment def-Comment def-Syntax'> ( Len )</span>
 51:         <span class='forth-forResWord def-Label'>then</span>
 52:     <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( T | size )</span><span class='forth-forWord def-Keyword'> ;</span><span class='forth-forComment def-Comment def-Syntax'> \ ++ 17-02-2000</span>
 53: 
 54: <span class='forth-forComment def-Comment def-Syntax'>\ Instance-to-package</span>
 55: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>proverprototype</span><span class='forth-forComment def-Comment def-Syntax'> ( Ihandle -- Phandle | T )</span> <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> \ Get prototip phandle</span>
 56:     provphandle<span class='forth-forComment def-Comment def-Syntax'> ( Phandle | T )</span><span class='forth-forWord def-Keyword'> ;</span>
 57: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>instance-to-package</span><span class='forth-forComment def-Comment def-Syntax'> ( Ihandle -- Phandle | T )</span>
 58:     <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forNumb def-Number'>4</span> <span class='forth-forWord def-Keyword'>mod</span> <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forWord def-Keyword'>true</span> <span class='forth-forResWord def-Label'>else</span> proverprototype <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle | T )</span><span class='forth-forWord def-Keyword'> ;</span>
 59: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>getnamepnode</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle Lbuf Abuf )</span>
 60:     <span class='forth-forWord def-Keyword'>rot</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>name</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forWord def-Keyword'>rot</span> getPhandleProperty<span class='forth-forComment def-Comment def-Syntax'> ( A L 0 | T )</span><span class='forth-forWord def-Keyword'> ;</span>
 61: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>fullstore</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf A L )</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forNumb def-Number'>2</span> <span class='forth-forWord def-Keyword'>pick</span> <span class='forth-forNumb def-Number'>2</span> <span class='forth-forWord def-Keyword'>pick</span> <span class='forth-forWord def-Keyword'>move</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf L )</span>
 62:     <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forWord def-Keyword'>+</span> <span class='forth-forWord def-Keyword'>-rot</span> <span class='forth-forWord def-Keyword'>-</span> <span class='forth-forWord def-Keyword'>swap</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf )</span><span class='forth-forWord def-Keyword'> ;</span>
 63: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>ukorot</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf A L )</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forWord def-Keyword'>over</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf A Abuf )</span> <span class='forth-forNumb def-Number'>3</span> <span class='forth-forWord def-Keyword'>pick</span> <span class='forth-forWord def-Keyword'>move</span>
 64:    <span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf )</span> <span class='forth-forWord def-Keyword'>+</span> <span class='forth-forNumb def-Number'>0</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf )</span><span class='forth-forWord def-Keyword'> ;</span>
 65: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>storename</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf A L )</span>
 66:     <span class='forth-forWord def-Keyword'>2swap</span> ascii / <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forWord def-Keyword'>c!</span> <span class='forth-forWord def-Keyword'>1+</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>1-</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>2swap</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf-1 Abuf+1 A L )</span>
 67:     <span class='forth-forNumb def-Number'>3</span> <span class='forth-forWord def-Keyword'>pick</span> <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forWord def-Keyword'>&lt;</span> <span class='forth-forResWord def-Label'>if</span> ukorot <span class='forth-forResWord def-Label'>else</span> fullstore <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf-L Abuf+L )</span><span class='forth-forWord def-Keyword'> ;</span>
 68: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>getbyroot</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle -- PhandleN ...... PhandleR N )</span>
 69:     <span class='forth-forNumb def-Number'>2</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle 1 )</span>
 70:     <span class='forth-forResWord def-Label'>begin</span>
 71:         <span class='forth-forWord def-Keyword'>over</span> parent<span class='forth-forComment def-Comment def-Syntax'> ( Parent )</span>
 72:         <span class='forth-forWord def-Keyword'>dup</span>  parent roothandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>=</span> <span class='forth-forWord def-Keyword'>not</span><span class='forth-forComment def-Comment def-Syntax'> ( ? Parent is Root )</span>
 73:     <span class='forth-forResWord def-Label'>while</span>
 74:         <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>1+</span>
 75:     <span class='forth-forResWord def-Label'>repeat</span> <span class='forth-forWord def-Keyword'>swap</span><span class='forth-forComment def-Comment def-Syntax'> ( PhandleN ...... PhandleR N )</span><span class='forth-forWord def-Keyword'> ;</span>
 76: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>getnodepath</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span> <span class='forth-forWord def-Keyword'>dup</span> parent roothandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>=</span> <span class='forth-forWord def-Keyword'>not</span>
 77:     <span class='forth-forResWord def-Label'>if</span> getbyroot <span class='forth-forResWord def-Label'>else</span> <span class='forth-forNumb def-Number'>1</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( Abuf PhandleN ...... PhandleR N )</span><span class='forth-forWord def-Keyword'> ;</span>
 78: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>upbychain</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf Phandle )</span>
 79:     <span class='forth-forWord def-Keyword'>over</span> <span class='forth-forWord def-Keyword'>>r</span> <span class='forth-forWord def-Keyword'>rot</span> <span class='forth-forWord def-Keyword'>>r</span>
 80:     getnodepath<span class='forth-forComment def-Comment def-Syntax'> ( Abuf PhandleN ...... PhandleR N )</span>
 81:     <span class='forth-forWord def-Keyword'>r></span> <span class='forth-forWord def-Keyword'>r></span> <span class='forth-forWord def-Keyword'>rot</span> <span class='forth-forNumb def-Number'>0</span>
 82:     <span class='forth-forResWord def-Label'>do</span>
 83:         getnamepnode <span class='forth-forWord def-Keyword'>not</span>
 84:         <span class='forth-forResWord def-Label'>if</span> <span class='forth-forComment def-Comment def-Syntax'> ( Abuf PhandleN ...... PhandleM Lbuf Abuf A L )</span>
 85:             <span class='forth-forExtWords def-VarStrong def-Var'>decode-string</span> <span class='forth-forWord def-Keyword'>2swap</span> <span class='forth-forWord def-Keyword'>2drop</span> storename
 86:         <span class='forth-forResWord def-Label'>then</span>
 87:     <span class='forth-forResWord def-Label'>loop</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forWord def-Keyword'>swap</span> <span class='forth-forWord def-Keyword'>-</span><span class='forth-forComment def-Comment def-Syntax'> ( LenPath )</span><span class='forth-forWord def-Keyword'> ;</span>
 88: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>package-to-path</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf Phandle -- LenPath )</span>
 89:     <span class='forth-forWord def-Keyword'>dup</span> provphandle <span class='forth-forWord def-Keyword'>true</span> <span class='forth-forWord def-Keyword'>=</span>
 90:     <span class='forth-forResWord def-Label'>if</span>  <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>drop</span> <span class='forth-forWord def-Keyword'>true</span>
 91:     <span class='forth-forResWord def-Label'>else</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf Phandle )</span> upbychain<span class='forth-forComment def-Comment def-Syntax'> ( LenPath )</span>
 92:     <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( LenPath )</span><span class='forth-forWord def-Keyword'> ;</span>
 93: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>pwd</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle -- )</span> <span class='forth-forNumb def-Number'>200</span> <span class='forth-forWord def-Keyword'>here</span> <span class='forth-forWord def-Keyword'>rot</span> package-to-path
 94:     <span class='forth-forWord def-Keyword'>here</span> <span class='forth-forWord def-Keyword'>swap</span><span class='forth-forComment def-Comment def-Syntax'> ( AdrPath LenPath )</span> <span class='forth-forWord def-Keyword'>type</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
 95: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>finddevice</span><span class='forth-forComment def-Comment def-Syntax'> ( AdrZstring -- Phandle )</span> norealize<span class='forth-forWord def-Keyword'> ;</span>
 96: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>canon</span><span class='forth-forComment def-Comment def-Syntax'> ( Lbuf Abuf StringZSpecif -- LenPath )</span> norealize<span class='forth-forWord def-Keyword'> ;</span>
 97: 
 98: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>gotoup</span><span class='forth-forComment def-Comment def-Syntax'> ( A L )</span> <span class='forth-forWord def-Keyword'>2drop</span> nodehandle <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> <span class='forth-forWord def-Keyword'>dup</span> roothandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>=</span> <span class='forth-forWord def-Keyword'>not</span>
 99:     <span class='forth-forResWord def-Label'>if</span> parenthandle <span class='forth-forWord def-Keyword'>@</span> nodehandle <span class='forth-forWord def-Keyword'>!</span> <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
100: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>gotodown</span><span class='forth-forComment def-Comment def-Syntax'> ( A L )</span> <span class='forth-forWord def-Keyword'>type</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> norealize<span class='forth-forWord def-Keyword'> ;</span>
101: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>tcd</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> <span class='forth-forWord def-Keyword'>bl</span> <span class='forth-forWord def-Keyword'>word</span> <span class='forth-forWord def-Keyword'>count</span><span class='forth-forComment def-Comment def-Syntax'> ( A L )</span> <span class='forth-forWord def-Keyword'>2dup</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>..</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forWord def-Keyword'>compare</span> <span class='forth-forWord def-Keyword'>not</span>
102:     <span class='forth-forResWord def-Label'>if</span> gotoup <span class='forth-forResWord def-Label'>else</span> gotodown <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
103: 
104: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>name>node</span><span class='forth-forComment def-Comment def-Syntax'> ( An Ln )</span> norealize <span class='forth-forWord def-Keyword'>2drop</span> roothandle <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forComment def-Comment def-Syntax'> ( Node )</span><span class='forth-forWord def-Keyword'> ;</span>
105: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>get-name-node-prop</span><span class='forth-forComment def-Comment def-Syntax'> ( Anp Lnp Node -- Ap Lp F | T )</span>
106:     name>node get-package-property<span class='forth-forComment def-Comment def-Syntax'> ( Ap Lp F | T )</span><span class='forth-forWord def-Keyword'> ;</span>
107: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>set-name-node-prop</span><span class='forth-forComment def-Comment def-Syntax'> ( Avp Lvp Anp Lnp AnN LnN -- AdrPropRec )</span>
108:     name>node get-package-property<span class='forth-forComment def-Comment def-Syntax'> ( AdrPropRec )</span><span class='forth-forWord def-Keyword'> ;</span>
109: 
110: <span class='forth-forNumb def-Number'>31</span> string namepropgs
111: <span class='forth-forNumb def-Number'>31</span> string newvalpropgs
112: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>p$setenv</span><span class='forth-forComment def-Comment def-Syntax'> ( Av Lv )</span> newvalpropgs st!<span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
113:    <span class='forth-forComment def-Comment def-Syntax'> \ space space namepropgs type ." ->" newvalpropgs type</span>
114:     namepropgs /chosen get-package-property
115:    <span class='forth-forComment def-Comment def-Syntax'> ( A L F | T )</span>
116:     <span class='forth-forResWord def-Label'>if</span>  <span class='forth-forWord def-Keyword'>cr</span> <span class='forth-forWord def-Keyword'>." </span><span class='forth-forString def-String'>No defined enviroment!</span><span class='forth-forWord def-Keyword'>"</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
117:     <span class='forth-forResWord def-Label'>else</span><span class='forth-forComment def-Comment def-Syntax'> ( Aov Lov )</span>
118:         <span class='forth-forWord def-Keyword'>2drop</span> newvalpropgs <span class='forth-forExtWords def-VarStrong def-Var'>encode-string</span> namepropgs<span class='forth-forComment def-Comment def-Syntax'> ( Av Lv An Ln )</span>
119:         /chosen nodehandle <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>>r</span> <span class='forth-forWord def-Keyword'>!</span> <span class='forth-forExtWords def-VarStrong def-Var'>property</span> <span class='forth-forWord def-Keyword'>r></span> nodehandle <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
120:     <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
121: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>$setenv</span><span class='forth-forComment def-Comment def-Syntax'> ( Av Lv An Ln -- )</span> namepropgs st!<span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forComment def-Comment def-Syntax'> ( Av Lv )</span> p$setenv<span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
122: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>setenv</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
123:     <span class='forth-forWord def-Keyword'>bl</span> <span class='forth-forWord def-Keyword'>word</span> <span class='forth-forWord def-Keyword'>count</span> namepropgs st!<span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
124:     carret <span class='forth-forWord def-Keyword'>word</span> <span class='forth-forWord def-Keyword'>count</span><span class='forth-forComment def-Comment def-Syntax'> ( Av Lv )</span> p$setenv<span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
125: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>$set-default</span><span class='forth-forComment def-Comment def-Syntax'> ( A L -- )</span> <span class='forth-forWord def-Keyword'>2dup</span> namepropgs st!
126:     /options get-package-property<span class='forth-forComment def-Comment def-Syntax'> ( A L F | T )</span>
127:     <span class='forth-forResWord def-Label'>if</span>  <span class='forth-forWord def-Keyword'>cr</span> <span class='forth-forWord def-Keyword'>." </span><span class='forth-forString def-String'>No defined enviroment!</span><span class='forth-forWord def-Keyword'>"</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
128:     <span class='forth-forResWord def-Label'>else</span><span class='forth-forComment def-Comment def-Syntax'> ( Aov Lov )</span>
129:         <span class='forth-forWord def-Keyword'>2drop</span> namepropgs /default get-package-property
130:         <span class='forth-forResWord def-Label'>if</span>    <span class='forth-forWord def-Keyword'>cr</span> <span class='forth-forWord def-Keyword'>." </span><span class='forth-forString def-String'>No defined default value!</span><span class='forth-forWord def-Keyword'>"</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
131:         <span class='forth-forResWord def-Label'>else</span>
132:             <span class='forth-forExtWords def-VarStrong def-Var'>decode-string</span> <span class='forth-forWord def-Keyword'>2swap</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forExtWords def-VarStrong def-Var'>encode-string</span> namepropgs
133:             /options nodehandle <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>>r</span> <span class='forth-forWord def-Keyword'>!</span> <span class='forth-forExtWords def-VarStrong def-Var'>property</span> <span class='forth-forWord def-Keyword'>r></span> nodehandle <span class='forth-forWord def-Keyword'>!</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
134:         <span class='forth-forResWord def-Label'>then</span>
135:     <span class='forth-forResWord def-Label'>then</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
136: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>set-default</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> <span class='forth-forWord def-Keyword'>bl</span> <span class='forth-forWord def-Keyword'>word</span> <span class='forth-forWord def-Keyword'>count</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forComment def-Comment def-Syntax'> \ space space 2dup type</span>
137:     $set-default<span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
138: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>set-defaults</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
139:     /default >code prophandle <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> \ Pointer to the first property name</span>
140:     <span class='forth-forResWord def-Label'>begin</span>
141:         >code <span class='forth-forWord def-Keyword'>dup</span> ptrnameprop <span class='forth-forWord def-Keyword'>count</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle A L A L )</span>
142:         <span class='forth-forWord def-Keyword'>2dup</span> <span class='forth-forWord def-Keyword'>2dup</span> <span class='forth-forWord def-Keyword'>cr</span> <span class='forth-forWord def-Keyword'>type</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>name</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forWord def-Keyword'>compare</span>
143:         <span class='forth-forResWord def-Label'>if</span>   $set-default
144:         <span class='forth-forResWord def-Label'>else</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>2drop</span>
145:         <span class='forth-forResWord def-Label'>then</span>
146:         <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>0=</span>
147:     <span class='forth-forResWord def-Label'>until</span> <span class='forth-forWord def-Keyword'>drop</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span><span class='forth-forWord def-Keyword'> ;</span>
148: <span class='forth-forWord def-Keyword'>:</span> <span class='forth-forWordDefinition def-Keyword'>printenv</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span>
149:     <span class='forth-forWord def-Keyword'>cr</span> <span class='forth-forWord def-Keyword'>." </span><span class='forth-forString def-String'>Variable Name     Value            Default Value</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forWord def-Keyword'>cr</span>
150:     /options >code prophandle <span class='forth-forWord def-Keyword'>@</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle )</span>
151:     <span class='forth-forResWord def-Label'>begin</span>
152:         >code <span class='forth-forWord def-Keyword'>dup</span> ptrvalprop <span class='forth-forExtWords def-VarStrong def-Var'>@nt</span> <span class='forth-forWord def-Keyword'>1+</span>
153:         <span class='forth-forWord def-Keyword'>over</span> ptrlenvalprop <span class='forth-forWord def-Keyword'>@</span>
154:         <span class='forth-forNumb def-Number'>2</span> <span class='forth-forWord def-Keyword'>pick</span> ptrnameprop <span class='forth-forWord def-Keyword'>count</span><span class='forth-forComment def-Comment def-Syntax'> ( Phandle A L A L )</span>
155:         <span class='forth-forWord def-Keyword'>2dup</span> <span class='forth-forWord def-Keyword'>s" </span><span class='forth-forString def-String'>name</span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forWord def-Keyword'>compare</span>
156:         <span class='forth-forResWord def-Label'>if</span>
157:             <span class='forth-forWord def-Keyword'>cr</span> <span class='forth-forWord def-Keyword'>2dup</span> <span class='forth-forWord def-Keyword'>type</span> <span class='forth-forWord def-Keyword'>." </span><span class='forth-forString def-String'>   </span><span class='forth-forWord def-Keyword'>"</span> <span class='forth-forWord def-Keyword'>2swap</span> <span class='forth-forNumb def-Number'>20</span> space.to.column <span class='forth-forWord def-Keyword'>type</span>
158:             /default<span class='forth-forComment def-Comment def-Syntax'> ( A L P )</span> getPhandleProperty <span class='forth-forWord def-Keyword'>not</span> <span class='forth-forResWord def-Label'>if</span> <span class='forth-forWord def-Keyword'>." </span><span class='forth-forString def-String'>    </span><span class='forth-forWord def-Keyword'>"</span>
159:             <span class='forth-forNumb def-Number'>50</span> space.to.column <span class='forth-forWord def-Keyword'>type</span> <span class='forth-forResWord def-Label'>then</span>
160:         <span class='forth-forResWord def-Label'>else</span> <span class='forth-forWord def-Keyword'>2drop</span> <span class='forth-forWord def-Keyword'>2drop</span>
161:         <span class='forth-forResWord def-Label'>then</span>
162:         <span class='forth-forWord def-Keyword'>@</span> <span class='forth-forWord def-Keyword'>dup</span> <span class='forth-forWord def-Keyword'>0=</span>
163:     <span class='forth-forResWord def-Label'>until</span> <span class='forth-forWord def-Keyword'>drop</span><span class='forth-forComment def-Comment def-Syntax'> ( -- )</span> <span class='forth-forWord def-Keyword'>cr</span><span class='forth-forWord def-Keyword'> ;</span>
164: 
165: <span class='forth-forComment def-Comment def-Syntax'>0 [if] \ Only for testing package-to-path</span>
166: <span class='forth-forComment def-Comment def-Syntax'>120 string mm</span>
167: <span class='forth-forComment def-Comment def-Syntax'>: tptp ( Phandle ) 120 mm drop rot package-to-path .s mm drop swap type cr (  ) ;</span>
168: <span class='forth-forComment def-Comment def-Syntax'>[then]</span>
169: <span class='forth-forComment def-Comment def-Syntax'>\ previous base ! cr</span>
170: 
