  0: 
  1: <span class='def-Keyword'>package</span><span class='def-Directive'> ru</span><span class='def-Symbol'>.</span><span class='def-Directive'>grw</span><span class='def-Symbol'>.</span><span class='def-Directive'>server</span><span class='def-Symbol'>.</span><span class='def-Directive'>ssvt</span><span class='def-SymbolStrong def-Symbol'>;</span>
  2: 
  3: <span class='def-Keyword'>import</span><span class='def-Directive'> java</span><span class='def-Symbol'>.</span><span class='def-Directive'>sql</span><span class='def-Symbol'>.</span><span class='def-Keyword'>*</span><span class='def-SymbolStrong def-Symbol'>;</span>
  4: 
  5: <span class='def-Keyword'>import</span><span class='def-Directive'> java</span><span class='def-Symbol'>.</span><span class='def-Directive'>util</span><span class='def-Symbol'>.</span><span class='def-Directive'>Enumeration</span><span class='def-SymbolStrong def-Symbol'>;</span>
  6: <span class='def-Keyword'>import</span><span class='def-Directive'> java</span><span class='def-Symbol'>.</span><span class='def-Directive'>util</span><span class='def-Symbol'>.</span><span class='def-Directive'>GregorianCalendar</span><span class='def-SymbolStrong def-Symbol'>;</span>
  7: <span class='def-Keyword'>import</span><span class='def-Directive'> java</span><span class='def-Symbol'>.</span><span class='def-Directive'>util</span><span class='def-Symbol'>.</span><span class='def-Directive'>Hashtable</span><span class='def-SymbolStrong def-Symbol'>;</span>
  8: <span class='def-Keyword'>import</span><span class='def-Directive'> java</span><span class='def-Symbol'>.</span><span class='def-Directive'>util</span><span class='def-Symbol'>.</span><span class='def-Directive'>Vector</span><span class='def-SymbolStrong def-Symbol'>;</span>
  9: 
 10: <span class='def-LineComment def-Comment def-Syntax'>//import ru.grw.http.core.HttpUser;</span>
 11: <span class='def-Keyword'>import</span><span class='def-Directive'> ru</span><span class='def-Symbol'>.</span><span class='def-Directive'>grw</span><span class='def-Symbol'>.</span><span class='def-Directive'>server</span><span class='def-Symbol'>.</span><span class='def-Directive'>http</span><span class='def-Symbol'>.</span><span class='def-Directive'>HttpUser</span><span class='def-SymbolStrong def-Symbol'>;</span>
 12: <span class='def-Keyword'>import</span><span class='def-Directive'> ru</span><span class='def-Symbol'>.</span><span class='def-Directive'>grw</span><span class='def-Symbol'>.</span><span class='def-Directive'>sql</span><span class='def-Symbol'>.</span><span class='def-Directive'>Field</span><span class='def-SymbolStrong def-Symbol'>;</span>
 13: <span class='def-Keyword'>import</span><span class='def-Directive'> ru</span><span class='def-Symbol'>.</span><span class='def-Directive'>grw</span><span class='def-Symbol'>.</span><span class='def-Directive'>util</span><span class='def-Symbol'>.</span><span class='def-Directive'>Function</span><span class='def-SymbolStrong def-Symbol'>;</span>
 14: 
 15: <span class='java-KeywordModifier def-Keyword'>public</span> <span class='def-Keyword'>class</span> ViewTable <span class='def-SymbolStrong def-Symbol'>{</span>
 16: 
 17:     <span class='java-KeywordModifier def-Keyword'>private</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span> tables <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span><span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 18: 
 19:     <span class='java-KeywordModifier def-Keyword'>protected</span> <span class='java-KeywordModifier def-Keyword'>static</span> TableQuery initFields<span class='def-Symbol'>(</span>ServerSSVT ssvt<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span> attributes<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 20:         <span class='def-ClassKeyword def-Keyword'>String</span> tableName <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span><span class='def-String'>"table"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 21:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 22:             TableQuery tableQuery <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span>TableQuery<span class='def-Symbol'>)</span> tables<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span>tableName<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 23:             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>tableQuery <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 24:                 tableQuery <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> TableQuery<span class='def-Symbol'>(</span>tableName<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 25:                 tables<span class='def-Symbol'>.</span>put<span class='def-Symbol'>(</span>tableName<span class='def-Symbol'>,</span> tableQuery<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 26:                 <span class='def-ClassKeyword def-Keyword'>String</span> startName <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"startName"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 27:                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>startName <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> startName <span class='def-Symbol'>=</span> <span class='def-String'>""</span><span class='def-SymbolStrong def-Symbol'>;</span>
 28:                 <span class='def-ClassKeyword def-Keyword'>Connection</span> connection <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getConnection<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 29:                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>connection <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 30:                     <span class='def-ClassKeyword def-Keyword'>String</span> sql <span class='def-Symbol'>=</span> getRecordsSQL<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> tableName<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 31:                     <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 32:                         <span class='def-ClassKeyword def-Keyword'>PreparedStatement</span> statement <span class='def-Symbol'>=</span> connection<span class='def-Symbol'>.</span>prepareStatement<span class='def-Symbol'>(</span>sql<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 33:                         <span class='def-ClassKeyword def-Keyword'>ResultSet</span> result <span class='def-Symbol'>=</span> statement<span class='def-Symbol'>.</span>executeQuery<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 34:                         <span class='def-ClassKeyword def-Keyword'>ResultSetMetaData</span> meta <span class='def-Symbol'>=</span> result<span class='def-Symbol'>.</span>getMetaData<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 35:                         <span class='def-TypeKeyword def-Keyword'>int</span> columnCount <span class='def-Symbol'>=</span> meta<span class='def-Symbol'>.</span>getColumnCount<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 36:                         <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>int</span> index <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>1</span><span class='def-SymbolStrong def-Symbol'>;</span> index <span class='def-Symbol'>&lt;</span><span class='def-Symbol'>=</span> columnCount<span class='def-SymbolStrong def-Symbol'>;</span> index<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 37:                             <span class='def-ClassKeyword def-Keyword'>String</span> name <span class='def-Symbol'>=</span> meta<span class='def-Symbol'>.</span>getColumnName<span class='def-Symbol'>(</span>index<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 38:                             <span class='def-TypeKeyword def-Keyword'>int</span> type <span class='def-Symbol'>=</span> meta<span class='def-Symbol'>.</span>getColumnType<span class='def-Symbol'>(</span>index<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 39:                             <span class='def-TypeKeyword def-Keyword'>int</span> size <span class='def-Symbol'>=</span> meta<span class='def-Symbol'>.</span>getColumnDisplaySize<span class='def-Symbol'>(</span>index<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 40:                             tableQuery<span class='def-Symbol'>.</span>addField<span class='def-Symbol'>(</span><span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>(</span>name<span class='def-Symbol'>,</span> type<span class='def-Symbol'>,</span> size<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 41:                         <span class='def-SymbolStrong def-Symbol'>}</span>
 42:                         result<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 43:                         statement<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 44:                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 45:                         ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 46:                     <span class='def-SymbolStrong def-Symbol'>}</span>
 47:                     <span class='def-LineComment def-Comment def-Syntax'>// получить список прав пользователей на таблицу</span>
 48:                     <span class='def-ClassKeyword def-Keyword'>String</span> sqlRights <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span><span class='def-String'>"getSqlRights"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 49:                     <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 50:                         <span class='def-ClassKeyword def-Keyword'>PreparedStatement</span> statement <span class='def-Symbol'>=</span> connection<span class='def-Symbol'>.</span>prepareStatement<span class='def-Symbol'>(</span>sqlRights<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 51:                         statement<span class='def-Symbol'>.</span>setString<span class='def-Symbol'>(</span><span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>,</span> tableName<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 52:                         <span class='def-ClassKeyword def-Keyword'>ResultSet</span> result <span class='def-Symbol'>=</span> statement<span class='def-Symbol'>.</span>executeQuery<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 53:                         <span class='def-Keyword'>while</span> <span class='def-Symbol'>(</span>result<span class='def-Symbol'>.</span>next<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 54:                             <span class='def-ClassKeyword def-Keyword'>String</span> userName <span class='def-Symbol'>=</span> result<span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"AD_USER"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 55:                             <span class='def-ClassKeyword def-Keyword'>String</span> table <span class='def-Symbol'>=</span> result<span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"AD_TABLE"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 56:                             <span class='def-ClassKeyword def-Keyword'>String</span> rightSelect <span class='def-Symbol'>=</span> result<span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"AD_SELECT"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 57:                             <span class='def-ClassKeyword def-Keyword'>String</span> rightUpdate <span class='def-Symbol'>=</span> result<span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"AD_UPDATE"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 58:                             <span class='def-ClassKeyword def-Keyword'>String</span> rightInsert <span class='def-Symbol'>=</span> result<span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"AD_INSERT"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 59:                             <span class='def-ClassKeyword def-Keyword'>String</span> rightDelete <span class='def-Symbol'>=</span> result<span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"AD_DELETE"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 60:                             TableUser tableUser <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> TableUser<span class='def-Symbol'>(</span>userName<span class='def-Symbol'>,</span> <span class='def-String'>"Y"</span><span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span>rightSelect<span class='def-Symbol'>)</span><span class='def-Symbol'>,</span> <span class='def-String'>"Y"</span><span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span>rightUpdate<span class='def-Symbol'>)</span><span class='def-Symbol'>,</span> <span class='def-String'>"Y"</span><span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span>rightInsert<span class='def-Symbol'>)</span><span class='def-Symbol'>,</span> <span class='def-String'>"Y"</span><span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span>rightDelete<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 61:                             tableQuery<span class='def-Symbol'>.</span>addUser<span class='def-Symbol'>(</span>tableUser<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 62:                         <span class='def-SymbolStrong def-Symbol'>}</span>
 63:                         result<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 64:                         statement<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 65:                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 66:                         ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 67:                     <span class='def-SymbolStrong def-Symbol'>}</span>
 68:                     <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 69:                         connection<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 70:                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 71:                         ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 72:                     <span class='def-SymbolStrong def-Symbol'>}</span>
 73:                     <span class='def-ClassKeyword def-Keyword'>String</span> keyField<span class='def-SymbolStrong def-Symbol'>;</span>
 74:                     <span class='def-TypeKeyword def-Keyword'>int</span> index <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>1</span><span class='def-SymbolStrong def-Symbol'>;</span>
 75:                     <span class='def-Keyword'>while</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>(</span>keyField <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='def-String'>".key."</span> <span class='def-Symbol'>+</span> index<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 76:                          tableQuery<span class='def-Symbol'>.</span>addKey<span class='def-Symbol'>(</span>keyField<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 77:                          index<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>;</span>
 78:                     <span class='def-SymbolStrong def-Symbol'>}</span>
 79:                     <span class='def-ClassKeyword def-Keyword'>String</span> hiddenField<span class='def-SymbolStrong def-Symbol'>;</span>
 80:                     index <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>1</span><span class='def-SymbolStrong def-Symbol'>;</span>
 81:                     <span class='def-Keyword'>while</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>(</span>hiddenField <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='def-String'>".hidden."</span> <span class='def-Symbol'>+</span> index<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 82:                          tableQuery<span class='def-Symbol'>.</span>addHidden<span class='def-Symbol'>(</span>hiddenField<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 83:                          index<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>;</span>
 84:                     <span class='def-SymbolStrong def-Symbol'>}</span>
 85:                 <span class='def-SymbolStrong def-Symbol'>}</span>
 86:             <span class='def-SymbolStrong def-Symbol'>}</span>
 87:             <span class='def-Keyword'>return</span> tableQuery<span class='def-SymbolStrong def-Symbol'>;</span>
 88:         <span class='def-SymbolStrong def-Symbol'>}</span>
 89:         <span class='def-Keyword'>return</span> <span class='def-Keyword'>null</span><span class='def-SymbolStrong def-Symbol'>;</span>
 90:     <span class='def-SymbolStrong def-Symbol'>}</span>
 91: 
 92:     <span class='java-KeywordModifier def-Keyword'>public</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>Vector</span> getForm<span class='def-Symbol'>(</span>ServerSSVT ssvt<span class='def-Symbol'>,</span> HttpUser user<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span> attributes<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 93:         <span class='def-ClassKeyword def-Keyword'>String</span> action <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span><span class='def-String'>"action"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 94:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>action <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-Keyword'>return</span> getRecords<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> user<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 95:         <span class='def-Keyword'>return</span> getFormRecord<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> user<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
 96:     <span class='def-SymbolStrong def-Symbol'>}</span>
 97: 
 98:     <span class='java-KeywordModifier def-Keyword'>public</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>Vector</span> handlePost<span class='def-Symbol'>(</span>ServerSSVT ssvt<span class='def-Symbol'>,</span> HttpUser user<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span> attributes<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 99:         <span class='def-ClassKeyword def-Keyword'>String</span> action <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span><span class='def-String'>"action"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
100:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>action <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-Keyword'>return</span> <span class='def-Keyword'>null</span><span class='def-SymbolStrong def-Symbol'>;</span>
101:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>action<span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span><span class='def-String'>"add"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-Keyword'>return</span> insertRecord<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> user<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
102:         <span class='def-Keyword'>else</span> <span class='def-Keyword'>return</span> updateRecord<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> user<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
103:     <span class='def-SymbolStrong def-Symbol'>}</span>
104: 
105:     <span class='java-KeywordModifier def-Keyword'>protected</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>String</span> getRecordsSQL<span class='def-Symbol'>(</span>ServerSSVT ssvt<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>String</span> tableName<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
106:         <span class='def-ClassKeyword def-Keyword'>String</span> sql <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"getRecords"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
107:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>sql <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> sql <span class='def-Symbol'>=</span> <span class='def-String'>"select * from "</span> <span class='def-Symbol'>+</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span><span class='def-String'>"schema"</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> tableName<span class='def-SymbolStrong def-Symbol'>;</span>
108:         <span class='def-Keyword'>return</span> sql<span class='def-SymbolStrong def-Symbol'>;</span>
109:     <span class='def-SymbolStrong def-Symbol'>}</span>
110: 
111:     <span class='java-KeywordModifier def-Keyword'>protected</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-TypeKeyword def-Keyword'>boolean</span> insertLinksToHTML<span class='def-Symbol'>(</span>HttpUser user<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
112:         <span class='def-TypeKeyword def-Keyword'>boolean</span> insertLinks<span class='def-SymbolStrong def-Symbol'>;</span>
113:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>user <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
114:             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>isAdministrator<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>|</span><span class='def-Symbol'>|</span> <span class='def-Symbol'>(</span><span class='def-Keyword'>true</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
115:                 insertLinks <span class='def-Symbol'>=</span> <span class='def-Keyword'>true</span><span class='def-SymbolStrong def-Symbol'>;</span>
116:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
117:                 insertLinks <span class='def-Symbol'>=</span> <span class='def-Keyword'>true</span><span class='def-SymbolStrong def-Symbol'>;</span>
118:             <span class='def-SymbolStrong def-Symbol'>}</span>
119:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
120:             insertLinks <span class='def-Symbol'>=</span> <span class='def-Keyword'>true</span><span class='def-SymbolStrong def-Symbol'>;</span>
121:         <span class='def-SymbolStrong def-Symbol'>}</span>
122:         <span class='def-Keyword'>return</span> insertLinks<span class='def-SymbolStrong def-Symbol'>;</span>
123:     <span class='def-SymbolStrong def-Symbol'>}</span>
124: 
125:     <span class='java-KeywordModifier def-Keyword'>private</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>Vector</span> insertRecord<span class='def-Symbol'>(</span>ServerSSVT ssvt<span class='def-Symbol'>,</span> HttpUser user<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span> attributes<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
126:         attributes<span class='def-Symbol'>.</span>put<span class='def-Symbol'>(</span><span class='def-String'>"nocache"</span><span class='def-Symbol'>,</span> <span class='def-String'>"yes"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
127:         TableQuery tableQuery <span class='def-Symbol'>=</span> initFields<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
128:         <span class='def-ClassKeyword def-Keyword'>String</span> tableName <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
129:         <span class='def-ClassKeyword def-Keyword'>String</span> resultMessage<span class='def-SymbolStrong def-Symbol'>;</span>
130:         <span class='def-TypeKeyword def-Keyword'>boolean</span> execute <span class='def-Symbol'>=</span> <span class='def-Keyword'>false</span><span class='def-SymbolStrong def-Symbol'>;</span>
131: 
132:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>isAdministrator<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>|</span><span class='def-Symbol'>|</span> tableQuery<span class='def-Symbol'>.</span>getUser<span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>getId<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getInsert<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
133:             <span class='def-ClassKeyword def-Keyword'>Connection</span> connection <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getConnection<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
134:             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>connection <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
135:                 <span class='def-LineComment def-Comment def-Syntax'>// Сформировать SQL запрос</span>
136:                 <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> sql <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span><span class='def-String'>"insert into "</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span><span class='def-String'>"schema"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'.'</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>tableName<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>" ("</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
137:                 <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> values <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span><span class='def-String'>"("</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
138:                 <span class='def-TypeKeyword def-Keyword'>int</span> index <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>;</span>
139:                 <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Enumeration</span> enumeration <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getSequence<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>elements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> enumeration<span class='def-Symbol'>.</span>hasMoreElements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> <span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
140:                     <span class='def-ClassKeyword def-Keyword'>Field</span> field <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>)</span> enumeration<span class='def-Symbol'>.</span>nextElement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
141:                     <span class='def-ClassKeyword def-Keyword'>String</span> name <span class='def-Symbol'>=</span> field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
142:                     <span class='def-ClassKeyword def-Keyword'>String</span> value <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> 
143:                     <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>value <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
144:                         <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
145:                             value <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> user<span class='def-Symbol'>.</span>getAttribute<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
146:                         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
147:                         <span class='def-SymbolStrong def-Symbol'>}</span>
148:                     <span class='def-SymbolStrong def-Symbol'>}</span>
149:                     <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>value <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
150:                         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>index <span class='def-Symbol'>></span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
151:                             sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>", "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
152:                             values<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>", "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
153:                         <span class='def-SymbolStrong def-Symbol'>}</span>
154:                         sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
155:                         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>value<span class='def-Symbol'>.</span>length<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>)</span> values<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"NULL"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
156:                         <span class='def-Keyword'>else</span> values<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>getValueField<span class='def-Symbol'>(</span>field<span class='def-Symbol'>,</span> value<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
157:                         index<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>;</span>
158:                     <span class='def-SymbolStrong def-Symbol'>}</span>
159:                 <span class='def-SymbolStrong def-Symbol'>}</span>
160:                 sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>") values "</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>values<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>")"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
161:                 ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>getId<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='def-String'>": "</span> <span class='def-Symbol'>+</span> sql<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
162:                 <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
163:                     <span class='def-ClassKeyword def-Keyword'>Statement</span> statement <span class='def-Symbol'>=</span> connection<span class='def-Symbol'>.</span>createStatement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
164:                     statement<span class='def-Symbol'>.</span>execute<span class='def-Symbol'>(</span>sql<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
165:                     statement<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
166:                     resultMessage <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"database.insertOk"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
167:                     execute <span class='def-Symbol'>=</span> <span class='def-Keyword'>true</span><span class='def-SymbolStrong def-Symbol'>;</span>
168:                 <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
169:                     resultMessage <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"database.executeError"</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> e<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
170:                     ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
171:                 <span class='def-SymbolStrong def-Symbol'>}</span>
172:                 <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
173:                     connection<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
174:                 <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
175:                     ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
176:                 <span class='def-SymbolStrong def-Symbol'>}</span>
177:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
178:                 resultMessage <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"database.connectError"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
179:             <span class='def-SymbolStrong def-Symbol'>}</span>
180:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
181:             resultMessage <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"database.notRights"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
182:         <span class='def-SymbolStrong def-Symbol'>}</span>
183: 
184:         <span class='def-ClassKeyword def-Keyword'>String</span> title <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"addRecordTitle"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
185:         <span class='def-Keyword'>return</span> getHtmlResultPage<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> tableQuery<span class='def-Symbol'>,</span> user<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>,</span> title<span class='def-Symbol'>,</span> resultMessage<span class='def-Symbol'>,</span> execute<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
186:     <span class='def-SymbolStrong def-Symbol'>}</span>
187: 
188: 
189:     <span class='java-KeywordModifier def-Keyword'>private</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>Vector</span> updateRecord<span class='def-Symbol'>(</span>ServerSSVT ssvt<span class='def-Symbol'>,</span> HttpUser user<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span> attributes<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
190:         attributes<span class='def-Symbol'>.</span>put<span class='def-Symbol'>(</span><span class='def-String'>"nocache"</span><span class='def-Symbol'>,</span> <span class='def-String'>"yes"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
191:         TableQuery tableQuery <span class='def-Symbol'>=</span> initFields<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
192:         <span class='def-ClassKeyword def-Keyword'>String</span> tableName <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
193:         <span class='def-LineComment def-Comment def-Syntax'>// Получить вектор ключевых полей</span>
194:         <span class='def-ClassKeyword def-Keyword'>Vector</span> keys <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getKeys<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
195:         <span class='def-TypeKeyword def-Keyword'>boolean</span> execute <span class='def-Symbol'>=</span> <span class='def-Keyword'>false</span><span class='def-SymbolStrong def-Symbol'>;</span>
196:         <span class='def-ClassKeyword def-Keyword'>String</span> resultMessage <span class='def-Symbol'>=</span> <span class='def-String'>""</span><span class='def-SymbolStrong def-Symbol'>;</span>
197:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span><span class='def-String'>"delRecord"</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
198:             <span class='def-LineComment def-Comment def-Syntax'>// Выполнить UPDATE записи</span>
199:             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>isAdministrator<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>|</span><span class='def-Symbol'>|</span> tableQuery<span class='def-Symbol'>.</span>getUser<span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>getId<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getUpdate<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
200:                 <span class='def-ClassKeyword def-Keyword'>Connection</span> connection <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getConnection<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
201:                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>connection <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
202:                     <span class='def-LineComment def-Comment def-Syntax'>// Сформировать SQL запрос</span>
203:                     <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> sql <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span><span class='def-String'>"update "</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span><span class='def-String'>"schema"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'.'</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>tableName<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>" set "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
204:                     <span class='def-LineComment def-Comment def-Syntax'>// Установить значения изменяемых полей</span>
205:                     <span class='def-TypeKeyword def-Keyword'>int</span> index <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>;</span>
206:                     <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Enumeration</span> e <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getSequence<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>elements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> e<span class='def-Symbol'>.</span>hasMoreElements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> <span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
207:                         <span class='def-ClassKeyword def-Keyword'>Field</span> field <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>)</span> e<span class='def-Symbol'>.</span>nextElement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
208:                         <span class='def-ClassKeyword def-Keyword'>String</span> name <span class='def-Symbol'>=</span> field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
209:                         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>!</span>keys<span class='def-Symbol'>.</span>contains<span class='def-Symbol'>(</span>field<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
210:                             <span class='def-ClassKeyword def-Keyword'>String</span> value <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span>field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
211:                             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>value <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
212:                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>index <span class='def-Symbol'>></span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>)</span> sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>", "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
213:                                 sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'='</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
214:                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>value<span class='def-Symbol'>.</span>length<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>)</span> sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"NULL"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
215:                                 <span class='def-Keyword'>else</span> sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>getValueField<span class='def-Symbol'>(</span>field<span class='def-Symbol'>,</span> value<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
216:                                 index<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>;</span>
217:                             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
218: <span class='def-LineComment def-Comment def-Syntax'>//</span>
219:                                 <span class='def-ClassKeyword def-Keyword'>String</span> keyField <span class='def-Symbol'>=</span> tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"FORM"</span> <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> name<span class='def-SymbolStrong def-Symbol'>;</span>
220:                                 <span class='def-ClassKeyword def-Keyword'>String</span> objectName <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>keyField<span class='def-Symbol'>,</span> <span class='def-String'>"INPUT"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
221:                                 <span class='def-ClassKeyword def-Keyword'>String</span> type <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>keyField <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"TYPE"</span><span class='def-Symbol'>,</span> <span class='def-String'>"TEXT"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
222:                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-String'>"CHECKBOX"</span><span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span>type<span class='def-Symbol'>)</span> <span class='def-Symbol'>&amp;</span><span class='def-Symbol'>&amp;</span> objectName<span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span><span class='def-String'>"INPUT"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
223:                                     <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>index <span class='def-Symbol'>></span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>)</span> sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>", "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
224:                                     sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'='</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
225:                                     <span class='def-ClassKeyword def-Keyword'>String</span> defaultValue <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"FORM"</span> <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"CHECKBOX"</span> <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"DEFAULT"</span><span class='def-Symbol'>,</span> <span class='def-String'>"NO"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
226:                                     <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-String'>"NULL"</span><span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span>defaultValue<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"null"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
227:                                     <span class='def-Keyword'>else</span> sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>getValueField<span class='def-Symbol'>(</span>field<span class='def-Symbol'>,</span> defaultValue<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
228:                                     index<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>;</span>
229:                                 <span class='def-SymbolStrong def-Symbol'>}</span> 
230: <span class='def-LineComment def-Comment def-Syntax'>//</span>
231:                             <span class='def-SymbolStrong def-Symbol'>}</span>
232:                         <span class='def-SymbolStrong def-Symbol'>}</span>
233:                     <span class='def-SymbolStrong def-Symbol'>}</span>
234:                     <span class='def-LineComment def-Comment def-Syntax'>// Установить значения уникальных полей</span>
235:                     sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>" where "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
236:                     addKeyFieldsToSQL<span class='def-Symbol'>(</span>keys<span class='def-Symbol'>,</span> sql<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
237:                     <span class='def-LineComment def-Comment def-Syntax'>// Выполнить сформированный запрос</span>
238:                     ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>getId<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='def-String'>": "</span> <span class='def-Symbol'>+</span> sql<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
239:                     <span class='def-TypeKeyword def-Keyword'>int</span> updateRecords <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>;</span>
240:                     <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>index <span class='def-Symbol'>></span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
241:                         <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
242:                             <span class='def-ClassKeyword def-Keyword'>Statement</span> statement <span class='def-Symbol'>=</span> connection<span class='def-Symbol'>.</span>createStatement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
243:                             updateRecords <span class='def-Symbol'>=</span> statement<span class='def-Symbol'>.</span>executeUpdate<span class='def-Symbol'>(</span>sql<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
244:                             statement<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
245:                             <span class='def-Keyword'>switch</span> <span class='def-Symbol'>(</span>updateRecords<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
246:                                 <span class='def-Keyword'>case</span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>:</span> resultMessage <span class='def-Symbol'>=</span> <span class='def-String'>"Запись не изменена."</span><span class='def-SymbolStrong def-Symbol'>;</span>
247:                                         <span class='def-Keyword'>break</span><span class='def-SymbolStrong def-Symbol'>;</span>
248:                                 <span class='def-Keyword'>case</span> <span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>:</span> resultMessage <span class='def-Symbol'>=</span> <span class='def-String'>"Операция редактирования записи выполнена успешно."</span><span class='def-SymbolStrong def-Symbol'>;</span>
249:                                         execute <span class='def-Symbol'>=</span> <span class='def-Keyword'>true</span><span class='def-SymbolStrong def-Symbol'>;</span>
250:                                         <span class='def-Keyword'>break</span><span class='def-SymbolStrong def-Symbol'>;</span>
251:                                 <span class='def-Keyword'>default</span><span class='def-Symbol'>:</span> resultMessage <span class='def-Symbol'>=</span> <span class='def-String'>"Изменено "</span> <span class='def-Symbol'>+</span> updateRecords <span class='def-Symbol'>+</span> <span class='def-String'>" записей."</span><span class='def-SymbolStrong def-Symbol'>;</span>
252:                             <span class='def-SymbolStrong def-Symbol'>}</span>
253:                         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
254:                             resultMessage <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"database.executeError"</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> e<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
255:                             ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
256:                         <span class='def-SymbolStrong def-Symbol'>}</span>
257:                     <span class='def-SymbolStrong def-Symbol'>}</span>
258:                     <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
259:                         connection<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
260:                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
261:                         ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
262:                     <span class='def-SymbolStrong def-Symbol'>}</span>
263:                 <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
264:                     resultMessage <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"database.connectError"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
265:                 <span class='def-SymbolStrong def-Symbol'>}</span>
266:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
267:                 resultMessage <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"database.notRights"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
268:             <span class='def-SymbolStrong def-Symbol'>}</span>
269:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
270:             <span class='def-LineComment def-Comment def-Syntax'>// Удалить запись</span>
271:             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>isAdministrator<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>|</span><span class='def-Symbol'>|</span> tableQuery<span class='def-Symbol'>.</span>getUser<span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>getId<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getDelete<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
272:                 <span class='def-ClassKeyword def-Keyword'>Connection</span> connection <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getConnection<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
273:                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>connection <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
274:                     <span class='def-LineComment def-Comment def-Syntax'>// Сформировать SQL запрос</span>
275:                     <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> sql <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span><span class='def-String'>"delete from "</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span><span class='def-String'>"schema"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'.'</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>tableName<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>" where "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
276:                     addKeyFieldsToSQL<span class='def-Symbol'>(</span>keys<span class='def-Symbol'>,</span> sql<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
277:                     <span class='def-LineComment def-Comment def-Syntax'>// Выполнить сформированный запрос</span>
278:                     ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>getId<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='def-String'>": "</span> <span class='def-Symbol'>+</span> sql<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
279:                     <span class='def-TypeKeyword def-Keyword'>int</span> deleteRecords <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>;</span>
280:                     <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
281:                         <span class='def-ClassKeyword def-Keyword'>Statement</span> statement <span class='def-Symbol'>=</span> connection<span class='def-Symbol'>.</span>createStatement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
282:                         deleteRecords <span class='def-Symbol'>=</span> statement<span class='def-Symbol'>.</span>executeUpdate<span class='def-Symbol'>(</span>sql<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
283:                         statement<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
284:                         <span class='def-Keyword'>switch</span> <span class='def-Symbol'>(</span>deleteRecords<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
285:                             <span class='def-Keyword'>case</span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>:</span> resultMessage <span class='def-Symbol'>=</span> <span class='def-String'>"Запись не удалена"</span><span class='def-SymbolStrong def-Symbol'>;</span>
286:                                     <span class='def-Keyword'>break</span><span class='def-SymbolStrong def-Symbol'>;</span>
287:                             <span class='def-Keyword'>case</span> <span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>:</span> resultMessage <span class='def-Symbol'>=</span> <span class='def-String'>"Операция удаления записи выполнена успешно."</span><span class='def-SymbolStrong def-Symbol'>;</span>
288:                                     execute <span class='def-Symbol'>=</span> <span class='def-Keyword'>true</span><span class='def-SymbolStrong def-Symbol'>;</span>
289:                                     <span class='def-Keyword'>break</span><span class='def-SymbolStrong def-Symbol'>;</span>
290:                             <span class='def-Keyword'>default</span><span class='def-Symbol'>:</span> resultMessage <span class='def-Symbol'>=</span> <span class='def-String'>"Удалено "</span> <span class='def-Symbol'>+</span> deleteRecords <span class='def-Symbol'>+</span> <span class='def-String'>" записей."</span><span class='def-SymbolStrong def-Symbol'>;</span>
291:                         <span class='def-SymbolStrong def-Symbol'>}</span>
292:                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
293:                         resultMessage <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"database.executeError"</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> e<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
294:                         ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
295:                     <span class='def-SymbolStrong def-Symbol'>}</span>
296:                     <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
297:                         connection<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
298:                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
299:                         ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
300:                     <span class='def-SymbolStrong def-Symbol'>}</span>
301:                 <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
302:                     resultMessage <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"database.connectError"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
303:                 <span class='def-SymbolStrong def-Symbol'>}</span>
304:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
305:                 resultMessage <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"database.notRights"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
306:             <span class='def-SymbolStrong def-Symbol'>}</span>
307:         <span class='def-SymbolStrong def-Symbol'>}</span>
308: 
309:         <span class='def-ClassKeyword def-Keyword'>String</span> title<span class='def-SymbolStrong def-Symbol'>;</span>
310:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span><span class='def-String'>"delRecord"</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
311:             title <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"editRecordTitle"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
312:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
313:             title <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"deleteRecordTitle"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
314:         <span class='def-SymbolStrong def-Symbol'>}</span>
315:         <span class='def-Keyword'>return</span> getHtmlResultPage<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> tableQuery<span class='def-Symbol'>,</span> user<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>,</span> title<span class='def-Symbol'>,</span> resultMessage<span class='def-Symbol'>,</span> execute<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
316:     <span class='def-SymbolStrong def-Symbol'>}</span>
317: 
318:     <span class='java-KeywordModifier def-Keyword'>public</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>Vector</span> getFormRecord<span class='def-Symbol'>(</span>ServerSSVT ssvt<span class='def-Symbol'>,</span> HttpUser user<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span> attributes<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
319:         attributes<span class='def-Symbol'>.</span>put<span class='def-Symbol'>(</span><span class='def-String'>"nocache"</span><span class='def-Symbol'>,</span> <span class='def-String'>"yes"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
320:         <span class='def-ClassKeyword def-Keyword'>Vector</span> form <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>Vector</span><span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
321:         <span class='def-ClassKeyword def-Keyword'>Hashtable</span> values <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span><span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
322:         TableQuery tableQuery <span class='def-Symbol'>=</span> initFields<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
323:         <span class='def-ClassKeyword def-Keyword'>String</span> tableName <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
324:         <span class='def-ClassKeyword def-Keyword'>String</span> startName <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"startName"</span><span class='def-Symbol'>,</span> <span class='def-String'>""</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
325:         <span class='def-LineComment def-Comment def-Syntax'>// Получить вектор ключевых полей</span>
326:         <span class='def-ClassKeyword def-Keyword'>Vector</span> keys <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getKeys<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
327:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;html>&lt;head>&lt;title>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
328:         <span class='def-ClassKeyword def-Keyword'>String</span> action <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span><span class='def-String'>"action"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
329:         <span class='def-ClassKeyword def-Keyword'>String</span> title<span class='def-SymbolStrong def-Symbol'>;</span>
330:         <span class='def-TypeKeyword def-Keyword'>boolean</span> add <span class='def-Symbol'>=</span> <span class='def-String'>"add"</span><span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span>action<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
331:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>add<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
332:             title <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"addRecordTitle"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
333:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
334:             title <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"editRecordTitle"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
335:         <span class='def-SymbolStrong def-Symbol'>}</span>
336:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>title<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
337:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/title>&lt;/head>&lt;body>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
338:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;center>&lt;h1>"</span> <span class='def-Symbol'>+</span> title <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;/h1>&lt;/center>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
339: 
340:         <span class='def-ClassKeyword def-Keyword'>String</span> uri <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span><span class='def-String'>"uri"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
341:         <span class='def-ClassKeyword def-Keyword'>String</span> actionForm <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"actionForm"</span><span class='def-Symbol'>,</span> uri<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
342:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;form method=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>POST</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> action=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span> <span class='def-Symbol'>+</span> actionForm <span class='def-Symbol'>+</span><span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
343: 
344:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>!</span>add<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
345:             <span class='def-LineComment def-Comment def-Syntax'>// Получить запись по уникальному ключу</span>
346:             <span class='def-ClassKeyword def-Keyword'>Connection</span> connection <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getConnection<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
347:             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>connection <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
348:                 <span class='def-LineComment def-Comment def-Syntax'>// Сформировать SQL запрос</span>
349: <span class='def-LineComment def-Comment def-Syntax'>//                StringBuffer sql = new StringBuffer(ssvt.getProperty(tableName + '.' + "getRecords"));</span>
350:                 <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> sql <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span>getRecordsSQL<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> tableName<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
351:                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>keys<span class='def-Symbol'>.</span>size<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>></span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
352:                     sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>" where "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
353:                     addKeyFieldsToSQL<span class='def-Symbol'>(</span>keys<span class='def-Symbol'>,</span> sql<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
354:                     <span class='def-LineComment def-Comment def-Syntax'>// Выполнить сформированный запрос и занести значения полей в [values]</span>
355:                     ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>getId<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='def-String'>": "</span> <span class='def-Symbol'>+</span> sql<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
356:                     <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
357:                         <span class='def-ClassKeyword def-Keyword'>PreparedStatement</span> statement <span class='def-Symbol'>=</span> connection<span class='def-Symbol'>.</span>prepareStatement<span class='def-Symbol'>(</span>sql<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
358:                         <span class='def-ClassKeyword def-Keyword'>ResultSet</span> record <span class='def-Symbol'>=</span> statement<span class='def-Symbol'>.</span>executeQuery<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
359:                         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>record<span class='def-Symbol'>.</span>next<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
360:                             <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Enumeration</span> e <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getSequence<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>elements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> e<span class='def-Symbol'>.</span>hasMoreElements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> <span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
361:                                 <span class='def-ClassKeyword def-Keyword'>Field</span> field <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>)</span> e<span class='def-Symbol'>.</span>nextElement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
362:                                 <span class='def-ClassKeyword def-Keyword'>String</span> value <span class='def-Symbol'>=</span> record<span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
363:                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>value <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> 
364:                                     values<span class='def-Symbol'>.</span>put<span class='def-Symbol'>(</span>field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>,</span> value<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
365:                             <span class='def-SymbolStrong def-Symbol'>}</span>
366:                         <span class='def-SymbolStrong def-Symbol'>}</span>
367:                         record<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
368:                         statement<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
369:                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
370:                         ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
371:                     <span class='def-SymbolStrong def-Symbol'>}</span>
372:                 <span class='def-SymbolStrong def-Symbol'>}</span>
373:                 <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
374:                     connection<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
375:                 <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
376:                     ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
377:                 <span class='def-SymbolStrong def-Symbol'>}</span>
378:             <span class='def-SymbolStrong def-Symbol'>}</span>
379:         <span class='def-SymbolStrong def-Symbol'>}</span>
380: 
381:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>!</span>add <span class='def-Symbol'>&amp;</span><span class='def-Symbol'>&amp;</span> <span class='def-Symbol'>(</span>values<span class='def-Symbol'>.</span>size<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
382:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"Запись для редактирования не найдена."</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
383:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
384:             <span class='def-LineComment def-Comment def-Syntax'>// Вставить в форму невидимые поля </span>
385:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;INPUT TYPE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>HIDDEN</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> NAME=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>table</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> VALUE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span> <span class='def-Symbol'>+</span> tableName <span class='def-Symbol'>+</span> <span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
386:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;INPUT TYPE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>HIDDEN</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> NAME=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>action</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> VALUE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span> <span class='def-Symbol'>+</span> action <span class='def-Symbol'>+</span> <span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
387: 
388:             <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> buf<span class='def-SymbolStrong def-Symbol'>;</span>
389:             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>!</span>add<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
390:                 <span class='def-LineComment def-Comment def-Syntax'>// Вставить в форму невидимые поля уникального ключа при редактировании записи</span>
391:                 <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Enumeration</span> e <span class='def-Symbol'>=</span> keys<span class='def-Symbol'>.</span>elements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> e<span class='def-Symbol'>.</span>hasMoreElements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> <span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
392:                     <span class='def-ClassKeyword def-Keyword'>Field</span> field <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>)</span> e<span class='def-Symbol'>.</span>nextElement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
393:                     <span class='def-ClassKeyword def-Keyword'>String</span> name <span class='def-Symbol'>=</span> field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
394:                     buf <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span><span class='def-String'>"&lt;INPUT TYPE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>HIDDEN</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> NAME=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> VALUE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>values<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
395:                     form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>buf<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
396:                 <span class='def-SymbolStrong def-Symbol'>}</span>
397:             <span class='def-SymbolStrong def-Symbol'>}</span>
398: 
399:             <span class='def-ClassKeyword def-Keyword'>String</span> checkValue <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span><span class='def-String'>"FORM"</span> <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"CHECKBOX"</span> <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"VALUE"</span><span class='def-Symbol'>,</span> <span class='def-String'>"YES"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
400:             <span class='def-LineComment def-Comment def-Syntax'>// Вставить в форму редактируемые поля записи</span>
401:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;table>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
402:             <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Enumeration</span> e <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getSequence<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>elements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> e<span class='def-Symbol'>.</span>hasMoreElements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> <span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
403:                 <span class='def-ClassKeyword def-Keyword'>Field</span> field <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>)</span> e<span class='def-Symbol'>.</span>nextElement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
404:                 <span class='def-ClassKeyword def-Keyword'>String</span> name <span class='def-Symbol'>=</span> field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
405:                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>!</span>tableQuery<span class='def-Symbol'>.</span>isHiddenField<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span> <span class='def-Symbol'>&amp;</span><span class='def-Symbol'>&amp;</span> <span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>getAttribute<span class='def-Symbol'>(</span>name<span class='def-Symbol'>.</span>substring<span class='def-Symbol'>(</span>startName<span class='def-Symbol'>.</span>length<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
406:                     <span class='def-ClassKeyword def-Keyword'>String</span> keyField <span class='def-Symbol'>=</span> tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"FORM"</span> <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> name<span class='def-SymbolStrong def-Symbol'>;</span>
407:                     <span class='def-ClassKeyword def-Keyword'>String</span> addField <span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-SymbolStrong def-Symbol'>;</span>
408:                     buf <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span><span class='def-String'>"&lt;tr>&lt;td>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
409:                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> name<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/td>&lt;td>"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&amp;nbsp;"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/td>&lt;td>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
410:                     <span class='def-ClassKeyword def-Keyword'>String</span> valueField <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> values<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
411:                     <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>keys<span class='def-Symbol'>.</span>contains<span class='def-Symbol'>(</span>field<span class='def-Symbol'>)</span> <span class='def-Symbol'>&amp;</span><span class='def-Symbol'>&amp;</span> <span class='def-Symbol'>!</span>add<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
412:                         <span class='def-LineComment def-Comment def-Syntax'>// При редактировании  поле уникального ключа недоступно для редактирования</span>
413:                         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>valueField <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
414:                             buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;B>"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>valueField<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/B>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
415:                         <span class='def-SymbolStrong def-Symbol'>}</span>
416:                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
417:                         <span class='def-ClassKeyword def-Keyword'>String</span> objectName <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>keyField<span class='def-Symbol'>,</span> <span class='def-String'>"INPUT"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
418:                         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>objectName<span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span><span class='def-String'>"INPUT"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
419:                             buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;INPUT TYPE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
420:                             <span class='def-ClassKeyword def-Keyword'>String</span> type <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>keyField <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"TYPE"</span><span class='def-Symbol'>,</span> <span class='def-String'>"TEXT"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
421:                             buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>type<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> NAME=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> VALUE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
422:                             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-String'>"TEXT"</span><span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span>type<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
423:                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>valueField <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
424:                                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>valueField<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
425:                                 <span class='def-SymbolStrong def-Symbol'>}</span>
426:                                 buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> MAXLENGTH=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
427:                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>field<span class='def-Symbol'>.</span>getSize<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>></span> <span class='def-NumberDec def-Number'>64</span><span class='def-Symbol'>)</span> buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-NumberDec def-Number'>64</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
428:                                 <span class='def-Keyword'>else</span> buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>field<span class='def-Symbol'>.</span>getSize<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
429:                                 buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> SIZE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>field<span class='def-Symbol'>.</span>getSize<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'\"'</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
430:                             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
431:                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-String'>"CHECKBOX"</span><span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span>type<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
432:                                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>checkValue<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
433:                                     <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>(</span>valueField <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>&amp;</span><span class='def-Symbol'>&amp;</span> valueField<span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span>checkValue<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
434:                                         buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>" CHECKED"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
435:                                     <span class='def-SymbolStrong def-Symbol'>}</span>
436:                                 <span class='def-SymbolStrong def-Symbol'>}</span> 
437:                             <span class='def-SymbolStrong def-Symbol'>}</span>
438:                             buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'>'</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
439:                         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
440:                             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>objectName<span class='def-Symbol'>.</span>equals<span class='def-Symbol'>(</span><span class='def-String'>"SELECT"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
441:                                 addField <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>keyField <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"ADD"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
442:                                 buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;SELECT "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
443:                                 buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"NAME=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
444:                                 buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>">"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
445:                                 <span class='def-ClassKeyword def-Keyword'>Connection</span> connection <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getConnection<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
446:                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>connection <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
447:                                     <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
448:                                         <span class='def-ClassKeyword def-Keyword'>String</span> sql <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>keyField <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"OPTIONS"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
449:                                         <span class='def-ClassKeyword def-Keyword'>Statement</span> statement <span class='def-Symbol'>=</span> connection<span class='def-Symbol'>.</span>createStatement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
450:                                         <span class='def-ClassKeyword def-Keyword'>ResultSet</span> result <span class='def-Symbol'>=</span> statement<span class='def-Symbol'>.</span>executeQuery<span class='def-Symbol'>(</span>sql<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
451:                                         <span class='def-Keyword'>while</span> <span class='def-Symbol'>(</span>result<span class='def-Symbol'>.</span>next<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
452:                                             buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;OPTION>"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>result<span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
453:                                         <span class='def-SymbolStrong def-Symbol'>}</span>
454:                                         result<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
455:                                         statement<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
456:                                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> sql<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
457:                                         ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>sql<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
458:                                     <span class='def-SymbolStrong def-Symbol'>}</span>
459:                                     <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
460:                                         connection<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
461:                                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> sql<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
462:                                         ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>sql<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
463:                                     <span class='def-SymbolStrong def-Symbol'>}</span>
464:                                 <span class='def-SymbolStrong def-Symbol'>}</span>
465:                                 buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/SELECT>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
466:                             <span class='def-SymbolStrong def-Symbol'>}</span>
467:                         <span class='def-SymbolStrong def-Symbol'>}</span>
468:                     <span class='def-SymbolStrong def-Symbol'>}</span>
469:                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;td>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
470:                     <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>addField <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
471:                         buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;INPUT TYPE=SUBMIT NAME=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span> <span class='def-Symbol'>+</span> addField <span class='def-Symbol'>+</span> <span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> VALUE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>Изменить</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
472:                         buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;INPUT TYPE=SUBMIT NAME=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span> <span class='def-Symbol'>+</span> keyField <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"ADD"</span> <span class='def-Symbol'>+</span> <span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> VALUE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>Изменить</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
473:                     <span class='def-SymbolStrong def-Symbol'>}</span> 
474:                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/td>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
475:                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/td>&lt;/tr>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
476:                     form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>buf<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
477:                 <span class='def-SymbolStrong def-Symbol'>}</span>
478:             <span class='def-SymbolStrong def-Symbol'>}</span>
479: 
480:             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>!</span>add<span class='def-Symbol'>)</span> form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;tr>&lt;td>"</span> <span class='def-Symbol'>+</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"deleteRecord"</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;/td>&lt;td>"</span> <span class='def-Symbol'>+</span> <span class='def-String'>"&amp;nbsp;"</span> <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;/td>&lt;td>"</span> <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;INPUT TYPE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>CHECKBOX</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> NAME=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>delRecord</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> VALUE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span> <span class='def-Symbol'>+</span> checkValue <span class='def-Symbol'>+</span> <span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>&lt;/td>&lt;/tr>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
481:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/table>&lt;p>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
482:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;INPUT TYPE=SUBMIT NAME=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>ENTER</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'> VALUE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>Ввод</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;INPUT TYPE=RESET VALUE=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>Очистить</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>&lt;/form>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
483:         <span class='def-SymbolStrong def-Symbol'>}</span>
484:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/body>&lt;/html>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
485:         <span class='def-Keyword'>return</span> form<span class='def-SymbolStrong def-Symbol'>;</span>
486:     <span class='def-SymbolStrong def-Symbol'>}</span>
487: 
488:     <span class='java-KeywordModifier def-Keyword'>public</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>Vector</span> getRecords<span class='def-Symbol'>(</span>ServerSSVT ssvt<span class='def-Symbol'>,</span> HttpUser user<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span> attributes<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
489:         TableQuery tableQuery <span class='def-Symbol'>=</span> initFields<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
490:         <span class='def-ClassKeyword def-Keyword'>String</span> tableName <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
491:         <span class='def-ClassKeyword def-Keyword'>Vector</span> sequence <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getSequence<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
492: 
493:         <span class='def-ClassKeyword def-Keyword'>String</span> uri <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span><span class='def-String'>"uri"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
494:         <span class='def-ClassKeyword def-Keyword'>String</span> uriTable <span class='def-Symbol'>=</span> uri <span class='def-Symbol'>+</span> <span class='def-String'>"?table="</span> <span class='def-Symbol'>+</span> tableName<span class='def-SymbolStrong def-Symbol'>;</span>
495:         <span class='def-ClassKeyword def-Keyword'>String</span> addRecord <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"addRecord"</span><span class='def-Symbol'>,</span> uriTable<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
496:         <span class='def-ClassKeyword def-Keyword'>String</span> editRecord <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"editRecord"</span><span class='def-Symbol'>,</span> uriTable<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
497:         <span class='def-ClassKeyword def-Keyword'>String</span> startName <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"startName"</span><span class='def-Symbol'>,</span> <span class='def-String'>""</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
498:         <span class='def-ClassKeyword def-Keyword'>String</span> maxRecords <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"maxRecords"</span><span class='def-Symbol'>,</span> <span class='def-String'>"100"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
499:         <span class='def-TypeKeyword def-Keyword'>int</span> max<span class='def-SymbolStrong def-Symbol'>;</span>
500:         <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
501:             max <span class='def-Symbol'>=</span> <span class='def-ClassKeyword def-Keyword'>Integer</span><span class='def-Symbol'>.</span>parseInt<span class='def-Symbol'>(</span>maxRecords<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
502:             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>max <span class='def-Symbol'>&lt;</span> <span class='def-NumberDec def-Number'>50</span><span class='def-Symbol'>)</span> max <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>50</span><span class='def-SymbolStrong def-Symbol'>;</span>
503:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
504:             max <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>100</span><span class='def-SymbolStrong def-Symbol'>;</span>
505:         <span class='def-SymbolStrong def-Symbol'>}</span>
506: 
507:         <span class='def-ClassKeyword def-Keyword'>String</span> strPage <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span><span class='def-String'>"page"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
508:         <span class='def-TypeKeyword def-Keyword'>int</span> page<span class='def-SymbolStrong def-Symbol'>;</span>
509:         <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
510:             page <span class='def-Symbol'>=</span> <span class='def-ClassKeyword def-Keyword'>Integer</span><span class='def-Symbol'>.</span>parseInt<span class='def-Symbol'>(</span>strPage<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
511:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
512:             page <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>1</span><span class='def-SymbolStrong def-Symbol'>;</span>
513:         <span class='def-SymbolStrong def-Symbol'>}</span>
514: 
515: 
516:         <span class='def-TypeKeyword def-Keyword'>boolean</span> insertLinks <span class='def-Symbol'>=</span> insertLinksToHTML<span class='def-Symbol'>(</span>user<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
517: 
518:         <span class='def-ClassKeyword def-Keyword'>Vector</span> form <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>Vector</span><span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
519:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;html>&lt;head>&lt;title>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
520:         <span class='def-ClassKeyword def-Keyword'>String</span> title <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"title"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
521:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>title<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
522:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/title>&lt;/head>&lt;body>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
523: 
524: <span class='def-LineComment def-Comment def-Syntax'>//        String script = ssvt.getProperty("script");</span>
525: <span class='def-LineComment def-Comment def-Syntax'>//        if (script != null) </span>
526: <span class='def-LineComment def-Comment def-Syntax'>//            form.addElement(script);</span>
527: 
528:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;center>&lt;h1>"</span> <span class='def-Symbol'>+</span> title <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;/h1>&lt;/center>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
529: 
530:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"comment"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
531: 
532:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;center>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
533:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;table border width="</span> <span class='def-Symbol'>+</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"width"</span><span class='def-Symbol'>,</span> <span class='def-String'>"%95"</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'>'</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
534:         <span class='def-LineComment def-Comment def-Syntax'>// Вывести заголовок таблицы</span>
535:         <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> header <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span><span class='def-String'>"&lt;tr>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
536:         <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Enumeration</span> e <span class='def-Symbol'>=</span> sequence<span class='def-Symbol'>.</span>elements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> e<span class='def-Symbol'>.</span>hasMoreElements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> <span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
537:             <span class='def-ClassKeyword def-Keyword'>Field</span> field <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>)</span> e<span class='def-Symbol'>.</span>nextElement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
538:             <span class='def-ClassKeyword def-Keyword'>String</span> name <span class='def-Symbol'>=</span> field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
539:             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>!</span>tableQuery<span class='def-Symbol'>.</span>isHiddenField<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span> <span class='def-Symbol'>&amp;</span><span class='def-Symbol'>&amp;</span> <span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>getAttribute<span class='def-Symbol'>(</span>name<span class='def-Symbol'>.</span>substring<span class='def-Symbol'>(</span>startName<span class='def-Symbol'>.</span>length<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
540:                 header<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;th>"</span> <span class='def-Symbol'>+</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> name<span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;/th>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
541:             <span class='def-SymbolStrong def-Symbol'>}</span>
542:         <span class='def-SymbolStrong def-Symbol'>}</span>
543:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>header<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/tr>"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
544: 
545:         <span class='def-TypeKeyword def-Keyword'>int</span> count <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>;</span> <span class='def-LineComment def-Comment def-Syntax'>// Количество выбранных записей</span>
546:         <span class='def-LineComment def-Comment def-Syntax'>// Вывести тело таблицы</span>
547:         <span class='def-ClassKeyword def-Keyword'>Connection</span> connection <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getConnection<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
548:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>connection <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
549:             <span class='def-LineComment def-Comment def-Syntax'>// Сформировать SQL запрос</span>
550:             <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> sql <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span>getRecordsSQL<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>,</span> tableName<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
551:             <span class='def-TypeKeyword def-Keyword'>int</span> index <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>;</span>
552:             <span class='def-TypeKeyword def-Keyword'>boolean</span> whereIs <span class='def-Symbol'>=</span> <span class='def-Keyword'>false</span><span class='def-SymbolStrong def-Symbol'>;</span>
553:             <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Enumeration</span> e <span class='def-Symbol'>=</span> user<span class='def-Symbol'>.</span>getKeyAttributes<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> e<span class='def-Symbol'>.</span>hasMoreElements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> <span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
554:                 <span class='def-ClassKeyword def-Keyword'>String</span> userNameAttribute <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> e<span class='def-Symbol'>.</span>nextElement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
555:                 <span class='def-ClassKeyword def-Keyword'>Field</span> field <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>)</span> tableQuery<span class='def-Symbol'>.</span>getField<span class='def-Symbol'>(</span>startName <span class='def-Symbol'>+</span> userNameAttribute<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
556:                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>field <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
557:                     <span class='def-ClassKeyword def-Keyword'>Object</span> value <span class='def-Symbol'>=</span> user<span class='def-Symbol'>.</span>getAttribute<span class='def-Symbol'>(</span>userNameAttribute<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
558:                     index<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>;</span>
559:                     <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>index <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
560:                         sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>" where "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
561:                         whereIs <span class='def-Symbol'>=</span> <span class='def-Keyword'>true</span><span class='def-SymbolStrong def-Symbol'>;</span>
562:                     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
563:                         sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>" and "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
564:                     <span class='def-SymbolStrong def-Symbol'>}</span>
565:                     sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>' '</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>startName<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>userNameAttribute<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'='</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>getValueField<span class='def-Symbol'>(</span>field<span class='def-Symbol'>,</span> value<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
566:                 <span class='def-SymbolStrong def-Symbol'>}</span>
567:             <span class='def-SymbolStrong def-Symbol'>}</span>
568:             <span class='def-LineComment def-Comment def-Syntax'>// Добавить в SQL запрос условия выброки записей установленные пользователем</span>
569: 
570:             <span class='def-LineComment def-Comment def-Syntax'>// Добавить в SQL запрос предикаты сортировки записей</span>
571: 
572: <span class='def-LineComment def-Comment def-Syntax'>//            sql.append(" ");</span>
573: 
574:             <span class='def-LineComment def-Comment def-Syntax'>// Выполнить запрос</span>
575:             <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
576: 
577:                 <span class='def-ClassKeyword def-Keyword'>PreparedStatement</span> statement <span class='def-Symbol'>=</span> connection<span class='def-Symbol'>.</span>prepareStatement<span class='def-Symbol'>(</span>sql<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
578:                 <span class='def-ClassKeyword def-Keyword'>ResultSet</span> result <span class='def-Symbol'>=</span> statement<span class='def-Symbol'>.</span>executeQuery<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
579:                 <span class='def-TypeKeyword def-Keyword'>int</span> beginNumber <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span>page <span class='def-Symbol'>-</span> <span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>*</span> max<span class='def-SymbolStrong def-Symbol'>;</span>
580:                 <span class='def-TypeKeyword def-Keyword'>int</span> endNumber <span class='def-Symbol'>=</span> page <span class='def-Symbol'>*</span> max<span class='def-SymbolStrong def-Symbol'>;</span>
581:                 <span class='def-Keyword'>while</span> <span class='def-Symbol'>(</span>result<span class='def-Symbol'>.</span>next<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
582:                     <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>(</span>count <span class='def-Symbol'>></span><span class='def-Symbol'>=</span> beginNumber<span class='def-Symbol'>)</span> <span class='def-Symbol'>&amp;</span><span class='def-Symbol'>&amp;</span> <span class='def-Symbol'>(</span>count <span class='def-Symbol'>&lt;</span> endNumber<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
583:                         <span class='def-ClassKeyword def-Keyword'>Enumeration</span> e<span class='def-SymbolStrong def-Symbol'>;</span>
584:                         <span class='def-LineComment def-Comment def-Syntax'>// Получить значения полей записи</span>
585:                         <span class='def-ClassKeyword def-Keyword'>Hashtable</span> values <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span><span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
586:                         <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span>e <span class='def-Symbol'>=</span> sequence<span class='def-Symbol'>.</span>elements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> e<span class='def-Symbol'>.</span>hasMoreElements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> <span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
587:                             <span class='def-ClassKeyword def-Keyword'>Field</span> field <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>)</span> e<span class='def-Symbol'>.</span>nextElement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
588:                             <span class='def-ClassKeyword def-Keyword'>String</span> valueField <span class='def-Symbol'>=</span> result<span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
589:                             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>valueField <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> values<span class='def-Symbol'>.</span>put<span class='def-Symbol'>(</span>field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>,</span> valueField<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
590:                         <span class='def-SymbolStrong def-Symbol'>}</span>
591:                         <span class='def-LineComment def-Comment def-Syntax'>// Вывести запись</span>
592:                         <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> buf <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span><span class='def-String'>"&lt;tr>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
593:                         <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span>e <span class='def-Symbol'>=</span> sequence<span class='def-Symbol'>.</span>elements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>,</span> index <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>;</span> e<span class='def-Symbol'>.</span>hasMoreElements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
594:                             <span class='def-ClassKeyword def-Keyword'>Field</span> field <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>)</span> e<span class='def-Symbol'>.</span>nextElement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
595:                             <span class='def-ClassKeyword def-Keyword'>String</span> name <span class='def-Symbol'>=</span> field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
596:                             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>!</span>tableQuery<span class='def-Symbol'>.</span>isHiddenField<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span> <span class='def-Symbol'>&amp;</span><span class='def-Symbol'>&amp;</span> <span class='def-Symbol'>(</span>user<span class='def-Symbol'>.</span>getAttribute<span class='def-Symbol'>(</span>name<span class='def-Symbol'>.</span>substring<span class='def-Symbol'>(</span>startName<span class='def-Symbol'>.</span>length<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
597:                                 index<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>;</span>
598:                                 <span class='def-ClassKeyword def-Keyword'>String</span> valueField <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span>values<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span>name<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
599:                                 buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;td>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
600:                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>(</span>index <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>&amp;</span><span class='def-Symbol'>&amp;</span> insertLinks<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
601:                                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;A HREF=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
602:                                     <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> link <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span>editRecord<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&amp;action=edit"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
603:                                     <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Enumeration</span> keys <span class='def-Symbol'>=</span> tableQuery<span class='def-Symbol'>.</span>getKeys<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>elements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> keys<span class='def-Symbol'>.</span>hasMoreElements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> <span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
604:                                         <span class='def-ClassKeyword def-Keyword'>Field</span> key <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>)</span> keys<span class='def-Symbol'>.</span>nextElement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
605:                                         <span class='def-ClassKeyword def-Keyword'>String</span> valueKey <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> values<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span>key<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
606:                                         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>valueKey <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
607:                                             link<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'&amp;'</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>key<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'='</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
608:                                             <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>int</span> pos <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>;</span> pos <span class='def-Symbol'>&lt;</span> valueKey<span class='def-Symbol'>.</span>length<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> pos<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
609:                                                 <span class='def-TypeKeyword def-Keyword'>char</span> c <span class='def-Symbol'>=</span> valueKey<span class='def-Symbol'>.</span>charAt<span class='def-Symbol'>(</span>pos<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
610: <span class='def-LineComment def-Comment def-Syntax'>// если русские буквы ?</span>
611:                                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>c <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='c-Character def-Character def-String'>' '</span><span class='def-Symbol'>)</span> link<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"%20"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
612:                                                 <span class='def-Keyword'>else</span> link<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>c<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
613:                                             <span class='def-SymbolStrong def-Symbol'>}</span>
614:                                         <span class='def-SymbolStrong def-Symbol'>}</span>
615:                                     <span class='def-SymbolStrong def-Symbol'>}</span>
616:                                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>link<span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'\"'</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
617: <span class='def-LineComment def-Comment def-Syntax'>//                                    if (script != null) buf.append(' ').append("onClick=\"return doClick(\'").append(link).append("\')\"");</span>
618:                                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'>'</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
619:                                 <span class='def-SymbolStrong def-Symbol'>}</span>
620:                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>valueField <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-Keyword'>null</span><span class='def-Symbol'>)</span>
621:                                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&amp;nbsp;"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
622:                                 <span class='def-Keyword'>else</span>
623:                                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>valueField<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
624:                                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>(</span>index <span class='def-Symbol'>=</span><span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>&amp;</span><span class='def-Symbol'>&amp;</span> insertLinks<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
625:                                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/A>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
626:                                 <span class='def-SymbolStrong def-Symbol'>}</span>
627:                                 buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/td>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
628:                             <span class='def-SymbolStrong def-Symbol'>}</span>
629:                         <span class='def-SymbolStrong def-Symbol'>}</span>
630:                         buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/tr>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
631:                         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>buf<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
632:                     <span class='def-SymbolStrong def-Symbol'>}</span>
633:                     count<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>;</span>
634:                 <span class='def-SymbolStrong def-Symbol'>}</span>
635:                 result<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
636:                 statement<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
637:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
638:                 ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
639:             <span class='def-SymbolStrong def-Symbol'>}</span>
640:             <span class='def-Keyword'>try</span> <span class='def-SymbolStrong def-Symbol'>{</span>
641:                 connection<span class='def-Symbol'>.</span>close<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
642:             <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>catch</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Exception</span> e<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
643:                 ssvt<span class='def-Symbol'>.</span>log<span class='def-Symbol'>(</span>e<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
644:             <span class='def-SymbolStrong def-Symbol'>}</span>
645:         <span class='def-SymbolStrong def-Symbol'>}</span>
646:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/table>&lt;p>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
647:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/center>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
648:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"Всего записей: "</span> <span class='def-Symbol'>+</span> count <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;p>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
649:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>count <span class='def-Symbol'>></span> max<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
650:             <span class='def-TypeKeyword def-Keyword'>int</span> countPage <span class='def-Symbol'>=</span> count <span class='def-Symbol'>/</span> max<span class='def-SymbolStrong def-Symbol'>;</span>
651:             <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>count <span class='def-Symbol'>%</span> max <span class='def-Symbol'>></span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>)</span> countPage<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-SymbolStrong def-Symbol'>;</span>
652:             <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> buf <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span><span class='def-Symbol'>(</span><span class='def-String'>"Страницы: "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
653:             <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-TypeKeyword def-Keyword'>int</span> index <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>1</span><span class='def-SymbolStrong def-Symbol'>;</span> index <span class='def-Symbol'>&lt;</span><span class='def-Symbol'>=</span> countPage<span class='def-SymbolStrong def-Symbol'>;</span> index<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
654:                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>index <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> page<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
655:                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;a href=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span> <span class='def-Symbol'>+</span> uriTable <span class='def-Symbol'>+</span> <span class='def-String'>"&amp;page="</span> <span class='def-Symbol'>+</span> index <span class='def-Symbol'>+</span> <span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> 
656:                 <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
657:                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;b>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
658:                 <span class='def-SymbolStrong def-Symbol'>}</span>
659:                 buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>index<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
660:                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>index <span class='def-Symbol'>!</span><span class='def-Symbol'>=</span> page<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
661:                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/a>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
662:                 <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
663:                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/b>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
664:                 <span class='def-SymbolStrong def-Symbol'>}</span>
665:                 <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>index <span class='def-Symbol'>&lt;</span> countPage<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
666:                     buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>", "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
667:                 <span class='def-SymbolStrong def-Symbol'>}</span>
668:             <span class='def-SymbolStrong def-Symbol'>}</span>
669:             buf<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>"&lt;p>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
670:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>buf<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
671:         <span class='def-SymbolStrong def-Symbol'>}</span>
672:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>insertLinks<span class='def-Symbol'>)</span> 
673:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;a href=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span> <span class='def-Symbol'>+</span> addRecord <span class='def-Symbol'>+</span> <span class='def-String'>"&amp;action=add</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>"</span> <span class='def-Symbol'>+</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"addRecord"</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;/a>&lt;p>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
674:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/body>&lt;/html>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
675:         <span class='def-Keyword'>return</span> form<span class='def-SymbolStrong def-Symbol'>;</span>
676:     <span class='def-SymbolStrong def-Symbol'>}</span>
677: 
678:     <span class='java-KeywordModifier def-Keyword'>public</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>Vector</span> getNoAccessPage<span class='def-Symbol'>(</span>ServerSSVT ssvt<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
679:         <span class='def-ClassKeyword def-Keyword'>Vector</span> form <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>Vector</span><span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
680:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;html>&lt;head>&lt;title>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
681:         <span class='def-ClassKeyword def-Keyword'>String</span> title <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"titleNoAccessPage"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
682:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>title<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
683:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"messageNoAccessPage"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
684:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/body>&lt;/html>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
685:         <span class='def-Keyword'>return</span> form<span class='def-SymbolStrong def-Symbol'>;</span>
686:     <span class='def-SymbolStrong def-Symbol'>}</span>
687: 
688:     <span class='java-KeywordModifier def-Keyword'>private</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-TypeKeyword def-Keyword'>void</span> addKeyFieldsToSQL<span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Vector</span> keys<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>StringBuffer</span> sql<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span> attributes<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
689:         <span class='def-TypeKeyword def-Keyword'>int</span> index <span class='def-Symbol'>=</span> <span class='def-NumberDec def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>;</span>
690:         <span class='def-Keyword'>for</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Enumeration</span> e <span class='def-Symbol'>=</span> keys<span class='def-Symbol'>.</span>elements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> e<span class='def-Symbol'>.</span>hasMoreElements<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span> index<span class='def-Symbol'>+</span><span class='def-Symbol'>+</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
691:         <span class='def-ClassKeyword def-Keyword'>Field</span> field <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span><span class='def-Symbol'>)</span> e<span class='def-Symbol'>.</span>nextElement<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
692:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>index <span class='def-Symbol'>></span> <span class='def-NumberDec def-Number'>0</span><span class='def-Symbol'>)</span> sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='def-String'>" and "</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
693:             sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span><span class='c-Character def-Character def-String'>'='</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
694:             sql<span class='def-Symbol'>.</span>append<span class='def-Symbol'>(</span>getValueField<span class='def-Symbol'>(</span>field<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
695:         <span class='def-SymbolStrong def-Symbol'>}</span>
696:     <span class='def-SymbolStrong def-Symbol'>}</span>
697: 
698:     <span class='java-KeywordModifier def-Keyword'>private</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>String</span> getValueField<span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span> field<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span> attributes<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
699:         <span class='def-Keyword'>return</span> getValueField<span class='def-Symbol'>(</span>field<span class='def-Symbol'>,</span> attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span>field<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
700:     <span class='def-SymbolStrong def-Symbol'>}</span>
701: 
702:     <span class='java-KeywordModifier def-Keyword'>private</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>String</span> getValueField<span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>Field</span> field<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>Object</span> object<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
703:         <span class='def-Keyword'>switch</span> <span class='def-Symbol'>(</span>field<span class='def-Symbol'>.</span>getType<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
704:             <span class='def-Keyword'>case</span> <span class='def-NumberDec def-Number'>1</span><span class='def-Symbol'>:</span>
705:             <span class='def-Keyword'>case</span> <span class='def-NumberDec def-Number'>12</span><span class='def-Symbol'>:</span> <span class='def-Keyword'>return</span> <span class='c-Character def-Character def-String'>'\''</span> <span class='def-Symbol'>+</span> object<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'\''</span><span class='def-SymbolStrong def-Symbol'>;</span>
706:         <span class='def-SymbolStrong def-Symbol'>}</span>
707:         <span class='def-Keyword'>return</span> object<span class='def-Symbol'>.</span>toString<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
708:     <span class='def-SymbolStrong def-Symbol'>}</span>
709: 
710:     <span class='java-KeywordModifier def-Keyword'>private</span> <span class='java-KeywordModifier def-Keyword'>static</span> <span class='def-ClassKeyword def-Keyword'>Vector</span> getHtmlResultPage<span class='def-Symbol'>(</span>ServerSSVT ssvt<span class='def-Symbol'>,</span> TableQuery table<span class='def-Symbol'>,</span> HttpUser user<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>Hashtable</span> attributes<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>String</span> title<span class='def-Symbol'>,</span> <span class='def-ClassKeyword def-Keyword'>String</span> resultMessage<span class='def-Symbol'>,</span> <span class='def-TypeKeyword def-Keyword'>boolean</span> execute<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
711:         <span class='def-ClassKeyword def-Keyword'>Vector</span> form <span class='def-Symbol'>=</span> <span class='def-Keyword'>new</span> <span class='def-ClassKeyword def-Keyword'>Vector</span><span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
712:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;html>&lt;head>&lt;title>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
713:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>title<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
714:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/title>&lt;/head>&lt;body>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
715:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;center>&lt;h1>"</span> <span class='def-Symbol'>+</span> title <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;/h1>&lt;/center>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
716:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>resultMessage<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
717:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;hr>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
718:         <span class='def-Keyword'>if</span> <span class='def-Symbol'>(</span>execute<span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
719:             <span class='def-ClassKeyword def-Keyword'>String</span> tableName <span class='def-Symbol'>=</span> table<span class='def-Symbol'>.</span>getName<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
720:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"admin.reloadMessage"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
721:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;hr>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
722:             <span class='def-ClassKeyword def-Keyword'>String</span> uri <span class='def-Symbol'>=</span> <span class='def-Symbol'>(</span><span class='def-ClassKeyword def-Keyword'>String</span><span class='def-Symbol'>)</span> attributes<span class='def-Symbol'>.</span>get<span class='def-Symbol'>(</span><span class='def-String'>"uri"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
723:             <span class='def-ClassKeyword def-Keyword'>String</span> uriTable <span class='def-Symbol'>=</span> uri <span class='def-Symbol'>+</span> <span class='def-String'>"?table="</span> <span class='def-Symbol'>+</span> tableName<span class='def-SymbolStrong def-Symbol'>;</span>
724:             <span class='def-ClassKeyword def-Keyword'>String</span> addRecord <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"addRecord"</span><span class='def-Symbol'>,</span> uriTable<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
725:             <span class='def-ClassKeyword def-Keyword'>String</span> viewRecords <span class='def-Symbol'>=</span> ssvt<span class='def-Symbol'>.</span>getProperty<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"title"</span><span class='def-Symbol'>,</span> uriTable<span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
726: <span class='def-LineComment def-Comment def-Syntax'>//            String page = (String) attributes.get("page");</span>
727: <span class='def-LineComment def-Comment def-Syntax'>//            if (page != null) viewRecords = viewRecords + "&amp;page=" + page;</span>
728:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;a href=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span> <span class='def-Symbol'>+</span> addRecord <span class='def-Symbol'>+</span> <span class='def-String'>"&amp;action=add</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>"</span> <span class='def-Symbol'>+</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"addRecord"</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;/a>&lt;br>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
729:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;a href=</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>"</span> <span class='def-Symbol'>+</span> viewRecords <span class='def-Symbol'>+</span> <span class='def-String'>"</span><span class='java-StringEscape def-StringContent def-String'>\"</span><span class='def-String'>>"</span> <span class='def-Symbol'>+</span> ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span>tableName <span class='def-Symbol'>+</span> <span class='c-Character def-Character def-String'>'.'</span> <span class='def-Symbol'>+</span> <span class='def-String'>"title"</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;/a>&lt;p>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
730:         <span class='def-SymbolStrong def-Symbol'>}</span> <span class='def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
731:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"User ID: "</span> <span class='def-Symbol'>+</span> user<span class='def-Symbol'>.</span>getId<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;p>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
732:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"Time : "</span> <span class='def-Symbol'>+</span> Function<span class='def-Symbol'>.</span>getTimeLabel<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>+</span> <span class='def-String'>"&lt;p>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
733:             form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span>ssvt<span class='def-Symbol'>.</span>getStringManager<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>.</span>getString<span class='def-Symbol'>(</span><span class='def-String'>"admin.sendMessage"</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
734:         <span class='def-SymbolStrong def-Symbol'>}</span>
735:         form<span class='def-Symbol'>.</span>addElement<span class='def-Symbol'>(</span><span class='def-String'>"&lt;/body>&lt;/html>"</span><span class='def-Symbol'>)</span><span class='def-SymbolStrong def-Symbol'>;</span>
736:         <span class='def-Keyword'>return</span> form<span class='def-SymbolStrong def-Symbol'>;</span>
737:     <span class='def-SymbolStrong def-Symbol'>}</span>
738: 
739: <span class='def-SymbolStrong def-Symbol'>}</span>
