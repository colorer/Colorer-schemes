  0: <span class='def-Comment def-Syntax'>#!</span><span class='def-VarStrong def-Var'>./perl</span>
  1: 
  2: <span class='perl-Word def-Keyword'>BEGIN</span> <span class='def-SymbolStrong def-Symbol'>{</span>
  3:     <span class='perl-Word def-Keyword'>chdir</span> <span class='perl-String def-String'>'t'</span> <span class='perl-Word def-Keyword'>if</span> <span class='perl-Word def-Keyword'>-d</span> <span class='perl-String def-String'>'t'</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
  4:     <span class='perl-WordFun def-FunctionKeyword def-Keyword'>unshift</span> <span class='perl-Var def-Var'>@INC</span><span class='perl-Symb def-Symbol'>,</span> <span class='perl-String def-String'>"../lib"</span> <span class='perl-Word def-Keyword'>if</span> <span class='perl-Word def-Keyword'>-d</span> <span class='perl-String def-String'>"../lib"</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
  5:     <span class='perl-Word def-Keyword'>eval</span> <span class='def-SymbolStrong def-Symbol'>{</span><span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>@n</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-WordFun def-FunctionKeyword def-Keyword'>getpwuid</span> <span class='perl-Numb def-Number'>0</span><span class='def-SymbolStrong def-Symbol'>}</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
  6:     <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Var def-Var'>$@</span> <span class='perl-Symb def-Symbol'>&amp;</span><span class='perl-Symb def-Symbol'>&amp;</span> <span class='perl-Var def-Var'>$@</span> <span class='perl-Symb def-Symbol'>=</span><span class='perl-Symb def-Symbol'>~</span><span class='perl-String def-String'> </span><span class='perl-StringEdge regexp-SpecQuote def-StringEdge def-String'>/</span><span class='regexp-Quote regexp-MetaSymb def-Symbol'>(</span><span class='perl-String def-String'>The </span><span class='regexp-SymbClass def-Var'>\w</span><span class='regexp-MetaSymb def-Symbol'>+</span><span class='perl-String def-String'> function is unimplemented</span><span class='regexp-Quote regexp-MetaSymb def-Symbol'>)</span><span class='perl-StringEdge regexp-SpecQuote def-StringEdge def-String'>/</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
  7:     <span class='perl-Word def-Keyword'>print</span> <span class='perl-String def-String'>"</span><span class='def-NumberDec def-Number'>1</span><span class='perl-String def-String'>.</span><span class='def-NumberFloat def-Number'>.0</span><span class='perl-String def-String'> # Skip: </span><span class='perl-Var def-Var'>$1</span><span class='regexp-Symbol def-StringContent def-String'>\n</span><span class='perl-String def-String'>"</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
  8:     <span class='perl-Word def-Keyword'>exit</span> <span class='perl-Numb def-Number'>0</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
  9:     <span class='def-SymbolStrong def-Symbol'>}</span>
 10:     <span class='perl-Word def-Keyword'>eval</span> <span class='def-SymbolStrong def-Symbol'>{</span> <span class='perl-Word def-Keyword'>require</span> <span class='perl-packages perl-WordExt def-KeywordStrong def-Keyword'>Config</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span> import <span class='perl-packages perl-WordExt def-KeywordStrong def-Keyword'>Config</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span> <span class='def-SymbolStrong def-Symbol'>}</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 11:     <span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>$reason</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 12:     <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Var def-Var'>$Config</span><span class='perl-Symb def-Symbol'>{</span><span class='perl-String def-String'>'i_pwd'</span><span class='perl-Symb def-Symbol'>}</span> <span class='perl-Symb def-Symbol'>ne</span> <span class='perl-String def-String'>'define'</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 13:     <span class='perl-Var def-Var'>$reason</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-String def-String'>'$Config{i_pwd} undefined'</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 14:     <span class='def-SymbolStrong def-Symbol'>}</span>
 15:     <span class='perl-Word def-Keyword'>elsif</span> <span class='def-Symbol'>(</span><span class='perl-Symb def-Symbol'>not</span> <span class='perl-Word def-Keyword'>-f</span> <span class='perl-String def-String'>"/etc/passwd"</span> <span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span> <span class='perl-Comment def-Comment def-Syntax'># Play safe.</span>
 16:     <span class='perl-Var def-Var'>$reason</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-String def-String'>'no /etc/passwd file'</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 17:     <span class='def-SymbolStrong def-Symbol'>}</span>
 18: 
 19:     <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Symb def-Symbol'>not</span> <span class='perl-Word def-Keyword'>defined</span> <span class='perl-Var def-Var'>$where</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>    <span class='perl-Comment def-Comment def-Syntax'># Try NIS.</span>
 20:     <span class='perl-Word def-Keyword'>foreach</span> <span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>$ypcat</span> <span class='def-Symbol'>(</span><span class='perl-ReType perl-Word def-Keyword'>qw</span><span class='perl-StringEdge regexp-SpecQuote def-StringEdge def-String'>(</span><span class='perl-String def-String'>/usr/bin/ypcat /bin/ypcat /etc/ypcat</span><span class='perl-StringEdge regexp-SpecQuote def-StringEdge def-String'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 21:         <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Word def-Keyword'>-x</span> <span class='perl-Var def-Var'>$ypcat</span> <span class='perl-Symb def-Symbol'>&amp;</span><span class='perl-Symb def-Symbol'>&amp;</span>
 22:         <span class='perl-WordFun def-FunctionKeyword def-Keyword'>open</span><span class='def-Symbol'>(</span>PW<span class='perl-Symb def-Symbol'>,</span> <span class='perl-String def-String'>"</span><span class='perl-Var def-Var'>$ypcat</span><span class='perl-String def-String'> passwd </span><span class='def-NumberDec def-Number'>2</span><span class='perl-String def-String'>>/dev/null |"</span><span class='def-Symbol'>)</span> <span class='perl-Symb def-Symbol'>&amp;</span><span class='perl-Symb def-Symbol'>&amp;</span>
 23:         <span class='perl-Word def-Keyword'>defined</span><span class='def-Symbol'>(</span><span class='perl-Stream def-Path def-URI'>&lt;PW></span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 24:         <span class='perl-Var def-Var'>$where</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-String def-String'>"NIS passwd"</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 25:         <span class='perl-Word def-Keyword'>undef</span> <span class='perl-Var def-Var'>$reason</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 26:         <span class='perl-Word def-Keyword'>last</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 27:         <span class='def-SymbolStrong def-Symbol'>}</span>
 28:     <span class='def-SymbolStrong def-Symbol'>}</span>
 29:     <span class='def-SymbolStrong def-Symbol'>}</span>
 30: 
 31:     <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Symb def-Symbol'>not</span> <span class='perl-Word def-Keyword'>defined</span> <span class='perl-Var def-Var'>$where</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>    <span class='perl-Comment def-Comment def-Syntax'># Try NetInfo.</span>
 32:     <span class='perl-Word def-Keyword'>foreach</span> <span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>$nidump</span> <span class='def-Symbol'>(</span><span class='perl-ReType perl-Word def-Keyword'>qw</span><span class='perl-StringEdge regexp-SpecQuote def-StringEdge def-String'>(</span><span class='perl-String def-String'>/usr/bin/nidump</span><span class='perl-StringEdge regexp-SpecQuote def-StringEdge def-String'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 33:         <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Word def-Keyword'>-x</span> <span class='perl-Var def-Var'>$nidump</span> <span class='perl-Symb def-Symbol'>&amp;</span><span class='perl-Symb def-Symbol'>&amp;</span>
 34:         <span class='perl-WordFun def-FunctionKeyword def-Keyword'>open</span><span class='def-Symbol'>(</span>PW<span class='perl-Symb def-Symbol'>,</span> <span class='perl-String def-String'>"</span><span class='perl-Var def-Var'>$nidump</span><span class='perl-String def-String'> passwd . </span><span class='def-NumberDec def-Number'>2</span><span class='perl-String def-String'>>/dev/null |"</span><span class='def-Symbol'>)</span> <span class='perl-Symb def-Symbol'>&amp;</span><span class='perl-Symb def-Symbol'>&amp;</span>
 35:         <span class='perl-Word def-Keyword'>defined</span><span class='def-Symbol'>(</span><span class='perl-Stream def-Path def-URI'>&lt;PW></span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 36:         <span class='perl-Var def-Var'>$where</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-String def-String'>"NetInfo passwd"</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 37:         <span class='perl-Word def-Keyword'>undef</span> <span class='perl-Var def-Var'>$reason</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 38:         <span class='perl-Word def-Keyword'>last</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 39:         <span class='def-SymbolStrong def-Symbol'>}</span>
 40:     <span class='def-SymbolStrong def-Symbol'>}</span>
 41:     <span class='def-SymbolStrong def-Symbol'>}</span>
 42: 
 43:     <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Symb def-Symbol'>not</span> <span class='perl-Word def-Keyword'>defined</span> <span class='perl-Var def-Var'>$where</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>    <span class='perl-Comment def-Comment def-Syntax'># Try local.</span>
 44:     <span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>$PW</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-String def-String'>"/etc/passwd"</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 45:     <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Word def-Keyword'>-f</span> <span class='perl-Var def-Var'>$PW</span> <span class='perl-Symb def-Symbol'>&amp;</span><span class='perl-Symb def-Symbol'>&amp;</span> <span class='perl-WordFun def-FunctionKeyword def-Keyword'>open</span><span class='def-Symbol'>(</span>PW<span class='perl-Symb def-Symbol'>,</span> <span class='perl-Var def-Var'>$PW</span><span class='def-Symbol'>)</span> <span class='perl-Symb def-Symbol'>&amp;</span><span class='perl-Symb def-Symbol'>&amp;</span> <span class='perl-Word def-Keyword'>defined</span><span class='def-Symbol'>(</span><span class='perl-Stream def-Path def-URI'>&lt;PW></span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 46:         <span class='perl-Var def-Var'>$where</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-Var def-Var'>$PW</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 47:         <span class='perl-Word def-Keyword'>undef</span> <span class='perl-Var def-Var'>$reason</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 48:     <span class='def-SymbolStrong def-Symbol'>}</span>
 49:     <span class='def-SymbolStrong def-Symbol'>}</span>
 50: 
 51:     <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Var def-Var'>$reason</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>    <span class='perl-Comment def-Comment def-Syntax'># Give up.</span>
 52:     <span class='perl-Word def-Keyword'>print</span> <span class='perl-String def-String'>"</span><span class='def-NumberDec def-Number'>1</span><span class='perl-String def-String'>.</span><span class='def-NumberFloat def-Number'>.0</span><span class='perl-String def-String'> # Skip: </span><span class='perl-Var def-Var'>$reason</span><span class='regexp-Symbol def-StringContent def-String'>\n</span><span class='perl-String def-String'>"</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 53:     <span class='perl-Word def-Keyword'>exit</span> <span class='perl-Numb def-Number'>0</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 54:     <span class='def-SymbolStrong def-Symbol'>}</span>
 55: <span class='def-SymbolStrong def-Symbol'>}</span>
 56: 
 57: <span class='perl-Comment def-Comment def-Syntax'># By now PW filehandle should be open and full of juicy password entries.</span>
 58: 
 59: <span class='perl-Word def-Keyword'>print</span> <span class='perl-String def-String'>"</span><span class='def-NumberDec def-Number'>1</span><span class='perl-String def-String'>.</span><span class='def-NumberFloat def-Number'>.1</span><span class='regexp-Symbol def-StringContent def-String'>\n</span><span class='perl-String def-String'>"</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 60: 
 61: <span class='perl-Comment def-Comment def-Syntax'># Go through at most this many users.</span>
 62: <span class='perl-Comment def-Comment def-Syntax'># (note that the first entry has been read away by now)</span>
 63: <span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>$max</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-Numb def-Number'>25</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 64: 
 65: <span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>$n</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-Numb def-Number'>0</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 66: <span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>$tst</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-Numb def-Number'>1</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 67: <span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>%perfect</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 68: <span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>%seen</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 69: 
 70: <span class='perl-Word def-Keyword'>while</span> <span class='def-Symbol'>(</span><span class='perl-Stream def-Path def-URI'>&lt;PW></span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 71:     <span class='perl-WordFun def-FunctionKeyword def-Keyword'>chomp</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 72:     <span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>@s</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-Symb def-Symbol'>split</span><span class='perl-String def-String'> </span><span class='perl-StringEdge regexp-SpecQuote def-StringEdge def-String'>/</span><span class='perl-String def-String'>:</span><span class='perl-StringEdge regexp-SpecQuote def-StringEdge def-String'>/</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 73:     <span class='perl-Word def-Keyword'>my</span> <span class='def-Symbol'>(</span><span class='perl-Var def-Var'>$name_s</span><span class='perl-Symb def-Symbol'>,</span> <span class='perl-Var def-Var'>$passwd_s</span><span class='perl-Symb def-Symbol'>,</span> <span class='perl-Var def-Var'>$uid_s</span><span class='perl-Symb def-Symbol'>,</span> <span class='perl-Var def-Var'>$gid_s</span><span class='perl-Symb def-Symbol'>,</span> <span class='perl-Var def-Var'>$gcos_s</span><span class='perl-Symb def-Symbol'>,</span> <span class='perl-Var def-Var'>$home_s</span><span class='perl-Symb def-Symbol'>,</span> <span class='perl-Var def-Var'>$shell_s</span><span class='def-Symbol'>)</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-Var def-Var'>@s</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 74:     <span class='perl-Word def-Keyword'>next</span> <span class='perl-Symb def-Symbol'>if</span><span class='perl-String def-String'> </span><span class='perl-StringEdge regexp-SpecQuote def-StringEdge def-String'>/</span><span class='regexp-MetaSymb def-Symbol'>^</span><span class='regexp-Symbol def-StringContent def-String'>\+</span><span class='perl-StringEdge regexp-SpecQuote def-StringEdge def-String'>/</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span> <span class='perl-Comment def-Comment def-Syntax'># ignore NIS includes</span>
 75:     <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Var def-Var'>@s</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 76:     <span class='perl-WordFun def-FunctionKeyword def-Keyword'>push</span> <span class='perl-Var def-Var'>@</span><span class='perl-Var def-Var'>{</span> <span class='perl-Var def-Var'>$seen</span><span class='perl-Symb def-Symbol'>{</span><span class='perl-Var def-Var'>$name_s</span><span class='perl-Symb def-Symbol'>}</span> <span class='perl-Var def-Var'>}</span><span class='perl-Symb def-Symbol'>,</span> <span class='perl-Var def-Var'>$.</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 77:     <span class='def-SymbolStrong def-Symbol'>}</span> <span class='perl-Word def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 78:     <span class='perl-WordFun def-FunctionKeyword def-Keyword'>warn</span> <span class='perl-String def-String'>"# Your </span><span class='perl-Var def-Var'>$where</span><span class='perl-String def-String'> line </span><span class='perl-Var def-Var'>$.</span><span class='perl-String def-String'> is empty.</span><span class='regexp-Symbol def-StringContent def-String'>\n</span><span class='perl-String def-String'>"</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 79:     <span class='perl-Word def-Keyword'>next</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 80:     <span class='def-SymbolStrong def-Symbol'>}</span>
 81:     <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Var def-Var'>$n</span> <span class='perl-Symb def-Symbol'>=</span><span class='perl-Symb def-Symbol'>=</span> <span class='perl-Var def-Var'>$max</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 82:     <span class='perl-Word def-Keyword'>local</span> <span class='perl-Var def-Var'>$/</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 83:     <span class='perl-Word def-Keyword'>my</span> <span class='perl-Var def-Var'>$junk</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-Stream def-Path def-URI'>&lt;PW></span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 84:     <span class='perl-Word def-Keyword'>last</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 85:     <span class='def-SymbolStrong def-Symbol'>}</span>
 86:     <span class='perl-Comment def-Comment def-Syntax'># In principle we could whine if @s != 7 but do we know enough</span>
 87:     <span class='perl-Comment def-Comment def-Syntax'># of passwd file formats everywhere?</span>
 88:     <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Var def-Var'>@s</span> <span class='perl-Symb def-Symbol'>=</span><span class='perl-Symb def-Symbol'>=</span> <span class='perl-Numb def-Number'>7</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 89:     <span class='perl-Var def-Var'>@n</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-WordFun def-FunctionKeyword def-Keyword'>getpwuid</span><span class='def-Symbol'>(</span><span class='perl-Var def-Var'>$uid_s</span><span class='def-Symbol'>)</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 90:     <span class='perl-Comment def-Comment def-Syntax'># 'nobody' et al.</span>
 91:     <span class='perl-Word def-Keyword'>next</span> <span class='perl-Word def-Keyword'>unless</span> <span class='perl-Var def-Var'>@n</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 92:     <span class='perl-Word def-Keyword'>my</span> <span class='def-Symbol'>(</span><span class='perl-Var def-Var'>$name</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$passwd</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$uid</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$gid</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$quota</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$comment</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$gcos</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$home</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$shell</span><span class='def-Symbol'>)</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-Var def-Var'>@n</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 93:     <span class='perl-Comment def-Comment def-Syntax'># Protect against one-to-many and many-to-one mappings.</span>
 94:     <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Var def-Var'>$name_s</span> <span class='perl-Symb def-Symbol'>ne</span> <span class='perl-Var def-Var'>$name</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
 95:         <span class='perl-Var def-Var'>@n</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-WordFun def-FunctionKeyword def-Keyword'>getpwnam</span><span class='def-Symbol'>(</span><span class='perl-Var def-Var'>$name_s</span><span class='def-Symbol'>)</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 96:         <span class='def-Symbol'>(</span><span class='perl-Var def-Var'>$name</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$passwd</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$uid</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$gid</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$quota</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$comment</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$gcos</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$home</span><span class='perl-Symb def-Symbol'>,</span><span class='perl-Var def-Var'>$shell</span><span class='def-Symbol'>)</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-Var def-Var'>@n</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 97:         <span class='perl-Word def-Keyword'>next</span> <span class='perl-Word def-Keyword'>if</span> <span class='perl-Var def-Var'>$name_s</span> <span class='perl-Symb def-Symbol'>ne</span> <span class='perl-Var def-Var'>$name</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
 98:     <span class='def-SymbolStrong def-Symbol'>}</span>
 99:     <span class='perl-Var def-Var'>$perfect</span><span class='perl-Symb def-Symbol'>{</span><span class='perl-Var def-Var'>$name_s</span><span class='perl-Symb def-Symbol'>}</span><span class='perl-Symb def-Symbol'>+</span><span class='perl-Symb def-Symbol'>+</span>
100:         <span class='perl-Word def-Keyword'>if</span> <span class='perl-Var def-Var'>$name</span>    <span class='perl-Symb def-Symbol'>eq</span> <span class='perl-Var def-Var'>$name_s</span>    <span class='perl-Symb def-Symbol'>and</span>
101:                <span class='perl-Var def-Var'>$uid</span>     <span class='perl-Symb def-Symbol'>eq</span> <span class='perl-Var def-Var'>$uid_s</span>     <span class='perl-Symb def-Symbol'>and</span>
102: <span class='perl-Comment def-Comment def-Syntax'># Do not compare passwords: think shadow passwords.</span>
103:                <span class='perl-Var def-Var'>$gid</span>     <span class='perl-Symb def-Symbol'>eq</span> <span class='perl-Var def-Var'>$gid_s</span>     <span class='perl-Symb def-Symbol'>and</span>
104:                <span class='perl-Var def-Var'>$gcos</span>    <span class='perl-Symb def-Symbol'>eq</span> <span class='perl-Var def-Var'>$gcos_s</span>    <span class='perl-Symb def-Symbol'>and</span>
105:                <span class='perl-Var def-Var'>$home</span>    <span class='perl-Symb def-Symbol'>eq</span> <span class='perl-Var def-Var'>$home_s</span>    <span class='perl-Symb def-Symbol'>and</span>
106:                <span class='perl-Var def-Var'>$shell</span>   <span class='perl-Symb def-Symbol'>eq</span> <span class='perl-Var def-Var'>$shell_s</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
107:     <span class='def-SymbolStrong def-Symbol'>}</span>
108:     <span class='perl-Var def-Var'>$n</span><span class='perl-Symb def-Symbol'>+</span><span class='perl-Symb def-Symbol'>+</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
109: <span class='def-SymbolStrong def-Symbol'>}</span>
110: 
111: <span class='perl-Word def-Keyword'>if</span> <span class='def-Symbol'>(</span><span class='perl-Word def-Keyword'>keys</span> <span class='perl-Var def-Var'>%perfect</span> <span class='perl-Symb def-Symbol'>=</span><span class='perl-Symb def-Symbol'>=</span> <span class='perl-Numb def-Number'>0</span><span class='def-Symbol'>)</span> <span class='def-SymbolStrong def-Symbol'>{</span>
112:     <span class='perl-Var def-Var'>$max</span><span class='perl-Symb def-Symbol'>+</span><span class='perl-Symb def-Symbol'>+</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
113: <span class='def-Text'>    </span><span class='perl-Word def-Keyword'>print</span><span class='def-Text'> </span><span class='perl-HereDocLt perl-StringEdge regexp-SpecQuote def-StringEdge def-String'>&lt;&lt;</span><span class='perl-HereDocName def-Label'>EOEX</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span><span class='perl-HereDoc perl-String def-String'></span>
114: <span class='perl-HereDoc perl-String def-String'>#</span>
115: <span class='perl-HereDoc perl-String def-String'># The failure of op/pwent test is not necessarily serious.</span>
116: <span class='perl-HereDoc perl-String def-String'># It may fail due to local password administration conventions.</span>
117: <span class='perl-HereDoc perl-String def-String'># If you are for example using both NIS and local passwords,</span>
118: <span class='perl-HereDoc perl-String def-String'># test failure is possible.  Any distributed password scheme</span>
119: <span class='perl-HereDoc perl-String def-String'># can cause such failures.</span>
120: <span class='perl-HereDoc perl-String def-String'>#</span>
121: <span class='perl-HereDoc perl-String def-String'># What the pwent test is doing is that it compares the </span><span class='perl-Var def-Var'>$max</span><span class='perl-HereDoc perl-String def-String'> first</span>
122: <span class='perl-HereDoc perl-String def-String'># entries of </span><span class='perl-Var def-Var'>$where</span><span class='perl-HereDoc perl-String def-String'></span>
123: <span class='perl-HereDoc perl-String def-String'># with the results of getpwuid() and getpwnam() call.  If it finds no</span>
124: <span class='perl-HereDoc perl-String def-String'># matches at all, it suspects something is wrong.</span>
125: <span class='perl-HereDoc perl-String def-String'># </span>
126: <span class='perl-HereDocName def-Label'>EOEX</span>
127:     <span class='perl-Word def-Keyword'>print</span> <span class='perl-String def-String'>"not "</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
128:     <span class='perl-Var def-Var'>$not</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-Numb def-Number'>1</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
129: <span class='def-SymbolStrong def-Symbol'>}</span> <span class='perl-Word def-Keyword'>else</span> <span class='def-SymbolStrong def-Symbol'>{</span>
130:     <span class='perl-Var def-Var'>$not</span> <span class='perl-Symb def-Symbol'>=</span> <span class='perl-Numb def-Number'>0</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
131: <span class='def-SymbolStrong def-Symbol'>}</span>
132: <span class='perl-Word def-Keyword'>print</span> <span class='perl-String def-String'>"ok "</span><span class='perl-Symb def-Symbol'>,</span> <span class='perl-Var def-Var'>$tst</span><span class='perl-Symb def-Symbol'>+</span><span class='perl-Symb def-Symbol'>+</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
133: <span class='perl-Word def-Keyword'>print</span> <span class='perl-String def-String'>"</span><span class='regexp-Symbol def-StringContent def-String'>\t</span><span class='perl-String def-String'># (not necessarily serious: run t/op/pwent.t by itself)"</span> <span class='perl-Word def-Keyword'>if</span> <span class='perl-Var def-Var'>$not</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
134: <span class='perl-Word def-Keyword'>print</span> <span class='perl-String def-String'>"</span><span class='regexp-Symbol def-StringContent def-String'>\n</span><span class='perl-String def-String'>"</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
135: 
136: <span class='perl-WordFun def-FunctionKeyword def-Keyword'>close</span><span class='def-Symbol'>(</span>PW<span class='def-Symbol'>)</span><span class='perl-MainSymb def-SymbolStrong def-Symbol'>;</span>
137: 
